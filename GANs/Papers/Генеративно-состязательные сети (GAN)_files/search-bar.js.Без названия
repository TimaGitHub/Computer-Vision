var _document$getElementB;const searchInput=document.getElementById("header__search-bar"),resultPopup=document.getElementById("search-bar__result"),headerSearch=document.getElementById("header__search"),searchButton=document.getElementById("header__search-button"),pageCover=document.getElementById("page__cover"),searchBar=document.getElementById("search-bar"),withHeaderSearchAuthors="true"===headerSearch.dataset.authors,headerSearchAuthorsText=headerSearch.dataset.authorsText||"";let isSearchPopupShown=!1,isSearchInputActive=!1;const searchBookUrl=(null===(_document$getElementB=document.getElementById("header__controls"))||void 0===_document$getElementB?void 0:_document$getElementB.getAttribute("book-url"))||"";function debounce(e,t=300){let a;return s=>{clearTimeout(a),a=setTimeout((()=>e(s)),t)}}function setResults(e,t,a){const s=`${searchBookUrl}/search?search=${e}`;if(Array.isArray(t)&&t.length>0){const e=`<div class="search-bar__all-results-container">\n                <a href="${s}" class="search-bar__all-results-link">\n                    Все результаты\n                </a>\n            </div>\n            <ul class="search-bar__result-list" id="search-bar__result-list">\n                ${t.map((e=>`<li class="search-bar__result-item" tabindex="0" role="listitem">\n                    <a class="search-bar__result-title" href="${e.link}">\n                        ${e.title}\n                    </a>\n                    ${a&&e.authors&&e.authors.length?`<div class="search-bar__result-authors">\n                            ${headerSearchAuthorsText} ${e.authors.join(", ")}\n                        </div>`:""}\n                    <div class="search-bar__result-description">\n                        ${e.description}\n                    </div>\n                </li>`)).join("")}\n            </ul>`;resultPopup.innerHTML=e}else{const e=`<div class="search-bar__all-results-container">\n                <a href="${s}" class="search-bar__all-results-link">\n                    Все результаты\n                </a>\n            </div>`;resultPopup.innerHTML=e}}const onChangeHandler=debounce((async e=>{const t=e.target.value,a=`${searchBookUrl}/suggest?search=${t}`,s=await fetch(a);if(!s.ok)throw Error();const r=await s.json();if(!r||r.error)throw Error();setResults(t,r,withHeaderSearchAuthors),e.target.value&&(showSuggestPopup(),activateSearch())}),300);searchInput.addEventListener("input",onChangeHandler);const hideSuggestPopup=()=>{resultPopup.classList.toggle("hidden",!0),resultPopup.setAttribute("aria-expanded","false"),isSearchPopupShown=!1},showSuggestPopup=()=>{resultPopup.classList.toggle("hidden",!1),resultPopup.setAttribute("aria-expanded","true"),isSearchPopupShown=!0};searchInput.addEventListener("input",(e=>{e.target.value||hideSuggestPopup()}));const activateSearch=()=>{pageCover.classList.toggle("hidden",!1),headerSearch.classList.toggle("hidden",!1),searchButton.classList.toggle("active",!0),isSearchInputActive=!0},deactivateSearch=()=>{pageCover.classList.toggle("hidden",!0),headerSearch.classList.toggle("hidden",!0),searchButton.classList.toggle("active",!1),isSearchInputActive=!1};searchInput.addEventListener("focus",(e=>{searchBar.classList.toggle("active",!0),e.target.value?(showSuggestPopup(),activateSearch()):hideSuggestPopup()})),headerSearch.addEventListener("blur",(()=>{searchBar.classList.toggle("active",!1),searchInput.value="",hideSuggestPopup()})),document.addEventListener("click",(e=>{e.target instanceof Node&&!headerSearch.contains(e.target)&&(searchInput.value="",isSearchPopupShown&&hideSuggestPopup(),isSearchInputActive&&deactivateSearch())})),searchButton.addEventListener("click",(()=>{headerSearch.classList.toggle("hidden"),searchButton.classList.toggle("active"),pageCover.classList.toggle("hidden")})),pageCover.addEventListener("click",(()=>{deactivateSearch()}));