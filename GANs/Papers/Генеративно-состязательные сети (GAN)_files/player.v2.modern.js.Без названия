/*! For license information please see player.v2.modern.js.LICENSE.txt */
(()=>{function e(i){var n=r[i];if(void 0!==n)return n.exports;var s=r[i]={id:i,exports:{}};return t[i].call(s.exports,s,s.exports,e),s.exports}var t={7050:(e,t,r)=>{function i(e){var t=n(e);return r(t)}function n(e){if(!r.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}var s={"./be.ts":5506,"./en.ts":7520,"./id.ts":823,"./kk.ts":2987,"./ru.ts":4072,"./tr.ts":1578,"./tt.ts":4606,"./uk.ts":2468,"./uz.ts":6185};i.keys=function(){return Object.keys(s)},i.resolve=n,e.exports=i,i.id=7050},4661:(e,t,r)=>{(t=e.exports=r(870)(!1)).push([e.id,"._1gZJUfw{user-select:none;-webkit-user-select:none;-webkit-tap-highlight-color:transparent;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;position:relative;background:#000;background-position:center;background-size:contain;background-repeat:no-repeat;width:100%;height:100%;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;overflow:hidden;text-align:left;outline:0}._2jlIyxK{width:100%;height:100%;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;overflow:hidden;user-select:none;text-align:left;outline:0;position:absolute;top:0;left:0;pointer-events:none;background:0 0}._1gZJUfw ._17DR8Wz{display:none!important}._1gZJUfw>.KNlHF8r{position:absolute;width:100%;height:100%;border:0}._1gZJUfw .xDBHr4L{position:absolute;width:100%;height:100%;pointer-events:none}._1gZJUfw video{width:100%;height:100%}._1gZJUfw video::-webkit-media-controls-start-playback-button{z-index:2147483647!important}._1gZJUfw video._33stY3F::-webkit-media-controls-start-playback-button{display:none!important}._1CaeSWZ{object-fit:cover!important}",""]),t.locals={StreamPlayer:"_1gZJUfw",StreamPlayer_ui:"_2jlIyxK",hidden:"_17DR8Wz",container:"KNlHF8r",adSkin:"xDBHr4L","hide-native-play-button":"_33stY3F",StreamPlayer_iosLandscapeWorkaround:"_1CaeSWZ"}},8024:(e,t,r)=>{var i=r(3379),n=r(866);"string"===typeof(n=n.__esModule?n.default:n)&&(n=[[e.id,n,""]]);var s={injectType:"singletonStyleTag",attributes:{"data-ya-player-style":"data-ya-player-style"},insert:"head",singleton:!0};i(n,s);e.exports=n.locals||{}},3379:(e,t,r)=>{"use strict";function i(e){for(var t=-1,r=0;r<p.length;r++)if(p[r].identifier===e){t=r;break}return t}function n(e,t){for(var r={},n=[],s=0;s<e.length;s++){var a=e[s],o=t.base?a[0]+t.base:a[0],d=r[o]||0,c="".concat(o," ").concat(d);r[o]=d+1;var u=i(c),h={css:a[1],media:a[2],sourceMap:a[3]};-1!==u?(p[u].references++,p[u].updater(h)):p.push({identifier:c,updater:l(h,t),references:1}),n.push(c)}return n}function s(e){var t=document.createElement("style"),i=e.attributes||{};if("undefined"===typeof i.nonce){var n=r.nc;n&&(i.nonce=n)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"===typeof e.insert)e.insert(t);else{var s=h(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}function a(e,t,r,i){var n=r?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=f(t,n);else{var s=document.createTextNode(n),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(s,a[t]):e.appendChild(s)}}function o(e,t,r){var i=r.css,n=r.media,s=r.sourceMap;if(n?e.setAttribute("media",n):e.removeAttribute("media"),s&&"undefined"!==typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function l(e,t){var r,i,n;if(t.singleton){var l=g++;r=m||(m=s(t)),i=a.bind(null,r,l,!1),n=a.bind(null,r,l,!0)}else r=s(t),i=o.bind(null,r,t),n=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(r)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else n()}}var d,c,u=function(){return"undefined"===typeof d&&(d=Boolean(window&&document&&document.all&&!window.atob)),d},h=function(){var e={};return function(t){if("undefined"===typeof e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(i){r=null}e[t]=r}return e[t]}}(),p=[],f=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")}),m=null,g=0;e.exports=function(e,t){(t=t||{}).singleton||"boolean"===typeof t.singleton||(t.singleton=u());var r=n(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var s=0;s<r.length;s++){var a=i(r[s]);p[a].references--}for(var o=n(e,t),l=0;l<r.length;l++){var d=i(r[l]);0===p[d].references&&(p[d].updater(),p.splice(d,1))}r=o}}}},5506:(e,t,r)=>{"use strict";r.r(t),r.d(t,{be:()=>i});const i={TRACK_AUTO:"\u0410\u045e\u0442\u0430"}},7520:(e,t,r)=>{"use strict";r.r(t),r.d(t,{en:()=>i});const i={TRACK_AUTO:"Auto"}},823:(e,t,r)=>{"use strict";r.r(t),r.d(t,{id:()=>i});const i={TRACK_AUTO:"Otomatis"}},2987:(e,t,r)=>{"use strict";r.r(t),r.d(t,{kk:()=>i});const i={TRACK_AUTO:"\u0410\u0432\u0442\u043e"}},4072:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ru:()=>i});const i={TRACK_AUTO:"\u0410\u0432\u0442\u043e"}},1578:(e,t,r)=>{"use strict";r.r(t),r.d(t,{tr:()=>i});const i={TRACK_AUTO:"Oto"}},4606:(e,t,r)=>{"use strict";r.r(t),r.d(t,{tt:()=>i});const i={TRACK_AUTO:"\u0410\u0432\u0442\u043e"}},2468:(e,t,r)=>{"use strict";r.r(t),r.d(t,{uk:()=>i});const i={TRACK_AUTO:"\u0410\u0432\u0442\u043e"}},6185:(e,t,r)=>{"use strict";r.r(t),r.d(t,{uz:()=>i});const i={TRACK_AUTO:"Avto"}},9525:(e,t,r)=>{"use strict";function i(){return"object"===typeof self?self:window}r.d(t,{I:()=>i})},3354:(e,t,r)=>{"use strict";r.d(t,{M:()=>a});const i=!(0,r(2839).t)(Math.random)||Math.random()===Math.random();var n=r(3451);let s=(0,n.m6)()*(0,n.no)()%2147483647;const a=i?function(){return s=16807*s%2147483647,(s-1)/2147483646}:function(){return Math.random()}},9396:(e,t,r)=>{"use strict";r.d(t,{t:()=>n});var i=r(2741);const n={getItem(e){try{return i.ZP.getItem(e)}catch(t){return null}},setItem(e,t){try{i.ZP.setItem(e,t)}catch(r){}},removeItem(e){try{i.ZP.removeItem(e)}catch(t){}},clear(){try{i.ZP.clear()}catch(e){}}}},3451:(e,t,r)=>{"use strict";function i(e){return"function"===typeof e||"Function"===(e=>{const t=n.call(e);if(!t)return null;const r=t.match(s);if(!r)return null;const i=r[1];if(!i)return null;return i})(e)}r.d(t,{m6:()=>a,no:()=>h});const n={}.toString,s=/\[object (\w+)\]/,a=Date&&i(Date.now)?()=>Date.now():()=>(new Date).getTime(),o="undefined"===typeof window?void 0:window.performance,l=o&&i(o.now),d=o&&o.timing&&o.timing.navigationStart,c=o&&o.timeOrigin?o.timeOrigin:d?o.timing.navigationStart:a();let u=0;const h=l?()=>o.now():()=>(()=>{const e=a()-c;return u=Math.max(e,u),u})()},2839:(e,t,r)=>{"use strict";function i(e,t){if(void 0===t&&(t=!1),!e)return!1;const r=t?Function.prototype.toString.call(e):e.toString?e.toString():"";return/\[native code\]/.test(r)||/\/\* source code not available \*\//.test(r)}r.d(t,{t:()=>i})},1247:(e,t,r)=>{"use strict";function i(e){void 0===e&&(e=window);try{return(e.navigator||{}).userAgent||""}catch(t){return""}}r.d(t,{i:()=>i})},2988:(e,t,r)=>{"use strict";r.d(t,{N:()=>n});const i=r(6386),n=function(e){void 0===e&&(e=window);const t=i(e);return"boolean"===typeof t?-1:t}},5776:(e,t,r)=>{"use strict";r.d(t,{y:()=>n});var i=r(1247);const n=function(e){void 0===e&&(e=window);return(0,i.i)(e).includes("Tizen")}},9201:(e,t,r)=>{"use strict";r.d(t,{b:()=>i});const i=(0,r(5940).b)()},5940:(e,t,r)=>{"use strict";function i(e){return function(e){return Boolean(e.PointerEvent)}(e)&&function(e){const t=e.navigator||{},{msMaxTouchPoints:r,maxTouchPoints:i}=t;return r||i||0}(e)>0&&!function(e){void 0===e&&(e=window);return(0,a.N)(e)>11}(e)}function n(e,t){if(!(0,l.m)(e.matchMedia))return!1;const r=e.matchMedia(t);return(0,d.K)(r)&&Boolean(r.matches)}function s(e){return void 0===e&&(e=window),i(e)||function(e){return n(e,c)}(e)||function(e){return n(e,u)}(e)||function(e){const{DocumentTouch:t}=e;return Boolean(t)&&e.document instanceof t}(e)||function(e){return"ontouchstart"in e}(e)}r.d(t,{b:()=>s});var a=r(2988);const o=["","-webkit-","-ms-","-moz-","-o-"];var l=r(4754),d=r(5689);const c=o.map(e=>"("+e+"any-pointer:coarse)").join(","),u=o.map(e=>"("+e+"touch-enabled)").join(",")},9881:(e,t,r)=>{"use strict";r.d(t,{F:()=>n});var i=r(1247);const n=function(e){void 0===e&&(e=window);const t=(0,i.i)(e);return t.includes("VIDAA")||t.includes("Hisense")}},6223:(e,t,r)=>{"use strict";r.d(t,{V:()=>n});var i=r(1247);const n=function(e){void 0===e&&(e=window);return(0,i.i)(e).includes("Web0S")}},4651:(e,t,r)=>{"use strict";let i;r.d(t,{Z:()=>i}),function(e){e.LIVE="LIVE",e.EVENT="EVENT",e.VOD="VOD"}(i||(i={}))},1771:(e,t,r)=>{"use strict";r.d(t,{j:()=>i});const i=new RegExp("^https?:\\/\\/([^\\/]+\\.)?("+["(an|strm)\\.yandex\\.(ru|net)","yastatic\\.net","strm-ott\\.akamaized\\.net","cdn\\.ngenix\\.net","strm\\.yandex\\.cdnga\\.net","strm-yandex\\.gcdn\\.co","(widevine|playready|fairplay)-proxy\\.ott\\.yandex\\.ru","drm\\.yandex-team\\.ru"].join("|")+")\\/(?!log|perf|jstracer)")},7333:(e,t,r)=>{"use strict";r.d(t,{p:()=>s});r(7881);var i=r(2127),n=r(371);class s{constructor(){this.lastUpdate=void 0,this.watchedTime=0}calc(e,t,r){if(void 0!==this.lastUpdate){const r=(e-this.lastUpdate.videoTime)/t,n=(0,i.G)(r,this.lastUpdate.getElapsedTime()/1e3);this.watchedTime=this.watchedTime+n}this.lastUpdate=r?{getElapsedTime:(0,n.u)(),videoTime:e}:void 0}get(){return this.watchedTime}restoreLastUpdate(){this.lastUpdate=void 0}}},2127:(e,t,r)=>{"use strict";function i(e,t){const r=e>=0&&e<=t+.5?e:t;return Math.max(0,r)}r.d(t,{G:()=>i});r(7881)},9761:(e,t,r)=>{"use strict";function i(e){let t="";for(let r=0;r<e;r++)t+=(16*(0,n.M)()|0).toString(16);return t}r.d(t,{a:()=>i});var n=r(3354)},9951:(e,t,r)=>{"use strict";r.d(t,{M:()=>s});const i={}.toString,n=/\[object (\w+)\]/,s=e=>{const t=i.call(e);if(!t)return null;const r=t.match(n);if(!r)return null;const s=r[1];return s||null}},371:(e,t,r)=>{"use strict";function i(e){void 0===e&&(e=n.no);const t=e();return()=>Math.max(0,e()-t)}r.d(t,{u:()=>i});r(7881);var n=r(3451)},3487:(e,t,r)=>{"use strict";function i(){}r.d(t,{Z:()=>i})},4364:(e,t,r)=>{"use strict";function i(e){setTimeout(()=>{throw e},0)}r.d(t,{L:()=>i})},4118:(e,t,r)=>{"use strict";function i(e,t){try{return e()}catch(r){"function"===typeof t&&t(r)}}r.d(t,{Y:()=>i})},4309:(e,t,r)=>{"use strict";r.d(t,{M:()=>s});const i={}.toString,n=/\[object (\w+)\]/,s=e=>{const t=i.call(e);if(!t)return null;const r=t.match(n);if(!r)return null;const s=r[1];return s||null}},8584:(e,t,r)=>{"use strict";function i(e){return"function"===typeof e||"Function"===(0,n.M)(e)}r.d(t,{no:()=>u});var n=r(4309);const s=Date&&i(Date.now)?()=>Date.now():()=>(new Date).getTime(),a="undefined"===typeof window?void 0:window.performance,o=a&&i(a.now),l=a&&a.timing&&a.timing.navigationStart,d=a&&a.timeOrigin?a.timeOrigin:l?a.timing.navigationStart:s();let c=0;const u=o?()=>a.now():()=>(()=>{const e=s()-d;return c=Math.max(e,c),c})()},4513:(e,t,r)=>{"use strict";r.d(t,{M:()=>n});var i=r(9329);class n extends i.v{destroy(){this.emit("Destroy"),this.off("Destroy"),Object.keys(this.handlers).forEach(e=>{this.off(e)}),Object.keys(this.onceHandlers).forEach(e=>{this.off(e)})}}},3942:(e,t,r)=>{"use strict";r.d(t,{R:()=>i});r(7881);const i=e=>null===e?1/0:void 0===e?1280:e},7550:(e,t,r)=>{"use strict";function i(){return s}r.d(t,{r:()=>i});const n=(0,r(9525).I)();n.Ya||(n.Ya={}),n.Ya.streamPlayer||(n.Ya.streamPlayer={}),n.Ya.streamPlayer.exp||(n.Ya.streamPlayer.exp={});const s=n.Ya.streamPlayer.exp;s.flags||(s.flags={})},2178:(e,t,r)=>{"use strict";function i(e){if(S.flagsInited)return;S.flagsInited=!0,function(){var e;const t=null==(e=g())?void 0:e.vpuid;if(!t)return;const r=(()=>{try{var e;return null==(e=v.localStorage)?void 0:e.getItem("vpuid")}catch(t){return null}})();if(!r||r!==t)try{var i;null==(i=v.localStorage)||i.setItem("vpuid",String(t))}catch(n){}}();const{flags:t,slots:r,testids:i}=g()||{};(0,E.K)(t)&&(0,m.Y)(()=>{(0,y.M)(t,(e,t)=>{S.flags[t]=String(e)})}),S.slots=void 0!==r?String(r):void 0,S.testids=Array.isArray(i)?i.join(","):void 0!==i?String(i):void 0,(0,E.K)(e)&&(0,E.K)(e.flags)&&(0,m.Y)(()=>{(0,y.M)(e.flags,(e,t)=>{S.flags[t]=String(e)})})}function n(e){(0,E.K)(e)&&(0,m.Y)(()=>{i({flags:JSON.parse(e.flags)})})}function s(){return u(),T.flags||{}}function a(e){return u(e),T.flags[e]}function o(e){return"true"===e||"1"===e||"false"!==e&&"0"!==e&&void 0}function l(e){const t=o(a(e));if("undefined"===typeof t){return o(A[e])}return t}function d(e){if("undefined"===typeof e)return;const t=parseFloat(e);return(0,h.z)(t)?t:void 0}function c(e){const t=d(a(e));if("undefined"===typeof t){return d(A[e])}return t}function u(e){if(T.flagsInited)return;const t=new Error(e?"Unexpected usage of player's flag "+e+" before any flag configuration":"Unexpected usage of player's getFlagsJson before any flag configuration");setTimeout(()=>{throw t})}r.d(t,{Vc:()=>i,ZP:()=>n,RW:()=>l,r0:()=>a,qm:()=>s,jS:()=>c});var h=r(7989),p=r(7550);var f=r(1153),m=r(8712);const g=(0,f.I)((function(){return(0,m.Y)(()=>{const{flags:e,testids:t,slots:r,vpuid:i}=JSON.parse("__UAAS_CONFIG_INLINE__");return{flags:e,testids:t,slots:r,vpuid:i}})||void 0})),v="object"===typeof self?self:window;var y=r(7974),E=r(5689);const S=(0,p.r)(),A={web_add_m4s_segments_for_safari:"false",web_add_mms_ios:"false",web_debug_log_calls:"false",web_debug_log_events:"false",web_debug_log_internals:"false",web_debug_panel:"false",web_forbid_allow_muted_autoplay:"false",web_ignore_render_stalled:"true",web_ios_landscape_fix:"true",web_preload_while_drm_init:"false",web_screen_wake_lock:"false",web_send_end_after_pause:"false",web_true_stored_bandwidth:"false",web_userquality_ttl:"false",web_watched_time_in_telemetry_package:"false",web_yasp_enable_network_traces:"false",web_yasp_enable_worker:"true",web_yasp_object_fit_in_resolution_rule:"false",web_yasp_screenshot_capturing:"false",web_yasp_static_timeout_for_low_latency:"true",web_yasp_target_latency_debug:"-1",web_yasp_target_latency_updater:"false",web_yasp_time_to_start:"null",yasp_decrease_mse_buffer_on_allocation_error:"false",yasp_decrease_mse_buffer_on_quota_exceeded_error:"false",yasp_decrease_virtual_buffer_on_allocation_error:"false",yasp_enable_for_ad:"true",yasp_no_source_abort_on_fake_seek:"false",yasp_share_worker:"false",yasp_share_worker_no_real_destroy:"false"},T=(0,p.r)()},7369:(e,t,r)=>{"use strict";function i(e){return"string"===typeof e?e.split(";"):[]}var n=r(9201),s=r(1247),a=r(5357),o=r(4519);const l=Math.random()<=.05;!function(){const e=window;if(!e.Ya||!e.Ya.Rum){r(7323),r(8058),r(7790),r(4491),r(1917),r(6260),r(2927),r(6212);try{const e={project:"video-player-iframe-api",env:"production",platform:n.b?"touch":"desktop",version:"1.0-11679".replace("1.0-",""),from:"unknown"},t=location.hash.indexOf("#",1),r=location.hash.substr(1,-1===t?location.hash.length:t).split("&");for(let i=0;i<r.length;i++){const t=r[i].split("=");e[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}(e=>{const{project:t,env:r,platform:s,version:l,from:d,from_block:c,reqid:u,vsid:h}=e;(0,o.I8)({vsid:h,from_block:c}),window.Ya.Rum.init({sendClientUa:!0,sendUrlInResTiming:!0,sendFirstRaf:!0,beacon:!0,clck:"https://yandex.ru/clck/click",slots:i(e.slots),crossOrigin:"",reqid:u||h,longTaskMetric:!0,maxLongTaskCounters:1/0},{"-project":t,"-version":l,"-env":r,"-platform":s,"-service":d,"-page":"stream-player/main",143:n.b?"28.3413.584.64":"28.3413.2048.64","-blocker":a.I?1:void 0,"-additional":decodeURIComponent((0,o.B6)())})})(e),(e=>{const{project:t,env:r,platform:n,version:d,from:c,slots:u,reqid:h,vsid:p}=e;window.Ya.Rum.initErrors({project:t,env:r,platform:n,version:d,slots:i(u),unhandledRejection:!0,traceUnhandledRejection:l,debug:!1,reqid:h||p,service:c,page:"stream-player/main",blocker:a.I?1:void 0,additional:(0,o.Vk)(),filters:{message:{0:/window\.webkit\.messageHandlers/,1:/Unhandled\srejection:\sFetch\sis\saborted/}},transform:e=>("touch"!==n||"script"!==e.type||!(0,s.i)().includes("; wv"))&&e})})(e)}catch(t){}}}()},123:(e,t,r)=>{"use strict";r.d(t,{g:()=>i});const i="source_index"},9047:(e,t,r)=>{"use strict";function i(e){const t=e.document;let r=t.getElementsByTagName("head")[0];return r||(r=t.createElement("head"),t.documentElement.appendChild(r)),r}function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function s(e){const{dropCacheOnRetry:t=!1,onBeforeLoad:r=es,retries:s=0}=e;if(e.checkLoad&&e.checkLoad())return void(e.onLoad&&e.onLoad());let a=r,o=0;return t&&s>0&&(a=e=>{if(r(e),o>0){const t=-1===e.src.indexOf("?")?"?":"&",r=function(e){const t=1e9;let r=Math.floor(Math.random()*t)%t;return Number.isFinite(r)||(r=0),r+=Date.now()%t,String(e)+r.toString(36)}(o);e.src+=t+r}o++}),function e(t){const{src:r,win:s=window,charset:a="utf-8",async:o=!0,retries:l=0,onRetry:d=es,retryDelay:c=0,checkLoad:u=ts,onBeforeLoad:h=es,onLoad:p=es,onError:f=es}=t,m=s.document.createElement("script"),g=i=>{var s;l>0?(d(i),e(n({},t,{src:r,retries:l-1}))):f(i),null==(s=m.parentNode)||s.removeChild(m)};m.type="text/javascript",m.async=o,m.onload=()=>u(m)?p():g(new Error("checkLoad for "+r+" failed")),m.onerror=e=>{try{s.setTimeout(()=>{g(e)},c)}catch(t){}},m.src=r,m.charset=a,h(m),i(s).appendChild(m)}(n({},e,{onBeforeLoad:a}))}function a(){return(a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function l(e){const{win:t=window,src:r,retries:i=0,onLoad:n=$n.Z,onError:l=$n.Z}=e,d=new Xn.s({id:"LOAD_SCRIPT_ERROR",message:"Failed to load script ["+r+"]",details:{src:r,isSelfWindow:t===window,onBeforeLoad:Boolean(e.onBeforeLoad),retries:i}});(function(e){return new Promise((t,r)=>{s(a({},e,{onLoad:t,onError:r}))})})(o({},e,{win:t})).then(n).catch(()=>l(d))}function d(e){if(e&&e.location){const{location:t}=e;return"function"===typeof t.toString?t.toString():t.href||""}return""}function c(e){return[...e.hash.substr(1).split("&"),...e.search.substr(1).split("&")].reduce((e,t)=>{const[r,i]=t.split("=");return void 0!==i&&(e[r]=decodeURIComponent(i.replace(/\+/g," "))),e},{})}function u(e){if(void 0===e)return ds.q.DEFAULT;const t=function(e){switch(e){case cs.DEFAULT_ERROR:return ds.q.DEFAULT;case cs.BROADCAST_AD_BLOCK_INIT_ERROR:case cs.AD_TYPE_IS_NOT_RECOGNIZED:case cs.AD_IS_ALREADY_PLAYING:case cs.MULTIROLL_INIT_ERROR:case cs.PLAY_AD_VIEWERS_ERROR:return ds.q.ADS;case cs.INVALID_METADATA:case cs.NO_STREAMS:case cs.INVALID_STREAM_URL:case cs.NO_DRM_CONFIG:return ds.q.CONFIG;case cs.YANDEX_RPC_ERROR:case cs.ON_TICK_ERROR:case cs.SAGA_ERROR:case cs.NO_HLS_JS_INSTANCE:case cs.REACT_COMPONENT_DID_CATCH_ERROR_INFO:case cs.RECOVER_TASK_ERROR:case cs.PRELOAD_SOURCE_FAILED:case cs.MEDIA_ERR_ABORTED:return ds.q.EXCEPTION;case cs.UNSUPPORTED_MEDIA_TYPE:case cs.NATIVE_HLS_NOT_SUPPORTED_ERROR:case cs.HLS_JS_NOT_SUPPORTED_ERROR:case cs.MEDIA_ERR_SRC_NOT_SUPPORTED:case cs.MEDIA_ERR_CUSTOM:case cs.MEDIA_ERR_DECODE:case cs.REPRESENTATION_CHANGE:return ds.q.MEDIA;case cs.SCRIPT_INIT_ERROR:case cs.META_INFO_REQUEST_FAILED:case cs.STRM_ABD_INVALID_RESPONSE:case cs.MANIFEST_NOT_FOUND:return ds.q.NETWORK_PLAYER;case cs.MEDIA_ERR_NETWORK:return ds.q.NETWORK_MEDIA;case cs.MPD_WIDEVINE_CERT_LOAD_ERROR:case cs.FAIRPLAY_CERT_LOAD_ERROR:case cs.FAIRPLAY_CREATE_MEDIA_KEYS_ERROR:case cs.FAIRPLAY_CREATE_KEY_SESSION_ERROR:case cs.FAIRPLAY_SPC_LOAD_ERROR:case cs.FAIRPLAY_CREATE_KEY_ERROR:case cs.FAIRPLAY_INVALID_CONTENT_ID:case cs.DRM_PROXY_ERROR:case cs.DRM_PROXY_ERROR_NEED_COOKIE:case cs.DRM_PROXY_ERROR_NEED_TEAM_LOGIN:case cs.DRM_PROXY_ERROR_NEED_VIEW_PERMISSION:case cs.DRM_PROXY_ERROR_SIGNATURE_EXPIRED:case cs.MEDIA_ERR_ENCRYPTED:case cs.FAIRPLAY_NOT_SUPPORTED:case cs.NO_DRM:case cs.DRM_INIT_ERROR:case cs.DRM_NO_INIT_DATA:case cs.DRM_CERT_LOAD_ERROR:case cs.DRM_NO_SUPPORTED_KEY_SYSTEM:case cs.DRM_FAILED_TO_CREATE_CDM:case cs.DRM_FAILED_TO_SET_MEDIA_KEYS:case cs.DRM_NO_LICENSE_SERVER:case cs.DRM_FAILED_TO_CREATE_SESSION:case cs.DRM_SESSION_ERROR:case cs.DRM_FAILED_TO_GENERATE_REQUEST:case cs.DRM_UNKNOWN_ERROR:return ds.q.DRM;case cs.REGIONAL_LIMITATION_MANIFEST:case cs.REGIONAL_LIMITATION_LEVEL:case cs.REGIONAL_LIMITATION_SEGMENT:return ds.q.REGIONAL;case cs.SIGNATURE_EXPIRED_MANIFEST:case cs.SIGNATURE_EXPIRED_LEVEL:case cs.SIGNATURE_EXPIRED_SEGMENT:return ds.q.ACCESS;case cs.BANNED_MANIFEST:case cs.BANNED_LEVEL:case cs.BANNED_SEGMENT:return ds.q.BANNED;case cs.NO_CODECS:return ds.q.NO_CODECS;case cs.NO_PLAYABLE_STREAMS:return ds.q.CANNOT_PLAY;case cs.NO_MSE:return ds.q.UNSUPPORTED_ENV}return ds.q.DEFAULT}(e);if(t!==ds.q.DEFAULT)return t;switch(e){case us.BUFFER_FULL_ERROR:case us.BUFFER_NUDGE_ON_STALL:case us.BUFFER_STALLED_ERROR:case us.FRAG_PARSING_ERROR:case us.BUFFER_SEEK_OVER_HOLE:case us.BUFFER_APPENDING_ERROR:case us.PIPELINE_ERROR_DECODE:case us.DECODER_ERROR_NOT_SUPPORTED:case us.BUFFER_APPEND_ERROR:case us.MEDIA_ELEMENT_ERROR_FORMAT_ERROR:case us.REMUX_ALLOC_ERROR:case us.BUFFER_ADD_CODEC_ERROR:case us.DEMUXER_ERROR_COULD_NOT_OPEN:case us.NS_ERROR_DOM_INVALID_STATE_ERR:case us.CHUNK_DEMUXER_ERROR_APPEND_FAILED:case us.FAILED_TO_INIT_DECODER:case us.PIPELINE_ERROR_INITIALIZATION_FAILED:case us.NS_ERROR_FAILURE:case us.REQUEST_FAILED:case us.PIPELINE_ERROR_EXTERNAL_RENDERER_FAILED:case us.PIPELINE_ERROR_COULD_NOT_RENDER:case us.NS_ERROR_DOM_MEDIA_METADATA_ERR:case us.MEDIA_ELEMENT_ERROR_EMPTY_SRC_ATTRIBUTE:case us.NS_ERROR_DOM_MEDIA_FATAL_ERR:case us.MANIFEST_PARSING_ERROR:return ds.q.MEDIA;case us.FRAG_LOAD_ERROR:case us.MANIFEST_LOAD_ERROR:case us.LEVEL_LOAD_ERROR:case us.AUDIO_TRACK_LOAD_ERROR:return ds.q.NETWORK_MEDIA;case us.FRAG_LOAD_TIME_OUT:case us.MANIFEST_LOAD_TIME_OUT:case us.LEVEL_LOAD_TIME_OUT:case us.AUDIO_TRACK_LOAD_TIME_OUT:return ds.q.NETWORK_TIMEOUT;case us.INTERNAL_EXCEPTION:case us.ON_PLAYER_INIT_ERROR_INTERNAL:case us.EXTERNAL_POST_MESSENGER_SEND_MESSAGE_ERROR:case us.INTERNAL_POST_MESSENGER_SEND_MESSAGE_ERROR:case us.LOAD_SKIN_ERROR:case us.INSERT_INTO_WITH_SECURE_FRAME:case us.PLAY_AD_VIEWERS_WITH_SECURE_FRAME:case us.ERROR_SCREEN_LOAD_ERROR:return ds.q.EXCEPTION;case us.UNABLE_TO_LOAD_PLAYER_IFRAME:case us.ON_PLAYER_INIT_ERROR:case us.LOADER_INIT_ERROR:case us.UNABLE_TO_LOAD_PLAYER_INTERNAL_SCRIPT:case us.FAILED_TO_DOWNLOAD_DEBUG_INFO:case us.REQUEST_SOURCE_ERROR:return ds.q.NETWORK_PLAYER;case us.PLAYER_CONTAINER_NOT_FOUND:case us.KEY_LOAD_ERROR:case us.FEATURE_HANDLER_ERROR:case us.INVALID_CONFIG_ELEMENT_IN_CREATE_PLAYER:case us.INVALID_CONFIG_LANG_IN_CREATE_PLAYER:case us.INVALID_CONFIG_IN_CREATE_PLAYER:case us.INVALID_CONFIG_IN_SET_SOURCE:case us.INVALID_CONFIG_IN_SOURCE_UPDATE:case us.IFRAME_DOES_NOT_ALLOW_DRM:case us.DRM_IS_NOT_ALLOWED:case us.ELEMENT_NOT_IN_DOM:case us.INVALID_LOG_URL:case us.SCREEN_WAKE_LOCK_ERROR:return ds.q.CONFIG}return ds.q.DEFAULT}function h(e,t){void 0===t&&(t=!1);const r=e.code;if(r===cs.NO_CODECS&&os&&ls>6)return{title:"NO_CODECS_TITLE",message:"NO_CODECS_MESSAGE",helpLink:"https://yandex.ru/support/video-player/player-issues.html#no-codecs",helpLinkButtonText:"NO_CODECS_HELP_LINK_TITLE"};if(r===cs.DRM_PROXY_ERROR_NEED_COOKIE)return{title:"NEED_COOKIE_TITLE",message:"NEED_COOKIE_MESSAGE",helpLink:e.helpLink||void 0,helpLinkButtonText:"NEED_COOKIE_HELP_LINK_TITLE"};if(r===cs.DRM_PROXY_ERROR_NEED_TEAM_LOGIN)return{title:"NEED_TEAM_LOGIN_TITLE",message:"NEED_TEAM_LOGIN_MESSAGE",helpLink:e.helpLink||void 0,helpLinkButtonText:"NEED_TEAM_LOGIN_HELP_LINK_TITLE"};if(r===cs.DRM_PROXY_ERROR_NEED_VIEW_PERMISSION)return{title:"NEED_VIEW_PERMISSION_TITLE",message:"NEED_VIEW_PERMISSION_MESSAGE",helpLink:e.helpLink||void 0,helpLinkButtonText:"NEED_VIEW_PERMISSION_HELP_LINK_TITLE"};const i=u(r);return t&&function(e){return[ds.q.NETWORK_PLAYER,ds.q.NETWORK_MEDIA,ds.q.NETWORK_TIMEOUT,ds.q.DRM,ds.q.ADS].indexOf(e)>-1}(i)?{title:"ADBLOCK_DETECTED_TITLE",message:"ADBLOCK_DETECTED_MESSAGE",helpLink:"https://yandex.ru/support/video-player/blocker-settings.html",helpLinkButtonText:"ERROR_SCREEN_DEFAULT_HELP_LINK"}:function(e){return{title:ps[e],message:fs[e],helpLink:hs[e],helpLinkButtonText:ms[e]||"ERROR_SCREEN_DEFAULT_HELP_LINK"}}(i)}function p(e,t){void 0===t&&(t=!0);const r=Ss(e);if(!r)return t;return!e[r]}function f(e,t){const r=function(e){const t=Ss(e);if(t)return t.replace(/hidden/i,"visibilitychange")}(e);if(!r)return As.Z;const i=()=>{t(p(e))};return e.addEventListener(r,i),()=>e.removeEventListener(r,i)}function m(){return bs}function g(e){Ts=window.Ya.Rum.makeSubPage(e?"Init":"SetSource"),ws++}function v(){return Ts}function y(){return ws}function E(){return(E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function S(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}function A(e){(0,Jn.Y)(()=>{window.Ya.Rum.time(e)})}function T(e,t){void 0===t&&(t={}),m()&&(0,Jn.Y)(()=>{const r=S(t,_s);window.Ya.Rum.timeEnd(e,E({},r,{"-additional":(0,Es.B6)(t)}))})}function b(){return(b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function w(e,t,r,i){void 0===i&&(i={}),(0,Jn.Y)(()=>{const{additional:n={}}=i,s=function(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(i,ks);window.Ya.Rum.sendTimeMark(e,t,r,b({},s,{"-additional":(0,Es.B6)(i)}))})}function _(e){if(e&&e.location){const{location:t}=e;return"function"===typeof t.toString?t.toString():t.href||""}return""}function R(e){return"function"===typeof e}function k(e){const t=typeof e;return Boolean(e)&&("object"===t||"function"===t)}function P(e,t,r){return e>r?r:e<t?t:e}function I(e){const t=[...e],r=t.pop();if(!r||0===t.length)throw new Error("memoizeSingle need at least 2 functions as arg");return{preparers:t,resolver:r}}function C(e){return(0,Ys.H)(e.className)?e.className:e.namespaceURI===zs&&e.getAttribute("class")||""}function O(e,t){(0,Ys.H)(e.className)?e.className=t:e.namespaceURI===zs&&e.setAttributeNS("","class",t)}function D(e,t){void 0===t&&(t=""),0!==e.className.length?Ks(e)?Xs(e,t):function(e,t){let r=C(e).split(" ").concat(t.split(" "));r=function(e){const t={};for(let r=0;r<e.length;r++)t[e[r]]=r;return(0,js.Z)(t)}((0,Us.h)(r,(function(e){return""!==e}))),O(e,r.join(" "))}(e,t):e.className=t}function N(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];na(e)&&e.forEach(e=>{"function"===typeof e&&e(...r)})}function L(){return(L=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function M(e,t){!function(e){return"function"===typeof e.dispatch}(e)?e(t):e.dispatch(t)}function F(e,t){e.forEach(e=>{M(e,t)})}function x(e){return 0===ha.length&&(ua=window.setInterval(()=>{ha.forEach(e=>e())},250)),ha.push(e),()=>{const t=ha.indexOf(e);t>-1&&ha.splice(t,1),0===ha.length&&clearInterval(ua)}}function V(){return(V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function U(e,t){return void 0===e&&(e=window),void 0===t&&(t=e.HTMLVideoElement&&e.HTMLVideoElement.prototype||{}),fa.filter(e=>{let{enabled:r}=e;return r in t})}function B(e,t){const r=function(e){void 0===e&&(e=window);const{document:t={}}=e;return fa.filter(e=>{let{enabled:r}=e;return r in t})}(e);if(r.length>0)return r[0];const i=U(e,t);return i.length>0?i[0]:void 0}function H(e,t){const r=B(e,t);if(!r)return null;let i=e.document[r.element];return t&&t[r.element]&&(i=t),i||null}function j(e){return!!e.includes(Aa.ALL)||Ta.every(t=>t===Aa.ALL||e.includes(t))}function W(e){void 0===e&&(e=window);const t=e.navigator.userAgent.toLowerCase();return/ipad|iphone|ipod/.test(t)&&!e.MSStream&&!function(e){void 0===e&&(e=window);return e.navigator.userAgent.indexOf("UCBrowser")>-1}(e)}function Y(e){if(void 0===e&&(e=window),!e.navigator)return Pa;const{connection:t={}}=e.navigator;return"number"===typeof(r=t.rtt)&&isFinite(r)?t.rtt:Pa;var r}function G(e,t){return e.map(e=>({adViewer:e,additionalData:{},adType:t}))}function z(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const i=t.map(q),n="YA PLAYER: "+(new Date).toString()+" "+i.join(" ");return n}function q(e){return e&&"object"===typeof e?JSON.stringify(e,Object.getOwnPropertyNames(e)):e}function K(){return(K=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Q(e){return e.reduce((e,t)=>e+t.getAdDuration(),0)}function Z(){return(Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function J(e){return Boolean(e&&e.adType===Oa.inroll)}function X(e,t){const{ad:{originalBroadcastAdCues:r}}=e,i=r[t];if(i){const{start:e}=i;if(void 0===e)return;const{end:t=e+za}=i;return{start:e,end:t}}}function $(e){const{ad:{originalBroadcastAdCues:t,adInfo:r}}=e;return J(r)?r.params.cueId:(0,js.Z)(t).find(t=>function(e,t){const{controller:{currentTime:r,programDateTime:i}}=e;if(void 0===i)return!1;const n=i/1e3+r,s=X(e,t);if(!s)return!1;const{start:a,end:o}=s;return a<=n&&n<=o}(e,t))}function ee(e){const{controller:{currentTime:t,programDateTime:r}}=e;return void 0===r?r:r+1e3*t}function te(e){if(!e)return;const{parentElement:t}=e;t&&t.removeChild(e)}function re(e,t){return Math.max(e+1e4,t+5e3)}function ie(e){let{cue_id:t,pts:r,offset:i,cutoff:n}=e;const s=r+i;return{start:s,isEndReceived:void 0!==n,cueId:t,end:void 0!==n?r+n:re(r,s),isValid:!0,invalidateReason:void 0}}function ne(){return(ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function se(){return(se=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function ae(e){void 0===e&&(e=window);try{return e.ya.videoAd.getBundleVersion()}catch(t){return"none"}}function oe(e){void 0===e&&(e=window);try{return e.ya.videoAd.getModuleVersion()}catch(t){return"none"}}function le(e){return"string"===typeof e}function de(e){return le(e)&&e.length>0}function ce(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const i=to(t,Boolean);if(0!==i.length)return i.join(";")}function ue(e){if(void 0!==e){if(!le(e))throw new Error("testIdsString is not a string or undefined ["+e+"]");if(0!==e.length){for(const t of e.split(";")){const r=t.split(",");if(3!==r.length)throw new Error("testIdParts length error ["+e+"]");const[i,,n]=r;if(0===i.trim().length)throw new Error("testId length error ["+e+"]");if(0===n.trim().length)throw new Error("testId bucket length error ["+e+"]")}return e}}}function he(e){if(!Boolean(null===e||void 0===e?void 0:e.toString))return!1;try{const t=e.toString();return/\[native code\]/.test(t)||/\/\* source code not available \*\//.test(t)}catch(t){return!1}}function pe(e){return JSON.stringify(e,function(){const e=[],t=function(){const e="undefined"===typeof WeakMap?void 0:new WeakMap,t=[];return{set:(r,i)=>{if(void 0!==e)try{e.set(r,i)}catch(n){t.push({path:i,value:r})}else t.push({path:i,value:r})},get:r=>{const i=oo(t,e=>e.value===r);return void 0!==e&&void 0===i?e.get(r):i?i.path:void 0}}}();return(r,i)=>{if(R(i))return le(i.name)?i.name:"[Function]";if(so(i))return{name:(n=i).name,message:n.message,stack:n.stack};var n;if(!k(i))return i;if((e=>{try{return"display"in function(e,t){return void 0===t&&(t=window),("function"===typeof t.getComputedStyle?t.getComputedStyle(e,null):e.currentStyle)||{}}(e)}catch(t){return!1}})(i))return function(e){if(e.id)return e.id;if(e.className)return e.className;return"HTML Element"}(i);const s=t.get(i);if(de(s))return"[Circular "+s+"]";for(;e.length>0&&e[e.length-1].value[r]!==i;)e.pop();const a=(e.length>0?e[e.length-1].path:"")+(r?"/"+r:"~");return e.push({path:a,value:i}),t.set(i,a),i}}())}function fe(){}function me(e){let t=function(){let r;return t=()=>r,r=e.apply(this,arguments),r};return function(){return t.apply(this,arguments)}}function ge(e,t){try{return e()}catch(r){"function"===typeof t&&t(r)}}function ve(e){const t=function(e,t){if(void 0===t&&(t=!0),_a&&t)return[];{const t=[];let i=e;for(;;)try{if(i=i.ownerDocument.defaultView.frameElement,!i)return t;t.push(i)}catch(r){return t}}}(e.documentElement).map(e=>e.ownerDocument);return t.unshift(e),t.map(e=>({location:_(e.defaultView),referrer:e.referrer}))}function ye(e){let t="",r="";if(e){ve(e).reverse().forEach(e=>{let{location:i,referrer:n}=e;t=t||i,r=r||n})}return{location:t,referrer:r}}function Ee(e){let t=function(){let r;return t=()=>r,r=e.apply(this,arguments),r};return function(){return t.apply(this,arguments)}}function Se(){}function Ae(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Te(){return(Te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function be(e){const{method:t,url:r,async:i=!0,data:n,responseType:s="text",onBeforeSend:a=Se,onRetry:o=Se,checkStatus:l=(e=>vo===e),headers:d={},xhrConstructor:c=XMLHttpRequest,retries:u=0,timeout:h=0,withCredentials:p,onAbort:f,onSetup:m}=e;if(!c)return;const g=e.onSuccess?Ee(e.onSuccess):Se,v=e.onError?Ee(e.onError):Se;let y,E=!1,S=0,A=e=>{E=!0,A=Se,y=e,T(new Error("Abort request")),"function"===typeof f&&f(e)};const T=t=>{b.onerror=null,b.onreadystatechange=null,S&&clearTimeout(S);if(S&&4!==b.readyState||E)try{b.abort()}catch(t){}if(!E)if(u>0){const r=o(t,b);if("boolean"!==typeof r||Boolean(r)||A(),E)return;be(Te({},e,{onSetup:e=>{let{abort:t}=e;A=e=>t(e),E&&t(y)},retries:u-1}))}else A=Se,v(t,b)},b=new c;try{b.open(t,r,i)}catch(w){return void T(w)}if(b.responseType=s,b.withCredentials=Boolean(p),function(e,t,r){for(const i in e)Ae(e,i)&&t.call(r,e[i],i,e)}(d,(e,t)=>{try{b.setRequestHeader(t,e)}catch(w){}}),h>0&&isFinite(h)&&(S=window.setTimeout(()=>{T(new Error("Request timeout, "+r))},h)),b.onerror=T,b.onreadystatechange=()=>{if(4===b.readyState){const{status:e}=b;l(e)?(A=Se,clearTimeout(S),g(b)):T(new Error("Invalid request status "+e+", "+r))}},("function"!==typeof m||(m({abort:e=>A(e)}),!E))&&(a(b,e),!E))try{b.send(n)}catch(w){T(w)}}function we(e){if(!e||!e.toString)return!1;const t=e.toString();return/\[native code\]/.test(t)||/\/\* source code not available \*\//.test(t)}function _e(e,t){var r,i,n;return null!==(n=null!==(i=null!==(r=Ao(e,t))&&void 0!==r?r:function(e,t){const r=function(e){var t,r;const i=[e.document];let n=e.document;for(;n;)n=null===(r=null===(t=n.defaultView)||void 0===t?void 0:t.frameElement)||void 0===r?void 0:r.ownerDocument,n&&i.push(n);return i}(e);for(let i=0;i<r.length;i++){const e=new URLSearchParams(r[i].location.search).get(t);if(null!==e)return e}return}(e,t))&&void 0!==i?i:((e,t)=>{var r,i;for(const n of Ps(e)){const e=null===(i=null===(r=n.Ya)||void 0===r?void 0:r.hardcodedParams)||void 0===i?void 0:i[t];if(e)return String(e)}return})(e,t))&&void 0!==n?n:void 0}function Re(e){return"function"===typeof e||"Function"===no(e)}function ke(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Pe(){return(Pe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Ie(e,t){var r,i,n;return null===(n=null===(i=null===(r=t.ya)||void 0===r?void 0:r.videoAd)||void 0===i?void 0:i.loadedModules)||void 0===n?void 0:n[e]}function Ce(){return(Ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Oe(e){return Wo||function(e){return""+Go+e+"/"}(e)}function De(e){return function(e){const{src:t,win:r,onBeforeLoad:i=fe}=e,n=new po(new Error,{});let s=fe;return{promise:new Promise((e,a)=>{const o=r.document.createElement("script");let l=!1;s=()=>{l=!0,function(e){if(!e)return;const{parentElement:t}=e;t&&t.removeChild(e)}(o)};o.type="text/javascript",o.async=!0,o.onload=()=>{l||e()},o.onerror=e=>{l||(a(new po(n,{message:"Failed to load script ["+t+"]",details:{src:t,isSelfWindow:r===window,event:e}})),s())},o.src=t,o.charset="utf-8",i(o),function(e){const t=e.document;let r=t.getElementsByTagName("head")[0];return r||(r=t.createElement("head"),t.documentElement.appendChild(r)),r}(r).appendChild(o)}),teardown:s}}(e)}function Ne(e){let t="";for(let r=0;r<e;r++)t+=(16*No()|0).toString(16);return t}function Le(e,t,r){void 0===r&&(r=" ");const i=t-e.length;if(i>0){let t=r;for(;t.length<i;)t+=t;return(t.length>i?t.substr(0,i):t)+e}return e}function Me(){return(Me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Fe(e){const t=y();return $o.subpageIndex!==t?($o.subpageIndex=t,$o.deltas={},!1):Boolean($o.deltas[e])}function xe(e){Fe(e)||A(e)}function Ve(e,t){var r;(void 0===t&&(t={}),Fe(e))||(T(e,t),r=e,$o.deltas[r]=!0)}function Ue(){return(Ue=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}async function Be(e,t,r,i){var n;void 0===e&&(e=window);const s=e===window;s&&xe("adsdk.multiroll.full");const a=(e=>{var t;0;const{win:r,config:{vasUaasConfig:i,activeTestIds:n,additionalCustomRootFields:s,vh_sid:a,withCredentials:o},moduleName:l,serviceName:d,serviceVersion:c,productTheme:u,pageId:h,impId:p}=e,f=null!==(t=null===s||void 0===s?void 0:s.vsid)&&void 0!==t?t:Zo,m=(e=>{let{serviceName:t,serviceVersion:r,vsid:i}=e;const n=new So({rnd:Lo,vsid:i,defaultProbability:wo,serviceName:t,serviceVersion:r});return{event:e=>n.log(e),error:e=>n.error(e)}})({serviceName:d,serviceVersion:c,vsid:f}),g=Me({},s),v=de(a)?a:void 0;!de(g.vh_sid)&&v&&(g.vh_sid=v);const y=ge(()=>ue(null===g||void 0===g?void 0:g.testIds),e=>{m.error({error:new po({code:"LOAD_VAS_MODULE_INVALID_TEST_IDS",details:{message:e.message}})})});return(e=>{const t=new go;return{promise:new Promise((r,i)=>{e({resolve:r,reject:i,subscribeForTeardown:e=>{t.subscribe(e)}})}),teardown:()=>t.dispatch(void 0)}})(e=>{let{resolve:t,reject:s,subscribeForTeardown:a}=e,d=!1;a(()=>{d=!0,s(new Error("Teardown called"))}),(e=>{let{externalUaasConfig:t,loaderFunctionsStatsWrapper:r,withCredentials:i}=e;return new Promise((e,n)=>{var s,a;const o=Uo(t);t?o.parseUaasConfigError?r.error({error:new po({code:"LOAD_VAS_MODULE_PARSE_EXTERNAL_UAAS_CONFIG_ERROR",details:{message:o.parseUaasConfigError.message,vasUaasConfig:t}})}):void 0===(null===(a=null===(s=o.parsedUaasConfig)||void 0===s?void 0:s.flags)||void 0===a?void 0:a.VAS_STABLE_VERSION)&&r.error({error:new po({code:"LOAD_VAS_MODULE_NO_VAS_STABLE_VERSION_IN_EXTERNAL_AB_FLAGS",details:{vasUaasConfig:t}})}):r.event({name:"LoadVasModule_NoUAAS",data:{}}),o.version?e({uaasConfig:o.parsedUaasConfig,rawUaasConfig:t,version:o.version}):zo(i).then(t=>{var i,n,s;const a=Uo(t);a.parseUaasConfigError?r.error({error:new po({code:"LOAD_VAS_MODULE_PARSE_LOADED_UAAS_CONFIG_ERROR",details:{message:a.parseUaasConfigError.message,vasUaasConfig:t}})}):void 0===(null===(n=null===(i=a.parsedUaasConfig)||void 0===i?void 0:i.flags)||void 0===n?void 0:n.VAS_STABLE_VERSION)&&r.error({error:new po({code:"LOAD_VAS_MODULE_NO_VAS_STABLE_VERSION_IN_LOADED_AB_FLAGS",details:{vasUaasConfig:t}})}),e({uaasConfig:a.parsedUaasConfig,rawUaasConfig:t,version:null!==(s=a.version)&&void 0!==s?s:String(t.stableVersion),stableVersion:t.stableVersion})}).catch(n)})})({externalUaasConfig:i,loaderFunctionsStatsWrapper:m,withCredentials:o}).then(e=>{let{uaasConfig:i,rawUaasConfig:o,version:c,stableVersion:v}=e;var E,S;if(d)return;if((e=>{if((e=>{const t=e.document;return"documentMode"in t&&"undefined"!==typeof t.documentMode})(e)||(e=>{const t=e.navigator.userAgent;if(t.indexOf("MSIE ")>0)return!0;if(t.indexOf("Trident/")>0)return!0;if(t.indexOf("Edge/")>0)return!0;return!1})(e))return!0;return!1})(r))return m.event({name:"LoadVasModule_brokeInIE11",probability:wo,data:{bundleName:l}}),t(void 0);const A={AB_FLAGS_STORE:void 0,AB_FLAGS:null!==(E=null===i||void 0===i?void 0:i.flags)&&void 0!==E?E:{},ICOOKIE:null===i||void 0===i?void 0:i.iCookie,TEST_IDS:ce(y,null===i||void 0===i?void 0:i.testIds),VAS_UAAS_CONFIG:i,ActiveTestIds:n,AdditionalStatsRootFields:g,VSID:f,VAS_USER_SESSION_RANDOM:Lo,STATS_ROOT_PARAMS:{},loaderLoadedFromAnYandexRu:void 0,loaderLoadedFromYaRu:void 0,grWasSent:void 0,productTheme:u,pageId:h,impId:p},T=e=>{const{promise:t,teardown:i}=(e=>{let{moduleName:t,version:r,win:i,scriptSessionParams:n}=e;var s;const a=Ie(t,i);if(a)return{promise:Promise.resolve(a),teardown:fe};const o=(e=>{let{bundleName:t,win:r,ecmaVersion:i,version:n}=e;const s=Ho[i],a=Ls(r),o=(e=>jo[e]+".bundle.js")(t),l=""+Oe(n)+s+"/"+o;return R(a)?a(l):l})({version:r,bundleName:t,win:i,ecmaVersion:null!==(s=bo.adsdkecmaver)&&void 0!==s?s:Bo}),{promise:l,teardown:d}=De({src:o,win:i,onBeforeLoad:e=>{(e=>{e.crossOrigin="anonymous"})(e),((e,t)=>{e.__AD_SDK_SCRIPT_SESSION_PARAMETERS__=t})(e,n)}});return{promise:l.then(()=>Ie(t,i)),teardown:d}})({moduleName:l,scriptSessionParams:A,version:e,win:r});return a(i),t},b=e=>{m.event({name:"LoadVasModule_ModuleLoaded",probability:wo,data:{bundleName:l}}),t(e)},w=null!==(S=bo.adsdkver)&&void 0!==S?S:c;T(w).then(b).catch(e=>{if(w===String(v))throw e;return m.error({error:new po({code:"LOAD_VAS_MODULE_CANNOT_LOAD_MODULE_WITH_UAAS_VERSION",details:{vasUaasConfig:o}})}),v?T(String(v)).then(b):zo().then(e=>String(e.stableVersion)).then(T).then(b)}).catch(s)}).catch(s)})})({serviceName:"player",serviceVersion:"1.0-11679",config:Ue({},t,{withCredentials:!i,additionalCustomRootFields:{vsid:r,contentPlayerVersion:"1.0-11679",testIds:null==(n=t.additionalParams)?void 0:n.slots}}),win:e,moduleName:"Multiroll"}).promise;return a.then(()=>{s&&Ve("adsdk.multiroll.full")}).catch(Xo.Z),a}function He(e){const{audioTrackValue:t,audioTracks:r}=e.controller;return r.find(e=>{let{value:r}=e;return r===t})}function je(e){const{textTrackValue:t,textTracks:r}=e.controller;return r.find(e=>{let{value:r}=e;return r===t})}function We(){return(We=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Ye(e){const{videoTrackValue:t,videoTracks:r,isAbrEnabled:i}=e.controller,n=r.find(e=>{let{value:r}=e;return r===t});if(n)return We({},n,{auto:i})}function Ge(e){let{controller:{videoType:t,currentTime:r},skin:{skinDVRStartTime:i,skinDVRDuration:n}}=e;return function(e){let{videoType:t,currentTime:r,dvrStartTime:i,dvrDuration:n}=e;return void 0===t||t===cl.Z.VOD?ul:n===1/0||r>i+n-10?pl:t!==cl.Z.LIVE?ul:i+(0===r?0:10)>r?hl:ul}({videoType:t,currentTime:r,dvrStartTime:i,dvrDuration:n})}function ze(e){return void 0!==e.ad.adInfo}function qe(e,t){const r=function(e,t,r){return void 0===r&&(r=0),(0,fl.s)(e,e=>{let{start:i,end:n}=e;return i-r<=t&&t<=n+r})}(e,t);return void 0===r?void 0:r.end-t}function Ke(e){const{currentTime:t,bufferingRanges:r}=e.controller;return qe(r,t)}function Qe(e){const t=e;return t.Ya||(t.Ya={}),t.Ya.streamPlayer||(t.Ya.streamPlayer={}),t.Ya.streamPlayer}function Ze(){return(Ze=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Je(){return(Je=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Xe(e,t){if(!e||!e.height||!e.width||!t)return"unknown";const r=t.getMaxCapAllowedVideoTrack();return r&&r.height&&r.width?r.width===e.width&&r.height===e.height?"same":r.width>e.width||r.height>e.height?"smaller":r.width<e.width||r.height<e.height?"larger":"unknown":"unknown"}function $e(){return($e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function et(e){const t=v();return $e({},t,{additional:$e({},(0,ys.K)(t)?t.additional:void 0,e)})}function tt(e){const t=0===jl,r=Wl[e];return Wl[e]=!0,m()&&t&&!r}function rt(){tt("sourceStart")&&w(Dl.autoplayFalse)}function it(e){let{reason:t="unknown"}=e,r=function(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,Nl);tt("sourceStart")&&w(Dl.firstStartAdSDKFailed,void 0,void 0,$e({reason:t},r))}function nt(){jl++,Wl.sourceStart=!1;const e=0===jl;e?w(Dl.firstLoadSource):bs=p(document);try{g(e);const t=v();(0,Es.Pj)(t.additional||{})}catch(t){}}function st(e,t){if(!m()||Wl.sourceStart)return;const r=0===jl;A(r&&t?Ul[e]:r?Vl[e]:t?Hl[e]:Bl[e])}function at(e,t,r){const i=Wl.sourceStart;if(Wl.sourceStart=!0,!m()||i)return;if(0===jl){const i=r?Ul[e]:Vl[e];w(r?Ml[e]:Ll[e],void 0,!1,{additional:t}),T(i,{additional:t})}else T(r?Hl[e]:Bl[e],et(t))}function ot(e,t,r){tt("yaFirstFrameDecoded")&&(r&&"AD"!==e||w(Fl[e],void 0,!1,{additional:t}))}function lt(e,t,r){tt("yaFirstFrameShown")&&(r&&"AD"!==e||w(xl[e],void 0,!1,{additional:t}))}function dt(e){return(t=e.supportInfo).supported&&void 0!==t.engine;var t}function ct(e){return!(t=e.supportInfo).supported&&void 0!==t.noSupportReason;var t}function ut(){return(ut=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function ht(e){const t=function(e){return e.filter(ct).map(e=>{let{supportInfo:t}=e;return t.noSupportReason})}(e),r={details:{streams:e},isFatal:!0};if(Zl(t,e=>e===ed.INVALID_STREAM_URL))return new ja(ut({},r,{code:cs.INVALID_STREAM_URL}));if(Zl(t,e=>e===ed.NO_SUPPORTED_DRM))return new ja(ut({},r,{code:cs.NO_DRM}));if(Zl(t,e=>e===ed.NO_CODECS))return new ja(ut({},r,{code:cs.NO_CODECS}));const i=Zl(t,e=>e===ed.NO_MSE);return new ja(ut({},r,i?$l?{code:cs.NO_PLAYABLE_STREAMS}:{code:cs.NO_MSE}:{code:cs.NO_PLAYABLE_STREAMS}))}function pt(e){const t=e.trim();return"//"===t.substr(0,2)||"http://"===t.substr(0,7)||"https://"===t.substr(0,8)}function ft(){return(ft=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function mt(e){rd.href=e;let t=rd.pathname||"";"/"!==t.charAt(0)&&(t="/"+t);const r=e.indexOf("?"),i=e.indexOf("#");let n;if(n=-1===r&&-1===i?e:-1===r?e.slice(0,i):-1===i?e.slice(0,r):e.slice(0,Math.min(r,i)),id.test(e)){const t=mt(e.replace(id,"https:"));return rd.href=e,ft({},t,{originalPath:n,protocol:e.slice(0,e.indexOf(":")+1),href:rd.href})}const s=rd.protocol&&/^[a-z\-]+:/i.test(rd.protocol)?rd.protocol:"";return{originalPath:n,href:rd.href,protocol:s,host:rd.host,hostname:rd.hostname,port:rd.port,pathname:t,search:rd.search,hash:rd.hash}}function gt(e,t){if(void 0===t&&(t=!1),t){const t=e.originalPath,r="/"===e.pathname&&"/"!==t[t.length-1];return e.originalPath+(r?"/":"")+e.search+e.hash}const r="443"===e.port||"80"===e.port?e.hostname:e.host;return e.protocol+"//"+r+e.pathname+e.search+e.hash}function vt(e){const t={},r=e.replace(/^[?#]+/,"").replace(/#.*$/,"").split("&");for(let i=0;i<r.length;i++){const e=r[i].indexOf("=");let n,s;if(-1===e?(n=nd(r[i]),s=""):(n=nd(r[i].slice(0,e)),s=r[i].slice(e+1)),n){const e=Boolean(/(\[\])$/.exec(n));n=n.replace(/\[\]$/,""),e?void 0===t[n]?t[n]=[nd(s)]:t[n]=[].concat(t[n],nd(s)):t[n]=nd(s)}}return t}function yt(e){const t=[];for(const r in e)if(e.hasOwnProperty(r)){const i=e[r];na(i)?t.push(sd(r,i)):void 0!==i&&t.push(r+"="+encodeURIComponent(i))}return"?"+t.join("&")}function Et(e,t,r){let{override:i=!0,saveOriginalPath:n=!1}=void 0===r?{}:r;const s=mt(e),a=vt(s.search);(0,td.M)(t,(e,t)=>{(void 0===a[t]||i)&&(a[t]=e)});return gt(ft({},s,{search:yt(a)}),n)}function St(e){const t=function(e){return mt(e).pathname.split("/").pop()||""}(e).split(".");return t.length>1?t.pop():""}function At(e,t){void 0===t&&(t=ad);const{hostname:r}=mt(e),i=function(e){const{hostname:t}=mt(e),r=t.split(".");return r.length<=2?t:r.slice(-2).join(".")}(e),n=t.includes(r)||t.includes(i);return n}function Tt(e){if(void 0===e||!(0,ys.K)(e))return!1;const{servers:t,advanced:r}=e;return(0,ys.K)(t)&&(0,Ys.H)(t["com.apple.fps.1_0"])&&(0,ys.K)(r)&&(0,ys.K)(r["com.apple.fps.1_0"])&&(0,Ys.H)(r["com.apple.fps.1_0"].processSPCPath)}function bt(e){return e.preferNative||gd||_a||Tt(e.stream.drmConfig)?Cl.NATIVE:Cl.HLS}function wt(){const e={};return vd.forEach(t=>{yd.forEach(r=>{var i;e["video/"+t+"/"+r]=Xl("video/"+t+'; codecs="'+r+'"'),e["mse-video/"+t+"/"+r]=null!=(i=null==cd?void 0:cd.isTypeSupported("video/"+t+'; codecs="'+r+'"'))&&i})}),Ed.forEach(t=>{Sd.forEach(r=>{var i;e["audio/"+t+"/"+r]=Xl("audio/"+t+'; codecs="'+r+'"'),e["mse-audio/"+t+"/"+r]=null!=(i=null==cd?void 0:cd.isTypeSupported("audio/"+t+'; codecs="'+r+'"'))&&i})}),e["audio/plain/flac"]=Xl("audio/flac"),e}function _t(){return(_t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Rt(e){void 0===e&&(e=window);const{userAgent:t=""}=e.navigator,r=/Android/.test(t),i=function(e){void 0===e&&(e=window);return/Windows Phone/i.test(e.navigator.userAgent)}(e),n=/com\.yandex\.mobile\.metrica\.ads\.sdk.*?Android/.test(t);return r&&!i||n}function kt(e){return function(e,t){void 0===t&&(t=window);const r=(0,as.i)(t),i=new RegExp("\\b"+e+"/((?:\\d+)(?:\\.\\d+)*)\\b","i"),n=r.match(i);if(n)return n[1].split(".").map(e=>parseInt(e,10))}("YaBrowser",e)}function Pt(){return(Pt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function It(e){if(!hd(e))return!1;const t=W(e);if(t&&function(e){void 0===e&&(e=window);return/YandexSearch|YaSearchBrowser|YaApp_iOS|YaApp_Android/i.test((0,as.i)(e))}(e))return!1;const r=kt(e);if(void 0===r)return!1;const[i,n,s,a]=r;if(i<18)return!0;if(18===i){if(n>4)return!1;if(t&&s<3)return!0;if(Rt(e)&&(s<1||!a||a<=526))return!0}return!1}async function Ct(){const e=[];return await Promise.all(Od.map(async t=>{try{await window.navigator.requestMediaKeySystemAccess(t,Nd),e.push(t)}catch(r){}})),e}function Ot(){const e=[];return Od.forEach(t=>{window.MSMediaKeys.isTypeSupported(t)&&e.push(t)}),e}function Dt(e){let{video:t}=e;const r=[];return Od.forEach(e=>{t.canPlayType("video/mp4",e)&&r.push(e)}),r}function Nt(){const e=[];return[Id.h9,Id.oo].forEach(t=>{window.WebKitMediaKeys.isTypeSupported(t,"video/mp4")&&e.push(t)}),e}async function Lt(e){void 0===Md&&(Md=async function(e){return Rd&&!(_d||wd||pd)?{supportedDrmSystems:[],detectionMethod:Ld.YandexBrowserLinux}:It()?{supportedDrmSystems:[],detectionMethod:Ld.OldYandexBrowser}:window.WebKitMediaKeys?{supportedDrmSystems:Nt(),detectionMethod:Ld.WebKitMediaKeys}:"function"===typeof window.navigator.requestMediaKeySystemAccess?{supportedDrmSystems:await Ct(),detectionMethod:Ld.requestMediaKeySystemAccess}:"function"===typeof window.MSMediaKeys?{supportedDrmSystems:Ot(),detectionMethod:Ld.MSMediaKeys}:e.video.webkitGenerateKeyRequest?{supportedDrmSystems:Dt(e),detectionMethod:Ld.GenerateKeyRequest}:{supportedDrmSystems:[],detectionMethod:Ld.NotAvailable}}(e));const t=await Md;return Pt({},t,{supportedDrmSystems:[...t.supportedDrmSystems]})}async function Mt(e,t){const{servers:r={}}=e,i=(0,js.Z)(r);if(0===i.length)return!1;const n=await Vd({video:t});return Zl(i,e=>-1!==Bs(n,e))}function Ft(){const e=Ud.canPlayType('video/mp4;codecs="avc1.4D481F"');return e?{supported:!0,engine:Cl.MP4}:{supported:!1,debugInfo:{checkedCodec:'video/mp4;codecs="avc1.4D481F"',isCodecSupported:e,codecs:wt()},noSupportReason:ed.NO_CODECS}}function xt(e){var t,r;const i=void 0!==e.stream.drmConfig,n=Id.ly in((null==(t=e.stream.drmConfig)?void 0:t.servers)||{}),s=Id.xE in((null==(r=e.stream.drmConfig)?void 0:r.servers)||{});return!(i&&!n&&!s)&&ld(e.stream.url)}function Vt(){return(Vt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}async function Ut(e){const{stream:t,video:r,preferNative:i}=e,{drmConfig:n,url:s}=t;if(!(e=>pt(e)&&At(e))(s))return{supported:!1,debugInfo:{cloud:!1},noSupportReason:ed.INVALID_STREAM_URL};const a=ld(s),o=od(s);if((e=>"mp4"===St(e.toLocaleLowerCase()))(s))return Ft();if(!a&&!o)return{supported:!1,debugInfo:{},noSupportReason:ed.NO_SUPPORTED_FORMAT};let l;if(l=a?Hd||(Hd=await md().then(()=>Bd).catch(e=>({supported:!1,debugInfo:(0,Ha.V)(e)?{message:e.message,stack:e.stack}:{message:"Unknown error while get support info",errorString:String(e)},noSupportReason:ed.NO_MSE}))):await async function(e){try{0,void 0===bd&&(bd=await md());const t=bd.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');return t?$l?{supported:!0,engine:bt(e)}:Tt(e.stream.drmConfig)?{supported:!1,debugInfo:{IS_HLS_NATIVE_SUPPORTED:$l},noSupportReason:ed.NO_SUPPORTED_DRM}:Td:$l?Ad:{supported:!1,debugInfo:{checkedCodec:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"',isCodecSupported:t,hasMse:!0,codecs:wt(),IS_HLS_NATIVE_SUPPORTED:$l},noSupportReason:ed.NO_CODECS}}catch(t){return $l?Ad:{supported:!1,debugInfo:_t({},(0,Ha.V)(t)?{message:t.message,stack:t.stack}:{message:"Unknown error while get support info",errorString:String(t)},{codecs:wt()}),noSupportReason:ed.NO_MSE}}}({stream:t,preferNative:i}),!l.supported)return l;if(void 0===n||!(0,ys.K)(n))return xt({stream:t})?Vt({},l,{engine:Cl.YASP}):l;const d=await Mt(n,r);return d?xt({stream:t})?Vt({},l,{engine:Cl.YASP}):l:{supported:!1,debugInfo:{isStreamDRMSupported:d,previousSupportInfo:l},noSupportReason:ed.NO_SUPPORTED_DRM}}function Bt(e){const t=e.filter(dt);if(0===t.length)return;const r=t.find(e=>{let{supportInfo:t}=e;return t.engine===Cl.NATIVE}),i=function(e){var t;const r=e.filter(e=>e.supportInfo.engine===Cl.YASP);if(0===r.length)return null;const i=r[0],n=null==(t=i.stream.drmConfig)?void 0:t.servers;if(!n||zd.some(e=>e in n))return i;if(Id.xE in n){return r.find(e=>zd.some(t=>{var r,i;return null==(r=e.stream.drmConfig)||null==(i=r.servers)?void 0:i[t]}))||i}return i}(t);if(!(0,is.RW)("web_add_mms_ios")&&qd&&Gd.major>=17)return r;const n=jd.major>=15&&!(Wd&&(e=>{let t=!1;e&&(t=Zl(Yd.T,t=>e.startsWith("https://"+t+"/live/")||e.startsWith("https://"+t+"/kal/")));return t})(null==i?void 0:i.stream.url));if(_a&&!n&&r)return r;if(i)return i;const s=t.find(e=>{let{supportInfo:t}=e;return t.engine!==Cl.MP4});return s||t[0]}async function Ht(e){if(0===e.streams.length)return{status:"error",error:new ja({code:cs.NO_STREAMS,details:{},isFatal:!0}),streamsWithSupportInfo:[]};const t=await function(e){let{streams:t,video:r,preferNative:i}=e;return Promise.all(t.map(async e=>({stream:e,supportInfo:await Ut({stream:e,video:r,preferNative:i})})))}(e),r=Bt(t);return r?{status:"success",supportedStream:r,streamsWithSupportInfo:t}:{status:"error",error:ht(t),streamsWithSupportInfo:t}}function jt(e,t){for(let r=0;r<e.length;++r){const{start:i,end:n}=e[r];if(i<=t+.1&&t<=n)return Math.max(n-t,0)}return 0}function Wt(e,t){return{total:jt(e.total,t),audio:jt(e.audio,t),video:jt(e.video,t)}}function Yt(){return(Yt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Gt(e,t,r){if(void 0===t)return e;if(void 0===r)return e;const i=encodeURIComponent(t)+"="+encodeURIComponent(r);return Qd.href=e,Qd.search=Qd.search?Qd.search+"&"+i:"?"+i,Qd.href}function zt(e,t,r){if(void 0===t)return e;if(void 0===r)return e;const i=encodeURIComponent(t)+"="+encodeURIComponent(r);return Qd.href=e,Qd.hash=Qd.hash?Qd.hash+"&"+i:"#"+i,Qd.href}function qt(e,t,r){return e=function(e,t){if(-1===e.indexOf("#"))return e;Qd.href=e;const r=Qt(Qd.hash.slice(1),t);return Qd.hash=r?"#"+r:"",Qd.href}(e,t),void 0===r?e:zt(e,t,r)}function Kt(e,t){if(-1===e.indexOf("?"))return e;Qd.href=e;const r=Qt(Qd.search.slice(1),t);return Qd.search=r?"?"+r:"",Qd.href}function Qt(e,t){return e.split("&").filter(e=>e!==t&&0!==e.indexOf(t+"=")).join("&")}function Zt(e){return Yd.T.indexOf(mt(e).hostname)>-1}function Jt(e){if(!Zt(e))return;const{protocol:t,host:r}=function(e){const t=Zd[e];if(t)return t;Qd.href=e;let r=Qd.pathname||"";"/"!==r.charAt(0)&&(r="/"+r);const i={href:Qd.href,protocol:Qd.protocol,host:Qd.host,hostname:Qd.hostname,port:Qd.port,pathname:r,search:Qd.search,hash:Qd.hash,baseDomain:(Qd.hostname||"").split(".").slice(-2).join(".")};return Zd[e]=i,Yt({},i)}(e);return t+"//"+r+"/ping"}async function Xt(e,t){const r=Jt(e);return async function(e,t){try{return await(0,el.W)({url:e,withCredentials:t,method:"GET",checkStatus:e=>0!==e,retries:3}),!1}catch(r){return!0}}(r||function(e,t,r){if(void 0===r)return e;const i=mt(e),n=vt(i.search);return n[t]=r,gt(ft({},i,{search:yt(n)}))}((0,Kd.c)(e),"abd","1"),!(0,Ys.H)(r)&&t)}function $t(){return($t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function er(e){const{additionalParams:t=Al}=e;if(!(0,ys.K)(e.adConfig))return;const{partnerId:r,adBreaks:i}=e.adConfig;return r||i?$t({},e.adConfig,{additionalParams:t}):void 0}function tr(e){if(void 0===e||isNaN(e))return"unknown";for(let t=0;t<Xd.length;t++)if(e<Xd[t].end)return Xd[t].name;return"unknown"}function rr(e){const t=mt(e),r=vt(t.search),i=(()=>{const e=void 0!==r.start,t=void 0!==r.end;return e||t?"?"+(e?"start="+r.start:"")+(t?(e?"&":"")+"end="+r.end:""):""})();return t.originalPath+i}function ir(e,t){return t&&"boolean"===typeof t.withCredentials?t.withCredentials:!!Zt(e.url)||Tl.withCredentials}function nr(e){if(void 0===e||isNaN(e))return"unknown";for(let t=0;t<$d.length;t++)if(e<$d[t].end)return $d[t].name;return"unknown"}function sr(e){const{stream:t,sourceParams:r}=e,i=mt(t.url),n=vt(i.search);return JSON.stringify([i.pathname,n.start,n.end,null==r?void 0:r.startPosition])}function ar(e){return e[0]}function or(e){return Array.isArray(e)}function lr(e){const t=nc.getItem("playerapi-numbers-session-storage-key"),r=(0,Jn.Y)(()=>JSON.parse(t||""));return function(e,t){const r=e.find(e=>!!or(e)&&ar(e)===t);return void 0===r?void 0:r[1]}(Array.isArray(r)?r:[],e)}function dr(e,t){const r=nc.getItem("playerapi-numbers-session-storage-key"),i=(0,Jn.Y)(()=>JSON.parse(r||"")),n=Array.isArray(i)?i:[];nc.setItem("playerapi-numbers-session-storage-key",JSON.stringify(function(e,t,r){const i=function(e,t){return[e,t]}(t,r),n=e.findIndex(e=>!!or(e)&&ar(e)===t);for(0===n?e[0]=i:(n>0&&e.splice(n,1),e.splice(0,0,i));10<e.length;)e.pop();return e}(n,e,t)))}function cr(e,t){try{e.details||(e.details={}),e.details.stage=t}catch(r){}}function ur(e,t){return hd(e)?function(e){void 0===e&&(e=window);const t=(0,as.i)(e).match(/YaBrowser\/([\d.]+)/),r=t&&t[1]||"";return r?parseFloat(r):-1}(e)<18.6?"pip":"x-yandex-pip":"disablePictureInPicture"in t?"disablePictureInPicture":void 0}function hr(e,t,r){const i=ur(e,r);i&&(t?r.removeAttribute(i):r.setAttribute(i,"true"))}function pr(e,t){return e.responseStart-t.responseStart}function fr(e){return e.responseStart-e.requestStart}function mr(){if("undefined"===typeof window.performance)return NaN;const e=lc.reduce((e,t)=>(0,ac.Z)(e,function(e){try{return e.performance.getEntriesByType("resource").filter(e=>{let{name:t,transferSize:r,responseStart:i,requestStart:n}=e;return"string"===typeof t&&r>0&&i>0&&n>0})}catch(t){return[]}}(t),pr),[]).filter(e=>{let{name:t}=e;return dc.j.test(t)});return 0===e.length?NaN:e.reduce((e,t)=>(1.3*e+.7*fr(t))/2,fr(e[0]))}function gr(e){const t=uc(e);return t?()=>{uc(e)!==t&&Ba()(e,t)}:Xo.Z}function vr(){return"media-track-"+hc++}function yr(e,t){if(void 0===t&&(t={bubbles:!1,cancelable:!1,detail:void 0}),"function"===typeof CustomEvent)return new CustomEvent(e,t);const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r}function Er(e,t){for(let r=0;r<e.length;r++)t.id!==e[r].id&&(e[r].enabled=!1)}function Sr(e){if(void 0!==e)for(;e.length>0;)e.removeTrack(e[0])}function Ar(e,t){for(let r=0;r<e.length;r++)Object.keys(e[r]).length&&t.id!==e[r].id&&(e[r].selected=!1)}function Tr(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function br(e,t,i){var n={};n[i]=[];var s=t.toString(),a=s.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||s.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!a)return n;for(var o,l=a[1],d=new RegExp("(\\\\n|\\W)"+Tr(l)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");o=d.exec(s);)"dll-reference"!==o[3]&&n[i].push(o[3]);for(d=new RegExp("\\("+Tr(l)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");o=d.exec(s);)e[o[2]]||(n[i].push(o[1]),e[o[2]]=r(o[1]).m),n[o[2]]=n[o[2]]||[],n[o[2]].push(o[4]);for(var c,u=Object.keys(n),h=0;h<u.length;h++)for(var p=0;p<n[u[h]].length;p++)c=n[u[h]][p],isNaN(1*c)||(n[u[h]][p]=1*n[u[h]][p]);return n}function wr(e){return Object.keys(e).reduce((t,r)=>t||e[r].length>0,!1)}function _r(e,t,r,i){let n=e[i].map(e=>'"'+e+'": '+t[i][e].toString()).join(","),s=wc.toString().split("ENTRY_MODULE");return s[0]+"{"+n+"}"+s[1]+'"'+r+'"'+s[2]}function Rr(e,t){t=t||{};var i={main:r.m},n=t.all?{main:Object.keys(i.main)}:function(e,t){for(var r={main:[t]},i={main:[]},n={main:{}};wr(r);)for(var s=Object.keys(r),a=0;a<s.length;a++){var o=s[a],l=r[o].pop();if(n[o]=n[o]||{},!n[o][l]&&e[o][l]){n[o][l]=!0,i[o]=i[o]||[],i[o].push(l);for(var d=br(e,e[o][l],o),c=Object.keys(d),u=0;u<c.length;u++)r[c[u]]=r[c[u]]||[],r[c[u]]=r[c[u]].concat(d[c[u]])}}return i}(i,e),s="";Object.keys(n).filter(e=>"main"!==e).forEach(e=>{for(var t=0;n[e][t];)t++;n[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+_r(n,i,t,modules)+")();\n"}),s=s+"var a = ("+_r(n,i,e,"main")+");\ntry {\n    a();\n} catch(e) { console.warn(e); throw e }";var a=window.Blob;try{a=window.top.Blob}catch(h){}var o=new a([s],{type:"text/javascript"});if(t.bare)return o;var l=void 0;try{l=window.top.URL||window.top.webkitURL||window.top.mozURL||window.top.msURL}catch(h){}l=l||window.URL||window.webkitURL||window.mozURL||window.msURL;var d=window.Worker;try{d=window.top.Worker}catch(h){}var c=l.createObjectURL(o),u=new d(c);return u.objectURL=c,u}function kr(){return(kr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Pr(e){if("function"===typeof e.getVideoPlaybackQuality){const t=e.getVideoPlaybackQuality();return{droppedVideoFrames:t.droppedVideoFrames,corruptedVideoFrames:t.corruptedVideoFrames,totalVideoFrames:t.totalVideoFrames}}const t=e;return"number"===typeof t.webkitDroppedFrameCount&&"number"===typeof t.webkitDecodedFrameCount?kr({},Oc,{droppedVideoFrames:t.webkitDroppedFrameCount,totalVideoFrames:t.webkitDecodedFrameCount}):Oc}function Ir(){return(Ir=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Cr(e){switch(e.source){case"default":case"default-slow":case"cache":case"timing-api":case"network-api":case"ewma":case"hlsjs":case"yabro":case"shaka-default":case"shaka-network-api":case"external-yasp":return e;default:return{value:e.value,source:"external-yasp"}}}function Or(e){if(isNaN(e.value))return;if((0,is.RW)("web_true_stored_bandwidth")&&!cu.includes(e.source))return;const t={bandwidthEstimate:Math.floor(e.value),time:lu(),source:e.source};ud.t.setItem("videoplayer-bandwidth-estimate",JSON.stringify(t))}function Dr(){try{const e=ud.t.getItem("videoplayer-bandwidth-estimate");if(!e)return NaN;const{bandwidthEstimate:t,time:r,source:i}=JSON.parse(e);return(0,is.RW)("web_true_stored_bandwidth")&&!cu.includes(i)?NaN:lu()-r<du?t:NaN}catch(e){return NaN}}function Nr(e){const t=function(e,t){if(void 0===t&&(t=!0),_a&&t)return[];const r=[];let i=e;for(;;)try{if(i=i.ownerDocument.defaultView.frameElement,!i)return r;r.push(i)}catch(n){return r}}(e.documentElement).map(e=>e.ownerDocument);return t.unshift(e),t.map(e=>({location:d(e.defaultView),referrer:e.referrer}))}function Lr(){return(Lr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Mr(e){void 0===e&&(e={});const t={};for(const r in e){const i=e[r],n=typeof i;"string"!==n&&"number"!==n&&"boolean"!==n||(t[r]=i)}return t}function Fr(){const{plugins:e}=window.navigator;return void 0===e||0===e.length?[]:((e,t,r)=>{const i=new Array(e.length);for(let n=0;n<e.length;n++)i[n]=t.call(r,e[n],n,e);return i})(e,Mr)}function xr(){const e=window.navigator||{},t=window.performance||{},{location:r,referrer:i}=function(e){let t="",r="";if(e){Nr(e).reverse().forEach(e=>{let{location:i,referrer:n}=e;t=t||i,r=r||n})}return{location:t,referrer:r}}(document);return{navigator:Lr({},Mr(e),{connection:Mr(e.connection),plugins:Fr()}),performance:{memory:Mr(t.memory)},playerLocation:location.href,iframeApiLocation:r,iframeApiReferrer:i}}function Vr(){return(Vr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Ur(e,t){if(void 0===t)return e;return void 0!==function(e){const t=function(e,t){return Qd.href=e,((Qd.hash||"").slice(1).split("&").map(e=>e.split("=")).map(e=>{let[t,r]=e;return[t,void 0===r?"":r]}).find(e=>{let[r]=e;return r===t})||[])[1]}(e,"t");return void 0===t?t:Number(t)}(e)?qt(e,"t",t):zt(e,"t",String(t))}function Br(e,t){const r={audio_mbr:"1",mburl:"1",drm_packager:"1"};return(e.startsWith("https://strm.yandex.ru/live/")||e.startsWith("https://streaming.tst.strm.yandex.net/live/"))&&(r.packager="1",r.lowlatency="1"),Et(Ur(e,t),r,{saveOriginalPath:!0})}function Hr(){return(Hr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function jr(e){let{engine:t,source:r,getState:i,getCapSizes:n,fpsController:s,getVideoElementSizes:a,defaultQuality:o}=e;switch(t){case Cl.YASP:return new Ou({source:r,getState:i,getCapSizes:n,type:Yl.Api,getVideoElementSizes:a,defaultQuality:o});default:return}}function Wr(e){const{error:t}=e;return new Nu(t)}function Yr(e){if(e.type===Hls.ErrorTypes.NETWORK_ERROR)return e.networkDetails?e.networkDetails.status:void 0}function Gr(e){if(e.type===Hls.ErrorTypes.NETWORK_ERROR)return e.networkDetails?e.networkDetails.readyState:void 0}function zr(e){if(void 0===e)return;const{level:t,start:r,duration:i,url:n,relurl:s,sn:a,programDateTime:o,deltaPTS:l,dropped:d,endDTS:c,endPTS:u,startDTS:h,startPTS:p}=e;return{level:t,start:r,duration:i,url:n,relurl:s,sn:a,programDateTime:o,deltaPTS:l,dropped:d,endDTS:c,endPTS:u,startDTS:h,startPTS:p}}function qr(){return(qr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Kr(e){try{return JSON.parse((0,Ma.Y)(qr({},e,{networkDetails:void 0,frag:zr(e.frag)})))}catch(t){return{message:(0,Jn.Y)(()=>t.message)||"Cannot serialize hlsJsError"}}}function Qr(){return(Qr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Zr(e){let{details:t,networkDetails:r}=e;const i=r?r.status:NaN,n=t===Hls.ErrorDetails.MANIFEST_LOAD_ERROR,s=t===Hls.ErrorDetails.LEVEL_LOAD_ERROR;return 451===i?n?cs.REGIONAL_LIMITATION_MANIFEST:s?cs.REGIONAL_LIMITATION_LEVEL:cs.REGIONAL_LIMITATION_SEGMENT:Hu.includes(i)?n?cs.SIGNATURE_EXPIRED_MANIFEST:s?cs.SIGNATURE_EXPIRED_LEVEL:cs.SIGNATURE_EXPIRED_SEGMENT:454===i?n?cs.BANNED_MANIFEST:s?cs.BANNED_LEVEL:cs.BANNED_SEGMENT:void 0}function Jr(e){const{details:t,fatal:r}=e;return t?Hls.ErrorDetails.FRAG_DECRYPT_ERROR!==t&&Hls.ErrorDetails.FRAG_PARSING_ERROR!==t&&Hls.ErrorDetails.BUFFER_STALLED_ERROR!==t&&Hls.ErrorDetails.BUFFER_NUDGE_ON_STALL!==t&&(void 0!==Zr(e)||Boolean(r)):Boolean(r)}function Xr(e,t){return void 0===e.err||void 0===e.err.message?"MISSED_STACK__"+t:e.err.message}function $r(e){if(void 0===e)return;const{details:t}=e;if(t===Hls.ErrorDetails.BUFFER_STALLED_ERROR)return;const r=Jr(e)&&!ei(e),i=Zr(e)||t||cs.DEFAULT_ERROR,{err:{stack:n=new Error(Xr(e,i)).stack}={stack:void 0}}=e;return new ja({code:i,isFatal:r,details:Qr({},Kr(e),{networkErrorStatus:Yr(e),xhrReadyState:Gr(e)}),stack:n})}function ei(e){if(void 0!==Zr(e))return!1;const{details:t}=e;return!!t&&(Hls.ErrorDetails.FRAG_LOAD_ERROR===t||Hls.ErrorDetails.FRAG_LOAD_TIMEOUT===t||Hls.ErrorDetails.FRAG_PARSING_ERROR===t||Hls.ErrorDetails.BUFFER_APPEND_ERROR===t||Hls.ErrorDetails.INTERNAL_EXCEPTION===t||Hls.ErrorDetails.LEVEL_LOAD_TIMEOUT===t||Hls.ErrorDetails.MANIFEST_LOAD_ERROR===t||Hls.ErrorDetails.MANIFEST_LOAD_TIMEOUT===t)}function ti(e){const{details:t}=e;return!!t&&(Hls.ErrorDetails.MANIFEST_LOAD_ERROR===t||Hls.ErrorDetails.MANIFEST_LOAD_TIMEOUT===t)}function ri(e,t){if(0===Object.keys(e).length)return;const{uri:r,duration:i,resolution:n,tiles:s}=e;if([r,i,n,s].some(e=>!e))return void(t&&t("NonValidHLSThumbnailTileSessionData"));const a=function(e){const t=e.split("x");if(t.length<2)return;const r={rows:parseInt(t[0],10),columns:parseInt(t[1],10)};return isNaN(r.rows)||isNaN(r.columns)?void 0:r}(s),o=function(e){if(""===e)return;const[t,r]=e.split("x"),i={width:parseInt(t,10),height:parseInt(r,10)};return isNaN(i.width)||isNaN(i.height)?void 0:i}(n),l=parseFloat(i);if(void 0===a||void 0===o||isNaN(l))return void(t&&t("MapTileSessionDataParseError"));return{tiles:a,uriTemplate:r,spriteDuration:l,resolution:o,tileSize:function(e,t){const{rows:r,columns:i}=e;if(!r||!i)return null;const{width:n,height:s}=t;return{width:n/i,height:s/r}}(a,o),tileDuration:function(e,t){return 0===e.rows||0===e.columns?0:t/(e.rows*e.columns)}(a,l)}}function ii(e,t,r){const i=t===ju.LOWRES?Wu:Yu,{VALUE:n=""}=e[i.tiles]||{},{VALUE:s=""}=e[i.duration]||{},{VALUE:a=""}=e[i.resolution]||{},{VALUE:o=""}=e[i.uri]||{},l=[n,s,a,o];if(!l.every(e=>""===e)){if(!l.some(e=>""===e))return{tiles:n,duration:s,resolution:a,uri:o};r&&r("NonValidHLSSessionData")}}function ni(e){if(void 0!==e)return{name:e.name,value:String(e.id),lang:e.lang||""}}function si(e){if(void 0!==e)return{name:e.name,value:String(e.id),lang:e.lang||""}}function ai(e){return e+"p"}function oi(e){let{width:t,height:r}=e;const i=!(0,va.z)(r)||r<=0;if(!(0,va.z)(t)||t<=0||i)return i?"":ai(r);const n=Math.max(t,r),s=Math.min(t,r);let a=Gu[0];for(let o=0;o<Gu.length;o++){if(Gu[o]===s)return ai(Gu[o]);if(n>=zu*Math.floor(16*Gu[o]/9)||s>=zu*Gu[o])return ai(a);a=Gu[o]}return ai(Gu[Gu.length-1])}function li(e,t){const{attrs:r={},width:i,height:n}=e;if(!(0,va.z)(n))return"";const s=oi(e);if(!(0,va.z)(i))return s;const a=function(e){let{width:t,height:r,bitrate:i}=e;return t+"x"+r+"@"+i}({width:i,height:n,bitrate:r["AVERAGE-BANDWIDTH"]?parseInt(r["AVERAGE-BANDWIDTH"],10):e.bitrate}),o=t.get(a);return void 0===o?s:o}function di(e,t){if(void 0===e)return;const{height:r,width:i,url:n,bitrate:s}=e;return Array.isArray(n)?{name:li(e,t),value:n[0],width:i,height:r,bitrate:s?s/1e3:bl}:void 0}function ci(e,t){const r=function(e,t,r){const i={};return e.filter(e=>Boolean(r(e))).forEach(e=>{const n=t(e);(!i[n]||r(i[n])<r(e))&&(i[n]=e)}),(0,kd.z)(i)}(e,e=>{let{height:t}=e;return t},e=>{let{bitrate:t}=e;return t}),i=[];return r.forEach(e=>{const r=di(e,t);r&&i.push(r)}),i}function ui(e,t){let{name:r,lang:i}=t;const n=r?e.find(e=>e.name===r):void 0;return n||(i?e.find(e=>e.lang===i):void 0)}function hi(e,t){let{name:r,height:i}=t;const n=r?e.find(e=>e.name===r):void 0;if(n)return n;if(void 0===i)return;const s=e.filter(e=>{let{height:t}=e;return void 0!==t});return(0,qu.U)(s,e=>{let{height:t}=e;return Math.abs(t-i)})}function pi(e,t){const{paused:r}=e,i=t();return r||(0,Kn.v)(e.play()),i}function fi(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}function mi(e){return void 0!==e&&(0,va.z)(e)&&e>=0}function gi(e){const{type:t}=e;return t===cl.Z.VOD||!1===e.live?cl.Z.VOD:t===cl.Z.EVENT?cl.Z.EVENT:cl.Z.LIVE}function vi(e){let t;void 0===e&&(e=window);try{t=e.devicePixelRatio}catch(r){}return t||1}function yi(e){let{video:t,maxHeightCapping:r,levels:i=[],bandwidth:n}=e;const s=i.slice().filter(Boolean).sort((e,t)=>t.bitrate-e.bitrate);if(0===s.length)return-1;const{width:a,height:o}=function(e){const t=vi();return{width:(e.width||e.clientWidth||e.offsetWidth)*t,height:(e.height||e.clientHeight||e.offsetHeight)*t}}(t),[l]=s.filter(e=>!(n&&e.bitrate>n)&&(!(r&&e.height>r)&&(e.width<=a||e.height<=o)));return void 0===l?i.indexOf(s.pop()):i.indexOf(l)}function Ei(e){const{VALUE:t=""}=e["com.yandex.video.labels.quality"]||{};return t.split(",").filter(Boolean).reduce((e,t)=>{const[r,i]=t.split(":");return void 0!==function(e){const t=e.match(Zu);if(t)return{width:parseInt(t[1],10),height:parseInt(t[2],10),bitrate:parseInt(t[3],10)}}(r)&&i&&e.set(r,i),e},new Map)}function Si(){return(Si=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Ai(e){let{win:t=window,src:r,checkLoad:i,onBeforeLoad:n=Xo.Z,onLoad:s=Xo.Z,withCredentials:a=!1}=e;$u["ll1.0-11679"]=$u["ll1.0-11679"]||{};const o=$u["ll1.0-11679"];var d;return o[r]||(o[r]=(d={checkLoad:i,win:t,src:r,retries:3,dropCacheOnRetry:!0,onBeforeLoad:e=>{a||(e.crossOrigin="anonymous"),n()}},new Promise((e,t)=>{l(Si({},d,{onLoad:e,onError:t}))})).then(s),o[r].catch(()=>delete o[r])),o[r]}function Ti(){let e=!1;return Ai({src:eh,checkLoad:()=>"undefined"!==typeof Hls,onBeforeLoad:()=>{e=!0,A("lib.hlsjs")},onLoad:()=>{e&&T("lib.hlsjs")}})}function bi(e,t,r){void 0===t&&(t=nh());let i=r;return function(r){if(!t(i,r))return i=r,e(r)}}function wi(e){let{skin:{hiddenControls:t}}=e;return!t.includes(Aa.TIMELINE)}function _i(e){const{controller:{videoType:t}}=e;return t!==cl.Z.VOD&&function(e){const{controller:{currentTime:t,bufferingRanges:r},skin:{skinDVRStartTime:i,skinDVRDuration:n}}=e;return 0!==r.length&&(n===1/0||t>i+n-10)}(e)}function Ri(e,t){let{name:r,lang:i}=t;const n=e.find(e=>e.name===r);return n||(i?e.find(e=>e.lang===i):void 0)}function ki(e,t){void 0===t&&(t={});let r=0;const i=[],n=(t,n)=>{i.push((0,Vs.O)(e,t,n,lh)),clearTimeout(r)},s=()=>N(i),a=new Promise((i,s)=>{const a=t=>{e.paused&&s(t)},o=e.play();if(a(oh.VideoTagPaused),n("durationchange",()=>a(oh.VideoTagPausedAfterDurationChange)),n("error",()=>a(oh.VideoTagPausedAfterError)),n("pause",()=>s(oh.PauseEvent)),n("playing",()=>{i(oh.PlayingEvent)}),o)t.useProgressEvent&&n("progress",()=>{i(oh.ProgressEvent)}),o.then(()=>i(oh.PromiseResolve)).catch(e=>s(function(e){return e?oh.PromiseReject+"["+e.code+"]["+e.name+"]["+e.message+"]":oh.PromiseReject}(e)));else{const{timeoutForNonPromisePlay:e}=t;"number"===typeof e&&e>0&&(r=window.setTimeout(()=>{s(oh.Timeout)},t.timeoutForNonPromisePlay))}});return a.then(s,s),a}function Pi(e){let{kind:t}=e;return"subtitles"===t}function Ii(e){const t=[];for(let r=0;r<e.length;r++)Pi(e[r])&&t.push(e[r]);return t}function Ci(e){return e?"showing":"hidden"}function Oi(e,t){return e.responseEnd-t.responseEnd}function Di(){if("undefined"===typeof window.performance)return{value:NaN,source:"timing-api"};const e=lc.reduce((e,t)=>(0,ac.Z)(e,function(e){try{return e.performance.getEntriesByType("resource").filter(e=>{let{duration:t,responseEnd:r,transferSize:i}=e;return t>0&&r>0&&i>1024})}catch(t){return[]}}(t),Oi),[]).filter(e=>{let{name:t}=e;return dc.j.test(t)});if(0===e.length)return{value:NaN,source:"timing-api"};const t=new fh.I;return e.forEach(e=>{let{transferSize:r,duration:i}=e;return t.sample(i,r)}),t.getBandwidthEstimate({value:NaN,source:"timing-api"})}function Ni(e){const{controller:{lastKnownBandwidthEstimate:t,playerConfig:r}}=e;if(isFinite(t.value))return t;if(null!=r&&r.slowConnection)return{value:ou.e,source:"default-slow"};const i=Dr();if(!isNaN(i)&&i>0)return{value:i,source:"cache"};const n=Di();if(!isNaN(n.value)&&n.value>0)return n;const s=function(e){void 0===e&&(e=window);const{navigator:t}=e,{connection:r={}}=t;if("number"===typeof r.downlink)return r.downlink;if("number"===typeof r.downlinkMax)return r.downlinkMax;if("string"===typeof r.type||"number"===typeof r.type)switch(r.type){case ph.BLUETOOTH:return 3;case hh.CELL_2G:return.384;case hh.CELL_3G:case ph.CELLULAR:return 2;case ph.WIMAX:return 37;case ph.NONE:return 0;case hh.ETHERNET:case ph.ETHERNET:case hh.WIFI:case ph.WIFI:case ph.MIXED:return 10;case hh.UNKNOWN:case ph.UNKNOWN:case ph.OTHER:}return-1}(window);return-1===s?{value:ou.S,source:"network-api"}:{value:1e3*s*1e3,source:"network-api"}}function Li(e,t){_d&&gh<81&&gh>77&&e.duration-t<.5&&(t=e.duration-.5),e.currentTime=t}function Mi(e){const{watchedTime:t=0}=e;return t<15?15:30}function Fi(e){const{currentTime:t=0,skippableFragments:r}=e;if(!r)return 30;const i=r.find(e=>t>=e.startTime&&t<e.endTime);if(i)return i.startTime,3;const n=r.find(e=>t<e.startTime);return n?n.startTime-t+nl:30}function xi(){return(xi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Vi(){return(Vi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Ui(){return(Ui=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Bi(e){if(Ph(e.message))return cs[e.message];if(Ph(e.code))return cs[e.code];const t=Du[e.code];return Ph(t)?cs[t]:cs.DEFAULT_ERROR}function Hi(e){if(void 0===e)return;const{id:t,label:r,language:i,bitrate:n}=e;return{name:r||i,value:t,lang:i||"",bitrate:n||void 0}}function ji(e){const t=(0,Xc.w)(e.audioTracks).find(e=>e.enabled);return t?Hi(t):void 0}function Wi(e){return"subtitles"===e.kind&&"StreamPlayerJs TextTrack"!==e.label}function Yi(e,t){if(void 0===e)return;const{id:r,label:i,language:n}=e;return{name:i||n,value:"undefined"!==typeof r&&""!==r?r:"index:"+t,lang:n||""}}function Gi(e){const t=[];return(0,Xc.w)(e).forEach(e=>{const r=Hi(e);r&&t.push(r)}),t}function zi(e){const t=[];return(0,Xc.w)(e).forEach((e,r)=>{if(!Wi(e))return;const i=Yi(e,r);i&&t.push(i)}),t}function qi(e){if(void 0===e)return;const{id:t,label:r,language:i,bitrate:n=bl,height:s=0,width:a=0,frameRate:o}=e;return{name:r||i,value:t,bitrate:n,height:s,width:a,frameRate:o}}function Ki(e){const t=[];return(0,Xc.w)(e).forEach(e=>{const r=qi(e);r&&t.push(r)}),t.filter(e=>{let{value:t}=e;return t!==kl.A})}function Qi(e){let{videoTracks:t=[],videoHeight:r,videoWidth:i}=e;const n=(0,Xc.w)(t),s=n.find(e=>{let{selected:t}=e;return t});if(void 0!==s)return s.id===kl.A?(e=>{let{tracks:t,videoHeight:r,videoWidth:i}=e;return t.sort((e,t)=>{const{width:n=0,height:s=0}=e,{width:a=0,height:o=0}=t;return Math.abs(s-r)-Math.abs(o-r)||Math.abs(n-i)-Math.abs(a-i)})[0]})({tracks:n,videoHeight:r,videoWidth:i}):s}function Zi(){return(Zi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Ji(e){let t,r=$n.Z,i=0;const n=e=>{i=e.status,t=e.response};return{promise:new Promise((t,i)=>{(0,Nh.W)(Zi({},e,{onSuccess:e=>{n(e),t(e)},onError:(e,t)=>{n(t),i(e)},onAbort:i,onSetup:e=>{let{abort:t}=e;return r=t}}))}),abort:e=>r(e),getStatus:()=>i,getResponse:()=>t}}function Xi(e){switch(e.error){case Lh.EXPIRED_SIGNATURE:return cs.DRM_PROXY_ERROR_SIGNATURE_EXPIRED;case Lh.NEED_COOKIE:return cs.DRM_PROXY_ERROR_NEED_COOKIE;case Lh.NEED_YATEAM_LOGIN:return cs.DRM_PROXY_ERROR_NEED_TEAM_LOGIN;case Lh.NEED_VIEW_PERMISSION:return cs.DRM_PROXY_ERROR_NEED_VIEW_PERMISSION;default:return cs.DRM_PROXY_ERROR}}function $i(e){return new ja({isFatal:e.isFatal,code:Xi(e),details:{drmProxyError:e.error},helpLink:e.helpLink})}function en(){return(en=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function tn(e,t){const r=(()=>{try{return function(e){return{error:String(e.error)||"",isFatal:Boolean(e.isFatal),helpLink:String(e.helpLink)||""}}(JSON.parse(e))}catch(t){return en({},Mh,{error:e})}})();return r.isFatal=r.isFatal||!isFinite(t)||t<=0,r}function rn(e,t){switch(e){case 429:return([500,2500,6500][t]||1e3)+1e3*Math.random();default:return 0}}function nn(){return(nn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function sn(e){return String.fromCharCode(...Array.from(e))}function an(e){return e.charCodeAt(0)}function on(e){return Array.from(e,an)}function ln(){return(ln=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function dn(e){const{ownerDocument:t}=e;if(!t)return;const{defaultView:r}=t;return r||void 0}function cn(e){return e&&dn(e)||window}function un(){return(un=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function hn(){return(hn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function pn(){return(pn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function fn(e,t){e.supportInfo.engine===Cl.HLS?function(e){if(e in ip)return ip[e];const t=document.createElement("link");t.rel="preload",t.as="script",ip[e]=new Promise((r,i)=>{t.onload=r,t.onerror=i,t.href=e,t.crossOrigin="anonymous",rp.appendChild(t)}).then(()=>{ip[e]=Promise.resolve()}).catch(()=>{delete ip[e],rp.removeChild(t)}),ip[e]}(eh):e.supportInfo.engine===Cl.YASP&&(Iu.setWorkerConfig(pn({},Qh,t)),Iu.warmUp())}function mn(e){const t=()=>op.forEach(e=>window.removeEventListener(e,r)),r=r=>{"pagehide"===r.type&&r.persisted||(e(r),t())};return op.forEach(e=>window.addEventListener(e,r)),t}function gn(e){return"ya-video-player-"+e}function vn(e,t){return function(e,t){if(!e)return;let r=e.parentElement;for(let i=t;i>0;i--)r=r&&r.parentElement;return r||void 0}(t.getElementById(gn(e)),2)}function yn(e,t){return void 0===e?void 0===t:"auto"in e&&!0===e.auto?t===kl.A:e.value===t}function En(e,t,r){void 0===r&&(r=nh());let i=t;return function(){var t;if(0===arguments.length)return;const n=(t=arguments.length-1)<0||arguments.length<=t?void 0:arguments[t],s=r(n,i)||Number.isNaN(n)&&Number.isNaN(i);return s?void 0:(i=n,e(...arguments))}}function Sn(e,t){const{controller:{textTrackValue:r,textTracks:i,userTextTrackName:n,userTextTrackLang:s}}=e.getState();if(r)return void t.setTextTrack(r);const a=Ri(i,{name:n,lang:s})||function(e){if(0===e.length)return;const t=function(e,t){if("string"!==typeof t)return;const r=t.split("-")[0].toLowerCase();for(let i=0;i<e.length;i++){const t=e[i];if(t.name.toLowerCase()===r)return t}}(e,navigator.language);return void 0!==t?t:e[0]}(i);void 0===a?xa.error("No text tracks to enable"):t.setTextTrack(a.value)}function An(e,t){const r=e.getState(),{skin:{nativeControlsVisibility:i},controller:{textTrackEnabled:n,nativeTextTrackVisible:s,isPip:a}}=r,o=void 0===s||s||a||Boolean(i&&n);t.toggleNativeSubtitles(o)}function Tn(e,t){const{skin:{hiddenControls:r}}=e.getState();t.setHiddenControls(r)}function bn(e,t){const r=e.getState(),{controller:{videoType:i,playbackRate:n,encoderState:s}}=r;i!==cl.Z.VOD&&s===ol.Attached&&(ze(r)||(n>1.03?function(e){const{controller:{currentTime:t,bufferingRanges:r,engine:i},skin:{skinDVRStartTime:n,skinDVRDuration:s}}=e;if(0===r.length)return!1;const a=i===Cl.NATIVE?5:0;return s===1/0||t>n+s-a}(r)&&t.setPlaybackRate(1):!function(e){const{controller:{currentTime:t,dvrStartTime:r,dvrDuration:i}}=e;return t<r||t>r+i}(r)&&function(e){const{controller:{videoType:t}}=e;if(t!==cl.Z.LIVE)return!1;const{controller:{currentTime:r},skin:{skinDVRStartTime:i}}=e;return i+(0===r?0:10)>r}(r)&&t.setPlaybackRate(1)))}function wn(e){return"number"!==typeof(t=Math.floor(2*e)/2)||isNaN(t)||!isFinite(t)?0:t;var t}async function _n(e,t){const{controller:{autoplay:r,encoderState:i}}=e.getState();r&&i===ol.Attached&&await t.play().catch(As.Z)}function Rn(e){return e instanceof Date||"Date"===(0,ra.M)(e)}function kn(e){const t=function(e){return Zt(e)&&mt(e).pathname.slice(1).split("/")[1]||""}(e);return{channel:t,metaInfoUrl:"https://strm.yandex.net/kal/"+t+"/break/last?start_ts={{video-timestamp}}"}}function Pn(e,t){const r=e.height||0;return(t.height||0)-r}function In(e){if(_a)return null;try{const t=oc(e.ownerDocument.defaultView);if(t.some(e=>{const{hasBeenActive:t}=(0,Jn.Y)(()=>function(e){const t=e.navigator;if(!t)return;const{userActivation:r}=t;if(!(0,ys.K)(r))return;const{isActive:i,hasBeenActive:n}=r;return{isActive:i,hasBeenActive:n}}(e))||{hasBeenActive:!1};return t}))return{muted:!1,allowed:!0,detectionMethod:"NavigationActive"}}catch(t){}return null}async function Cn(e,t,r){return r.stopped?null:(pi(e,()=>{e.load()}),_a&&(await(0,Rp._)(0),r.stopped)?null:(e.src=Fp,e.muted=t,e.volume=t?0:1,new Promise(i=>{ki(e,{useProgressEvent:!0,timeoutForNonPromisePlay:500}).then(e=>{if(r.stopped)return i(null);i({muted:t,allowed:!0,detectionMethod:"RealPlayPolicy|"+e})}).catch(()=>{if(r.stopped)return i(null);const n=Wr(e);n&&n.code===Du.MEDIA_ERR_DECODE?setTimeout(()=>{if(r.stopped)return i(null);i({muted:t,allowed:!0,detectionMethod:"RealPlayPolicy|OldBrowser"})},0):i(null)})})))}function On(e,t){if(void 0===t&&(t=window),!t||!t[e]||!t[e].prototype)return;const{play:r}=t[e].prototype;return r&&(0,Gs.t)(r)?r:void 0}function Dn(e){if(!Zn)return Promise.reject();const t=(r=e.play).__yaMuffleVideoPlayPromiseOriginalPlay||r;var r;if((0,Gs.t)(t))return t.call(e);const i=On("HTMLVideoElement")||On("HTMLMediaElement");if(i)return i.call(e);const n=document.createElement("div");n.style.display="none",document.body.appendChild(n);const s=On("HTMLMediaElement",function(e,t){let{content:r,size:i}=void 0===t?{}:t;const n=e.ownerDocument.createElement("iframe");n.scrolling="no",n.setAttribute("allowfullscreen",""),n.style.display="block",i&&(n.height=i.height,n.width=i.width),e.appendChild(n);const s=n.contentDocument;s.open(),r&&s.write(r),s.close();try{s.body.style.margin="0"}catch(a){}return n.style.borderWidth="0",n}(n).contentWindow);if(s){const t=s.call(e);return te(n),t}return e.play()}function Nn(e,t){var r,i,n,s;let{initialMuted:a,checkMuted:o,checkUnmuted:l,process:d}=t;if(!o&&!l)return{muted:a,allowed:!1,detectionMethod:"NoCheck"};const{muted:c,paused:u,volume:h}=e,p=e.getAttribute("src"),f=()=>{null===p?e.removeAttribute("src"):e.setAttribute("src",p),e.load(),e.muted=c,e.volume=h,u?e.pause():e.paused&&(0,Kn.v)(Dn(e))},m=null!=(r=null!=(i=null!=(n=null!=(s=null!=null?null:In(e))?s:function(e,t){let{checkMuted:r,checkUnmuted:i}=t;try{if("boolean"===typeof e.allowedToPlay){const t=e;if(i&&(t.muted=!1,t.volume=1,t.allowedToPlay))return{muted:!1,allowed:!0,detectionMethod:"YandexBrowser"};if(r)return t.muted=!0,t.volume=0,{muted:!0,allowed:t.allowedToPlay,detectionMethod:"YandexBrowser"}}}catch(n){}return null}(e,{checkMuted:o,checkUnmuted:l}))?n:function(e){try{switch(navigator.getAutoplayPolicy(e)){case"allowed":return{muted:!1,allowed:!0,detectionMethod:"NavigatorAutoplayPolicy"};case"allowed-muted":return{muted:!0,allowed:!0,detectionMethod:"NavigatorAutoplayPolicy"};case"disallowed":return{muted:!1,allowed:!1,detectionMethod:"NavigatorAutoplayPolicy"};default:return null}}catch(t){return null}}(e))?i:Mp>-1&&Mp<=16?{muted:!1,allowed:!0,detectionMethod:"IEPolicy"}:null)?r:rh&&Gd.major<=9?{muted:!1,allowed:!1,detectionMethod:"IosTill9Policy"}:null;if(null===m){if(l)return Cn(e,!1,d).then(t=>null!=t?t:o?Cn(e,!0,d):null).then(e=>null!=e?e:{muted:a,allowed:!1,detectionMethod:"RestUnmuted"}).then(e=>(f(),e));if(o)return Cn(e,!0,d).then(e=>null!=e?e:{muted:a,allowed:!1,detectionMethod:"RestMuted"}).then(e=>(f(),e))}return f(),null!=m?m:{muted:a,allowed:!1,detectionMethod:"Default"}}function Ln(){return(Ln=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Mn(e,t){const r="cover"===t.objectFit?{transform:"translate(-1px, -1px)",height:"calc(100% + 2px)",width:"calc(100% + 2px)"}:{transform:"",height:"",width:""};!function(e,t){const r=e.style;for(const i in t)if(t.hasOwnProperty(i)){r[jp(i)]=t[i]}}(e,Ln({},"objectFit"in t?r:{},t))}function Fn(){return(Fn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function xn(e){void 0===e&&(e=window);const t=(0,as.i)(e).match(/YaBrowser\/([\d]+)\.([\d]+)/);if(!t)return{major:-1,minor:-1};const[,r,i]=t;return{major:parseInt(r,10),minor:parseInt(i,10)}}function Vn(){return hd(window)&&!rh&&!Wd}function Un(e,t){return fa.some(r=>{if(!e[r.element])return!1;let i=t;for(;i;){if(e[r.element]===i)return!0;i=i.parentElement}return!1})}function Bn(e){return(0,rs.m)(e.toJSON)?e.toJSON():e}function Hn(){return(Hn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function jn(e,t,r){if(void 0===r&&(r=window),!r.history)return;if(Mp>-1&&Mp<=15)return;const i=((e,t,r)=>{const i=Hn({},c(e));i.mq_url=void 0,i.lq_url=void 0,i.hq_url=void 0,i.hd_url=void 0,i.stream_url=r?function(e,t){return-1===e.indexOf("?")?e:t.reduce(Kt,e)}(r,["vsid","partner-id","video-category-id","imp-id","gzip"]):"",i.additional_params="object"===typeof t.additionalParams?JSON.stringify(t.additionalParams):void 0;const{adConfig:n={}}=t;return i.partner_id=rf(n.partnerId),i.category=rf(n.category),i.imp_id=rf(n.impId),i.distr_id=rf(n.distrId),i.video_content_id=rf(n.videoContentId),i.video_content_name=rf(n.videoContentName),i.video_publisher_id=rf(n.videoPublisherId),i.video_publisher_name=rf(n.videoPublisherName),i.video_genre_id=rf(n.videoGenreId),i.video_genre_name=rf(n.videoGenreName),i.start_position=rf(t.startPosition),i.loop=rf(t.loop),i.with_credentials=rf(t.withCredentials),i.preview=rf(t.preview),i.host=e.hostname,i})(r.location,e,t),n=function(e,t,r){void 0===r&&(r={});for(const i in t)t.hasOwnProperty(i)&&(e=Gt(e,i,t[i]));for(const i in r)r.hasOwnProperty(i)&&(e=zt(e,i,r[i]));return e}(r.location.href.split("?")[0].split("#")[0],i);try{r.history.replaceState(void 0,"",n)}catch(s){}}function Wn(){return(Wn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Yn(e){const t=e.getVideoType(),r=e.getTimelineInfo();if(t!==cl.Z.LIVE)return r;const{currentTime:i,utcStartTime:n,dvrStartTime:s,dvrDuration:a}=r;return{dvrDuration:a,dvrStartTime:(n||0)+s,utcStartTime:0,duration:1/0,currentTime:(n||0)+i}}function Gn(e,t){if(e.getVideoType()!==cl.Z.LIVE)return t;const{utcStartTime:r=0}=e.getTimelineInfo();return t.map(e=>{let{start:t,end:i}=e;return{start:r+t,end:r+i}})}function zn(e,t){if(e.getVideoType()!==cl.Z.LIVE)return t;const{utcStartTime:r=0}=e.getTimelineInfo();return t-r}function qn(){return df?df.getSourceId():NaN}r(7369);var Kn=r(6252);const Qn=document.createElement("video"),Zn="function"===typeof Qn.load;(function(){function e(){const e=t.apply(this);return(0,Kn.v)(e),e}if(!Zn)return;const t=HTMLMediaElement.prototype.play;e.__yaMuffleVideoPlayPromiseOriginalPlay=t,HTMLMediaElement.prototype.play=e})();var Jn=r(8712);"toJSON"in Error.prototype||Object.defineProperty(Error.prototype,"toJSON",{value(){const e={};return(0,Jn.Y)(()=>{Object.getOwnPropertyNames(this).forEach((function(t){e[t]=this[t]}),this)}),e},configurable:!0,writable:!0});var Xn=r(3603),$n=r(4612);const es=()=>{},ts=e=>!0;var rs=r(4754);r(5235),r(7873),r(9418),function(e){void 0===e&&(e=d(window));try{if("1"===localStorage.getItem("rumdebug"))return console&&(0,rs.m)(console.warn)&&console.warn("using rumdebug=1 from localStorage"),!0}catch(t){}return/[?&#]rumdebug=1(?:[&#]|$)/.test(e)}()&&l({win:window,src:"https://yastatic.net/s3/home/rum/debug/blockstat.js"});var is=r(2178);const ns=c(window.location);(0,is.ZP)(ns);var ss=r(5357),as=r(1247);const os=function(e){void 0===e&&(e=window);const t=(0,as.i)(e).toLowerCase();return/windows/.test(t)}(),ls=function(e){void 0===e&&(e=window);const t=(0,as.i)(e).toLowerCase(),r=/windows nt (\d+\.\d+)/.exec(t);if(r){const e=Number(r[1]);return e>0?e:-1}return-1}();var ds=r(6971);let cs,us;!function(e){e.DEFAULT_ERROR="DEFAULT_ERROR",e.YANDEX_RPC_ERROR="YANDEX_RPC_ERROR",e.BROADCAST_AD_BLOCK_INIT_ERROR="BROADCAST_AD_BLOCK_INIT_ERROR",e.AD_TYPE_IS_NOT_RECOGNIZED="AD_TYPE_IS_NOT_RECOGNIZED",e.INVALID_METADATA="INVALID_METADATA",e.INVALID_STREAM_URL="INVALID_STREAM_URL",e.UNSUPPORTED_MEDIA_TYPE="UNSUPPORTED_MEDIA_TYPE",e.SCRIPT_INIT_ERROR="SCRIPT_INIT_ERROR",e.MPD_WIDEVINE_CERT_LOAD_ERROR="MPD_WIDEVINE_CERT_LOAD_ERROR",e.NATIVE_HLS_NOT_SUPPORTED_ERROR="NATIVE_HLS_NOT_SUPPORTED_ERROR",e.HLS_JS_NOT_SUPPORTED_ERROR="HLS_JS_NOT_SUPPORTED_ERROR",e.ON_TICK_ERROR="ON_TICK_ERROR",e.FAIRPLAY_NOT_SUPPORTED="FAIRPLAY_NOT_SUPPORTED",e.FAIRPLAY_CERT_LOAD_ERROR="FAIRPLAY_CERT_LOAD_ERROR",e.FAIRPLAY_CREATE_MEDIA_KEYS_ERROR="FAIRPLAY_CREATE_MEDIA_KEYS_ERROR",e.FAIRPLAY_CREATE_KEY_SESSION_ERROR="FAIRPLAY_CREATE_KEY_SESSION_ERROR",e.FAIRPLAY_SPC_LOAD_ERROR="FAIRPLAY_SPC_LOAD_ERROR",e.FAIRPLAY_CREATE_KEY_ERROR="FAIRPLAY_CREATE_KEY_ERROR",e.FAIRPLAY_INVALID_CONTENT_ID="FAIRPLAY_INVALID_CONTENT_ID",e.DRM_PROXY_ERROR="DRM_PROXY_ERROR",e.DRM_PROXY_ERROR_SIGNATURE_EXPIRED="DRM_PROXY_ERROR_SIGNATURE_EXPIRED",e.DRM_PROXY_ERROR_NEED_COOKIE="DRM_PROXY_ERROR_NEED_COOKIE",e.DRM_PROXY_ERROR_NEED_TEAM_LOGIN="DRM_PROXY_ERROR_NEED_TEAM_LOGIN",e.DRM_PROXY_ERROR_NEED_VIEW_PERMISSION="DRM_PROXY_ERROR_NEED_VIEW_PERMISSION",e.DRM_INIT_ERROR="DRM_INIT_ERROR",e.DRM_NO_INIT_DATA="DRM_NO_INIT_DATA",e.DRM_CERT_LOAD_ERROR="DRM_CERT_LOAD_ERROR",e.DRM_NO_SUPPORTED_KEY_SYSTEM="DRM_NO_SUPPORTED_KEY_SYSTEM",e.DRM_FAILED_TO_CREATE_CDM="DRM_FAILED_TO_CREATE_CDM",e.DRM_FAILED_TO_SET_MEDIA_KEYS="DRM_FAILED_TO_SET_MEDIA_KEYS",e.DRM_NO_LICENSE_SERVER="DRM_NO_LICENSE_SERVER",e.DRM_FAILED_TO_CREATE_SESSION="DRM_FAILED_TO_CREATE_SESSION",e.DRM_SESSION_ERROR="DRM_SESSION_ERROR",e.DRM_FAILED_TO_GENERATE_REQUEST="DRM_FAILED_TO_GENERATE_REQUEST",e.DRM_UNKNOWN_ERROR="DRM_UNKNOWN_ERROR",e.NO_HLS_JS_INSTANCE="NO_HLS_JS_INSTANCE",e.AD_IS_ALREADY_PLAYING="AD_IS_ALREADY_PLAYING",e.META_INFO_REQUEST_FAILED="META_INFO_REQUEST_FAILED",e.MULTIROLL_INIT_ERROR="MULTIROLL_INIT_ERROR",e.REACT_COMPONENT_DID_CATCH_ERROR_INFO="REACT_COMPONENT_DID_CATCH_ERROR_INFO",e.PLAY_AD_VIEWERS_ERROR="PLAY_AD_VIEWERS_ERROR",e.SAGA_ERROR="SAGA_ERROR",e.STRM_ABD_INVALID_RESPONSE="STRM_ABD_INVALID_RESPONSE",e.REPRESENTATION_CHANGE="REPRESENTATION_CHANGE",e.RECOVER_TASK_ERROR="RECOVER_TASK_ERROR",e.PRELOAD_SOURCE_FAILED="PRELOAD_SOURCE_FAILED",e.REGIONAL_LIMITATION_MANIFEST="REGIONAL_LIMITATION_MANIFEST",e.REGIONAL_LIMITATION_LEVEL="REGIONAL_LIMITATION_LEVEL",e.REGIONAL_LIMITATION_SEGMENT="REGIONAL_LIMITATION_SEGMENT",e.SIGNATURE_EXPIRED_MANIFEST="SIGNATURE_EXPIRED_MANIFEST",e.SIGNATURE_EXPIRED_LEVEL="SIGNATURE_EXPIRED_LEVEL",e.SIGNATURE_EXPIRED_SEGMENT="SIGNATURE_EXPIRED_SEGMENT",e.BANNED_MANIFEST="BANNED_MANIFEST",e.BANNED_LEVEL="BANNED_LEVEL",e.BANNED_SEGMENT="BANNED_SEGMENT",e.MANIFEST_NOT_FOUND="MANIFEST_NOT_FOUND",e.NO_STREAMS="NO_STREAMS",e.NO_CODECS="NO_CODECS",e.NO_MSE="NO_MSE",e.NO_DRM_CONFIG="NO_DRM_CONFIG",e.NO_DRM="NO_DRM",e.NO_PLAYABLE_STREAMS="NO_PLAYABLE_STREAMS",e.MEDIA_ERR_CUSTOM="MEDIA_ERR_CUSTOM",e.MEDIA_ERR_ABORTED="MEDIA_ERR_ABORTED",e.MEDIA_ERR_NETWORK="MEDIA_ERR_NETWORK",e.MEDIA_ERR_DECODE="MEDIA_ERR_DECODE",e.MEDIA_ERR_SRC_NOT_SUPPORTED="MEDIA_ERR_SRC_NOT_SUPPORTED",e.MEDIA_ERR_ENCRYPTED="MEDIA_ERR_ENCRYPTED"}(cs||(cs={})),function(e){e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.BUFFER_STALLED_ERROR="bufferStalledError",e.FRAG_PARSING_ERROR="fragParsingError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.PIPELINE_ERROR_DECODE="PIPELINE_ERROR_DECODE",e.DECODER_ERROR_NOT_SUPPORTED="DECODER_ERROR_NOT_SUPPORTED",e.BUFFER_APPEND_ERROR="bufferAppendError",e.MEDIA_ELEMENT_ERROR_FORMAT_ERROR="MEDIA_ELEMENT_ERROR: Format error",e.REMUX_ALLOC_ERROR="remuxAllocError",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.DEMUXER_ERROR_COULD_NOT_OPEN="DEMUXER_ERROR_COULD_NOT_OPEN",e.NS_ERROR_DOM_INVALID_STATE_ERR="NS_ERROR_DOM_INVALID_STATE_ERR",e.CHUNK_DEMUXER_ERROR_APPEND_FAILED="CHUNK_DEMUXER_ERROR_APPEND_FAILED",e.FAILED_TO_INIT_DECODER="Failed to init decoder",e.PIPELINE_ERROR_INITIALIZATION_FAILED="PIPELINE_ERROR_INITIALIZATION_FAILED",e.NS_ERROR_FAILURE="NS_ERROR_FAILURE",e.REQUEST_FAILED="2147500036: Request failed",e.PIPELINE_ERROR_EXTERNAL_RENDERER_FAILED="PIPELINE_ERROR_EXTERNAL_RENDERER_FAILED",e.PIPELINE_ERROR_COULD_NOT_RENDER="PIPELINE_ERROR_COULD_NOT_RENDER",e.MEDIA_ELEMENT_ERROR_EMPTY_SRC_ATTRIBUTE="MEDIA_ELEMENT_ERROR: Empty src attribute",e.NS_ERROR_DOM_MEDIA_METADATA_ERR="NS_ERROR_DOM_MEDIA_METADATA_ERR",e.NS_ERROR_DOM_MEDIA_FATAL_ERR="NS_ERROR_DOM_MEDIA_FATAL_ERR",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.FRAG_LOAD_ERROR="fragLoadError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.LEVEL_LOAD_ERROR="levelLoadError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.FRAG_LOAD_TIME_OUT="fragLoadTimeOut",e.MANIFEST_LOAD_TIME_OUT="manifestLoadTimeOut",e.LEVEL_LOAD_TIME_OUT="levelLoadTimeOut",e.AUDIO_TRACK_LOAD_TIME_OUT="audioTrackLoadTimeOut",e.INTERNAL_EXCEPTION="internalException",e.ON_PLAYER_INIT_ERROR_INTERNAL="ON_PLAYER_INIT_ERROR_INTERNAL",e.UNABLE_TO_LOAD_PLAYER_IFRAME="UNABLE_TO_LOAD_PLAYER_IFRAME",e.ON_PLAYER_INIT_ERROR="ON_PLAYER_INIT_ERROR",e.LOADER_INIT_ERROR="LoaderInitError",e.UNABLE_TO_LOAD_PLAYER_INTERNAL_SCRIPT="UNABLE_TO_LOAD_PLAYER_INTERNAL_SCRIPT",e.FAILED_TO_DOWNLOAD_DEBUG_INFO="FAILED_TO_DOWNLOAD_DEBUG_INFO",e.PLAYER_CONTAINER_NOT_FOUND="PLAYER_CONTAINER_NOT_FOUND",e.KEY_LOAD_ERROR="keyLoadError",e.FEATURE_HANDLER_ERROR="FEATURE_HANDLER_ERROR",e.INVALID_CONFIG_ELEMENT_IN_CREATE_PLAYER="InvalidConfigElementInCreatePlayer",e.INVALID_CONFIG_LANG_IN_CREATE_PLAYER="InvalidConfigLangInCreatePlayer",e.INVALID_CONFIG_IN_CREATE_PLAYER="InvalidConfigInCreatePlayer",e.INVALID_CONFIG_IN_SET_SOURCE="InvalidConfigInSetSource",e.INVALID_CONFIG_IN_SOURCE_UPDATE="InvalidConfigInSourceUpdate",e.INVALID_LOG_URL="InvalidLogUrl",e.IFRAME_DOES_NOT_ALLOW_DRM="IframeDoesNotAllowDrm",e.DRM_IS_NOT_ALLOWED="DrmIsNotAllowed",e.EXTERNAL_POST_MESSENGER_SEND_MESSAGE_ERROR="EXTERNAL_POST_MESSENGER_SEND_MESSAGE_ERROR",e.INTERNAL_POST_MESSENGER_SEND_MESSAGE_ERROR="INTERNAL_POST_MESSENGER_SEND_MESSAGE_ERROR",e.LOAD_SKIN_ERROR="LOAD_SKIN_ERROR",e.INSERT_INTO_WITH_SECURE_FRAME="INSERT_INTO_WITH_SECURE_FRAME",e.PLAY_AD_VIEWERS_WITH_SECURE_FRAME="PLAY_AD_VIEWERS_WITH_SECURE_FRAME",e.ELEMENT_NOT_IN_DOM="ELEMENT_NOT_IN_DOM",e.ERROR_SCREEN_LOAD_ERROR="ERROR_SCREEN_LOAD_ERROR",e.REQUEST_SOURCE_ERROR="REQUEST_SOURCE_ERROR",e.SCREEN_WAKE_LOCK_ERROR="SCREEN_WAKE_LOCK_ERROR"}(us||(us={}));const hs={[ds.q.MEDIA]:"https://yandex.ru/support/video-player/loading-issues.html",[ds.q.NETWORK_MEDIA]:"https://yandex.ru/support/video-player/loading-issues.html",[ds.q.NETWORK_PLAYER]:"https://yandex.ru/support/video-player/player-issues.html",[ds.q.NETWORK_TIMEOUT]:"https://yandex.ru/support/video-player/player-issues.html",[ds.q.NO_CODECS]:"https://yandex.ru/search/?text=\u043a\u043e\u0434\u0435\u043a\u0438",[ds.q.UNSUPPORTED_ENV]:"https://yandex.ru/soft/browsers/",[ds.q.EXCEPTION]:"https://yandex.ru/support/video-player/loading-issues.html",[ds.q.DRM]:"https://yandex.ru/support/video-player/drm.html",[ds.q.BANNED]:null},ps={[ds.q.DEFAULT]:"DEFAULT_ERROR_CATEGORY_TITLE",[ds.q.MEDIA]:"MEDIA_ERROR_CATEGORY_TITLE",[ds.q.NETWORK_MEDIA]:"NETWORK_MEDIA_ERROR_CATEGORY_TITLE",[ds.q.NETWORK_PLAYER]:"NETWORK_PLAYER_ERROR_CATEGORY_TITLE",[ds.q.NETWORK_TIMEOUT]:"NETWORK_TIMEOUT_ERROR_CATEGORY_TITLE",[ds.q.NO_CODECS]:"NO_CODECS_ERROR_CATEGORY_TITLE",[ds.q.UNSUPPORTED_ENV]:"UNSUPPORTED_ENV_ERROR_CATEGORY_TITLE",[ds.q.CANNOT_PLAY]:"CANNOT_PLAY_ERROR_CATEGORY_TITLE",[ds.q.EXCEPTION]:"EXCEPTION_ERROR_CATEGORY_TITLE",[ds.q.CONFIG]:"CONFIG_ERROR_CATEGORY_TITLE",[ds.q.REGIONAL]:"REGIONAL_ERROR_CATEGORY_TITLE",[ds.q.DRM]:"DRM_ERROR_CATEGORY_TITLE",[ds.q.ACCESS]:"ACCESS_ERROR_CATEGORY_TITLE",[ds.q.BANNED]:"BANNED_ERROR_CATEGORY_TITLE"},fs={[ds.q.DEFAULT]:"DEFAULT_ERROR_CATEGORY_MESSAGE",[ds.q.MEDIA]:"MEDIA_ERROR_CATEGORY_MESSAGE",[ds.q.NETWORK_MEDIA]:"NETWORK_MEDIA_ERROR_CATEGORY_MESSAGE",[ds.q.NETWORK_PLAYER]:"NETWORK_PLAYER_ERROR_CATEGORY_MESSAGE",[ds.q.NETWORK_TIMEOUT]:"NETWORK_TIMEOUT_ERROR_CATEGORY_MESSAGE",[ds.q.NO_CODECS]:"NO_CODECS_ERROR_CATEGORY_MESSAGE",[ds.q.UNSUPPORTED_ENV]:"UNSUPPORTED_ENV_ERROR_CATEGORY_MESSAGE",[ds.q.CANNOT_PLAY]:"CANNOT_PLAY_ERROR_CATEGORY_MESSAGE",[ds.q.EXCEPTION]:"EXCEPTION_ERROR_CATEGORY_MESSAGE",[ds.q.CONFIG]:"CONFIG_ERROR_CATEGORY_MESSAGE",[ds.q.DRM]:"DRM_ERROR_CATEGORY_MESSAGE",[ds.q.ACCESS]:"ACCESS_ERROR_CATEGORY_MESSAGE",[ds.q.BANNED]:"BANNED_ERROR_CATEGORY_MESSAGE"},ms={[ds.q.NO_CODECS]:"NO_CODECS_ERROR_CATEGORY_HELP_LINK",[ds.q.UNSUPPORTED_ENV]:"UNSUPPORTED_ENV_ERROR_CATEGORY_HELP_LINK"},gs="3036",vs="2923";var ys=r(5689),Es=r(4519);const Ss=e=>"hidden"in e?"hidden":"webkitHidden"in e?"webkitHidden":void 0;var As=r(3487);let Ts,bs=p(document);f(document,e=>{e||(bs=e)});let ws=-1;const _s=["additional"],Rs=["additional","initSubpage"],ks=["additional"],Ps=e=>{const t=[];for(;e;)try{if(_(e),t.push(e),e.parent===e)break;e=e.parent}catch(r){break}return t},Is=(e,t)=>{for(const r of t.split(".")){if(!k(e)){e=void 0;break}e=e[r]}return e},Cs="__ADB_CONFIG__",Os=(e,t,r)=>{for(let i=0;i<e.length;i++)t.call(r,e[i],i,e)},Ds=k(Cs)&&k(Cs.fn)?Cs.fn:void 0,Ns=["encodeUrl","decodeUrl","encodeCSS","isEncodedUrl"],Ls=e=>(e=>{if(Ds)return Ds;const t={},r=Ps(e);for(;r.length;){const e=r.pop();e&&Os(Ns,r=>{if(R(t[r]))return;const i=Is(e,"ya.videoAd."+r);R(i)&&(t[r]=i)})}return t})(e).encodeUrl;var Ms=r(2988);const Fs=function(e){return void 0===e&&(e=window),-1!==(0,Ms.N)(e)}(),xs=function(e){return void 0===e&&(e=window),(0,as.i)(e).indexOf("SamsungBrowser")>-1}();var Vs=r(8243),Us=r(6295);const Bs=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=Hs);for(let n=r;n<e.length;n++)if(i(e[n],t))return n;return-1},Hs=(e,t)=>e===t;var js=r(9298);const Ws=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const{resolver:i,preparers:n}=I(t);let s,a=null,o=null;return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(a&&a.every((e,r)=>t[r]===e))return s;const l=n.map(e=>e(...t));if(o&&o.every((e,t)=>l[t]===e))return a=t,s;const d=i(...l);return a=t,o=l,s=d,d}};var Ys=r(9899),Gs=r(2839);const zs="http://www.w3.org/2000/svg",qs="classList"in document.documentElement,Ks=Ws(e=>e.classList&&e.classList.add,Gs.t),Qs=Ws(e=>e.classList&&e.classList.remove,Gs.t),Zs=(()=>{const e=document.createElement("p");return!!qs&&(e.classList.add("c1","c2"),!!e.classList.contains("c2")&&(e.classList.toggle("c3",!1),!e.classList.contains("c3")))})(),Js=e=>e.split(" ").filter(e=>Boolean(e)),Xs=Zs?(e,t)=>{const r=Js(t);e.classList.add(...r)}:(e,t)=>{const r=Js(t);for(let i=0;i<r.length;i++)e.classList.add(r[i])},$s=function(e,t){return void 0===t&&(t=""),Qs(e)?ea(e,t):function(e,t){const r=C(e).split(" "),i=t.split(" "),n=[];for(let s=0;s<r.length;s++)r[s]&&-1===Bs(i,r[s])&&n.push(r[s]);O(e,n.join(" "))}(e,t)},ea=Zs?(e,t)=>{const r=Js(t);e.classList.remove(...r)}:(e,t)=>{const r=Js(t);for(let i=0;i<r.length;i++)e.classList.remove(r[i])},ta=e=>{try{const{left:t,right:r,top:i,bottom:n}=e.getBoundingClientRect();return{left:t,right:r,top:i,bottom:n,width:r-t,height:n-i}}catch(t){return{left:0,width:0,top:0,height:0,right:0,bottom:0}}};var ra=r(9951);const ia=(0,r(3635).C)(Array,"isArray"),na=ia?e=>ia.call(Array,e):e=>"Array"===(0,ra.M)(e);r(9761);const sa=$n.Z,aa=$n.Z,oa=$n.Z;(e=>{let{win:t,propertyName:r}=e})({propertyName:"YANDEX_DESTROYABLE_GLOBAL_CALLBACK_PROPERTY_NAME",win:window});class la{get destroyReason(){return this._destroyReason}get isDestroyed(){return this._isDestroyed}static addErrorHandler(e){la.errorHandlers.push(e)}constructor(){this._isDestroyed=!1,this.destroyHandlers=[],this._destroyReason=void 0}addDestroyHandler(e){this._isDestroyed?e(this._destroyReason):this.destroyHandlers.push(e)}destroy(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const[i]=t;if(!this._isDestroyed){this._isDestroyed=!0,this._destroyReason=i;try{N(this.destroyHandlers,...t)}catch(n){N(la.errorHandlers,n)}this.destroyHandlers.length=0}}}la.errorHandlers=[];class da{constructor(){this.on=[],this.once=[]}add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.on.push(...t),()=>this.remove(...t)}addOne(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.once.push(...t),()=>this.remove(...t)}promise(){return new Promise(e=>this.addOne(e))}dispatch(e){const{once:t}=this;this.once=[],F(this.on,e),F(t,e)}removeAll(){this.on.length=0,this.once.length=0}remove(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.on=this.on.filter(e=>t.indexOf(e)<0),this.once=this.once.filter(e=>t.indexOf(e)<0)}}class ca extends da{constructor(e,t){void 0===t&&(t=(e,t)=>e===t),super(),this.checkToEqualFunction=t,this.value=void 0,this.value=e}getValue(){return this.value}subscribeValueCondition(e,t){return this.add(r=>{e(r)&&M(t,r)})}subscribeValueConditionOnce(e,t){const r=this.subscribeValueCondition(e,e=>{r(),M(t,e)});return r}dispatch(e){this.checkToEqualFunction(this.value,e)||(this.value=e,super.dispatch(e))}}let ua=0;const ha=[];r(7881);class pa extends la{constructor(e){super(),this.onResize=void 0,this.resizeObserverCallback=e=>{let[{contentRect:{width:t,height:r}}]=e;this.onResize.dispatch({width:t,height:r})};const t=ta(e);if(this.onResize=new ca({width:t.width,height:t.height},(e,t)=>{let{width:r,height:i}=t;return!!(isNaN(r)||isNaN(i)||r<1||i<1)||e.width===r&&e.height===i}),this.addDestroyHandler(()=>{this.onResize.removeAll()}),"undefined"!==typeof ResizeObserver)try{const t=new ResizeObserver(this.resizeObserverCallback);t.observe(e),this.addDestroyHandler(()=>{t.disconnect()})}catch(r){this.fallbackToCustomDetectionMethods(e)}else this.fallbackToCustomDetectionMethods(e)}getSize(){return V({},this.onResize.getValue())}fallbackToCustomDetectionMethods(e){const{ownerDocument:t}=e;if(!t)return;const{defaultView:r}=t;if(!r)return;const i=()=>{const t=ta(e);this.onResize.dispatch({width:t.width,height:t.height})};this.addDestroyHandler((0,Vs.O)(r,"resize",i,{passive:!0})),this.addDestroyHandler(x(i))}}const fa=[{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",events:{change:"fullscreenchange",error:"fullscreenerror"}},{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",events:{change:"webkitfullscreenchange",error:"webkitfullscreenerror"}},{enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",events:{change:"mozfullscreenchange",error:"mozfullscreenerror"}},{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",events:{change:"MSFullscreenChange",error:"MSFullscreenError"}},{enabled:"webkitSupportsFullscreen",element:"webkitDisplayingFullscreen",request:"webkitEnterFullscreen",exit:"webkitExitFullscreen",events:{change:"webkitfullscreenchange",error:"webkitfullscreenerror"}}];var ma=r(1153);const ga=e=>function(e){return e instanceof Promise||"Promise"===(0,ra.M)(e)&&Boolean((0,Jn.Y)(()=>(0,Gs.t)(e.constructor)))}(e)||(e=>Boolean((0,Jn.Y)(()=>(0,rs.m)(e.then)&&(0,rs.m)(e.catch))))(e);var va=r(7989),ya=r(3125);const Ea=e=>{let t=0;return{promise:new Promise(r=>{t=window.setTimeout(r,e)}),clear(){clearTimeout(t)},timeoutId:t}};let Sa,Aa;!function(e){e.PLAY="play",e.PAUSE="pause",e.BUFFERING="buffering",e.END="end"}(Sa||(Sa={})),function(e){e.ALL="*",e.PLAY="play",e.START_SCREEN_PLAY="startScreenPlay",e.VOLUME="sound",e.VOLUME_SLIDER="volumeSlider",e.SETTINGS="settings",e.SETTINGS_ITEM="settingsItem",e.FULLSCREEN="fullscreen",e.TIMELINE="timeline",e.TIMELINE_PREVIEW="timelinePreview",e.LIVE="live",e.POSTER="poster",e.START_POSITION_CONFIRM="startPositionConfirm",e.TIME_DISPLAY="time",e.TITLE_DISPLAY="titleDisplay",e.REPORT="report",e.FORWARD="forward",e.BACKWARD="backward",e.LOGO="logo",e.PRELOADER="preloader",e.CONTEXT_MENU="contextMenu",e.START_SCREEN="startScreen",e.PLAYBACK_RATE="playbackRate",e.SKIPPABLE_FRAGMENTS="skippableFragments",e.EXTERNAL_PLAYBACK="externalPlayback",e.RECOMMENDATIONS="recommendations",e.CLOSE_BUTTON="closeButton",e.NEXT_AD_INFO="nextAdInfo",e.SUBTITLES_TOGGLE="subtitlesToggle",e.LOGO_WIDGET="logoWidget",e.SKIP_AD="skipAd",e.MOBILE_SEEK_BUTTONS="mobileSeekButtons",e.TITLE="title"}(Aa||(Aa={}));const Ta=(0,js.Z)(Aa).map(e=>Aa[e]);var ba=r(5940);const wa=function(e){void 0===e&&(e=window);const t=(0,as.i)(e).toLowerCase();if(t.indexOf("android")>-1)return!1;const r=t.replace(/\(.+?\)/gi,"").split(" ").map(e=>e.trim().split("/")[0]).filter(e=>e&&"mobile"!==e);return 4===r.length&&"mozilla"===r[0]&&"applewebkit"===r[1]&&"version"===r[2]&&"safari"===r[3]},_a=function(e){return void 0===e&&(e=window),wa(e)||W(e)||function(e){return void 0===e&&(e=window),/Apple/.test(e.navigator.vendor)&&(0,ba.b)(e)}(e)}(),Ra=_a?"":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";var ka=r(5636);const Pa=NaN;var Ia=r(9329);let Ca,Oa,Da,Na,La;!function(e){e.BroadcastAdReceived="BroadcastAdReceived",e.BroadcastAdInit="BroadcastAdInit",e.StreamPlayerReceivedMetadata="StreamPlayerReceivedMetadata",e.StreamPlayerChooseMetadata="StreamPlayerChooseMetadata",e.PlayWithoutRAAResults="PlayWithoutRAAResults",e.CanPlay="CanPlay",e.ContentImpression="ContentImpression",e.WaitForPlayCompleted="WaitForPlayCompleted",e.DrmSystemsSupportDetected="DrmSystemsSupportDetected",e.InrollAdStart="InrollAdStart",e.InrollAdPodStart="InrollAdPodStart",e.InrollAdPodEnd="InrollAdPodEnd",e.InrollAdEnd="InrollAdEnd",e.PlayAdViewers="PlayAdViewers",e.AdStart="AdStart",e.AdPodImpression="AdPodImpression",e.AdPodLoading="AdPodLoading",e.AdPodError="AdPodError",e.AdPodStart="AdPodStart",e.AdPodEnd="AdPodEnd",e.AdEnd="AdEnd",e.AdClickThru="AdClickThru",e.NoAdPodsToPlayAd="NoAdPodsToPlayAd",e.Stalled="Stalled",e.NudgeStalledFailed="NudgeStalledFailed",e.LoadSource="LoadSource",e.PrerollInit="PrerollInit",e.WaitForUserGesture="WaitForUserGesture",e.WaitForDocumentVisibility="WaitForDocumentVisibility",e.HiddenAutoplayPrevented="HiddenAutoplayPrevented",e.PlayVideoOnVisibilityChange="PlayVideoOnVisibilityChange",e.PauseVideoOnVisibilityChange="PauseVideoOnVisibilityChange",e.StreamStopWhileLoadingMultiroll="StreamStopWhileLoadingMultiroll",e.StreamStopWhileChoosingStream="StreamStopWhileChoosingStream",e.StreamStopWhileDestroyVideoController="StreamStopWhileDestroyVideoController",e.StreamStopDuringDefineAutoplaySettings="StreamStopDuringDefineAutoplaySettings",e.StreamStopWhileWaitingForPlay="StreamStopWhileWaitingForPlay",e.StreamStopWhileWaitingForDocumentVisibility="StreamStopWhileWaitingForDocumentVisibility",e.StreamStopWhileLoadingPreroll="StreamStopWhileLoadingPreroll",e.StreamStopWhilePreloadingPreroll="StreamStopWhilePreloadingPreroll",e.SkippableFragmentWidgetDrawn="SkippableFragmentWidgetDrawn",e.SkippableFragmentWidgetHidden="SkippableFragmentWidgetHidden",e.PreloadSource="PreloadSource",e.UsePreloadedHlsJs="UsePreloadedHlsJs",e.PlayAfterWaitingForDocumentVisibility="PlayAfterWaitingForDocumentVisibility",e.ResourcesIdle="ResourcesIdle",e.ClientInfo="ClientInfo",e.HlsJsForceCappingStart="HlsJsForceCappingStart",e.ExternalPlaybackOpenButtonClick="ExternalPlaybackOpenButtonClick",e.ExternalPlaybackCloseButtonClick="ExternalPlaybackCloseButtonClick",e.ExternalPlayerListVisibleStatusChange="ExternalPlayerListVisibleStatusChange",e.ExternalPlaybackPlayerCsrfFetching="ExternalPlaybackPlayerCsrfFetching",e.ExternalPlaybackPlayerCsrfFetchSuccess="ExternalPlaybackPlayerCsrfFetchSuccess",e.ExternalPlaybackPlayerCsrfFetchError="ExternalPlaybackPlayerCsrfFetchError",e.ExternalPlaybackPlayerListHasAnyDevice="ExternalPlaybackPlayerListHasAnyDevice",e.ExternalPlaybackPlayerListFetching="ExternalPlaybackPlayerListFetching",e.ExternalPlaybackPlayerListFetchSuccess="ExternalPlaybackPlayerListFetchSuccess",e.ExternalPlaybackPlayerListFetchError="ExternalPlaybackPlayerListFetchError",e.ExternalPlaybackPlayerActivate="ExternalPlaybackPlayerActivate",e.ExternalPlaybackPlayerActivateSucceed="ExternalPlaybackPlayerActivateSucceed",e.ExternalPlaybackPlayerActivateFailed="ExternalPlaybackPlayerActivateFailed",e.ExternalPlaybackCsrfTokenExpired="ExternalPlaybackCsrfTokenExpired",e.Seek="Seek",e.MediaInternalsHistoryOnFatal="MediaInternalsHistoryOnFatal",e.PlayInrollAd="PlayInrollAd",e.FPSControllerRestrictions="FPSControllerRestrictions",e.NativeVideoTypeChange="NativeVideoTypeChange"}(Ca||(Ca={})),function(e){e.preroll="preroll",e.midroll="midroll",e.postPauseroll="postPauseroll",e.postroll="postroll",e.inroll="inroll"}(Oa||(Oa={})),function(e){e.Init="Init",e.SetSource="SetSource",e.Seek="Seek",e.VideoTrackChange="VideoTrackChange",e.AudioTrackChange="AudioTrackChange",e.Recover="Recover",e.MediaError="MediaError",e.Offline="Offline",e.Other="Other",e.Render="Render",e.RepresentationsChange="RepresentationsChange",e.LiveEdge="LiveEdge",e.AdStart="AdStart",e.AdOther="AdOther",e.AdBetween="AdBetween",e.AdEnd="AdEnd"}(Da||(Da={})),function(e){e.Internal="internal",e.Api="api",e.Cache="cache"}(Na||(Na={})),function(e){e.AdCompleted="AdCompleted",e.LoadSource="LoadSource",e.PlayerDestroy="PlayerDestroy",e.CutOff="CutOff",e.PlayerError="PlayerError",e.AdTypeChange="AdTypeChange",e.InsertIntoCalled="InsertIntoCalled",e.AdSkipped="AdSkipped"}(La||(La={}));var Ma=r(8468);const Fa=[];class xa{static enableConsole(){xa.consoleEnabled=!0,xa.log("YA PLAYER VERSION: 1.0-11679")}static log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];xa.consoleEnabled&&console.log(z(...t)),xa.addToHistory("log",t)}static warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];xa.consoleEnabled&&console.warn(z(...t)),xa.addToHistory("warn",t)}static error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];xa.consoleEnabled&&console.error(z(...t)),xa.addToHistory("error",t)}static getHistory(){return[...Fa]}static addToHistory(e,t){Fa.length>=150&&Fa.shift(),Fa.push("["+e+"]["+Date.now()+"] "+t.map(e=>{try{return(0,Ma.Y)(e)}catch(t){return(0,ys.K)(t)?JSON.stringify(["stringify_error",t.stack]):JSON.stringify(["stringify_error","not_an_object_error"])}}).join())}}xa.consoleEnabled=void 0;var Va=r(3525),Ua=r(8139),Ba=r.n(Ua),Ha=r(9117);class ja extends Error{constructor(e,t){const r="object"===typeof e?e:{message:String(e),code:0};super(r.message||String(r.code)),this.message=void 0,this.messageDetails=void 0,this.code=void 0,this.category=void 0,this.isFatal=void 0,this.details=void 0,this.stack=void 0,this.vsid=void 0,this.helpLink=void 0,Ba()(this,ja.prototype),this.message=r.message||String(r.code)||this.message,this.messageDetails=r.messageDetails,this.code=r.code;const i=u(this.code);if(this.category=null!=r&&r.category&&i===ds.q.DEFAULT?r.category:i,this.details=r.details,this.isFatal=void 0===r.isFatal||r.isFatal,this.stack=r.stack&&"?:?:?"!==r.stack?r.stack:this.details&&this.details.stack||((e,t)=>{const{url:r,line:i,col:n,fileName:s,columnNumber:a,lineNumber:o}=e;return String(t||(r||s||"?")+":"+(i||o||"?")+":"+(n||a||"?"))})(r,this.stack),!this.stack||this.stack===Va.J.stack)try{throw new Error(this.message)}catch(n){(0,ys.K)(n)&&(this.stack=n.stack||Va.J.stack)}this.helpLink=r.helpLink||void 0,this.vsid=t||r.vsid}static from(e,t){var r,i;void 0===t&&(t={});const n=null!=(r=null!=(i=t.code)?i:(0,Jn.Y)(()=>e.code))?r:0;return e instanceof ja?t?new ja(K({},e,t,{code:n})):e:(0,Ha.V)(e)?new ja(K({},e,t,{code:n})):(0,Ys.H)(e)?new ja(K({message:e},t,{code:n})):new ja(K({message:"UNEXPECTED_ERROR_TYPE"},t,{code:n}))}toString(){return JSON.stringify(this.toJSON())}toJSON(){const e={message:this.message,messageDetails:this.messageDetails,code:this.code,category:this.category,isFatal:this.isFatal,details:this.details,stack:this.stack,vsid:this.vsid,helpLink:this.helpLink||void 0};return K({},e,{raw:JSON.stringify(e)})}}const Wa={play:Sa.PLAY,pause:Sa.PAUSE,end:Sa.END,idle:Sa.PAUSE};class Ya extends la{constructor(e){super(),this.params=e,this.destroyPromise=new Promise(e=>{this.addDestroyHandler(()=>{e()})}),this.currentAdPlaybackController=void 0,this.playbackQueue=[],this.logAdStart=(0,ma.I)(()=>{const e=this.getAdTypeForLogs(),t=this.playbackQueue.length,{logEvent:r}=this.params;r({event:Ca.AdStart,params:{adPodsCount:t,adType:e}}),e===Oa.inroll&&r({event:Ca.InrollAdStart,params:{adPodsCount:t}})}),this.logAdEnd=(0,ma.I)(()=>{const e=this.getAdTypeForLogs(),t=this.playbackQueue.length,{logEvent:r}=this.params;e===Oa.inroll&&r({event:Ca.InrollAdEnd,params:{adPodsCount:t}}),r({event:Ca.AdEnd,params:{stopAdReason:this.destroyReason||La.AdCompleted,adPodsCount:t,adType:e}})}),this.adPodIndex=0,this.startPlayingAd=(0,ma.I)(async()=>{for(this.logAdStart();this.adPodIndex<this.playbackQueue.length&&!this.isDestroyed;)await this.playAdPod(this.playbackQueue[this.adPodIndex]),this.adPodIndex++;this.logAdEnd();const e=this.playbackQueue[this.playbackQueue.length-1];this.isDestroyed||void 0===e||(0,Jn.Y)(()=>{this.params.onLastAdPodStopped({adType:e.adViewer.getAdBreakType()})}),this.destroy(La.AdCompleted)}),this.dispatchOnFirstAdPodStarted=(0,ma.I)(()=>{this.params.onFirstAdPodStarted()}),this.updateAdPodCloseState=e=>{this.params.onAdPodCloseStateChange(e.getAdPodCloseState())},this.updateAdVolumeAvailabilityStateChange=e=>{this.params.onAdVolumeAvailabilityStateChange(e.getAdVolumeAvailabilityState())},this.updateAdPodTimeToSkip=e=>{const t=e.getAdPodTimeToSkip();this.params.onAdPodTimeToSkipChange((0,va.z)(t)?Math.ceil(t):void 0)},this.playAdPod=async e=>{let{adType:t,adViewer:r,additionalData:i,adDisplayConfig:n,posterUrl:s,adElement:a}=e;if(0===r.getAdPodsCount())return void xa.log("AdViewer is empty");const{logEvent:o}=this.params;if(o({event:Ca.AdPodLoading,params:{adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adPodType,additionalData:i}}),t===Oa.inroll){const{cueId:e}=i;o({event:Ca.InrollAdPodStart,params:{adPodsCount:this.playbackQueue.length,cueId:e}}),r.setStatsRootFields({cueid:e})}const l=Z({videoSlotCanAutoPlay:!0,controlsSettings:this.params.getControlsSettings(),visibilitySlot:this.params.playerContainer,lang:this.params.lang,contentAfterAd:this.getContentAfterAd(t,s),adSequence:{index:this.adPodIndex,count:this.playbackQueue.length},requestFullscreenStateChange:this.params.onRequestFullscreenStateChange},n),d=r.createPlaybackController(this.params.video,a,l);this.currentAdPlaybackController=d,this.updateAdPodDuration(d),this.params.onAdPodCurrentTimeChange(0),this.params.onAdSkippableStateChange(d.getAdSkippableState()),this.updateAdPodCloseState(d),this.updateAdVolumeAvailabilityStateChange(d),d.subscribe("AdPlayingStateChange",()=>{this.updateAdPodPlayingStateChange()}),d.subscribe("AdMediaStateChange",()=>{this.updateAdPodPlayingStateChange()}),d.subscribe("AdRemainingTimeChange",()=>{const e=d.getAdPodRemainingTime(),t=this.updateAdPodDuration(d);this.params.onAdPodCurrentTimeChange(t-e),this.updateAdPodTimeToSkip(d),this.updateAdPodPlayingStateChange()}),d.subscribe("AdPodError",e=>{const t=Z({},e,{adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adPodType,additionalData:i});o({event:"AdPodError",params:t}),this.params.onAdPodError(t)}),d.subscribe("AdInteraction",()=>{this.params.onAdInteraction()}),d.subscribe("AdSkippableStateChange",e=>{this.updateAdPodTimeToSkip(d),this.params.onAdSkippableStateChange(e.skippableState)}),d.subscribe("AdStartRejected",e=>{this.params.onAdStartRejected(new Error("AdStartRejected"))}),d.subscribe("AdPodDurationChange",()=>{this.updateAdPodDuration(d)}),d.subscribe("AdPodStartRequest",()=>{this.params.onBeforeAdPodStart({adPlaybackController:d})}),d.subscribe("AdPodStarted",()=>{o({event:Ca.AdPodStart,params:{adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adPodType,additionalData:i}}),this.dispatchOnFirstAdPodStarted(),this.params.onAdPodStarted(),this.updateAdPodPlayingStateChange(),this.updateAdPodDuration(d)});const c=()=>{this.params.onAdPodDurationChange(void 0),this.params.onAdPodCurrentTimeChange(void 0),this.params.onAdSkippableStateChange(!1),this.params.onAdPodTimeToSkipChange(void 0),this.params.onAdPodCloseStateChange(void 0)};d.subscribe("AdPodStopped",()=>{c(),this.params.onAdPodStopped()}),d.subscribe("AdPodSkipped",()=>{c(),this.params.onAdPodSkipped()}),d.subscribe("AdContentSizeChange",()=>{const e=d.getAdContentSize();if(void 0===e)return;const{width:t,height:r}=e;this.params.onAdSizeChange({width:(0,va.z)(t)?t:NaN,height:(0,va.z)(r)?r:NaN})}),d.subscribe("AdPodImpression",()=>{o({event:Ca.AdPodImpression,params:{adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adPodType,additionalData:i}})}),d.subscribe("AdClickThru",()=>{this.params.onAdClickThru(),o({event:"AdClickThru",params:{adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adPodType,additionalData:i}})}),this.shouldSkipAllAdPods()&&d.subscribe("AdPodSkipped",()=>{this.destroy(La.AdSkipped)}),d.subscribe("AdPodCloseStateChange",()=>{this.updateAdPodCloseState(d)}),d.subscribe("AdVolumeAvailabilityStateChange",()=>{this.updateAdVolumeAvailabilityStateChange(d)}),await new Promise(e=>{d.subscribe("AdStopped",e),d.playAd(),this.params.onAdPodPlayingStateChange({adType:t,playingState:Sa.BUFFERING,expectedStalledReason:0===this.adPodIndex?Da.AdStart:Da.AdBetween})}),this.currentAdPlaybackController=void 0,o({event:Ca.AdPodEnd,params:{adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adPodType,additionalData:i}}),t===Oa.inroll&&(o({event:Ca.InrollAdPodEnd,params:{adPodsCount:this.playbackQueue.length,cueId:i.cueId}}),r.setStatsRootFields({cueid:void 0}))},this.addDestroyHandler(()=>{this.currentAdPlaybackController&&(this.currentAdPlaybackController.stopAd(),this.currentAdPlaybackController=void 0)})}getUtcPositionBeforeAd(){return this.params.utcPositionBeforeAd}getQueueDuration(){return Q(this.playbackQueue.map(e=>{let{adViewer:t}=e;return t}))}playAdViewers(e){this.isDestroyed||(this.playbackQueue.push(e),this.addDestroyHandler(()=>{e.adViewer.destroy()}),Promise.resolve().then(()=>this.startPlayingAd()))}resumeAd(){this.currentAdPlaybackController&&(this.currentAdPlaybackController.resumeAd(),this.updateAdPodPlayingStateChange())}pauseAd(){this.currentAdPlaybackController&&(this.currentAdPlaybackController.pauseAd(),this.updateAdPodPlayingStateChange())}skipAdPod(){this.currentAdPlaybackController&&this.currentAdPlaybackController.skipAd()}setVolume(e){this.currentAdPlaybackController&&this.currentAdPlaybackController.setAdVolume(e)}getDestroyPromise(){return this.destroyPromise}getAdTypeForLogs(){const[e]=this.playbackQueue;return e?e.adType:(this.params.onError(new ja({code:cs.AD_TYPE_IS_NOT_RECOGNIZED,isFatal:!1})),"unrecognized")}updateAdPodPlayingStateChange(){if(!this.currentAdPlaybackController)return;const e=this.currentAdPlaybackController.getAdMediaState(),t=this.currentAdPlaybackController.getAdPlayingState(),r=this.playbackQueue[this.adPodIndex].adPodType,i=this.params.video.src,n="stalled"===(null==e?void 0:e.name)&&i?{adType:r,playingState:Sa.BUFFERING,expectedStalledReason:Da.AdOther}:{adType:r,playingState:Wa[t],expectedStalledReason:void 0};this.params.onAdPodPlayingStateChange(n)}updateAdPodDuration(e){const t=e.getAdPodDuration();return this.params.onAdPodDurationChange(t),t}shouldSkipAllAdPods(){var e;return Boolean(null==(e=this.params.adConfig)?void 0:e.skipAllAdPods)||!1}getContentAfterAd(e,t){const r=this.playbackQueue.length-1===this.adPodIndex,i=this.shouldSkipAllAdPods(),n=t?[{url:t}]:[];switch(e){case Oa.preroll:return r||i?{type:"startVideo",poster:n}:{type:"nextAd",poster:[]};case Oa.postroll:return{poster:[]};case Oa.midroll:case Oa.postPauseroll:case Oa.inroll:return r||i?{type:"continueVideo",poster:n}:{type:"nextAd",poster:[]};default:return{poster:[]}}}}var Ga=r(4513);const za=900;let qa;!function(e){e.original="original"}(qa||(qa={}));class Ka{constructor(e,t){this.parent=e,this.element=document.createElement("div");const{style:r}=this.element;r.backgroundColor=function(e){switch(e){case qa.original:return"rgba(0, 255, 0, 0.5)";default:throw new Error("Unexpected BroadcastAdType ["+e+"]")}}(t),r.width="10px",r.height="10px",r.cssFloat="left",r.marginRight="1px"}setVisibility(e){e?this.show():this.hide()}show(){this.parent.appendChild(this.element)}hide(){te(this.element)}}class Qa{constructor(e){this.element=document.createElement("div"),e.appendChild(this.element);const{style:t}=this.element;t.position="absolute",t.bottom="1px",t.left="1px"}createIndicator(e){return new Ka(this.element,e)}}let Za;!function(e){e.INVALID_INROLL_FRAME="INVALID_INROLL_FRAME",e.INVALID_START="INVALID_START",e.CROSSED_BY_INVALID="CROSSED_BY_INVALID",e.MAX_DURATION="MAX_DURATION"}(Za||(Za={}));class Ja extends Ia.v{constructor(){super(...arguments),this.adIntervals=[]}handleInrollFrame(e){if(!function(e){if(e.offset<-6e5||e.offset>63e4)return!1;if(void 0===e.cutoff)return!0;if(e.cutoff<-6e5||e.cutoff>63e4)return!1;const t=e.cutoff-e.offset;return t>=5e3&&t<=6e5}(e))return xa.warn("invalid inroll frame:",e),void this.handleInvalidInrollFrame(e,Za.INVALID_INROLL_FRAME);const t=this.adIntervals.find(t=>{let{cueId:r}=t;return r===e.cue_id});if(!t)return this.addAdIntervalByFastFrame(e);this.updateAdIntervalByInrollFrame(t,e)}validateAdIntervalsByTimestamp(e){for(let t=0;t<this.adIntervals.length;t++){const r=this.adIntervals[t];if(r.start>e)return;if(!r.isValid||r.isEndReceived)continue;if(e-r.start>6e5){this.invalidateAdInterval(r,Za.MAX_DURATION);continue}const i=this.adIntervals[t+1];if(!i)return;i.start<=e&&this.invalidateAdInterval(r,Za.CROSSED_BY_INVALID)}}handleInvalidInrollFrame(e,t){const r=this.adIntervals.find(t=>{let{cueId:r}=t;return r===e.cue_id});if(r)return this.invalidateAdInterval(r,t),void this.updateAdIntervalByInrollFrame(r,e);const i=ie(e);this.invalidateAdInterval(i,t),this.pushAdInterval(i)}addAdIntervalByFastFrame(e){const t=ie(e);return this.pushAdInterval(t),t.isValid?t:void 0}updateAdIntervalByInrollFrame(e,t){const r=t.pts+t.offset;if(Math.abs(e.start-r)>1e3)return void this.invalidateAdInterval(e,Za.INVALID_START);if(e.isEndReceived)return;const i=void 0!==t.cutoff,n=i?t.pts+t.cutoff:re(t.pts,e.start);e.isEndReceived=i,e.end=n,this.handleUpdatedAdInterval(e)}findCrossedAdIntervals(e){return this.adIntervals.filter(t=>e!==t&&(e.start<t.start?e.end>t.start:t.end>e.start))}pushAdInterval(e){const t=this.findCrossedAdIntervals(e);t.length&&this.invalidateAdInterval(e,Za.CROSSED_BY_INVALID),this.adIntervals.push(e),this.adIntervals.sort((e,t)=>{let{start:r}=e,{start:i}=t;return r-i}),this.invalidate(t,Za.CROSSED_BY_INVALID),e.isValid&&this.emit("AdIntervalUpdated",e)}handleUpdatedAdInterval(e){const t=this.findCrossedAdIntervals(e);if(t.length)return t.push(e),void this.invalidate(t,Za.CROSSED_BY_INVALID);e.isValid&&this.emit("AdIntervalUpdated",e)}invalidate(e,t){e.forEach(e=>{this.invalidateAdInterval(e,t)})}invalidateAdInterval(e,t){e.isValid&&(e.isValid=!1,e.invalidateReason=t,this.emit("InvalidAdInterval",{reason:t,cueId:e.cueId}))}}class Xa{constructor(){this.ads=[],this.postAdsIds=[]}add(e){if(this.postAdsIds.indexOf(e.cueId)>-1)return;const t=this.findById(e.cueId);t?t.startTime=e.startTime:this.ads.push(ne({},e,{adViewers:e.adViewers.reduce((e,t)=>e.concat(t.separateAdPods()),[])}))}getAdViewers(e,t){const[r,i]=function(e,t){const r=[],i=[];return((e,t,r)=>{for(let i=0;i<e.length;i++)t.call(r,e[i],i,e)})(e,(n,s)=>{t(n,s,e)?r.push(n):i.push(n)}),[r,i]}(this.ads,r=>{let{startTime:i,endTime:n,cueId:s,adViewers:a}=r;if(s!==t)return!1;if(e<i)return!1;if(n-15e3<e)return!1;for(const t of a){if(e+1e3*t.getAdDuration()<n)return!0}return!1});if(0===r.length)return[];this.postAdsIds.push(...r.map(e=>{let{cueId:t}=e;return t})),this.ads=i,r.sort((e,t)=>e.startTime-t.startTime);let n=0;const s=[];for(const{adViewers:a,endTime:o,cueId:l}of r)for(const t of a){const r=e+1e3*n;if(o-15e3<r)break;o<r+1e3*t.getAdDuration()||(s.push({adViewer:t,additionalData:{cueId:l},adType:Oa.inroll}),n+=t.getAdDuration())}return s}findById(e){return this.ads.find(t=>{let{cueId:r}=t;return r===e})}}class $a extends Ga.M{constructor(e){let t,{video:r,slot:i,playerApi:n,playerStore:s,stateController:a,onError:o}=e;super(),this.adIntervalStorage=new Ja,this.isEnabled=!0,this.adIndicators=void 0,this.inrolls=new Xa,this.playerApi=void 0,this.playerStore=void 0,this.stateController=void 0,this.onError=void 0,this.adIndicators=new Qa(i),this.playerApi=n,this.playerStore=s,this.stateController=a,this.onError=o;const l=this.adIndicators.createIndicator(qa.original);r.addEventListener("timeupdate",()=>{const e=this.playerStore.getState(),i=$(e);if(t!==i){const e=void 0!==i;l.setVisibility(e),t=i}const n=ee(e);n&&(this.adIntervalStorage.validateAdIntervalsByTimestamp(n),this.isEnabled&&!r.paused&&(this.stateController.updateOriginalAdState(),this.handleInrolls()))}),this.adIntervalStorage.on("AdIntervalUpdated",e=>{this.emit("AdIntervalUpdated",{cueId:e.cueId,start:e.start,end:e.end})}),this.adIntervalStorage.on("InvalidAdInterval",e=>{let{cueId:t,reason:r}=e;xa.warn("invalid ad interval: [cueId="+t+"] [reason="+r+"]"),this.onError(new ja({code:cs.INVALID_METADATA,details:{cueId:t,reason:r},isFatal:!1})),this.emit("AdIntervalRemoved",t)})}handleInrollFrame(e){const t=this.adIntervalStorage.handleInrollFrame(e);if(!t)return Promise.resolve();const{cueId:r,start:i,end:n,isEndReceived:s}=t,a=s?n+15e3:i+6e5;return this.addInroll(r,i,a,{inrollFrame:e})}setEnabled(e){this.isEnabled=e}async addInroll(e,t,r,i){let{inrollFrame:n}=i;this.playerApi.callbacks.logEvent({event:Ca.BroadcastAdReceived,params:{cueId:e,podStart:t,adType:Oa.inroll}});const s=this.playerApi.getMultiroll(),a=await s.inroll.loadViewers(se({},n));if(0===a.length)return;const o=Q(a);this.playerApi.callbacks.logEvent({event:Ca.BroadcastAdInit,params:{cueId:e,podStart:t,duration:o,adPodsCount:a.length,adType:Oa.inroll}}),this.inrolls.add({adViewers:a,cueId:e,startTime:t,endTime:r})}handleInrolls(){const e=this.playerStore.getState(),t=ee(e);if(!t)return;const r=$(e);if(!r)return;const i=this.inrolls.getAdViewers(t,r);i.length&&this.emit("InrollAdPlayRequest",i)}}class eo{constructor(){this.stopReasonInternal=void 0,this.stopDeferred=new ka.B}stop(e){this.stopReasonInternal=e,this.stopDeferred.resolve(e)}get stopReason(){return this.stopReasonInternal}get stopPromise(){return this.stopDeferred.promise}}const to=(e,t,r)=>{const i=[];for(let n=0;n<e.length;n++){const s=e[n];t.call(r,s,n,e)&&i.push(s)}return i},ro={}.toString,io=/\[object (\w+)\]/,no=e=>{const t=ro.call(e);if(!t)return null;const r=t.match(io);if(!r)return null;const i=r[1];return i||null},so=e=>e instanceof Error||"Error"===no(e),ao=[].find,oo=he(ao)?(e,t)=>ao.call(e,t):(e,t)=>{for(let r=0;r<e.length;r++){const i=e[r];if(t(i,r,e))return i}},lo="DEFAULT_ERROR_MESSAGE",co="0",uo="",ho="?:?:?";class po extends Error{constructor(){const e=2===arguments.length?arguments.length<=0?void 0:arguments[0]:void 0,t=2===arguments.length?arguments.length<=1?void 0:arguments[1]:arguments.length<=0?void 0:arguments[0],r=k(i=e)&&le(i.name)&&le(i.message)||"object"===typeof e&&e&&"code"in e&&"details"in e?e:{message:String(e||lo)};var i;super(),Object.defineProperty(this,"originalError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stack",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toJSON",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.originalError="object"===typeof e&&e?e:{unknown:e,unknownStr:String(e)},Ba()(this,po.prototype);const n=t.code||r.code||r.id||co,s=t.message||r.message||lo;this.message="VAS Error ["+n+"]"+(s?"["+s+"]":""),this.code=n,this.details=t.details||r.details||uo;const a=r.stack||function(e){const{url:t,line:r,col:i,fileName:n,columnNumber:s,lineNumber:a}=e;return(t||n||"?")+":"+(r||a||"?")+":"+(i||s||"?")}(r);let o=a===ho?this.stack:a;if(o&&o!==ho)this.stack=o;else if(!this.stack)try{throw new Error(this.message)}catch(l){this.stack=o=l.stack||ho}this.toString=()=>pe(this.toJSON()),this.toJSON=()=>({originalError:this.originalError,message:this.message,code:this.code,details:this.details,stack:o})}}const fo=function(e,t){let r=e[t];if(!he(r)){const n=r;try{delete e[t];const i=e[t];"function"===typeof i&&(r=i),e[t]=n}catch(i){}}return r}(Array,"isArray"),mo=Boolean(fo)?e=>fo.call(Array,e):e=>"Array"===no(e);class go{constructor(e){Object.defineProperty(this,"dispatch",{enumerable:!0,configurable:!0,writable:!0,value:me(e=>{this.value=e,this._isDispatched=!0,function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];mo(e)&&Os(e,e=>{"function"===typeof e&&e(...r)})}(this.callbacks,e),this.callbacks.length=0})}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_isDispatched",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),R(e)&&this.callbacks.push(e)}subscribe(e){return this._isDispatched?(e(this.value),fe):(this.callbacks.push(e),()=>{this.callbacks=to(this.callbacks,t=>t!==e)})}getDispatched(){return this._isDispatched}getValue(){return this.value}wait(){return new Promise(e=>{this.subscribe(e)})}}const vo=200,yo=e=>we(e.navigator.sendBeacon),Eo=yo(window);class So{constructor(e){let{defaultProbability:t,rnd:r,vsid:i,serviceName:n,serviceVersion:s}=e;Object.defineProperty(this,"rnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vsid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultProbability",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serviceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serviceVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let{error:t}=e;this.push({eventName:String(t.code),eventType:"error",eventData:t,probability:1})}}),this.rnd=r,this.vsid=i,this.defaultProbability=t,this.serviceName=n,this.serviceVersion=s}log(e){let{name:t,probability:r,data:i}=e;this.push({eventType:"event",eventName:t,probability:r,eventData:i})}push(e){let{eventType:t,eventName:r,probability:i=this.defaultProbability,eventData:n}=e;if(this.rnd<i){const e="https://log.strm.yandex.ru/log?"+t+"="+r,i=JSON.stringify({service:"VAS",eventType:t,eventName:r,rnd:this.rnd,vsid:this.vsid,data:n,topLocation:ye(document).location,version:"loadVasModule_"+(this.serviceName||"unknown")+"_"+(this.serviceVersion||"unknown"),timestamp:Date.now()});0;if(function(e,t){return!!Eo&&window.navigator.sendBeacon(e,t)}(e,i))return;be({url:e,data:i,method:"POST"})}}}const Ao=(e,t)=>{try{return e.localStorage.getItem(t)}catch(r){return null}},To=(e,t)=>{const r=_e(e,t);return"false"!==r&&Boolean(r)},bo=function(e){let t,r,i=!1,n=!1,s=!1;return ge(()=>{t=function(e){const t=_e(e,"adsdkecmaver");if("ES2017"===t||"ES5"===t)return t;return}(e)}),ge(()=>{s=Boolean(_e(e,"adsdkdebug"))}),ge(()=>{r=_e(e,"adsdkver")}),ge(()=>{i=Boolean(_e(e,"vasnetworklogs"))}),ge(()=>{n=To(e,"vasfulldebug")}),s&&(console.warn("adsdkdebug is deprecated, use vasfulldebug instead"),n=!0),n&&(i=!0),{adsdkecmaver:t,vasfulldebug:n,vasnetworklogs:i,adsdkver:r,adsdkdebug:s}}(window),wo=bo.vasnetworklogs?1:.05,_o=!we(Math.random)||Math.random()===Math.random(),Ro=Date&&Re(Date.now)?()=>Date.now():()=>(new Date).getTime(),ko="undefined"===typeof window?void 0:window.performance,Po=ko&&Re(ko.now),Io=ko&&ko.timing&&ko.timing.navigationStart?ko.timing.navigationStart:Ro();let Co=0;const Oo=Po?()=>ko.now():()=>(()=>{const e=Ro()-Io;return Co=Math.max(e,Co),Co})();let Do=Date.now()*Oo()%2147483647;const No=_o?function(){return Do=16807*Do%2147483647,(Do-1)/2147483646}:function(){return Math.random()},Lo=No();var Mo=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r};const Fo=e=>{const{expFlags:t}=e,r=Mo(e,["expFlags"]),i={},n={};return Os(e.expFlags,e=>{Os(e,e=>{let{CONTEXT:{FLAGS:t},TESTID:r}=e;k(t)&&Os(function(e){if("function"===typeof Object.keys)return Object.keys(e);const t=[];for(const r in e)ke(e,r)&&t.push(r);return t}(t),e=>{var s;const a=t[e];i[e]=a,n[e]=null!==(s=n[e])&&void 0!==s?s:[],n[e].push({value:a,testId:r[0]})})})}),Pe({flags:i,flagsMap:n},r)},xo={testIds:"",flags:{}};me(()=>{try{return __UAAS_CFG__}catch(e){return e}});const Vo=e=>{if(so(e))return{error:e,config:xo};try{const t=k(e)?e:JSON.parse(""+(e||"")),r=(e=>!!k(e)&&!(!("expFlags"in e)||!mo(e.expFlags)))(t)?Fo(t):t;if(!((e,t)=>{if(!k(t))throw new Error("Parsed replaced macro is not an object: "+e);if(ue(t.testIds),!("flags"in t)||!k(t.flags))throw new Error("Parsed replaced macro has no flags field: "+e);return!0})(String(e),r))throw new Error("UAAS config is not valid: "+e);return{error:void 0,config:r}}catch(t){return{error:t,config:xo}}},Uo=e=>{var t;const{error:r,config:i}=Vo(e);if(!r){const e=i.flags,r=null!==(t=e.ADSDKVER)&&void 0!==t?t:e.VAS_STABLE_VERSION,n=de(r)?r:void 0;if(de(n))return{version:n,parsedUaasConfig:i,parseUaasConfigError:void 0}}return{version:void 0,parsedUaasConfig:void 0,parseUaasConfigError:r}},Bo=(e=>(e=>{try{if("noModule"in e.HTMLScriptElement.prototype)return!0}catch(t){}return!1})(e)&&yo(e))(window)?"ES2017":"ES5",Ho={ES5:"bundles",ES2017:"bundles-es2017"},jo=Ce(Ce({},{InPage:"inpage",AdLoader:"loader",VideoBannerAd:"videobannerad",Multiroll:"multiroll",YaMusicAPI:"ya-music-api",VpaidPlayer:"vpaid_player",Rum:"rum"}),{MotionTailor:"motion_ad_creative",Survey:"survey"}),Wo="undefined"===typeof BUNDLES_PATH?"":BUNDLES_PATH,Yo=("undefined"===typeof BUNDLE_NAME||BUNDLE_NAME,"undefined"===typeof BUILD_TIME||BUILD_TIME,["a","n.ya","nd","ex.ru"].join(""),["y","a","nde","x.ru"].join(""),["y","a",".r","u"].join(""),["ya","sta","tic.net"].join("")),Go=(["ver","ify.y","a","nde","x.ru"].join(""),"https://"+Yo+"/vas-bundles/"),zo=e=>new Promise((t,r)=>{be({method:"GET",url:"https://yandex.ru/ads/system/video-ads-sdk/vas_uaas",responseType:"json",retries:2,withCredentials:Boolean(e),onSuccess:e=>{t(e.response)},onError:()=>{r(new Error("Cannot load uaas"))}})});let qo;try{qo=BUILD_VERSION}catch(yf){qo="INVALID_BUILD_VERSION"}const Ko="VAS",Qo=e=>Le(e.substr(-4),4,"0"),Zo=(void 0===(Jo="1")&&(Jo=qo),[Ne(44),Ko,Qo(Jo),Le(Date.now().toString().slice(0,10),10,"0")].join("x"));var Jo;var Xo=r(55);const $o={subpageIndex:y(),deltas:{}};var el=r(7668),tl=r(5809);const rl={inStreamPlayingState:void 0,adConfig:void 0,adInfo:void 0,originalBroadcastAdCueId:void 0,originalBroadcastAdCues:{},adblockDetected:!1,hasPreroll:!1,adSyncInit:!1,nextAdInfo:void 0,nativeAdControlsVisibility:!0},il=Math.max(0,0),nl=Math.max(5,0),sl="0000000000000000000000000000000000000000000000000000000000000000";let al,ol;!function(e){e.init="init",e.waitForUserPlay="waitForUserPlay",e.waitForDocumentVisibility="waitForDocumentVisibility",e.starting="starting",e.started="started",e.broken="broken",e.destroyed="destroyed"}(al||(al={})),function(e){e.Detached="Detached",e.Attaching="Attaching",e.Attached="Attached"}(ol||(ol={}));const ll={autoplay:!1,initialAutoplay:!1,allowMuted:!0,autoplayImpossible:!1,startStage:al.init,preload:!0,from:void 0,encoderState:ol.Detached,vsid:sl,streams:[],stream:void 0,sourceParams:void 0,sourceId:0,volume:1,muted:!1,userVolume:NaN,duration:NaN,currentTime:il,currentTimeLowGranularity:il,watchedTime:0,startPosition:{},programDateTime:void 0,fragmentDuration:nl,dvrStartTime:0,dvrDuration:NaN,videoType:void 0,playingState:Sa.PAUSE,bufferingRanges:[],preview:void 0,isFullscreen:!1,isPip:!1,isVisible:void 0,togglePlaybackOnVisibilityChangeSetting:void 0,errorInfo:{},lastRecoverPosition:void 0,isOnline:!0,isDocumentVisible:!0,lastKnownBandwidthEstimate:{value:NaN,source:"default"},isAbrSupported:!1,isAbrEnabled:!1,defaultQuality:720,feed:!1,videoTrackValue:void 0,videoTracks:[],userVideoTrackName:void 0,userVideoTrackHeight:void 0,audioTrackValue:void 0,audioTracks:[],userAudioTrackName:void 0,userAudioTrackLang:void 0,textTrackEnabled:!1,nativeTextTrackVisible:void 0,textTrackValue:void 0,textTracks:[],userTextTrackEnabled:void 0,userTextTrackLang:void 0,userTextTrackName:void 0,playbackRate:1,expectedStalled:{reason:Da.Init,details:{}},videoWidth:0,videoHeight:0,playerConfig:void 0,preloadDetails:void 0},dl={hiddenControls:[],useNativeSubtitles:!1,nativeControlsVisibility:!0,skinDVRStartTime:0,skinDVRDuration:0};var cl=r(4651);const ul={min:0,max:1/0},hl={min:1,max:1/0},pl={min:0,max:1};var fl=r(5002);let ml,gl,vl,yl,El;!function(e){e.inStreamPlayingState="inStreamPlayingState",e.adConfig="adConfig",e.adInfo="adInfo",e.originalBroadcastAdCueId="originalBroadcastAdCueId",e.originalBroadcastAdCues="originalBroadcastAdCues",e.adblockDetected="adblockDetected",e.hasPreroll="hasPreroll",e.adSyncInit="adSyncInit",e.nextAdInfo="nextAdInfo",e.nativeAdControlsVisibility="nativeAdControlsVisibility"}(ml||(ml={})),function(e){e.hiddenControls="hiddenControls",e.useNativeSubtitles="useNativeSubtitles",e.nativeControlsVisibility="nativeControlsVisibility",e.skinDVRStartTime="skinDVRStartTime",e.skinDVRDuration="skinDVRDuration"}(gl||(gl={})),function(e){e.engine="engine",e.autoplay="autoplay",e.allowMuted="allowMuted",e.autoplayImpossible="autoplayImpossible",e.startStage="startStage",e.preload="preload",e.duration="duration",e.encoderState="encoderState",e.from="from",e.vsid="vsid",e.streams="streams",e.stream="stream",e.streamsWithSupportInfo="streamsWithSupportInfo",e.sourceParams="sourceParams",e.sourceId="sourceId",e.bufferingRanges="bufferingRanges",e.userVolume="userVolume",e.currentTime="currentTime",e.currentTimeLowGranularity="currentTimeLowGranularity",e.watchedTime="watchedTime",e.startPosition="startPosition",e.videoType="videoType",e.playingState="playingState",e.errorInfo="errorInfo",e.lastRecoverPosition="lastRecoverPosition",e.preview="preview",e.isFullscreen="isFullscreen",e.isPip="isPip",e.isVisible="isVisible",e.togglePlaybackOnVisibilityChangeSetting="togglePlaybackOnVisibilityChangeSetting",e.isDocumentVisible="isDocumentVisible",e.isOnline="isOnline",e.lastKnownBandwidthEstimate="lastKnownBandwidthEstimate",e.fragmentDuration="fragmentDuration",e.dvrStartTime="dvrStartTime",e.dvrDuration="dvrDuration",e.programDateTime="programDateTime",e.isAbrSupported="isAbrSupported",e.isAbrEnabled="isAbrEnabled",e.defaultQuality="defaultQuality",e.videoTrackValue="videoTrackValue",e.videoTracks="videoTracks",e.userVideoTrackName="userVideoTrackName",e.userVideoTrackHeight="userVideoTrackHeight",e.audioTrackValue="audioTrackValue",e.audioTracks="audioTracks",e.userAudioTrackName="userAudioTrackName",e.userAudioTrackLang="userAudioTrackLang",e.textTrackEnabled="textTrackEnabled",e.nativeTextTrackVisible="nativeTextTrackVisible",e.textTrackValue="textTrackValue",e.textTracks="textTracks",e.userTextTrackEnabled="userTextTrackEnabled",e.userTextTrackName="userTextTrackName",e.userTextTrackLang="userTextTrackLang",e.playbackRate="playbackRate",e.expectedStalled="expectedStalled",e.videoWidth="videoWidth",e.videoHeight="videoHeight",e.volume="volume",e.videoElementStyle="videoElementStyle",e.playerConfig="playerConfig",e.preloadDetails="preloadDetails",e.feed="feed"}(vl||(vl={})),function(e){e.PlaybackRateCatchupSelection="PlaybackRateCatchupSelection",e.Recover="Recover",e.Other="Other"}(yl||(yl={})),function(e){e.ApiPlay="ApiPlay",e.VolumeChange="VolumeChange",e.MuteChange="MuteChange"}(El||(El={}));const Sl="other",Al={from:Sl,reqid:void 0,hash:void 0,vsid:sl},Tl={startPosition:{},additionalParams:Al,adConfig:void 0,withCredentials:!1,loop:!1,preview:"",videoInfo:{}},bl=-1;var wl=r(8533),_l=r.n(wl);const Rl=Qe("object"===typeof self?self:window);var kl=r(8682);const Pl={name:(e=>{Rl.i18nLang||(Rl.i18nLang="ru");const t=Rl.i18nLang;if(!(0,rs.m)(Rl.i18nTranslateEngine)){const e=r(7050)("./"+t+".ts");(0,wl.setI18nLang)(t),Rl.i18nTranslateEngine=_l()(Ze({},e))}return Rl.i18nTranslateEngine(e)})("TRACK_AUTO"),value:kl.A,bitrate:bl};let Il,Cl,Ol,Dl;!function(e){e.VideoIsNotPausedOnInit="VideoIsNotPausedOnInit",e.DetectByInterval="DetectByInterval",e.VideoPlayEvent="VideoPlayEvent",e.PlayCallback="PlayCallback"}(Il||(Il={})),function(e){e.NATIVE="NATIVE",e.HLS="HLS",e.MP4="MP4",e.YASP="YASP"}(Cl||(Cl={})),function(e){e.firstNetworkAdSDK="first.network.adsdk",e.firstNetworkHls="first.network.hls",e.firstNetworkMpd="first.network.mpd",e.firstNetworkMp4="first.network.mp4",e.firstNetworkNative="first.network.native",e.firstNetworkYasp="first.network.yasp",e.firstNetworkAdSDKHls="first.network.adsdk.hls",e.firstNetworkAdSDKMpd="first.network.adsdk.mpd",e.firstNetworkAdSDKMp4="first.network.adsdk.mp4",e.firstNetworkAdSDKNative="first.network.adsdk.native",e.firstNetworkAdSDKYasp="first.network.adsdk.yasp",e.setSourceNetworkAdSDK="setsource.network.adsdk",e.setSourceNetworkHls="setsource.network.hls",e.setSourceNetworkMpd="setsource.network.mpd",e.setSourceNetworkMp4="setsource.network.mp4",e.setSourceNetworkNative="setsource.network.native",e.setSourceNetworkYasp="setsource.network.yasp",e.setSourceNetworkAdSDKHls="setsource.network.adsdk.hls",e.setSourceNetworkAdSDKMpd="setsource.network.adsdk.mpd",e.setSourceNetworkAdSDKMp4="setsource.network.adsdk.mp4",e.setSourceNetworkAdSDKNative="setsource.network.adsdk.native",e.setSourceNetworkAdSDKYasp="setsource.network.adsdk.yasp"}(Ol||(Ol={})),function(e){e.firstLoadSource="firstloadsource",e.yaFirstFrameDecodedMp4="ya.firstframedecoded.mp4",e.yaFirstFrameDecodedMpd="ya.firstframedecoded.mpd",e.yaFirstFrameDecodedHls="ya.firstframedecoded.hls",e.yaFirstFrameDecodedYandex="ya.firstframedecoded.yandex",e.yaFirstFrameDecodedYasp="ya.firstframedecoded.yasp",e.yaFirstFrameDecodedNative="ya.firstframedecoded.native",e.yaFirstFrameDecodedAdSDK="ya.firstframedecoded.adsdk",e.yaFirstFrameShownMp4="ya.firstframeshown.mp4",e.yaFirstFrameShownMPD="ya.firstframeshown.mpd",e.yaFirstFrameShownHls="ya.firstframeshown.hls",e.yaFirstFrameShownYandex="ya.firstframeshown.yandex",e.yaFirstFrameShownYasp="ya.firstframeshown.yasp",e.yaFirstFrameShownNative="ya.firstframeshown.native",e.yaFirstFrameShownAdSDK="ya.firstframeshown.adsdk",e.autoplayFalse="autoplayfalse",e.firstStartAdSDKFailed="firststart.adsdk.failed",e.firstStartAdSDK="firststart.adsdk",e.firstStartYandex="firststart.yandex",e.firstStartYasp="firststart.yasp",e.firstStartHls="firststart.hls",e.firstStartMp4="firststart.mp4",e.firstStartMpd="firststart.mpd",e.firstStartNative="firststart.native",e.firstStartAdSDKYandex="firststart.adsdk.yandex",e.firstStartAdSDKYasp="firststart.adsdk.yasp",e.firstStartAdSDKHls="firststart.adsdk.hls",e.firstStartAdSDKMpd="firststart.adsdk.mpd",e.firstStartAdSDKMp4="firststart.adsdk.mp4",e.firstStartAdSDKNative="firststart.adsdk.native"}(Dl||(Dl={}));const Nl=["reason"],Ll={[Cl.HLS]:Dl.firstStartHls,[Cl.MP4]:Dl.firstStartMp4,[Cl.NATIVE]:Dl.firstStartNative,[Cl.YASP]:Dl.firstStartYasp,AD:Dl.firstStartAdSDK},Ml={[Cl.HLS]:Dl.firstStartAdSDKHls,[Cl.MP4]:Dl.firstStartAdSDKMp4,[Cl.NATIVE]:Dl.firstStartAdSDKNative,[Cl.YASP]:Dl.firstStartAdSDKYasp,AD:Dl.firstStartAdSDK},Fl={[Cl.HLS]:Dl.yaFirstFrameDecodedHls,[Cl.MP4]:Dl.yaFirstFrameDecodedMp4,[Cl.NATIVE]:Dl.yaFirstFrameDecodedNative,[Cl.YASP]:Dl.yaFirstFrameDecodedYasp,AD:Dl.yaFirstFrameDecodedAdSDK},xl={[Cl.HLS]:Dl.yaFirstFrameShownHls,[Cl.MP4]:Dl.yaFirstFrameShownMp4,[Cl.NATIVE]:Dl.yaFirstFrameShownNative,[Cl.YASP]:Dl.yaFirstFrameShownYasp,AD:Dl.yaFirstFrameShownAdSDK},Vl={[Cl.HLS]:Ol.firstNetworkHls,[Cl.MP4]:Ol.firstNetworkMp4,[Cl.NATIVE]:Ol.firstNetworkNative,[Cl.YASP]:Ol.firstNetworkYasp,AD:Ol.firstNetworkAdSDK},Ul={[Cl.HLS]:Ol.firstNetworkAdSDKHls,[Cl.MP4]:Ol.firstNetworkAdSDKMp4,[Cl.NATIVE]:Ol.firstNetworkAdSDKNative,[Cl.YASP]:Ol.firstNetworkAdSDKYasp,AD:Ol.firstNetworkAdSDK},Bl={[Cl.HLS]:Ol.setSourceNetworkHls,[Cl.MP4]:Ol.setSourceNetworkMp4,[Cl.NATIVE]:Ol.setSourceNetworkNative,[Cl.YASP]:Ol.setSourceNetworkYasp,AD:Ol.setSourceNetworkAdSDK},Hl={[Cl.HLS]:Ol.setSourceNetworkAdSDKHls,[Cl.MP4]:Ol.setSourceNetworkAdSDKMp4,[Cl.NATIVE]:Ol.setSourceNetworkAdSDKNative,[Cl.YASP]:Ol.setSourceNetworkAdSDKYasp,AD:Ol.setSourceNetworkAdSDK};let jl=-1;const Wl={sourceStart:!1,yaFirstFrameDecoded:!1,yaFirstFrameShown:!1};let Yl,Gl,zl,ql,Kl,Ql;!function(e){e.Internal="internal",e.Api="api",e.Cache="cache"}(Yl||(Yl={})),function(e){e[e.PLAYING=1]="PLAYING",e[e.NOT_PLAYING=2]="NOT_PLAYING"}(Gl||(Gl={})),function(e){e.INIT="INIT",e.SET_SOURCE="SET_SOURCE"}(zl||(zl={})),function(e){e.ON="ON",e.OFF="OFF"}(ql||(ql={})),function(e){e.setSource="setSource",e.destroy="destroy",e.end="end"}(Kl||(Kl={})),function(e){e.SetMuted="SetMuted",e.SetVolume="SetVolume",e.RequestAutoplaySettings="RequestAutoplaySettings",e.VolumeChangeEvent="VolumeChangeEvent",e.RestoreSavedMuted="RestoreSavedMuted"}(Ql||(Ql={}));const Zl=(e,t)=>{for(let r=0;r<e.length;r++)if(t(e[r],r,e))return!0;return!1},Jl=function(e){void 0===e&&(e=window);const t=e.navigator.userAgent,r=t.indexOf("Android");return-1===r?-1:parseFloat(t.slice(r+8))}(),Xl=Zn?function(e,t){return void 0===t&&(t=Qn),Boolean(t.canPlayType(e).replace(/no/,""))}:()=>!1,$l=Xl("application/vnd.apple.mpegurl")||Jl>=4.4;let ed;!function(e){e.NO_MSE="NO_MSE",e.NO_CODECS="NO_CODECS",e.NO_SUPPORTED_DRM="NO_SUPPORTED_DRM",e.NO_SUPPORTED_FORMAT="NO_SUPPORTED_FORMAT",e.INVALID_STREAM_URL="INVALID_STREAM_URL"}(ed||(ed={}));var td=r(7974);const rd=document.createElement("a"),id=/^(android-app:|chrome-extension:)/,nd=e=>{try{return decodeURIComponent(e)}catch(yf){return e}},sd=(e,t)=>t.map(t=>e+"[]="+encodeURIComponent(t)).join("&"),ad=["yandex.ru","yandex.net","yastatic.net","yandex-team.ru","kinopoisk.ru","strm-ott.akamaized.net","playlists-strm-yango.akamaized.net","media-strm-yango.akamaized.net"].concat([]),od=e=>"m3u8"===St(e.toLocaleLowerCase()),ld=e=>"mpd"===St(e.toLocaleLowerCase());var dd=r(3480);const cd=(0,dd.Q)();var ud=r(9396);const hd=function(e){return void 0===e&&(e=window),/YaBrowser/.test((0,as.i)(e))},pd=hd(),fd="detect.probe_mse_support.success",md=(0,ma.I)(()=>{if(void 0===cd)return Promise.reject(new Error("MSE is not supported"));if(function(){if(!pd)return!1;try{return void 0!==window.top.WEB_NTP_VERSION}catch(e){return!1}}())return Promise.resolve(cd);A(fd),A("detect.probe_mse_support.fail");if(function(){try{const e=ud.t.getItem("videoplayer-supported-mse");if(null===e)return;const{value:t,time:r,version:i}=JSON.parse(e);if(Date.now()-r>2592e5)return void ud.t.removeItem("videoplayer-supported-mse");if("1"!==i)return;return t||void 0}catch(e){return}}())return T(fd),Promise.resolve(cd);const e=document.createElement("video"),t=new cd,r=URL.createObjectURL(t);let i,n;const s=new Promise((s,a)=>{i=()=>{s(cd);try{ud.t.setItem("videoplayer-supported-mse",JSON.stringify({value:!0,time:Date.now(),version:"1"}))}catch(e){}},n=()=>a(new Error("MSE is not supported")),t.addEventListener("sourceopen",i),e.addEventListener("error",n),e.addEventListener("durationchange",n),e.setAttribute("x-webkit-airplay","deny"),e.src=r});return s.then(()=>T(fd)).catch(()=>T("detect.probe_mse_support.fail")).then(()=>{URL.revokeObjectURL(r),t.removeEventListener("sourceopen",i),e.removeEventListener("error",n),e.removeEventListener("durationchange",n)}),s});(0,Kn.v)(md());const gd=function(e){void 0===e&&(e=window);const t=(0,as.i)(e).toLowerCase();return/yandexstation.*yandexio/.test(t)||/station.*crosswalk/.test(t)}(),vd=["mp4","webm"],yd=["vp09.00.50.08.00.02.02.02.00","vp09.00.31.08.00.02.02.02.00","hev1.1.6.L150.90","hev1.1.6.L93.90","avc1.640028","avc1.64001F"],Ed=["mp4","ogg","webm"],Sd=["mp4a.40.2","vorbis","opus","flac"],Ad={supported:!0,engine:Cl.NATIVE},Td={supported:!0,engine:Cl.HLS};let bd;const wd=function(e){return void 0===e&&(e=window),/Chrome/.test(e.navigator.userAgent)&&/Google Inc/.test(e.navigator.vendor)&&!hd(e)}(),_d=function(e){return void 0===e&&(e=window),/firefox/.test(e.navigator.userAgent.toLowerCase())}(),Rd=function(e){void 0===e&&(e=window);const t=(0,as.i)(e).toLowerCase();return/linux/.test(t)&&!Rt(e)}();var kd=r(2615);let Pd;!function(e){e.fairplay="fairplay",e.playready="playready",e.widevine="widevine",e.none="none"}(Pd||(Pd={}));var Id=r(7922);const Cd={[Pd.fairplay]:[Id.D,Id.h9,Id.oo],[Pd.widevine]:[Id.ly],[Pd.playready]:[Id.xE],[Pd.none]:[]},Od=(Dd=(0,kd.z)(Cd),[].concat.apply([],Dd));var Dd;const Nd=[{initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"'}],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42E01E"'}]}];let Ld,Md;!function(e){e.YandexBrowserLinux="YandexBrowserLinux",e.OldYandexBrowser="OldYandexBrowser",e.WebKitMediaKeys="WebKitMediaKeys",e.requestMediaKeySystemAccess="requestMediaKeySystemAccess",e.MSMediaKeys="MSMediaKeys",e.GenerateKeyRequest="GenerateKeyRequest",e.Constant="Constant",e.NotAvailable="NotAvailable",e.LiteMode="LiteMode"}(Ld||(Ld={}));const Fd=[];let xd;const Vd=(0,ma.I)(async e=>{let{video:t}=e;const r=function(){try{const e=ud.t.getItem("videoplayer-supported-drm-systems");if(null===e)return;const{value:t,time:r,version:i}=JSON.parse(e);if(Date.now()-r>2592e5)return void ud.t.removeItem("videoplayer-supported-drm-systems");if("e368556cdf348ac5931a077c9485bedc"!==i)return void ud.t.removeItem("videoplayer-supported-drm-systems");if(0===t.supportedDrmSystems.length)return;return t}catch(e){return}}();A("detect.drm");const i=r||await Lt({video:t});return Fd.forEach(e=>e(i)),Fd.length=0,xd=i,void 0===r&&function(e){if(0!==e.supportedDrmSystems.length)try{ud.t.setItem("videoplayer-supported-drm-systems",JSON.stringify({value:e,time:Date.now(),version:"e368556cdf348ac5931a077c9485bedc"}))}catch(t){}}(i),T("detect.drm"),i.supportedDrmSystems}),Ud=document.createElement("video"),Bd={supported:!0,engine:Cl.YASP};let Hd;const jd=function(e){if(void 0===e&&(e=window),wa(e)){const t=(0,as.i)(e).match(/version\/([\d]+)\.([\d]+)/i);if(!t)return{major:-1,minor:-1};const[,r,i]=t;return{major:parseInt(r,10),minor:parseInt(i,10)}}return{major:-1,minor:-1}}(),Wd=navigator&&"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1;var Yd=r(2248);const Gd=function(e){if(void 0===e&&(e=window),W(e)&&e.navigator){const t=(0,as.i)(e).match(/OS ([\d]+)_([\d]+)_?(\d+)?/i);if(!t)return{major:-1,minor:-1};const[,r,i]=t;return{major:parseInt(r,10),minor:parseInt(i,10)}}return{major:-1,minor:-1}}(),zd=[Id.ly],qd=function(e){return void 0===e&&(e=window),W(e)&&(0,as.i)(e).toLowerCase().indexOf("iphone")>-1}();var Kd=r(3564);const Qd=document.createElement("a"),Zd={},Jd={destroy:Xo.Z,setStatsRootFields:Xo.Z,dispatchEvent:Xo.Z,getNextAdInfo:()=>{},preroll:{loadViewers:()=>Promise.resolve([])},midroll:{loadViewers:()=>Promise.resolve([])},inroll:{loadViewers:()=>Promise.resolve([]),schedule:Xo.Z},postroll:{loadViewers:()=>Promise.resolve([])},postPauseroll:{loadViewers:()=>Promise.resolve([])}},Xd=[{end:0,name:"invalid"},{end:750,name:"750)"},{end:1250,name:"[750-1250)"},{end:2e3,name:"[1250-2000)"},{end:3500,name:"[2000-3500)"},{end:5500,name:"[3500-5500)"},{end:9e3,name:"[5500-9000)"},{end:1e6,name:"[9000"},{end:1/0,name:"infinity"}],$d=[{end:0,name:"invalid"},{end:100,name:"100"},{end:250,name:"250"},{end:500,name:"500"},{end:750,name:"750"},{end:1e3,name:"1000"},{end:1500,name:"1500"},{end:2500,name:"2500"},{end:5e3,name:"5000"},{end:1/0,name:"infinity"}];var ec=r(2786);class tc{constructor(e){this.length=e,this.list=[]}push(e){this.list.length>=this.length&&this.list.shift(),this.list.push(e)}getAll(){return this.list}clear(){this.list.length=0}copy(){const e=new tc(this.length);return e.list=this.list.slice(),e}has(e){return-1!==this.list.indexOf(e)}size(){return this.list.length}}class rc extends la{constructor(e){super(),this.history=new tc(100),this.addDestroyHandler((0,Vs.O)(e,"logposted",e=>{xa.log("chrome://media-internals event",e.data),this.history.push(e.data)})),this.addDestroyHandler(()=>{this.history=null})}getHistory(){return this.history?[...this.history.getAll()]:["MediaInternalsHistory is destroyed"]}}class ic extends Ia.v{constructor(){super(),this.once("Destroy",(0,Vs.O)(window,"online",()=>{this.emit("Online")})),this.once("Destroy",(0,Vs.O)(window,"offline",()=>{this.emit("Offline")}))}destroy(){this.emit("Destroy")}}const nc={setItem(e,t){try{sessionStorage.setItem(e,t)}catch(yf){}},getItem(e){try{return sessionStorage.getItem(e)}catch(yf){return null}},removeItem(e){try{sessionStorage.removeItem(e)}catch(yf){}}};class sc{constructor(){this.videoContentId=void 0,this.lastProgress=void 0}setVideoContentId(e){this.lastProgress=void 0,this.videoContentId=e}clearVideoContentId(){this.lastProgress=void 0,this.videoContentId=void 0}getProgress(){if(!this.videoContentId)return;const e=lr(this.videoContentId);return(0,va.z)(e)?e:void 0}saveProgress(e){this.videoContentId&&("number"===typeof this.lastProgress&&Math.abs(this.lastProgress-e)<1||(this.lastProgress=e,dr(this.videoContentId,e)))}}var ac=r(6197);const oc=e=>{const t=[];for(;e;)try{if(d(e),t.push(e),e.parent===e)break;e=e.parent}catch(yf){break}return t},lc=oc(window);var dc=r(1771);class cc extends HTMLVideoElement{constructor(){super(...arguments),this.yasp=void 0,this.error=void 0}}cc.isSupported=void 0,cc.attach=void 0,cc.isYaspVideoElement=void 0,cc.preloadSrc=void 0,cc.releaseSrc=void 0,cc.setVideoElementSizes=void 0,cc.getStats=void 0,cc.configureSource=void 0,cc.messenger=void 0,cc.destroy=void 0,cc.getExpConfig=void 0,cc.setWorkerConfig=void 0;const uc=(0,Gs.t)(Object.getPrototypeOf)?e=>Object.getPrototypeOf(e):e=>e.__proto__||Object.prototype;let hc=0;class pc{constructor(e){let{label:t="",language:r="",id:i=vr(),sourceBuffer:n=null,props:s}=e;this.label=void 0,this.id=void 0,this.language=void 0,this.kind="",this.props=void 0,this.sourceBuffer=null,this.label=t,this.language=r,this.id=i,this.sourceBuffer=n,this.props=s}}const fc=["enabled","bitrate","channels"];class mc extends pc{constructor(e){let t=void 0===e?{}:e,{enabled:r=!1,bitrate:i,channels:n}=t;super(function(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(t,fc)),this._enabled=!1,this.bitrate=void 0,this.channels=void 0,this.onenabledchange=void 0,this._enabled=r,this.bitrate=i,this.channels=n}_destroy(){delete this.onenabledchange}get enabled(){return this._enabled}set enabled(e){var t;"boolean"===typeof e&&e!==this._enabled&&(this._enabled=e,null==(t=this.onenabledchange)||t.call(this))}}var gc=r(9840);class vc extends gc.Z{constructor(e){void 0===e&&(e=[]),super(),this.tracks=[],this._changing=!1;for(let t=0;t<e.length;t++)this.addTrack(e[t])}get length(){return this.tracks.length}addTrack(e){if(-1!==this.tracks.indexOf(e))return;const t=this.tracks.length;Object.defineProperty(this,t,{get:()=>this.tracks[t],enumerable:!1,configurable:!0}),this.tracks.push(e),this.dispatchTrackEvent("addtrack",e)}removeTrack(e){const t=this.tracks.indexOf(e);if(-1===t)return;null==e._destroy||e._destroy();const r=this.tracks.length-1;String(r)in this&&Object.defineProperty(this,r,{get:void 0,enumerable:!1,configurable:!0}),this.tracks.splice(t,1),this.dispatchTrackEvent("removetrack",e)}getTrackById(e){return this.tracks.find(t=>t.id===e)||null}item(e){return this.tracks[e]}dispatchTrackEvent(e,t){const r=yr(e);r.track=t,this.dispatchEvent(r)}}class yc extends vc{constructor(e){void 0===e&&(e=[]);for(let t=e.length-1;t>=0;t--)if(e[t].enabled){Er(e,e[t]);break}super(e),this.onaddtrack=void 0,this.onchange=void 0,this.onremovetrack=void 0,this.onaddtrack=null,this.onchange=null,this.onremovetrack=null,this.addEventListener("change",e=>{var t;return null==(t=this.onchange)?void 0:t.call(this,e)}),this.addEventListener("addtrack",e=>{var t;return null==(t=this.onaddtrack)?void 0:t.call(this,e)}),this.addEventListener("removetrack",e=>{var t;return null==(t=this.onremovetrack)?void 0:t.call(this,e)})}addTrack(e){e.enabled&&Er(this,e),super.addTrack(e),e.onenabledchange=()=>{this._changing||(this._changing=!0,Er(this,e),this._changing=!1,this.dispatchEvent(yr("change")))}}addEventListener(e,t,r){super.addEventListener(e,t,r)}removeEventListener(e,t,r){super.removeEventListener(e,t,r)}}const Ec=["selected","width","height","bitrate","frameRate"];class Sc extends pc{constructor(e){let t=void 0===e?{}:e,{selected:r=!1,width:i,height:n,bitrate:s,frameRate:a}=t;super(function(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(t,Ec)),this._selected=!1,this.width=void 0,this.height=void 0,this.bitrate=void 0,this.frameRate=void 0,this.onselectedchange=void 0,this.selected=r,this.bitrate=s,this.frameRate=a,this.width=i,this.height=n}_destroy(){delete this.onselectedchange}get selected(){return this._selected}set selected(e){var t;"boolean"===typeof e&&e!==this._selected&&(this._selected=e,null==(t=this.onselectedchange)||t.call(this))}}class Ac extends vc{constructor(e){void 0===e&&(e=[]);for(let t=e.length-1;t>=0;t--)if(e[t].selected){Ar(e,e[t]);break}super(e),this.onaddtrack=void 0,this.onchange=void 0,this.onremovetrack=void 0,this.onaddtrack=null,this.onchange=null,this.onremovetrack=null,this.addEventListener("change",e=>{var t;return null==(t=this.onchange)?void 0:t.call(this,e)}),this.addEventListener("addtrack",e=>{var t;return null==(t=this.onaddtrack)?void 0:t.call(this,e)}),this.addEventListener("removetrack",e=>{var t;return null==(t=this.onremovetrack)?void 0:t.call(this,e)})}addEventListener(e,t,r){super.addEventListener(e,t,r)}removeEventListener(e,t,r){super.removeEventListener(e,t,r)}get selectedIndex(){for(let e=0;e<this.length;e++)if(this[e].selected)return e;return-1}addTrack(e){e.selected&&Ar(this,e),super.addTrack(e),e.onselectedchange=()=>{this._changing||(this._changing=!0,Ar(this,e),this._changing=!1,this.dispatchEvent(yr("change")))}}}var Tc=r(9622);class bc{constructor(e){this.externalEventTarget=new gc.Z,this.internalEventTarget=new gc.Z,e({addEventListener:this.internalEventTarget.addEventListener.bind(this.internalEventTarget),removeEventListener:this.internalEventTarget.addEventListener.bind(this.internalEventTarget),postMessage:e=>{const t=new MessageEvent("message",{data:e});Promise.resolve().then(()=>this.externalEventTarget.dispatchEvent(t))}})}addEventListener(e,t,r){this.externalEventTarget.addEventListener(e,t,r)}removeEventListener(e,t,r){this.externalEventTarget.removeEventListener(e,t,r)}terminate(){}postMessage(e){this.internalEventTarget.dispatchEvent(new MessageEvent("message",{data:e}))}}const wc=function(){function e(i){if(r[i])return r[i].exports;var n=r[i]={exports:{}};return t[i](n,n.exports,e),n.exports}var t=ENTRY_MODULE,r={};e.m=t,e.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},e.d=(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},e.g=function(){if("[object Object]"===Object.prototype.toString.call(globalThis))return globalThis;try{return this||new Function("return this")()}catch(yf){if("[object Object]"===Object.prototype.toString.call(window))return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i=e(ENTRY_MODULE);return i.default||i};wc.toString();var _c=r(7926),Rc=r(1647);class kc{constructor(e){this.workerPromise=void 0,this.handleTerminate=void 0,this.workerPromise=function e(t){let r,{inline:i,path:n,workerInternal:s,workerConfig:a}=t;if(!i)try{r=Rr(n)}catch(c){i=!0}i&&(r=new bc(s));const o=new _c.A(e=>{r.postMessage(e,(0,Rc._)(e))});let l=!1;const d=new Promise((t,d)=>{const c=o.request({method:"initWorker",params:a}),u=o=>{l||i?console.error(o):(h(),r.terminate(),t(e({inline:!0,workerInternal:s,path:n,workerConfig:a})))},h=()=>{r.removeEventListener("error",u)};c.then(()=>{l=!0,h(),t({worker:r,rpc:o})}).catch(u),r.addEventListener("error",u),r.addEventListener("message",e=>{o.handleMessage(e)})});return(0,Kn.v)(d),d}({inline:!e.useWebWorker,path:9622,workerInternal:Tc.Z,workerConfig:e.workerConfig}),this.handleTerminate=e.onTerminate,this.workerPromise.then(()=>{console.log("!!! YaspWorker ready")})}async postMessage(){const{worker:e}=await this.workerPromise;e.postMessage(...arguments)}sendEvent(e){let{method:t,params:r}=e;return this.workerPromise.then(e=>{let{rpc:i}=e;return i.sendEvent({method:t,params:r})})}request(e){let{method:t,params:r}=e;return this.workerPromise.then(e=>{let{rpc:i}=e;return i.request({method:t,params:r})})}registerRpcHandler(e,t){return this.workerPromise.then(r=>{let{rpc:i}=r;return i.registerHandler(e,t)}),()=>this.removeRpcHandler(e,t)}registerStaticRpcHandler(e,t){return this.workerPromise.then(r=>{let{rpc:i}=r;return i.registerStaticHandler(e,t)}),()=>this.removeRpcHandler(e,t)}removeRpcHandler(e,t){this.workerPromise.then(r=>{let{rpc:i}=r;return i.removeHandler(e,t)})}destroy(){this.workerPromise.then(e=>{let{worker:t,rpc:r}=e;t.terminate(),r.destroy(),this.handleTerminate()})}}class Pc extends Ga.M{constructor(e,t){super();let r={videoWidth:e.videoWidth,videoHeight:e.videoHeight};const i=()=>{const{videoWidth:i,videoHeight:n}=e;isNaN(i)||isNaN(n)||i<1||n<1||r.videoWidth===i&&r.videoHeight===n||(r={videoWidth:i,videoHeight:n},t({videoWidth:i,videoHeight:n}))};if("onresize"in e)e.addEventListener("resize",i),this.once("Destroy",()=>e.removeEventListener("resize",i));else{e.addEventListener("timeupdate",i),this.once("Destroy",()=>e.removeEventListener("timeupdate",i));const t=setInterval(i,1e3);this.once("Destroy",()=>clearInterval(t))}}}const Ic={attributes:!0,childList:!1,subtree:!1,attributeFilter:["loop"]};class Cc{constructor(e,t){this.observer=void 0,this.observer=new MutationObserver((function(r){for(const i of r){if("attributes"!==i.type)return;const r=i.attributeName;t(r,e[r])}})),this.observer.observe(e,Ic)}destroy(){var e;null==(e=this.observer)||e.disconnect(),this.observer=null}}const Oc={droppedVideoFrames:0,corruptedVideoFrames:0,totalVideoFrames:0};class Dc extends la{constructor(e){super(),this.video=void 0,this.playbackQuality=Oc,this.persistedPlaybackQuality=Oc,this.accumulatedPlaybackQuality=Oc,this.video=e,this.addDestroyHandler(()=>{this.reset(),this.video=void 0})}update(){if(!this.video)return;const e=Pr(this.video);this.playbackQuality=e,0!==this.persistedPlaybackQuality.totalVideoFrames&&(this.persistedPlaybackQuality.totalVideoFrames>e.totalVideoFrames&&(this.accumulatedPlaybackQuality={droppedVideoFrames:this.accumulatedPlaybackQuality.droppedVideoFrames+this.persistedPlaybackQuality.droppedVideoFrames,corruptedVideoFrames:this.accumulatedPlaybackQuality.corruptedVideoFrames+this.persistedPlaybackQuality.corruptedVideoFrames,totalVideoFrames:this.accumulatedPlaybackQuality.totalVideoFrames+this.persistedPlaybackQuality.totalVideoFrames}),this.persistedPlaybackQuality=Oc)}persist(){0!==this.playbackQuality.totalVideoFrames&&(this.persistedPlaybackQuality=this.playbackQuality,this.playbackQuality=Oc)}reset(){this.playbackQuality=Oc,this.persistedPlaybackQuality=Oc,this.accumulatedPlaybackQuality=Oc}getPlaybackQuality(){return this.persistedPlaybackQuality.totalVideoFrames>0?Oc:{droppedVideoFrames:this.playbackQuality.droppedVideoFrames+this.accumulatedPlaybackQuality.droppedVideoFrames,corruptedVideoFrames:this.playbackQuality.corruptedVideoFrames+this.accumulatedPlaybackQuality.corruptedVideoFrames,totalVideoFrames:this.playbackQuality.totalVideoFrames+this.accumulatedPlaybackQuality.totalVideoFrames}}}const Nc=e=>e.devicePixelRatio||e.screen.deviceXDPI&&e.screen.deviceXDPI/e.screen.logicalXDPI||1;const Lc=(0,r(5776).y)();const Mc=(0,r(9881).F)();const Fc=(0,r(6223).V)(),xc=(0,ma.I)(async e=>{const t=Nc(e);if(!Lc)return t;const r=e.tizen;if(!r)return t;const i=e.screen.height;try{const e=await new Promise(e=>{r.systeminfo.getPropertyValue("PANEL",t=>e(t.panelHeight))});return e?e/i:t}catch(n){return t}}),Vc=(0,ma.I)(e=>{let t=Nc(e);if(!Mc)return t;const r=e.Hisense_GetPanelResolution,i=e.Hisense_Get4KSupportState;if(i&&i()&&(t=2),!r)return t;const n=e.screen.height;try{const e=r(),{height:i}=Uc(e);return i?i/n:t}catch(s){return t}}),Uc=e=>{const t=e.split("*");return{height:parseInt(t[1],10),width:parseInt(t[0],10)}},Bc=(0,ma.I)(async e=>{const t=Nc(e);if(!Fc)return t;const r=e.webOS;if(!r)return t;const i=e.screen.height;try{const e=await new Promise(e=>{r.deviceInfo(t=>e(t.screenHeight))});return e?e/i:t}catch(n){return t}}),Hc=e=>Lc?xc(e):Fc?Bc(e):Mc?Promise.resolve(Vc(e)):Promise.resolve(Nc(e));class jc{constructor(e,t){this.callback=void 0,this.intervalId=void 0,this.playbackQualityController=void 0,this.oldValues={},this.dprCheckingInProgress=!1,this.tick=()=>{var e;null==(e=this.playbackQualityController)||e.update();const t=this.getFramesValue();void 0!==t&&this.callback("frames",t),this.checkDevicePixelRatio()},this.callback=t,this.playbackQualityController=new Dc(e),this.intervalId=null}getFramesValue(){var e,t;if(null===this.playbackQualityController||null===this.oldValues)return;const{droppedVideoFrames:r,totalVideoFrames:i}=this.playbackQualityController.getPlaybackQuality();return(null==(e=this.oldValues.frames)?void 0:e.dropped)!==r||(null==(t=this.oldValues.frames)?void 0:t.total)!==i?(this.oldValues.frames={dropped:Math.max(Math.floor(r)),total:Math.max(Math.floor(i))},this.oldValues.frames):void 0}checkDevicePixelRatio(){if(null===this.oldValues)return;if(this.dprCheckingInProgress)return;const e="undefined"!==typeof globalThis?globalThis:window;this.oldValues.devicePixelRatio||this.handleDpr(Nc(e)),this.dprCheckingInProgress=!0,Hc(e).then(e=>{this.handleDpr(e)}).catch(()=>{this.handleDpr(Nc(e))})}handleDpr(e){this.dprCheckingInProgress=!1,null!==this.oldValues&&this.oldValues.devicePixelRatio!==e&&(this.oldValues.devicePixelRatio=e,void 0!==e&&this.callback("devicePixelRatio",e))}enable(){this.tick(),this.intervalId=setInterval(this.tick,250)}disable(){var e;this.oldValues={},null==(e=this.playbackQualityController)||e.persist(),clearInterval(this.intervalId)}destroy(){var e;this.disable(),null==(e=this.playbackQualityController)||e.destroy(),this.callback=Xo.Z,this.oldValues=null}}const Wc=Fs||_a?(e,t)=>{let r=e.paused;return x(()=>{e.paused!==r&&(r=e.paused,t(r))})}:(e,t)=>{let r=e.paused;const i=e=>{const i="pause"===e.type;i!==r&&(r=i,t(r))},n=(0,Vs.O)(e,"pause",i,{passive:!0}),s=(0,Vs.O)(e,"playing",i,{passive:!0}),a=(0,Vs.O)(e,"play",i,{passive:!0});return()=>{n(),s(),a()}};class Yc{constructor(e){this.unsubscribers=[],this.video=void 0,this.destroy=()=>{N(this.unsubscribers)},this.unsubscribers=[],this.video=e}observe(e){const t=Wc(this.video,e),r=()=>{t(),this.unsubscribers=this.unsubscribers.filter(e=>e!==r)};return this.unsubscribers.push(r),r}}var Gc=r(9150);const zc=function(e,t){if(!e||!e.length)return null;if(1===e.length&&e.end(0)-e.start(0)<1e-6)return null;for(let r=0;r<e.length;r++)if(e.start(r)>t&&(0===r||e.end(r-1)-t<=.5))return r;return null},qc=(e,t,r)=>{let i=!1;const n=()=>{const n=Kc(e,i?.3:.15,r);n!==i&&(i=n,t(i))},s=x(n),a=setTimeout(n,0);return()=>{s(),clearTimeout(a)}},Kc=function(e,t,r){void 0===t&&(t=.15);const{currentTime:i,duration:n}=e;if(e.readyState<e.HAVE_FUTURE_DATA)return!0;return(!(null!==zc(e.buffered,e.currentTime))||!r)&&!(0,Gc.w)(e).some(e=>{let{start:r,end:s}=e;return!(i<r||i>s)&&(n<=s||i+t<s)})};class Qc{constructor(e){this.unsubscribers=[],this.video=void 0,this.destroy=()=>{N(this.unsubscribers)},this.unsubscribers=[],this.video=e}observe(e){const t=qc(this.video,e),r=()=>{t(),this.unsubscribers=this.unsubscribers.filter(e=>e!==r)};return this.unsubscribers.push(r),r}}class Zc{constructor(e){this.observer=void 0,this.lastValue=void 0,this.video=void 0,this.onChangeCallbacks=[],this.video=e,this.lastValue=this.computeObjectFit(),this.observer=new MutationObserver(e=>{for(let t of e)if("attributes"===t.type&&("class"===t.attributeName||"style"===t.attributeName)){const e=this.computeObjectFit();this.lastValue!==e&&(this.lastValue=e,this.onChangeCallbacks.forEach(t=>t(e)))}}),this.observer.observe(e,{attributes:!0,attributeFilter:["class","style"]})}computeObjectFit(){if(!this.video)throw new Error("No video-element to compute object-fit");return self.getComputedStyle(this.video).getPropertyValue("object-fit")}getObjectFit(){return this.lastValue}onChange(e){this.onChangeCallbacks.push(e)}destroy(){var e;null==(e=this.observer)||e.disconnect(),this.observer=null,this.video=null,this.onChangeCallbacks=[]}}class Jc{constructor(e,t){this.yaspVideoElement=void 0,this.notifyCallback=void 0,this.attributeObserver=null,this.intervalWatcher=null,this.videoSizeObserver=null,this.pausedObserver=null,this.bufferingObserver=null,this.videoSizeSensor=null,this.objectFitObserver=null,this.handleIntervalUpdate=(e,t)=>{switch(e){case"frames":return void this.handleFrames(t);case"devicePixelRatio":return void this.handleDevicePixelRatio(t)}},this.handleVideoResize=()=>{if(null===this.yaspVideoElement)throw new Error("Unexpected subscription call after destroy");this.notify("updateVideoSize",{height:Math.max(Math.floor(this.yaspVideoElement.videoHeight)),width:Math.max(Math.floor(this.yaspVideoElement.videoWidth))})},this.handleResize=(e,t)=>{if(null===this.yaspVideoElement)throw new Error("Unexpected subscription call after destroy");this.notify("updateContainerSize",{height:Math.max(Math.floor(t),0),width:Math.max(Math.floor(e),0)})},this.handleObjectFit=e=>{this.notify("updateObjectFit",e)},this.handlePaused=e=>{this.notify("updatePaused",e)},this.handleBuffering=e=>{this.notify("updateBuffering",e)},this.handleBuffered=()=>{if(null===this.yaspVideoElement)throw new Error("Unexpected subscription call after destroy");const e=[],t=this.yaspVideoElement.buffered;for(let r=0;r<t.length;r++)e.push([t.start(r),t.end(r)]);this.notify("updateBuffered",e)},this.handleRatechange=()=>{if(null===this.yaspVideoElement)throw new Error("Unexpected subscription call after destroy");this.notify("updatePlaybackRate",this.yaspVideoElement.playbackRate)},this.handleTimeupdate=()=>{if(null===this.yaspVideoElement)throw new Error("Unexpected subscription call after destroy");this.notify("updateCurrentTime",Math.max(this.yaspVideoElement.currentTime,0))},this.handleDurationchange=()=>{if(null===this.yaspVideoElement)throw new Error("Unexpected subscription call after destroy");this.notify("updateDuration",Math.max(this.yaspVideoElement.duration,0))},this.notify=(e,t)=>{this.notifyCallback&&this.notifyCallback(e,t)},this.yaspVideoElement=e,this.notifyCallback=t,this.intervalWatcher=new jc(this.yaspVideoElement,this.handleIntervalUpdate)}enable(){var e;if(null===this.yaspVideoElement||null===this.intervalWatcher)return;this.disable(),this.yaspVideoElement.addEventListener("ratechange",this.handleRatechange,{passive:!0}),this.yaspVideoElement.addEventListener("timeupdate",this.handleTimeupdate,{passive:!0}),this.yaspVideoElement.addEventListener("seeking",this.handleTimeupdate,{passive:!0}),this.yaspVideoElement.addEventListener("durationchange",this.handleDurationchange,{passive:!0}),this.yaspVideoElement.addEventListener("progress",this.handleBuffered,{passive:!0}),this.videoSizeObserver=new Pc(this.yaspVideoElement,this.handleVideoResize),this.objectFitObserver=new Zc(this.yaspVideoElement),this.objectFitObserver.onChange(this.handleObjectFit),this.videoSizeSensor=new pa(this.yaspVideoElement),this.videoSizeSensor.onResize.add(e=>{let{width:t,height:r}=e;return this.handleResize(t,r)});const t=this.videoSizeSensor.getSize();this.handleResize(t.width,t.height),this.intervalWatcher.enable(),this.attributeObserver=new Cc(this.yaspVideoElement,(e,t)=>{"loop"===e&&this.handleLoop(null!=t&&t)}),this.pausedObserver=new Yc(this.yaspVideoElement),this.bufferingObserver=new Qc(this.yaspVideoElement),this.pausedObserver.observe(this.handlePaused),this.bufferingObserver.observe(this.handleBuffering),this.handleLoop(null!=(e=this.yaspVideoElement.loop)&&e)}disable(){var e,t,r,i,n,s;null!==this.yaspVideoElement&&null!==this.intervalWatcher&&(this.yaspVideoElement.removeEventListener("ratechange",this.handleRatechange),this.yaspVideoElement.removeEventListener("timeupdate",this.handleTimeupdate),this.yaspVideoElement.removeEventListener("seeking",this.handleTimeupdate),this.yaspVideoElement.removeEventListener("durationchange",this.handleDurationchange),this.yaspVideoElement.removeEventListener("progress",this.handleBuffered),this.intervalWatcher.disable(),null==(e=this.videoSizeSensor)||e.destroy(),null==(t=this.videoSizeObserver)||t.destroy(),this.videoSizeObserver=null,null==(r=this.objectFitObserver)||r.destroy(),this.objectFitObserver=null,null==(i=this.attributeObserver)||i.destroy(),this.attributeObserver=null,null==(n=this.pausedObserver)||n.destroy(),this.pausedObserver=null,null==(s=this.bufferingObserver)||s.destroy(),this.bufferingObserver=null)}destroy(){var e;this.disable(),null==(e=this.intervalWatcher)||e.destroy(),this.intervalWatcher=null,this.yaspVideoElement=null,this.notifyCallback=null}handleLoop(e){this.notify("updateLoop",e)}handleFrames(e){if(null===this.yaspVideoElement)throw new Error("Unexpected notification call after destroy");this.notify("updateFrames",e)}handleDevicePixelRatio(e){if(null===this.yaspVideoElement)throw new Error("Unexpected notification call after destroy");this.notify("updateDevicePixelRatio",e)}}var Xc=r(5214),$c=r(4910);class eu{constructor(e){this.onTick=void 0,this.cancelPending=void 0,this.onTick=e,this.cancelPending=null}tickAfter(e){this.stop();let t=!0,r=null;this.cancelPending=()=>{self.clearTimeout(r),t=!1};return r=self.setTimeout(()=>{t&&this.onTick()},1e3*e),this}stop(){this.cancelPending&&(this.cancelPending(),this.cancelPending=null)}}class tu{constructor(e){this.onTick=void 0,this.ticker=void 0,this.onTick=e,this.ticker=null}tickNow(){return this.stop(),this.onTick(),this}tickAfter(e){return this.stop(),this.ticker=new eu(()=>{this.onTick()}).tickAfter(e),this}tickEvery(e){return this.stop(),this.ticker=new eu(()=>{var t;null==(t=this.ticker)||t.tickAfter(e),this.onTick()}).tickAfter(e),this}stop(){this.ticker&&(this.ticker.stop(),this.ticker=null)}}class ru{constructor(e,t,r,i,n){this.video=void 0,this.timeline=void 0,this.config=void 0,this.stallDetector=void 0,this.onEvent=void 0,this.unsubscribe=void 0,this.seekingEventReceived=void 0,this.prevReadyState=void 0,this.didFireLargeGap=void 0,this.hadSegmentAppended=void 0,this.locked=void 0,this.gapJumpTimer=void 0,this.video=e,this.timeline=t,this.config=r,this.stallDetector=i,this.onEvent=n,this.seekingEventReceived=!1,this.prevReadyState=e.readyState,this.didFireLargeGap=!1,this.hadSegmentAppended=!1,this.locked=!1,this.unsubscribe=(0,Vs.O)(e,"waiting",()=>this.onPollGapJump(),!1),this.gapJumpTimer=new tu(()=>{this.onPollGapJump()}).tickEvery(.25)}release(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),null!==this.gapJumpTimer&&(this.gapJumpTimer.stop(),this.gapJumpTimer=null),this.stallDetector&&(this.stallDetector.release(),this.stallDetector=null),this.onEvent=null,this.timeline=null,this.video=null}configure(e){this.config=Ir({},this.config,e)}onSegmentAppended(){this.hadSegmentAppended=!0,this.onPollGapJump()}onSeeking(){this.seekingEventReceived=!0,this.hadSegmentAppended=!1,this.didFireLargeGap=!1}lock(){this.locked=!0}unlock(){this.locked=!1}onPollGapJump(){var e,t,r,i,n;if(!this.video)return;if(this.locked&&(0,is.RW)("yasp_no_source_abort_on_fake_seek"))return;if(0===this.video.readyState)return;if(this.video.seeking){if(!this.seekingEventReceived)return}else this.seekingEventReceived=!1;if(this.video.paused&&(null==(e=this.config)||!e.jumpOnPause))return;if(this.video.readyState!==this.prevReadyState&&(this.didFireLargeGap=!1,this.prevReadyState=this.video.readyState),null!=(t=this.stallDetector)&&t.poll())return;const s=(null==(r=this.config)?void 0:r.smallGapLimit)||.5,a=(null==(i=this.config)?void 0:i.largeGapLimit)||1/0;let o=this.video.currentTime,l=this.video.buffered,d=zc(l,o);if(null===d)return;if(0===d&&!this.hadSegmentAppended)return;let c=l.start(d);if(c>=((null==(n=this.timeline)?void 0:n.getSeekRangeEnd())||0))return;let u=c-o,h=u<=s,p=!1;if(!(u<ru.BROWSER_GAP_TOLERANCE)){if(!h&&!this.didFireLargeGap){var f,m;this.didFireLargeGap=!0;const e=[];for(let t=0;t<this.video.buffered.length;t++)e.push([this.video.buffered.start(t),this.video.buffered.end(t)]);null==(f=this.onEvent)||f.call(this,{currentTime:o,gapSize:u,bufferedRanges:e}),null!=(m=this.config)&&m.jumpLargeGaps&&u<a&&(p=!0)}(h||p)&&(this.video.currentTime=c)}}}ru.BROWSER_GAP_TOLERANCE=.001;var iu=r(520);class nu{static isBuffered(e,t,r){if(void 0===r&&(r=0),!e||!e.length)return!1;if(1===e.length&&e.end(0)-e.start(0)<1e-6)return!1;if(t>e.end(e.length-1))return!1;for(let i=0;i<e.length;i++)if(t+r>=e.start(i)&&t-r<=e.end(i))return!0;return!1}static getTimeRanges(e){const t=[];for(let r=0;r<e.length;r++)try{t.push({start:e.start(r),end:e.end(r)})}catch(yf){}return(0,iu.l)(t)}}var su=r(1106),au=r(371),ou=r(8493);const lu=Date&&(0,rs.m)(Date.now)?()=>Date.now():()=>(new Date).getTime();const du=r(9201).b?9e5:864e5,cu=["ewma","hlsjs"],uu=function(e){void 0===e&&(e=window);return(0,as.i)(e).includes("CrKey")}(),hu=Mc||Fc||Lc;class pu{constructor(e,t,r,i){void 0===t&&(t=Xo.Z),void 0===r&&(r=.1),void 0===i&&(i=1),this.video=void 0,this.wasMakingProgress=void 0,this.value=void 0,this.lastUpdateSeconds=void 0,this.didJump=void 0,this.didTryToEscape=void 0,this.didTryToEscapeSeekingStucking=void 0,this.skipOffset=void 0,this.stallThresholdSeconds=void 0,this.extraThresholdSeconds=void 0,this.onEvent=void 0,this.makePP=()=>{this.video&&(this.video.pause(),(0,Kn.v)(this.video.play()))},this.handleTVPoll=(e,t)=>{if(!this.video)return!1;if(this.video.seeking)return this.tryToEscapeSeekingStucking(e);if(e>=this.stallThresholdSeconds&&t&&!this.didJump)return this.onStall(),this.didJump=!0,this.value=this.video.currentTime,this.onEvent(),!0;return!(!(e>=this.extraThresholdSeconds&&t)||this.didTryToEscape)&&this.tryToEscapeTVStucking()},this.handlePoll=(e,t)=>{if(!this.video)return!1;const r=e>=this.stallThresholdSeconds&&t&&!this.didJump;return r&&(this.onStall(),this.didJump=!0,this.value=this.video.currentTime,this.onEvent()),r},this.video=e,this.wasMakingProgress=this.shouldBeMakingProgress(),this.value=null==e?void 0:e.currentTime,this.lastUpdateSeconds=Date.now()/1e3,this.didJump=!1,this.didTryToEscape=!1,this.didTryToEscapeSeekingStucking=!1,this.skipOffset=r,this.stallThresholdSeconds=i,this.extraThresholdSeconds=2*i,this.onEvent=t}release(){this.video=null,this.onEvent=Xo.Z}onStall(){if(!this.video)return;Fc||Lc||uu||!this.skipOffset?this.makePP():this.video.currentTime+=this.skipOffset}poll(){if(!this.video)return;const e=this.shouldBeMakingProgress(),t=this.video.currentTime,r=Date.now()/1e3;(this.value!==t||this.wasMakingProgress!==e)&&(this.lastUpdateSeconds=r,this.value=t,this.wasMakingProgress=e,this.didJump=!1,this.didTryToEscape=!1,this.didTryToEscapeSeekingStucking=!1);const i=r-this.lastUpdateSeconds;return(hu?this.handleTVPoll:this.handlePoll)(i,e)}shouldBeMakingProgress(){return!!this.video&&(!this.video.paused&&(0!==this.video.playbackRate&&(0!==this.video.buffered.length&&this.hasContentFor(this.video.currentTime))))}tryToEscapeTVStucking(){if(!this.video)return!1;if(Mc)return!(this.video.readyState<this.video.HAVE_ENOUGH_DATA)&&(this.didTryToEscape=!0,setTimeout(()=>{var e;null!=(e=this.video)&&e.paused||this.makePP()},2e3),!0);if(Lc){const e=qe((0,Gc.w)(this.video),this.video.currentTime);if(!e||e<7.5)return!1;if(this.video.readyState===this.video.HAVE_METADATA)return this.video.currentTime+=this.skipOffset,this.value=this.video.currentTime,this.didTryToEscape=!0,!0}return!1}tryToEscapeSeekingStucking(e){return!(!this.video||this.didTryToEscapeSeekingStucking||!this.video.paused||e<this.extraThresholdSeconds)&&(this.video.readyState===this.video.HAVE_METADATA&&(this.video.currentTime+=this.skipOffset,this.value=this.video.currentTime,this.didTryToEscapeSeekingStucking=!0,!0))}hasContentFor(e){if(!this.video)return!1;for(const{start:t,end:r}of(0,Gc.w)(this.video))if(!(e<t-.1)&&!(e>r-.5))return!0;return!1}}var fu=r(5887);const mu=URL.createObjectURL(new Blob(["WEBVTT"],{type:"text/vtt"}));var gu=r(4364);class vu{constructor(e){this.video=null,this.wasNativeProgressEmited={default:!1,onPause:!1},this.interval=null,this.lastBufferedEnd=0,this.onPoll=()=>{if(!this.video)return;const{length:e}=this.video.buffered;if(!e)return void(this.lastBufferedEnd=0);const t=this.video.buffered.end(e-1);this.lastBufferedEnd<t&&this.emitProgress(),this.lastBufferedEnd=t},this.onProgress=e=>{this.video&&("detail"in e&&e.detail.synthetic||(this.video.paused?this.wasNativeProgressEmited.onPause=!0:this.wasNativeProgressEmited.default=!0,this.shouldStopPolling()&&this.release()))},this.video=e,e.addEventListener("progress",this.onProgress),this.interval=setInterval(this.onPoll,250)}shouldStopPolling(){return(0,kd.z)(this.wasNativeProgressEmited).every(Boolean)}release(){var e;null==(e=this.video)||e.removeEventListener("progress",this.onProgress),this.interval&&(clearInterval(this.interval),this.interval=null),this.video=null}emitProgress(){var e,t;this.shouldStopPolling()||(this.wasNativeProgressEmited.default||null!=(e=this.video)&&e.paused)&&(this.wasNativeProgressEmited.onPause||null==(t=this.video)||!t.paused)||this.dispatchSyntheticProgress()}dispatchSyntheticProgress(){var e;null==(e=this.video)||e.dispatchEvent(new CustomEvent("progress",{detail:{synthetic:!0}}))}}var yu=r(7550),Eu=r(8584),Su=r(153),Au=r(1911);const Tu=["play","playing","pause","error","waiting","stalled","suspend","ended","loadstart","abort","loadedmetadata","loadeddata","canplay","canplaythrough","durationchange","seeking","seeked","encrypted","ratechange"],bu=["error","waiting","seeking","seeked","canplay","encrypted"];class wu{constructor(e,t){this.video=e,this.getDump=t,this.history=new Au.d(Su.K),this.handleEvent=e=>{const t=e.type,r={event:t,timestamp:Date.now()};bu.includes(t)&&(r.dump=this.getDump()),this.history.push(r)},this.subscribeToEvents()}subscribeToEvents(){Tu.forEach(e=>{this.video.addEventListener(e,this.handleEvent)})}release(){Tu.forEach(e=>{this.video.removeEventListener(e,this.handleEvent)})}getEventHistory(){return this.history.toArray()}pushCustomEvent(e){this.history.push(e)}}var _u=r(4118);const Ru=(0,_u.Y)(()=>{if(MediaSource.canConstructInDedicatedWorker)return window.top.Ya=window.top.Ya||{},window.top.Ya.YaspWorkerConsumers=window.top.Ya.YaspWorkerConsumers||[],window.top.Ya})||{YaspWorkerConsumers:[]};class ku{constructor(e,t){this.maxAttempts=t,this.remainingAttempts=0,this.originTime=0,this.targetTime=0,this.timer=new tu(()=>{this.onTick()}),this.video=void 0,this.video=e}release(){this.timer&&(this.timer.stop(),this.timer=null),this.video=null}moveTo(e){this.video&&this.timer&&(this.originTime=this.video.currentTime,this.targetTime=e,this.remainingAttempts=this.maxAttempts,this.video.currentTime=e,this.timer.tickEvery(.1))}onTick(){this.video&&this.timer&&(this.remainingAttempts<=0?this.timer.stop():this.video.currentTime===this.originTime?(this.video.currentTime=this.targetTime,this.remainingAttempts--):this.timer.stop())}}class Pu{constructor(e,t){this.yaspVideo=void 0,this.detachedSrcInternal=void 0,this.airplaySrcInternal=void 0,this.airplayEnabled=void 0,this.lastSetSrcTime=void 0,this.onAirplayStateChange=void 0,this.airplayEnabled=e.webkitCurrentPlaybackTargetIsWireless,this.onAirplayStateChange=t,this.yaspVideo=e,this.setUpAirplay()}set airplaySrc(e){this.airplaySrcInternal=e,this.airplayEnabled&&e&&(this.lastSetSrcTime=(0,Eu.no)(),this.yaspVideo.src=e,this.yaspVideo.play())}get airplaySrc(){return this.airplaySrcInternal}set detachedSrc(e){this.detachedSrcInternal=e}get detachedSrc(){return this.detachedSrcInternal}setUpAirplay(){let e;this.yaspVideo.setAttribute("x-webkit-airplay","allow"),this.yaspVideo.disableRemotePlayback=!0,this.yaspVideo.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",t=>{const r=(0,Eu.no)();if(this.lastSetSrcTime&&r-this.lastSetSrcTime<3e3)return;if(e&&r-e<2e3)return;e=(0,Eu.no)();const{currentTime:i}=this.yaspVideo;this.yaspVideo.disableRemotePlayback?(this.yaspVideo.disableRemotePlayback=!1,this.onAirplayStateChange(!0),this.airplayEnabled=!0,this.detachedSrc=this.yaspVideo.src,this.yaspVideo.src=this.airplaySrcInternal,this.yaspVideo.addEventListener("loadedmetadata",()=>{this.yaspVideo.currentTime=i,this.yaspVideo.play()})):(this.airplayEnabled=!1,this.onAirplayStateChange(!1),this.yaspVideo.disableRemotePlayback=!0,this.yaspVideo.src=this.detachedSrc,this.yaspVideo.addEventListener("loadedmetadata",()=>{this.yaspVideo.currentTime=i,this.yaspVideo.play()}))})}}class Iu extends cc{constructor(){super(...arguments),this.progressWatcher=void 0,this.gapController=void 0,this.eventsWatcher=void 0,this.playheadMover=void 0,this.airplayController=void 0,this.srcSetDeferred=void 0,this.detachCallbacks=void 0,this.playCalled=void 0,this.shouldPlay=void 0,this.restorePrototype=void 0,this.videoTrackList=void 0,this.audioTrackList=void 0,this.yaspSrc=void 0,this.yaspError=null,this.error=null,this.videoStateNotifier=void 0,this.unsubscribeTextTracksChange=void 0,this.unsubscribeTextTracksAdd=void 0,this.streamEndTime=void 0,this.serverTimeInfo=void 0,this.isLowLatency=!1,this.stallDetector=null,this.yaspSeekable=void 0,this.startTime=0}static isSupported(){try{return"function"===typeof MediaSource.isTypeSupported}catch(e){return!1}}static isCurrentSrc(e,t){return!(null===t||!Iu.isYaspVideoElement(e))&&(0,$c.Hi)(e.yaspSrc)===(0,$c.Hi)(t)}static getDefaultBandwidthEstimate(){const e=Iu.bandwidth;if(e)return Cr(e);const t=Dr();return t?{value:t,source:"cache"}:{value:ou.S,source:"default"}}static setDevicePixelRatioForSource(e){Iu.worker.request({method:"setDevicePixelRatio",params:{source:e,devicePixelRatio:Nc(window)}}).catch(Xo.Z),Hc(window).then(t=>Iu.worker.request({method:"setDevicePixelRatio",params:{source:e,devicePixelRatio:t}})).catch(Xo.Z)}logAirplayStateChange(e){this.yaspDispatchEvent("yasp-event",{name:"AirplayStateChange",data:{enabled:e}})}static attach(e,t){if(Iu.isYaspVideoElement(e))return(0,gu.L)(new Error("Unexpected YaspVideoElement.attach(yaspVideoElement) call")),e;Iu.setWorkerConfig(t);const r=gr(e);Ba()(e,Iu.prototype);const i=e;i.restorePrototype=r,i.detachCallbacks=[],i.initWorker(),i.initVideoTrackList(),i.initAudioTrackList(),i.initTextTrackList(),i.initPlayheadMover(),i.initWatchdog(),i.initEventsWatcher(),i.initNativeErrorHandling();const n=Iu.overrideYaspGetters(i);return i.detachCallbacks.push(n),(0,is.RW)("web_add_mms_ios")&&i.initAirplayController(),Iu.instances.push(i),i}static warmUp(){(0,Xo.Z)(Iu.worker)}static async destroy(){var e;console.log("destroy worker"),await Promise.all(Iu.instances.map(e=>e.detach())),e=Iu,(0,is.RW)("yasp_share_worker")&&(Ru.YaspWorkerConsumers=Ru.YaspWorkerConsumers.filter(t=>t!==e));!function(){if(!(0,is.RW)("yasp_share_worker"))return!1;try{var e;if(0===Ru.YaspWorkerConsumers.length&&!(0,is.RW)("yasp_share_worker_no_real_destroy"))null==(e=Ru.YaspWorker)||e.destroy(),delete Ru.YaspWorker;return!0}catch(yf){}return!1}()&&Iu.workerImpl&&Iu.workerImpl.destroy()}checkShouldPlay(){return this.shouldPlay}static overrideYaspGetters(e){const t=Iu.initYaspSeekable(e),r=Iu.attachErrorStore(e),i=Iu.initYaspCurrentSrc(e);return()=>{t(),r(),i()}}static attachErrorStore(e){return Object.defineProperty(e,"error",{get(){const t=this;return void 0!==t.yaspError?t.yaspError:Iu.getNativeErrorAndAttachErrorStore(e)},configurable:!0}),()=>delete e.error}static getNativeErrorAndAttachErrorStore(e){delete e.error;const{error:t}=e;return Iu.attachErrorStore(e),t}static getNativeSeekableAndInitYaspSeekable(e){delete e.seekable;const{seekable:t}=e;return Iu.initYaspSeekable(e),t}static isYaspVideoElement(e){return!0===e.yasp}get videoTracks(){return this.videoTrackList}get audioTracks(){return this.audioTrackList}canPlayType(e){return Iu.isSupported()&&"application/dash+xml"===e?super.canPlayType('video/mp4; codecs="avc1.42E01E"'):super.canPlayType(e)}rethrowEmptySrc(e){e||(0,gu.L)(new Error("Setting empty src"))}getAttribute(e){return"src"===e&&void 0!==this.yaspSrc?this.yaspSrc:super.getAttribute(e)}setAttribute(e,t){return"src"===e?(this.rethrowEmptySrc(t),this.setSrc(t)):super.setAttribute(e,t)}removeAttribute(e){"src"===e&&this.setSrc(""),super.removeAttribute(e)}get src(){var e;return void 0===this.yaspSrc?null!=(e=HTMLVideoElement.prototype.getAttribute.call(this,"src"))?e:"":this.yaspSrc}set src(e){this.rethrowEmptySrc(e),this.setSrc(e)}set airplaySrc(e){this.airplayController&&(this.airplayController.airplaySrc=e)}get airplaySrc(){var e;return null==(e=this.airplayController)?void 0:e.airplaySrc}addEventListener(e,t,r){super.addEventListener(e,t,r)}removeEventListener(e,t,r){super.removeEventListener(e,t,r)}get yasp(){return!0}getVideoElementDebugDump(){const{paused:e,seeking:t,yaspError:r,yaspSeekable:i,currentTime:n,yaspSrc:s,readyState:a}=this,o=nu.getTimeRanges(Iu.getNativeSeekableAndInitYaspSeekable(this)),l=Iu.getNativeErrorAndAttachErrorStore(this),d=(0,Gc.w)(this);return{error:l,yaspError:r,paused:e,seeking:t,seekable:o,yaspSeekable:i,buffered:d,bufferedTime:qe(d,this.currentTime),currentTime:n,src:HTMLVideoElement.prototype.getAttribute.call(this,"src"),yaspSrc:s,readyState:a}}async yaspRequestDebugInfo(){var e;const{videoTracks:t,audioTracks:r,textTracks:i}=this,n={videoElement:Vr({},this.getVideoElementDebugDump(),{audioTracks:(0,Xc.w)(r),videoTracks:(0,Xc.w)(t),textTracks:(0,Xc.w)(i)}),time:(0,Eu.no)()/1e3,videoEventsHistory:null==(e=this.eventsWatcher)?void 0:e.getEventHistory()};return Vr({},n,await Iu.worker.request({method:"requestDebugInfo",params:{source:this.yaspSrc}}))}async detach(){var e,t,r,i,n,s,a,o;void 0!==this.yaspSrc&&await Iu.worker.request({method:"detach",params:{source:this.yaspSrc}}),this.detachCallbacks&&(this.detachCallbacks.filter(Boolean).forEach(async e=>{try{await e()}catch(t){(0,gu.L)(t)}}),this.detachCallbacks.length=0,delete this.detachCallbacks),null==(e=this.gapController)||e.release(),this.stallDetector=null,this.gapController=void 0,null==(t=this.progressWatcher)||t.release(),this.progressWatcher=void 0,null==(r=this.eventsWatcher)||r.release(),this.eventsWatcher=void 0,null==(i=this.playheadMover)||i.release(),this.playheadMover=void 0,this.restore(),this.removeEventListener("progress",this.onSegmentAppended),this.removeEventListener("seeking",this.onSeeking),this.removeEventListener("canplay",this.onCanPlay),this.removeEventListener("error",this.onNativeError),null==(n=this.unsubscribeTextTracksChange)||n.call(this),this.unsubscribeTextTracksChange=void 0,null==(s=this.unsubscribeTextTracksAdd)||s.call(this),this.unsubscribeTextTracksAdd=void 0,this.removeAttribute("src"),null==(a=this.restorePrototype)||a.call(this),this.restorePrototype=void 0,Iu.instances=Iu.instances.filter(e=>e!==this),null==(o=this.videoStateNotifier)||o.disable()}static async preloadSrc(e,t){const r=t.yaspSourceConfig;r?Iu.configureSource(e,r):Iu.shouldSaveBandwidth&&Iu.worker.sendEvent({method:"configureSource",params:{source:e,config:{defaultBandwidthEstimate:Iu.getDefaultBandwidthEstimate()}}}),Iu.setDevicePixelRatioForSource(e),await Iu.worker.request({method:"load",params:{source:e}})}async yaspPreloadSrc(e,t){return Iu.preloadSrc(e,t)}static async releaseSrc(e){return Iu.worker.request({method:"destroy",params:{source:e}}).catch(xa.warn)}async yaspReleaseSrc(e){return Iu.releaseSrc(e)}yaspSetVideoElementSizes(e){Iu.setVideoElementSizes(this.src,e)}static setVideoElementSizes(e,t){(0,is.RW)("web_add_mms_ios")&&!ld(e)||Iu.worker.sendEvent({method:"setVideoElementSizes",params:{source:e,videoSizes:t}})}yaspDispatchEvent(e,t,r){const i=new CustomEvent(e,Vr({detail:t},r));super.dispatchEvent(i)}static getStats(){return{bandwidth:Iu.bandwidth,maxCapAllowedVideoTrack:Iu.maxCapAllowedVideoTrack}}static configureSource(e,t){const r=t.defaultBandwidthEstimate?Cr(t.defaultBandwidthEstimate):void 0;void 0!==r&&(Iu.shouldSaveBandwidth=!1),Iu.worker.sendEvent({method:"configureSource",params:{source:e,config:Vr({},t,{defaultBandwidthEstimate:r})}})}static setWorkerConfig(e){void 0!==e&&(Iu.workerConfig.sourceLimit=e.sourceLimit,Iu.workerConfig.perfLogUrl=e.perfLogUrl)}static get worker(){let e=void 0===Iu.workerImpl;if(void 0===Iu.workerImpl&&(Iu.workerImpl=function(){if((0,is.RW)("yasp_share_worker"))return Ru.YaspWorker}()),void 0===Iu.workerImpl){const e=(0,dd.Q)(),i=!(!(0,is.RW)("web_yasp_enable_worker")||(t=e,r="canConstructInDedicatedWorker",!Object.prototype.hasOwnProperty.call(t,r)))&&(MediaSource.canConstructInDedicatedWorker&&Boolean(window.MediaSourceHandle));Iu.workerImpl=new kc({useWebWorker:i,workerConfig:Vr({},Iu.workerConfig,{flags:(0,is.qm)()}),onTerminate:()=>{Iu.messenger.emit("yasp-event",{name:"YaspWorkerTerminate",data:void 0}),Iu.workerImpl=void 0}})}var t,r,i,n;return e&&(n=Iu.workerImpl,(0,is.RW)("yasp_share_worker")&&(Ru.YaspWorker=n),i=Iu,(0,is.RW)("yasp_share_worker")&&Ru.YaspWorkerConsumers.push(i),Iu.workerImpl.registerStaticRpcHandler("updateBandwidthEstimate",e=>(Iu.bandwidth=e.bandwidth,Iu.shouldSaveBandwidth&&Or(e.bandwidth),{done:!0,value:void 0})),Iu.workerImpl.registerStaticRpcHandler("updateMaxCapAllowedVideoTrack",e=>(Iu.maxCapAllowedVideoTrack=e.maxCapAllowedVideoTrack,{done:!0,value:void 0})),Iu.workerImpl.registerStaticRpcHandler("updateBufferedInfo",e=>(Iu.messenger.emit("BufferedInfoChanged",e),{done:!0,value:void 0})),Iu.workerImpl.registerStaticRpcHandler("logWorkerState",e=>(Iu.messenger.emit("LogWorkerState",e),{done:!0,value:void 0})),Iu.workerImpl.registerStaticRpcHandler("error",Iu.detachedErrorRpcHandler),Iu.workerImpl.registerStaticRpcHandler("event",Iu.detachedEventRpcHandler)),Iu.workerImpl}handleError(e){if(e.isFatal){const t=this.createMediaError(MediaError.MEDIA_ERR_NETWORK,e.message,e);this.yaspError=t,this.yaspDispatchEvent("error",void 0)}else"YASP_BUFFER_ALLOCATION_ERROR"===e.code&&(e.details.memory=self?Mr((self.performance||{}).memory):{}),this.yaspDispatchEvent("yasp-error",e,{cancelable:!0})}initVideoTrackList(){if(void 0!==this.videoTrackList)return;const e=new Ac;e.addEventListener("change",()=>{const{id:t}=e[e.selectedIndex];Iu.worker.sendEvent({method:"setVideoTrack",params:{source:this.yaspSrc,trackId:t}});const r=new Event("change");(0,Jn.Y)(()=>{super.videoTracks.dispatchEvent(r)})}),this.videoTrackList=e}yaspSetAudioTrack(e){e&&Iu.worker.sendEvent({method:"setAudioTrack",params:{source:this.yaspSrc,language:e}})}initAudioTrackList(){if(void 0!==this.audioTrackList)return;const e=new yc;e.addEventListener("change",()=>{(0,Xc.w)(e).find(e=>{e.enabled&&Iu.worker.sendEvent({method:"setAudioTrack",params:{source:this.yaspSrc,language:e.language}})});const t=new Event("change");(0,Jn.Y)(()=>{super.audioTracks.dispatchEvent(t)})}),this.audioTrackList=e}static removeCues(e){if(!e.cues)return;let t=e.cues;for(let r=t.length-1;r>=0;r--){let i=t[r];i&&e.removeCue(i)}}initTextTrackList(){Mc&&(this.unsubscribeTextTracksAdd=(0,Vs.O)(this.textTracks,"addtrack",e=>{let{track:t}=e;const r=t;var i;"empty-yasp-text-track"===r.id&&"showing"===r.mode&&(r.mode="disabled",null==(i=this.findEmptyTextTrack())||i.remove())})),this.unsubscribeTextTracksChange=(0,Vs.O)(this.textTracks,"change",e=>{let{target:t}=e;const r={source:this.yaspSrc,track:void 0},i=t;for(let s=0;s<i.length;s++){const e=i[s];var n;if("empty-yasp-text-track"!==e.id)"disabled"!==e.mode&&(Iu.removeCues(e),r.track={id:e.id,label:e.label,language:e.language,kind:e.kind});else null==(n=this.findEmptyTextTrack())||n.remove()}Iu.worker.sendEvent({method:"setTextTrack",params:r})})}findEmptyTextTrack(){return this.querySelector('track[id="empty-yasp-text-track"]')}updateObjectUrl(e){this.rethrowEmptySrc(e),"string"===typeof e?HTMLVideoElement.prototype.setAttribute.call(this,"src",e):this.srcObject=e}registerRpcHandlerForInstance(e,t){this.detachCallbacks.push(Iu.worker.registerRpcHandler(e,e=>Iu.isCurrentSrc(this,"source"in e?e.source:null)?t(e):{done:!1,value:void 0}))}initWorker(){this.registerRpcHandlerForInstance("setStartInfo",e=>{var t,r;return this.updateObjectUrl(e.objectUrl),this.setStartPosition(e.startPosition),this.readyState<HTMLMediaElement.HAVE_METADATA&&this.addEventListener("loadedmetadata",()=>{(0,$c.Hi)(this.yaspSrc)===(0,$c.Hi)(e.source)&&this.setStartPosition(e.startPosition)},{once:!0}),null==(t=this.videoStateNotifier)||t.handleTimeupdate(),null==(r=this.srcSetDeferred)||r.resolve(),{done:!0,value:void 0}}),this.registerRpcHandlerForInstance("addAudioTrack",e=>{var t,r;return null==(t=this.audioTrackList)||t.addTrack(new mc({enabled:e.track.selected,label:e.track.label,language:null!=(r=e.track.language)?r:void 0,id:e.track.id,kind:e.track.kind,bitrate:e.track.bitrate,channels:e.track.channels})),{done:!0,value:void 0}}),this.registerRpcHandlerForInstance("addVideoTrack",e=>{var t,r,i;return null==(t=this.videoTrackList)||t.addTrack(new Sc({selected:e.track.selected,width:e.track.width,height:e.track.height,bitrate:e.track.bitrate,label:e.track.label,language:null!=(r=e.track.language)?r:void 0,frameRate:e.track.frameRate,id:e.track.id,kind:e.track.kind})),e.length===(null==(i=this.videoTrackList)?void 0:i.length)&&this.yaspDispatchEvent("yasp-videotracksadded",void 0),{done:!0,value:void 0}}),this.registerRpcHandlerForInstance("addTextTrack",e=>{if(Mc&&!this.findEmptyTextTrack()){const t=document.createElement("track");t.setAttribute("kind",e.track.kind),t.setAttribute("default","true"),t.setAttribute("id","empty-yasp-text-track"),t.src=mu,this.appendChild(t)}const t=document.createElement("track");return t.setAttribute("kind",e.track.kind),t.setAttribute("label",e.track.label),t.setAttribute("srclang",e.track.language),t.setAttribute("id",e.track.id),t.src=mu,this.appendChild(t),{done:!0,value:void 0}}),this.registerRpcHandlerForInstance("cuesAdded",e=>{let t,{source:r,cues:i,label:n}=e;for(let a=0;a<this.textTracks.length;a++)this.textTracks[a].label===n&&(t=this.textTracks[a]);if(!t)return{done:!0,value:void 0};const s=e=>{const r=new VTTCue(e.startTime,e.endTime,e.payload);t.addCue(r),(e.nestedCues||[]).forEach(s)};return i.forEach(s),{done:!0,value:void 0}}),this.registerRpcHandlerForInstance("changeSelectedVideoTrack",e=>{if(!this.videoTrackList)return{done:!0,value:void 0};const t=this.videoTrackList.getTrackById(e.trackId);return t?(t.selected=!0,{done:!0,value:void 0}):{done:!0,value:void 0}}),this.registerRpcHandlerForInstance("changeSelectedAudioLanguage",e=>{if(!this.audioTrackList)return{done:!0,value:void 0};for(let t=0;t<this.audioTrackList.length;t++)this.audioTrackList[t].enabled=this.audioTrackList[t].language===e.language;return{done:!0,value:void 0}}),this.registerRpcHandlerForInstance("applyDrmInfos",e=>(this.yaspDispatchEvent("yasp-drmInfoReceived",e.drmInfos,{cancelable:!0}),{done:!0,value:void 0})),this.registerRpcHandlerForInstance("changeVideoType",e=>(this.yaspDispatchEvent("yasp-videoTypeChange",e.videoType,{cancelable:!0}),{done:!0,value:void 0})),this.registerRpcHandlerForInstance("changeIsLowLatency",e=>(this.isLowLatency=e.isLowLatency,{done:!0,value:void 0})),this.registerRpcHandlerForInstance("emsg",e=>(this.yaspDispatchEvent("yasp-emsg",e.emsg,{cancelable:!0}),{done:!0,value:void 0})),this.registerRpcHandlerForInstance("logSegmentLoaded",e=>{const t="[SegmentLoader] loaded type = "+e.info.type+", number = "+e.info.number+", cmaf = "+e.info.cmaf;return this.yaspDispatchEvent("yasp-debug",t,{cancelable:!0}),{done:!0,value:void 0}}),(0,is.RW)("web_yasp_target_latency_updater")&&this.registerRpcHandlerForInstance("updateTargetLatency",e=>(this.yaspDispatchEvent("yasp-updateTargetLatency",e.latency,{cancelable:!0}),{done:!0,value:void 0})),this.registerRpcHandlerForInstance("updateUtcStartTime",e=>(this.startTime=e.time,{done:!0,value:void 0})),this.registerRpcHandlerForInstance("updateSeekableRange",e=>(this.yaspSeekable={start:e.start,end:e.end},{done:!0,value:void 0})),this.registerRpcHandlerForInstance("urlObjectUpdated",e=>{const t=this.currentTime;return this.updateObjectUrl(e.objectUrl),this.currentTime=t,{done:!0,value:void 0}}),this.registerRpcHandlerForInstance("flushMediaPipeline",e=>(0===this.buffered.length&&(this.currentTime-=.001),{done:!0,value:void 0})),this.registerRpcHandlerForInstance("updateServerTime",e=>(this.serverTimeInfo?(this.serverTimeInfo.time=e.time,this.serverTimeInfo.getTime=(0,au.u)()):this.serverTimeInfo={time:e.time,getTime:(0,au.u)()},{done:!0,value:void 0})),this.registerRpcHandlerForInstance("updateStreamEndTime",e=>(this.streamEndTime=e.time,{done:!0,value:void 0})),this.registerRpcHandlerForInstance("event",e=>(this.yaspDispatchEvent("yasp-event",e,{cancelable:!0}),{done:!0,value:void 0})),this.registerRpcHandlerForInstance("error",e=>{let{error:t,source:r}=e;const i=Iu.parseErrorString(t);return this.handleError(i),{done:!0,value:void 0}});this.videoStateNotifier=new Jc(this,(e,t)=>{null!==this.yasp&&Iu.worker.postMessage({jsonrpc:"2.0",method:e,sourceKey:(0,$c.Hi)(this.yaspSrc),params:t})}),this.videoStateNotifier.enable()}setStartPosition(e){var t;e<=0||null===this.clampPosition(e)&&((0,is.RW)("yasp_no_source_abort_on_fake_seek")&&this.currentTime===e||null==(t=this.playheadMover)||t.moveTo(e))}getServerTime(){if(this.serverTimeInfo&&this.serverTimeInfo.time)return(this.serverTimeInfo.time+this.serverTimeInfo.getTime())/1e3}forceTimeUpdate(){var e;null==(e=this.videoStateNotifier)||e.handleTimeupdate()}getStreamEndTime(){return this.streamEndTime?this.streamEndTime/1e3:null}isLowLatencyLive(){return this.isLowLatency}clearTextTrackList(){const e=this.getElementsByTagName("track");for(;e.length;)e[0].remove()}clearTrackLists(){Sr(this.videoTrackList),Sr(this.audioTrackList),this.clearTextTrackList()}createMediaError(e,t,r){let i=r;if(this.error)try{const e="string"===typeof(null==r?void 0:r.details)?Vr({},JSON.parse(r.details),{videoTagError:this.error}):Vr({},r.details,{videoTagError:this.error});i=new su.w(Vr({},r,{details:e}))}catch(n){}return{code:e,message:t,yaspError:i}}static parseErrorString(e){try{return new su.w(JSON.parse(e))}catch(t){return new su.w({code:"YASP_PARSE_ERROR_EXCEPTION",details:{error:t,errorString:e},message:"Expect error to be serialized error.",isFatal:!0,category:ds.q.EXCEPTION})}}initNativeErrorHandling(){this.addEventListener("error",this.onNativeError)}onNativeError(){if(!this.yaspSrc)return;Iu.getNativeErrorAndAttachErrorStore(this)&&Iu.worker.sendEvent({method:"destroy",params:{source:this.yaspSrc}})}initEventsWatcher(){this.eventsWatcher=new wu(this,()=>this.getVideoElementDebugDump())}initAirplayController(){this.airplayController||(this.airplayController=new Pu(this,e=>this.logAirplayStateChange(e)))}initPlayheadMover(){this.playheadMover=new ku(this,3)}initWatchdog(){this.initStallDetector(),this.gapController||(this.gapController=new ru(this,{getSeekRangeEnd:()=>this.seekable.end(0)},{jumpLargeGaps:!0,jumpOnPause:!0,largeGapLimit:nl},this.stallDetector,e=>{var t;null==(t=this.eventsWatcher)||t.pushCustomEvent({event:"YaspLargeGap",timestamp:Date.now(),dump:e}),this.yaspDispatchEvent("yasp-event",{name:"YaspLargeGap",data:e},{cancelable:!0})}),this.addEventListener("seeking",this.onSeeking),this.addEventListener("canplay",this.onCanPlay),this.addEventListener("progress",this.onSegmentAppended),this.progressWatcher=new vu(this))}onCanPlay(){var e;null==(e=this.gapController)||e.configure({jumpOnPause:!1}),this.shouldPlay&&this.play()}onSegmentAppended(){var e;null==(e=this.gapController)||e.onSegmentAppended()}clampPosition(e){if(!this.seekable.length)return null;const t=this.seekable.end(this.seekable.length-1);return t-e<fu.C?(this.currentTime=t-fu.C,this.currentTime):null}onSeeking(){var e;if(null!==this.clampPosition(this.currentTime))return;null==(e=this.gapController)||e.configure({jumpOnPause:!0});if(!nu.isBuffered(this.buffered,this.currentTime,.5)&&this.yaspSrc){var t,r;if((0,is.RW)("yasp_no_source_abort_on_fake_seek"))null==(t=this.gapController)||t.lock(),null==(r=this.gapController)||r.onSeeking();Iu.worker.request({method:"seeking",params:{source:this.yaspSrc,currentTime:this.currentTime}}).then(async()=>{var e,t,r;(0,is.RW)("yasp_no_source_abort_on_fake_seek")?null==(e=this.gapController)||e.unlock():null==(t=this.gapController)||t.onSeeking();_a&&Promise.resolve().then(null==(r=this.videoStateNotifier)?void 0:r.handleTimeupdate)}).catch(()=>{var e;(0,is.RW)("yasp_no_source_abort_on_fake_seek")&&(null==(e=this.gapController)||e.unlock())})}else{var i;null==(i=this.gapController)||i.onSeeking()}}updateShouldPlayState(e){this.shouldPlay=e}async play(){var e;(this.playCalled=!0,this.updateShouldPlayState(!0),this.yaspSrc&&"none"===this.preload&&Iu.worker.sendEvent({method:"load",params:{source:this.yaspSrc}}),HTMLVideoElement.prototype.getAttribute.call(this,"src")||this.srcObject)||await(null==(e=this.srcSetDeferred)?void 0:e.promise);if(this.playCalled)return this.playCalled=!1,this.handleLivePresentationWindowDropout(),super.play()}pause(){this.playCalled=!1,this.updateShouldPlayState(!1),super.pause()}setSrc(e){var t,r,i;this.yaspSrc&&(Iu.worker.sendEvent({method:"detach",params:{source:this.yaspSrc}}),this.yaspSrc=void 0,this.srcObject=null,this.srcSetDeferred=void 0,null==(t=this.videoStateNotifier)||t.disable(),this.clearTrackLists());if(this.srcSetDeferred=new ka.B,ld(e))return(0,is.RW)("web_add_mms_ios")&&this.airplayController&&this.airplayController.airplayEnabled?void(this.airplayController.detachedSrc=e):(this.yaspSrc=e,Iu.setDevicePixelRatioForSource(e),Iu.worker.sendEvent({method:"attach",params:{source:e}}),null==(r=this.videoStateNotifier)||r.enable(),null==(i=this.gapController)||i.configure({jumpOnPause:!0}),"none"!==this.preload&&Iu.worker.sendEvent({method:"load",params:{source:e}}),void(Iu.shouldSaveBandwidth&&Iu.worker.sendEvent({method:"configureSource",params:{source:e,config:{defaultBandwidthEstimate:Iu.getDefaultBandwidthEstimate()}}})));e?HTMLVideoElement.prototype.setAttribute.call(this,"src",e):HTMLVideoElement.prototype.removeAttribute.call(this,"src")}initStallDetector(){if(this.stallDetector)return;this.stallDetector=new pu(this,()=>{var e;null==(e=this.eventsWatcher)||e.pushCustomEvent({event:"YaspNudgeStalled",timestamp:Date.now(),dump:this.getVideoElementDebugDump()}),this.yaspDispatchEvent("yasp-event",{name:"YaspNudgeStalled",data:void 0},{cancelable:!0})})}static initYaspCurrentSrc(e){return Object.defineProperty(e,"currentSrc",{get(){return this.src},configurable:!0}),()=>delete e.currentSrc}static initYaspSeekable(e){return Object.defineProperty(e,"seekable",{get(){return this.yaspSeekable?{start:e=>{if(e>this.length-1)throw new Error("Failed to execute 'start' on 'TimeRanges': The index provided ("+e+") is greater than the maximum bound ("+(this.length-1)+")");return this.yaspSeekable.start},end:e=>{if(e>this.length-1)throw new Error("Failed to execute 'end' on 'TimeRanges': The index provided ("+e+") is greater than the maximum bound ("+(this.length-1)+")");return this.yaspSeekable.end},length:1}:Iu.getNativeSeekableAndInitYaspSeekable(this)},configurable:!0}),()=>delete e.seekable}restore(){this.startTime=0,this.streamEndTime=void 0,this.serverTimeInfo=void 0,this.yaspSeekable=void 0,this.isLowLatency=!1}handleLivePresentationWindowDropout(){this.duration===1/0&&this.seekable.length&&this.currentTime<this.seekable.start(0)&&(this.currentTime=this.seekable.end(this.seekable.length-1))}getStartDate(){return new Date(this.startTime)}static getExpConfig(){const{flags:e,testids:t,slots:r}=(0,yu.r)()||{};return{flags:(0,ys.K)(e)?JSON.parse(JSON.stringify(e)):{},testids:(0,Ys.H)(t)?t.split(",").map(Number).filter(Boolean):[],slots:(0,Ys.H)(r)?r:""}}}Iu.instances=[],Iu.shouldSaveBandwidth=!0,Iu.bandwidth=void 0,Iu.maxCapAllowedVideoTrack=void 0,Iu.workerImpl=void 0,Iu.messenger=new Ia.v,Iu.workerConfig={},Iu.detachedErrorRpcHandler=e=>{let{error:t}=e;const r=Iu.parseErrorString(t),i=new su.w(Vr({},r,{message:"Detached videoElement error: "+r.message}));return Iu.messenger.emit("yasp-error",i),{done:!0,value:void 0}},Iu.detachedEventRpcHandler=e=>{let{name:t,data:r,shouldLogWhenDetached:i}=e;return i&&Iu.messenger.emit("yasp-event",{name:t,data:r}),{done:!0,value:void 0}};var Cu=r(4834);class Ou extends Ga.M{constructor(e){super(),this.props=e,this.isDestroyed=!1,this.preloaded="none",this.url="",this.bufferedInfo={total:[],audio:[],video:[]},this.fullPreloadDeferred=new ka.B,this.handleBufferedInfoChange=e=>{let{source:t,bufferedInfo:r}=e;if((0,$c.Hi)(t)!==(0,$c.Hi)(this.url))return;this.bufferedInfo=r;this.bufferedInfo.total.reduce((e,t)=>{let{start:r,end:i}=t;return e+(i-r)},0)>=Cu.a?(this.preloaded="full",this.fullPreloadDeferred.resolve()):this.preloaded="partial"},this.preload=(0,ma.I)(async e=>{var t,r,i;if(this.isDestroyed)throw new Error("YaspPreloader was destroyed");this.url=Br(this.props.source.stream.url,this.props.source.sourceParams.startPosition.videoTime),Iu.messenger.on("BufferedInfoChanged",this.handleBufferedInfoChange);const n=this.props.getVideoElementSizes(),s=Hr({},e,{maxAutoQuality:null!=(t=null==e?void 0:e.maxAutoQuality)?t:this.props.defaultQuality});return Iu.preloadSrc(this.url,{videoContentId:null!=(r=null==(i=this.props.source.sourceParams.videoInfo)?void 0:i.videoContentId)?r:"missed",yaspSourceConfig:s}).then(()=>(n&&Iu.setVideoElementSizes(this.url,n),this.preloaded="manifest",this.fullPreloadDeferred.promise))}),this.once("Destroy",()=>{this.isDestroyed=!0})}getType(){return this.props.type}getBufferedInfo(){return this.bufferedInfo}getSource(){return this.props.source}destroy(){Iu.releaseSrc(this.props.source.stream.url),Iu.messenger.off("BufferedInfoChanged",this.handleBufferedInfoChange),super.destroy()}}let Du;!function(e){e[e.MEDIA_ERR_CUSTOM=0]="MEDIA_ERR_CUSTOM",e[e.MEDIA_ERR_ABORTED=1]="MEDIA_ERR_ABORTED",e[e.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK",e[e.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE",e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=4]="MEDIA_ERR_SRC_NOT_SUPPORTED",e[e.MEDIA_ERR_ENCRYPTED=5]="MEDIA_ERR_ENCRYPTED"}(Du||(Du={}));class Nu{constructor(e){this.code=0,this.message="",this.details=void 0,"number"===typeof e?this.code=e:"string"===typeof e?this.message=e:(0,ys.K)(e)&&("number"===typeof e.code&&(this.code=e.code),"string"===typeof e.message&&(this.message=e.message),this.details=e.details),this.message||(this.message=Du[this.code]||"")}}var Lu=r(6636);const Mu=(0,dd.Q)(),Fu=window.SourceBuffer||window.WebKitSourceBuffer,xu=Mu&&"function"===typeof Mu.isTypeSupported&&Mu.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),Vu=!Fu||Fu.prototype&&"function"===typeof Fu.prototype.appendBuffer&&"function"===typeof Fu.prototype.remove,Uu=Boolean(xu)&&Boolean(Vu);var Bu=r(442);const Hu=[401,403];let ju;!function(e){e.LOWRES="lowres",e.HIGHRES="highres"}(ju||(ju={}));const Wu={tiles:"com.yandex.video.thumbnail.lowres.tiles",duration:"com.yandex.video.thumbnail.lowres.duration",resolution:"com.yandex.video.thumbnail.lowres.resolution",uri:"com.yandex.video.thumbnail.lowres.uri"},Yu={tiles:"com.yandex.video.thumbnail.tiles",duration:"com.yandex.video.thumbnail.duration",resolution:"com.yandex.video.thumbnail.resolution",uri:"com.yandex.video.thumbnail.uri"},Gu=[4320,2880,2160,1440,1080,720,576,480,360,240,144],zu=Math.min(...Gu.slice(1).map((e,t)=>Gu[t]/e));var qu=r(9473);let Ku;!function(e){e.WAS_WORKER_INTERNAL_ERROR="YANDEX_PLAYER_HLS_WAS_WORKER_INTERNAL_ERROR"}(Ku||(Ku={}));let Qu;!function(e){e.HasAd="HasAd",e.NoAd="NoAd",e.NoData="NoData"}(Qu||(Qu={}));const Zu=/^(\d+)x(\d+)@(\d+)$/,Ju=[...["sendReportLog","preloadSource","requestVideoElementFullscreen","requestDebugInfo","requestExternalPlay","requestExternalPlayerList","insertInto","playAdViewers","play","setSource","destroy"],...["setVideoTrack","setAudioTrack","setTextTrack","changeAdditionalParams","exitVideoElementFullscreen","setPlaybackRate","setMuted","setVolume","setPictureInPictureAllowed","setVideoStyle","setNativeControlsVisibility","setNativeTextTrackVisibility","logEvent","logEventInternal","logError","seek","openReportWindow","playInrollAd","skipAdPod","setNativeAdControlsVisibility","setDebugPanelVisibility","pause","on","once","off","publicEmit"],"getState","getReadyState"],Xu=window;Xu.Ya||(Xu.Ya={}),Xu.Ya.playerApi||(Xu.Ya.playerApi={}),Xu.Ya.playerApi.METHODS||(Xu.Ya.playerApi.METHODS=Ju);window.Ya.playerApi;const $u=window.Ya.playerApi,eh="https://yastatic.net/yandex-video-player-iframe-api-bundles/hlsjs/0.12.2-1761-1846-1976_tmp-2080-2095-2146-2171-2-2172-2232_tmp-2427-2498/hls.min.js";const th=function(){try{const{volume:e}=Qn;Qn.volume=0===e?1:0;const t=Qn.volume!==e;return Qn.volume=e,t}catch(e){return!1}}(),rh=W();var ih=r(6048),nh=r.n(ih);const sh=wa(),ah=sh?.25:.02;let oh;!function(e){e.VideoTagPaused="VideoTagPaused",e.VideoTagPausedAfterDurationChange="VideoTagPausedAfterDurationChange",e.VideoTagPausedAfterError="VideoTagPausedAfterError",e.PauseEvent="PauseEvent",e.ProgressEvent="ProgressEvent",e.PromiseResolve="PromiseResolve",e.PromiseReject="PromiseReject",e.PlayingEvent="PlayingEvent",e.Timeout="Timeout"}(oh||(oh={}));const lh={once:!0,passive:!0};class dh{constructor(e){this.props=e,this.currentAttempt=0,this.recovering=!1,this.plannedTaskPromise=void 0,this.resetTimeoutId=0}get allowed(){return this.currentAttempt<10}get started(){return this.currentAttempt>0}get attempt(){return this.currentAttempt}getState(){return this.started?ql.ON:ql.OFF}planTask(e,t){let r,{reason:i,delay:n,force:s,rawData:a}=t;if(this.recovering&&!s)return this.log("Can't plan task cause is in process of recover"),void this.props.onConcurrentRecover({reason:i,rawData:a});this.clearPlannedTask("new task planned"),this.clearResetTimeout("new task planned"),"number"===typeof n?(r=Ea(n).promise.then(Xo.Z),this.log("#"+this.currentAttempt+", PLAN task, "+n+"ms, ["+i+"]",a)):(r=n,this.log("#"+this.currentAttempt+", PLAN async task, ["+i+"]",a)),(0,Kn.v)(r),r.then(()=>{if(r===this.plannedTaskPromise)return this.recovering=!0,this.currentAttempt++,this.props.onRunTask({reason:i,delay:n,rawData:a,attempt:this.currentAttempt}),this.log("#"+this.currentAttempt+", RUN task, ["+i+"]",a),this.clearPlannedTask(),e()}).catch(e=>{this.log("Error while recover",e),this.props.onRecoverError({reason:i,rawData:a},e)}).then(()=>{this.recovering=!1}),this.plannedTaskPromise=r}isRecovering(){return this.recovering}planReset(e){let{reason:t,delay:r}=e;this.log("plan RESET, "+r+"ms, if ["+t+"]"),this.clearResetTimeout("new reset planned"),this.resetTimeoutId=window.setTimeout(()=>{this.reset(t)},r)}destroy(){this.reset("destroy")}reset(e){this.props.onReset(),this.log("RESET because of ["+e+"]"),this.clearPlannedTask(),this.clearResetTimeout(),this.currentAttempt=0}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];xa.log("RecoverHelper:",...t)}clearPlannedTask(e){e&&this.log("CLEAR planned TASKS because of ["+e+"]"),this.plannedTaskPromise=void 0}clearResetTimeout(e){e&&this.log("CLEAR planned RESET because of ["+e+"]"),0!==this.resetTimeoutId&&(clearTimeout(this.resetTimeoutId),this.resetTimeoutId=0)}}var ch=r(8024),uh=r.n(ch);var hh,ph;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.ETHERNET=1]="ETHERNET",e[e.WIFI=2]="WIFI",e[e.CELL_2G=3]="CELL_2G",e[e.CELL_3G=4]="CELL_3G"}(hh||(hh={})),function(e){e.BLUETOOTH="bluetooth",e.CELLULAR="cellular",e.ETHERNET="ethernet",e.MIXED="mixed",e.NONE="none",e.OTHER="other",e.UNKNOWN="unknown",e.WIFI="wifi",e.WIMAX="wimax"}(ph||(ph={}));var fh=r(3984);class mh{constructor(e){void 0===e&&(e={}),this.timeMeasurer=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.totalDecodedFrames=0,this.totalDroppedFrames=0,this.lastVideoWidth=void 0,this.lastVideoHeight=void 0,this.maxWidth=1/0,this.maxHeight=1/0,this.props=void 0,this.frameHistoryDuration=1e3,this.frameHistory=[{time:0,shownFrames:0,droppedFrames:0}],this.props=e}setRestrictions(e,t){var r,i;e>=this.maxWidth&&t>=this.maxHeight||t<360||(this.maxWidth=e,this.maxHeight=t,xa.warn("FPSController changed restrictions: "+e+"\xd7"+t+"."),null==(r=(i=this.props).onRestrictionsChange)||r.call(i,{decodedFrames:this.totalDecodedFrames,droppedFrames:this.totalDroppedFrames,maxWidth:e,maxHeight:t}))}getRestrictions(){return{maxWidth:this.maxWidth,maxHeight:this.maxHeight}}update(e){if(!e.videoWidth||!e.videoHeight)return;const t=Pr(e);this.checkFPS(e.videoWidth,e.videoHeight,t.totalVideoFrames,t.droppedVideoFrames)}checkFPS(e,t,r,i){if(!this.timeMeasurer||!r||this.lastVideoWidth!==e||this.lastVideoHeight!==t||r<this.lastDecodedFrames)this.timeMeasurer=(0,ya.u)(),this.totalDecodedFrames=0,this.totalDroppedFrames=0;else{const n=r-this.lastDecodedFrames,s=i-this.lastDroppedFrames;this.totalDecodedFrames+=n,this.totalDroppedFrames+=s,this.timeMeasurer()>5e3&&this.totalDroppedFrames>.25*this.totalDecodedFrames&&this.setRestrictions(e,t),this.updateFrameHistory(n,s)}this.lastDecodedFrames=r,this.lastDroppedFrames=i,this.lastVideoWidth=e,this.lastVideoHeight=t}updateFrameHistory(e,t){if(!this.timeMeasurer)return;const r=this.timeMeasurer();this.frameHistory.push({time:r,shownFrames:e-t,droppedFrames:t}),this.cleanFilterFrameHistory(r)}cleanFilterFrameHistory(e){this.timeMeasurer&&(this.frameHistory=this.frameHistory.filter(t=>e-t.time<=this.frameHistoryDuration))}getApproximateFPS(){if(!this.timeMeasurer)return{approximateShownFPS:0,approximateDroppedFPS:0};const e=this.timeMeasurer();if(this.cleanFilterFrameHistory(e),!this.frameHistory.length)return{approximateShownFPS:0,approximateDroppedFPS:0};const t=this.frameHistory[0].time,r=(this.frameHistory[this.frameHistory.length-1].time-t)/1e3,i=r>0?1/r:1,n=this.frameHistory.slice(1).reduce((e,t)=>e+t.shownFrames,0)*i,s=this.frameHistory.slice(1).reduce((e,t)=>e+t.droppedFrames,0)*i;return{approximateShownFPS:n<0?0:n,approximateDroppedFPS:s<0?0:s}}}const gh=function(e){const t=(0,as.i)(e).match(/Firefox\/([0-9]+)\./);return t&&parseInt(t[1],10)||-1}(window);class vh{constructor(e,t){this.win=e,this.callback=t,this.started=!1,this.intervalId=0,this.getDiff=(0,ya.u)()}start(){this.started||(this.started=!0,this.getDiff=(0,ya.u)(),this.intervalId=this.win.setInterval(()=>{const e=this.getDiff();this.getDiff=(0,ya.u)(),this.callback(e)},100))}stop(){this.started&&(this.started=!1,this.win.clearInterval(this.intervalId))}}class yh{constructor(e){this.props=void 0,this.bufferGoalFilters=[Mi,Fi],this.props=e}getBufferGoal(e){const{watchedTime:t=0,currentTime:r=0}=e,i=xi({},this.props,{watchedTime:t,currentTime:r});return this.bufferGoalFilters.reduce((e,t)=>Math.min(t(i),e),30)}}var Eh=r(9787),Sh=r(6513),Ah=r(3942);class Th{constructor(e){this.props=e,this.video=void 0,this.videoSizeSensor=void 0,this.defaultQuality=void 0,this.getPipWindowSize=void 0;const{video:t,videoSizeSensor:r,defaultQuality:i,getPipWindowSize:n}=this.props;this.video=t,this.videoSizeSensor=r,this.defaultQuality=i,this.getPipWindowSize=n}getCapSizes(){var e;const t=null!=(e=this.getPipWindowSize())?e:(0,Sh.k)(this.video,this.props.objectFit||"contain",this.videoSizeSensor.getSize()),r=t.height>t.width,i=(0,ec.R)(),n=null!==this.defaultQuality,s=(0,Ah.R)(this.defaultQuality),a=(n?Math.max(screen.height,t.height):t.height)*devicePixelRatio,o=(n?Math.max(screen.width,t.width):t.width)*devicePixelRatio,l=r?Math.min(a,s):a,d=r?o:Math.min(o,s),c=r&&i?Eh.T/9*16:1/0;return{width:d,height:l,maxWidth:!r&&i?Eh.T/9*16:1/0,maxHeight:c}}}const bh=function(){const e=document.createElement("video");if(!("playbackRate"in e))return!1;try{return e.playbackRate-=.05,!0}catch(t){return!1}}();class wh extends Ga.M{get state(){return this.playerStore.getState()}get fragDuration(){return this.getFragmentsData().fragmentDuration}get isDestroyed(){return this.destroyed}async requestDebugInfo(){return{notImplemented:!0}}constructor(e){var t;super(),this.props=e,this.engine=void 0,this.recoverHelper=void 0,this.video=void 0,this.wasPausedAfterQualityChanged=!1,this.currentTextTrack=void 0,this.withCredentials=!1,this.targetLatency=7,this.playerStore=void 0,this.stateController=void 0,this.currentState=void 0,this.videoTrackLabels=new Map,this.previousScreenshotBlobUrl=void 0,this.destroy=(0,ma.I)(()=>(this.destroyed=!0,this.destroyUnsafe())),this.destroyed=!1,this.tickController=void 0,this.fpsController=new mh({onRestrictionsChange:e=>{this.props.logEvent({event:"FPSControllerRestrictions",params:e})}}),this.currentSubtitles=[],this.bandwidthEstimateUpdateInterval=null,this.bufferGoalManager=void 0,this.preventPauseState=void 0,this.playDeferred=void 0,this.sizeCapper=void 0,this.isPauseHandlerCalled=void 0,this.longStalledRecoverInfo=null,this.handleConcurrentRecover=e=>{this.props.logEvent({event:"ConcurrentRecoverCalled",params:e})},this.handleRecoverError=(e,t)=>{this.props.onError(new ja({code:cs.RECOVER_TASK_ERROR,isFatal:!1,details:e,stack:null==t?void 0:t.stack}))},this.setMaxListeners(100),this.isPauseHandlerCalled=this.props.video.paused,this.recoverHelper=new dh({onRunTask:this.props.onRecover,onReset:()=>this.playerStore.setControllerStateField(vl.lastRecoverPosition,void 0),onConcurrentRecover:this.handleConcurrentRecover,onRecoverError:this.handleRecoverError}),this.on("Destroy",()=>this.recoverHelper.destroy());const{video:r,playerStore:i,sourceParams:n,stateController:s}=this.props;this.video=r,this.playerStore=i,this.stateController=s,this.setLoop(Boolean(e.sourceParams.loop)),this.withCredentials=Boolean(e.sourceParams.withCredentials);const a=!n.startPosition.videoTime&&(!n.adConfig||!1===n.adConfig.hasPreroll)&&n.firstFrameHash&&n.firstFrameUrl;this.setPoster(a?n.firstFrameUrl:n.preview,a?n.firstFrameHash:""),this.updateNativeControlsVisibility();const o=this.playerStore.getState().controller.preload||rh;r.setAttribute("preload",o?"auto":"none");const l=this.playerStore.getState().controller.vsid,d=(0,Vs.O)(r,"loadstart",()=>{this.video.style.opacity="1",(0,_u.Y)(()=>this.video.setVideoSessionId(l))});this.on("Destroy",d),this.tickController=new vh(window,e=>{try{this.onTick(e)}catch(yf){this.props.onError(ja.from(yf,{code:cs.ON_TICK_ERROR,isFatal:!1}))}}),this.on("Destroy",()=>this.tickController.stop()),this.on("InternalPlayingStateChange",this.updateBufferGoal),Promise.resolve().then(()=>{this.initInternalSubscribe()}),this.bufferGoalManager=new yh({skippableFragments:e.sourceParams.skippableFragments}),this.sizeCapper=new Th({video:this.video,fpsController:this.fpsController,videoSizeSensor:this.props.videoSizeSensor,getPipWindowSize:this.props.getPipWindowSize,from:this.state.controller.from,defaultQuality:this.props.defaultQuality,objectFit:null==(t=this.state.controller.videoElementStyle)?void 0:t.objectFit})}initInternalSubscribe(){this.on("VideoPlayingStateChange",e=>{if(e!==Sa.END||ze(this.state)){if(e===Sa.PLAY&&!ze(this.state)){const e=this.fragDuration<=2*nl?1e3*this.fragDuration:1e3*nl;this.recoverHelper.planReset({delay:e,reason:"no new errors for "+e+"ms"})}}else this.recoverHelper.reset("onPlayingStateChange ["+Sa.END+"]")}),this.on("InternalPlayingStateChange",e=>{const{encoderState:t}=this.state.controller;(t===ol.Attaching||t===ol.Attached)&&this.currentState!==e&&(this.isBufferingOnPreload(e)||this.currentState===Sa.END&&this.video.paused||(this.currentState=e,this.emit("VideoPlayingStateChange",e)))}),this.on("CurrentTimeChange",e=>{const t=this.getDuration(),{videoType:r}=this.state.controller;e>=t&&t>0&&r===cl.Z.VOD&&!this.props.sourceParams.loop&&this.emit("InternalPlayingStateChange",Sa.END)}),this.on("InternalVideoTrackValueChange",bi(e=>{this.emit("VideoTrackValueChange",e)})),this.on("InternalAudioTrackValueChange",bi(e=>{this.emit("AudioTrackValueChange",e)})),this.on("InternalTextTrackValueChange",bi(e=>{this.emit("TextTrackValueChange",e)})),this.subscribeYabroRum(),this.addVideoEventListener("playing",()=>this.handleVideoElementPlayEvent()),this.addVideoEventListener("loadedmetadata",()=>{this.emit("DurationChange",this.getDuration())}),this.addVideoEventListener("play",()=>{this.isPauseHandlerCalled=!1}),this.addVideoEventListener("seeking",()=>{this.props.logEvent({event:"Seeking",params:{time:this.video.currentTime}})}),this.addVideoEventListener("seeked",()=>{this.props.logEvent({event:"Seeked",params:{time:this.video.currentTime}}),this.emit("Seeked")});let e=this.video.playbackRate;this.addVideoEventListener("ratechange",()=>{const t=this.video.playbackRate,r=this.state.controller.playbackRate;if(e===t)return;const i=e;e=t,ze(this.state)||this.recoverHelper.isRecovering()||0===t||t===r||(0===i&&t!==r?this.setPlaybackRate(r,yl.Recover):t!==this.state.controller.playbackRate&&this.stateController.putPlaybackRate(t,yl.Other))}),this.addVideoEventListener("pause",()=>this.onPause()),this.addVideoEventListener("progress",()=>{ze(this.state)||this.emit("BufferingRangesChange",(0,Gc.w)(this.props.video))}),this.addVideoEventListener("canplay",()=>{this.emit("CanPlay",void 0)}),this.addVideoEventListener("ended",()=>{const{videoType:e}=this.playerStore.getState().controller;e===cl.Z.VOD||void 0===e?this.emit("InternalPlayingStateChange",Sa.END):this.video.paused&&xa.warn('Pause stream after "ended" event on LIVE stream')}),this.addVideoEventListener("loadeddata",()=>{this.emit("LoadedData",void 0)}),this.addVideoEventListener("error",e=>this.onVideoTagError(e)),this.handleSubtitles(),this.addVideoEventListener("timeupdate",()=>{ze(this.state)||this.state.controller.playingState===Sa.PAUSE||this.fpsController.update(this.video)}),this.addVideoEventListener("durationchange",()=>{ze(this.state)||this.dispatchOnDurationChange()}),this.on("DvrChange",()=>this.updateDVRParams())}async play(){if(this.preventPauseState)return this.preventPauseState=Vi({},this.preventPauseState,{shouldPlayAfterEnd:!0}),xa.log("play method call during preventPauseAsync operation"),this.playDeferred||(this.playDeferred=new ka.B,this.playDeferred.promise.catch(Xo.Z).then(()=>this.playDeferred=void 0)),this.playDeferred.promise;await this.playInternal()}getVideoElementSizes(){var e,t;return Vi({},null!=(e=this.props.getPipWindowSize())?e:(0,Sh.k)(this.video,(null==(t=this.state.controller.videoElementStyle)?void 0:t.objectFit)||"contain",this.props.videoSizeSensor.getSize()),{dpi:"undefined"!==typeof devicePixelRatio?devicePixelRatio:1})}getFragmentsData(){return{totalDuration:this.getDuration(),fragmentDuration:nl,startTime:0}}getUtcStartTime(){return 0}getUtcPosition(){return 0}async attachEncoder(){this.tickController.start(),this.bandwidthEstimateUpdateInterval=window.setInterval(()=>{this.stateController.putLastKnownBandwidthEstimate(this.getBandwidthEstimate()),Or(this.getBandwidthEstimate())},5e3),"defaultPlaybackRate"in this.video&&(this.video.defaultPlaybackRate=this.state.controller.playbackRate);const e=new Pc(this.video,()=>{this.onVideoResize()});this.once("Detach",()=>e.destroy())}onVideoTagError(e){!this.video.src&&!ze(this.state)&&(this.video.style.opacity="0")}captureScreenshot(){return Promise.resolve(void 0)}clearScreenshot(){this.previousScreenshotBlobUrl&&(URL.revokeObjectURL(this.previousScreenshotBlobUrl),this.previousScreenshotBlobUrl=void 0)}seek(e){if(!this.canSeek())return void this.playerStore.setControllerStateField(vl.startPosition,{videoTime:e});this.playerStore.setControllerStateField(vl.lastRecoverPosition,void 0);const{start:t,end:r}=this.getSeekableRange(),{currentTime:i}=this.state.controller,n=P(e,t,r);this.props.onExpectedStalledChange({reason:Da.Seek,details:{oldPosition:i,newPosition:n}}),Li(this.video,n),this.emit("CurrentTimeChange",this.getCurrentTime())}setPlaybackRate(e,t){if(!bh)return;const r=this.video.playbackRate;if(r===e)return;this.video.playbackRate=e;const i=this.video.playbackRate;i!==r&&this.stateController.putPlaybackRate(i,t)}getUtcEndTime(){return 0}static isLiveStreamUrl(e){return e.startsWith("https://strm.yandex.ru/live/")||e.startsWith("https://streaming.tst.strm.yandex.net/live/")}updateNativeControlsVisibility(){const e=!j(this.state.skin.hiddenControls)&&(this.state,!0);var t,r;this.playerStore.setSkinStateField(gl.nativeControlsVisibility,e),t=this.video,r={controls:e?"controls":null},(0,js.Z)(r).forEach(e=>{const i=r[e];null===i?t.removeAttribute(e):t.setAttribute(e,i)}),this.video.classList.toggle(uh().video_hiddenControls,!e),this.setNativeTimeControlVisibility(wi(this.state)),this.setNativeTimelineControlVisibility(wi(this.state))}detachEncoder(){if(this.tickController.stop(),this.state.controller.encoderState===ol.Attached){const e=this.getBandwidthEstimate();this.stateController.putLastKnownBandwidthEstimate(e),Or(e)}return null!==this.bandwidthEstimateUpdateInterval&&clearInterval(this.bandwidthEstimateUpdateInterval),this.emit("BufferingRangesChange",[]),this.emit("InternalVideoTrackValueChange",void 0),this.emit("InternalAudioTrackValueChange",void 0),this.emit("InternalTextTrackValueChange",void 0),this.emit("Detach",void 0),"defaultPlaybackRate"in this.video&&(this.video.defaultPlaybackRate=1),Promise.resolve()}async preloadSource(){xa.log("preloadSource() is not implemented for "+this.engine)}createCachePreloader(){}setLoop(e){const{video:t}=this.props,{loop:r}=this.video;e!==r&&(t.loop=e)}isPaused(){return this.props.video.paused}pause(){var e;this.recoverHelper.reset("pause"),this.props.video.pause(),this.onPause(),null==(e=this.playDeferred)||e.reject(new Error("playing rejected cause of #pause()"))}getDuration(){return this.video.duration}getCurrentTime(){return Math.floor(1e3*this.props.video.currentTime)/1e3}getVideoWidth(){return this.video.videoWidth}getVideoHeight(){return this.video.videoHeight}setVolume(e){!function(e){return"number"===typeof e&&0<=e&&e<=1}(e)?xa.warn("setVolume wrong value"):th?this.video.volume=e:xa.warn("cannot change video volume")}getVolume(){return this.video.volume}setMuted(e){this.video.muted=e}getMuted(){return this.video.muted}setPoster(e,t){if(this.state.skin.nativeControlsVisibility||t)if(this.removePoster(),t){if(this.props.video.setAttribute("poster",t),e){(function(e,t){void 0===t&&(t={});const{silent:r=!0,allowRelative:i=!1}=t;return i||pt(e)?new Promise((t,i)=>{const n=document.createElement("img");n.onload=()=>t(e),n.onerror=r?()=>t(null):()=>i(new Error("knockPixel failed to load image ["+e+"]")),n.src=e}):r?Promise.resolve(null):Promise.reject("["+e+"] is not an absolute url, to knock this pixel use { allowRelative: true } option")})(e).then(()=>{this.isDestroyed||this.props.video.setAttribute("poster",e)}).catch(Xo.Z)}}else this.props.video.setAttribute("poster",e||Ra)}removePoster(){this.props.video.removeAttribute("poster")}isDvrEnabled(){return!0}toggleNativeSubtitles(e){const t=this.state.skin.useNativeSubtitles;if(t===e)return;const r=Ci(t),i=Ci(e);this.playerStore.setSkinStateField(gl.useNativeSubtitles,e),Ii(this.video.textTracks).forEach((e,t)=>{e&&(e.mode=r===e.mode?i:"disabled")})}canSeek(){const{video:e}=this.props;return e.readyState>0&&e.duration>0}getRecoverHelperState(){return this.recoverHelper.getState()}getCapSizes(){return this.sizeCapper.getCapSizes()}getMaxCapAllowedVideoTrack(){}getRemainingBufferedTime(){return{total:Ke(this.state)||0}}getBandwidthEstimate(){return Ni(this.playerStore.getState())}async recoverStream(e){void 0===e&&(e=!1);const t=this.getPositionToRecover();this.playerStore.setControllerStateField(vl.startPosition,e?{}:t),await this.detachEncoder(),await this.attachEncoder()}getLiveLatency(){if(!this.isLiveStreaming())return;const e=this.getUtcPosition(),t=this.getServerTime();return e>0&&void 0!==t?Math.max(t-e,0):void 0}getServerTime(){}getPlayingState(){return this.currentState}isLiveStreaming(){const{state:e}=this;if(!_i(e)||ze(e))return!1;const{controller:{playingState:t,currentTime:r,duration:i}}=e;return!(t!==Sa.PLAY&&t!==Sa.BUFFERING)&&!(0===r||!i)}subscribeVideoBuffering(e){const{video:t}=this;let r=Kc(t);const i=()=>{const e=function(e,t){let{paused:r}=e;return r?Sa.PAUSE:t?Sa.BUFFERING:Sa.PLAY}(t,r);if(this.isStalledLiveEdge(e))this.props.onExpectedStalledChange({reason:Da.LiveEdge,details:void 0});else if(this.isRender(e)){if((0,is.RW)("web_ignore_render_stalled"))return;this.props.onExpectedStalledChange({reason:Da.Render,details:{}})}this.emit("InternalPlayingStateChange",e)},n=qc(t,e=>{r=e,i()},e);this.addEventListener(t,"play",i),this.once("Destroy",n)}updateVideoSize(){const{videoWidth:e,videoHeight:t}=this.video;this.state.controller.videoWidth===e&&this.state.controller.videoHeight===t||this.stateController.putVideoSize({videoWidth:e,videoHeight:t})}isRender(e){if(e!==Sa.BUFFERING||this.video.seeking)return!1;const{approximateShownFPS:t,approximateDroppedFPS:r}=this.fpsController.getApproximateFPS();return!!r&&(t+r>300&&r>t)}isStalledLiveEdge(e){const{video:t}=this,{controller:{videoType:r}}=this.state,i=e===Sa.BUFFERING,n=r===cl.Z.EVENT||r===cl.Z.LIVE,s=t.seekable.length>0&&t.seekable.end(0)-t.currentTime<2.5;return i&&n&&s}getPositionToRecover(){const{programDateTime:e,currentTime:t,startPosition:r}=this.state.controller;return t?{utc:void 0===e?void 0:e/1e3+t,videoTime:t}:r}subscribeContentImpression(){this.once("Detach",function(e,t){const r=(0,Vs.O)(e,"timeupdate",()=>{e.currentTime>0&&!e.paused&&(n(),t())}),i=(0,Vs.O)(e,"playing",()=>{e.duration>0&&(n(),t())}),n=()=>{r(),i()};return n}(this.video,()=>{this.emit("ContentImpression",void 0)}))}onTick(e){const t=this.getCurrentTime();t===this.state.controller.currentTime&&0!==t||this.emit("CurrentTimeChange",t),this.video.paused&&this.currentState===Sa.PLAY&&!this.wasPausedAfterQualityChanged&&this.state.controller.encoderState!==ol.Attaching&&this.state.controller.playingState!==Sa.PAUSE&&this.emit("InternalPlayingStateChange",Sa.PAUSE),this.setPlaybackRateCatchup(),this.planRecoverCauseLongStalled()}planRecoverCauseLongStalled(){if(this.state.controller.playingState!==Sa.BUFFERING||this.state.controller.encoderState!==ol.Attached)return void(this.longStalledRecoverInfo=null);if(this.engine!==Cl.NATIVE)return;if(null===this.longStalledRecoverInfo)return void(this.longStalledRecoverInfo={getTime:(0,ya.u)(),planned:!1});if(this.longStalledRecoverInfo.planned)return;const e=4*this.getFragmentsData().fragmentDuration;if(!isNaN(e)&&this.longStalledRecoverInfo.getTime()>1e3*e){this.longStalledRecoverInfo.planned=!0;const{videoType:e}=this.state.controller,t=e!==cl.Z.VOD;this.recoverHelper.planTask(()=>this.recoverStream(t),{delay:0,reason:"Stalled longer than 4 segments."})}}addVideoEventListener(e,t,r){let{once:i}=void 0===r?{}:r,n=t;const{video:s}=this,a=()=>{s.removeEventListener(e,n)};return i&&(n=e=>{this.off("Destroy",a),a(),t.call(s,e)}),this.on("Destroy",a),this.video.addEventListener(e,n),a}addEventListener(e,t,r,i){const n=(0,Vs.O)(e,t,r,i);this.once("Destroy",n)}getSeekableRange(){return{start:0,end:this.getDuration()||0}}setNativeTimeControlVisibility(e){this.video.classList.toggle(uh().video_hiddenTime,!e)}setNativeTimelineControlVisibility(e){this.video.classList.toggle(uh().video_hiddenTimeline,!e)}getVisibleTextTrackMode(){return Ci(this.state.skin.useNativeSubtitles)}getHiddenTextTrackMode(){return"disabled"}getCurrentTextTrack(){if(!this.video)return;const e=this.getVisibleTextTrackMode();return Ii(this.video.textTracks).find(t=>void 0!==t&&t.mode===e)}restoreUserTextTrack(){const{userTextTrackEnabled:e}=this.state.controller;if(void 0!==e)if(e){const e=function(e){const{userTextTrackName:t,userTextTrackLang:r,textTracks:i}=e.controller;return Ri(i,{name:t,lang:r})}(this.state);e&&this.setTextTrack(e)}else this.disableTextTrack()}restoreUserAudioTrack(){const e=function(e){const{userAudioTrackName:t,userAudioTrackLang:r,audioTracks:i}=e.controller;return ui(i,{name:t,lang:r})}(this.playerStore.getState());e&&(xa.log("Set audio track by user params audioTrack=["+JSON.stringify(e)+"]"),this.setAudioTrack(e))}restoreUserVideoTrack(){const e=function(e){const{videoTracks:t,userVideoTrackName:r,userVideoTrackHeight:i}=e.controller;return hi(t,{name:r,height:i})}(this.playerStore.getState());e&&(xa.log("Set video track by user params videoTrack=["+JSON.stringify(e)+"]"),this.setVideoTrack(e))}updateSkinDvrParameters(e){const t=e/1e3,{skin:{skinDVRStartTime:r,skinDVRDuration:i},controller:{videoType:n,dvrDuration:s,duration:a}}=this.state;if(n===cl.Z.LIVE){const e=Math.min(r+t,a||0);this.playerStore.setSkinStateField(gl.skinDVRStartTime,e),this.emit("DVRStartTimeChange",e)}else if(n===cl.Z.EVENT){const e=Math.min(i+t,s);this.playerStore.setSkinStateField(gl.skinDVRDuration,e),this.emit("DVRDurationChange",e)}}async destroyUnsafe(){this.emit("Destroy",void 0),await this.detachEncoder(),super.destroy();const{error:e}=this.state.controller.errorInfo;e&&e.isFatal&&this.video.src&&this.video.removeAttribute("src")}async preventPauseAsync(e,t){const{paused:r}=e,i=t();this.preventPauseState||(this.preventPauseState={promises:[],shouldPlayAfterEnd:!r}),this.preventPauseState.promises.push(i);const n=await i;if(this.preventPauseState){const e=this.preventPauseState.promises.length;Promise.all(this.preventPauseState.promises).catch(Xo.Z).then(()=>{this.preventPauseState&&e===this.preventPauseState.promises.length&&(this.preventPauseState.shouldPlayAfterEnd&&(0,Kn.v)(this.playInternal()),this.preventPauseState=void 0)})}return n}getVideoOwnerDocument(){return this.video.ownerDocument||document}logLoadToRum(){st(this.engine,this.state.ad.adSyncInit)}subscribeYabroRum(){this.once("Detach",this.addVideoEventListener("firstframedecoded",()=>{ot(this.engine,{},this.state.ad.adSyncInit)},{once:!0})),this.once("Detach",this.addVideoEventListener("firstframeshown",()=>{lt(this.engine,{},this.state.ad.adSyncInit)},{once:!0}))}getStreamUrl(){return this.props.stream.url}shouldUseLowBuffer(){const{startStage:e,autoplay:t,preload:r,feed:i}=this.state.controller;return!(!this.video.paused||!i)||e!==al.started&&!t&&r}isBufferingOnPreload(e){if(e!==Sa.BUFFERING)return!1;if(!this.state.controller.preload)return!1;const{startStage:t}=this.state.controller;return t!==al.started&&(t!==al.starting&&(t!==al.init||!this.state.controller.initialAutoplay||!this.state.controller.autoplay))}getMaxBufferLength(){return this.shouldUseLowBuffer()?5:this.bufferGoalManager.getBufferGoal({watchedTime:this.state.controller.watchedTime,currentTime:this.getCurrentTime()})}handleVideoElementPlayEvent(){this.video.paused||(this.wasPausedAfterQualityChanged=!1,this.emit("InternalPlayingStateChange",Sa.PLAY))}updateBufferGoal(){}isLowLatencyLive(){return!1}onVideoResize(){this.updateVideoSize()}onPause(){this.video.paused&&(this.isPauseHandlerCalled||(this.isPauseHandlerCalled=!0,this.wasPausedAfterQualityChanged||this.video.ended||this.getCurrentTime()>=this.getDuration()||this.emit("InternalPlayingStateChange",Sa.PAUSE)))}calculateDVRParams(){const{fragmentDuration:e,startTime:t,totalDuration:r}=this.getFragmentsData();return{fragmentDuration:e,dvrDuration:r,dvrStartTime:t,skinDVRDuration:r,skinDVRStartTime:t}}updateDVRParams(){if(isNaN(this.video.duration))return;const{fragmentDuration:e,dvrStartTime:t,dvrDuration:r,skinDVRStartTime:i,skinDVRDuration:n}=this.calculateDVRParams();this.playerStore.setControllerStateField(vl.fragmentDuration,e);const{dvrDuration:s,dvrStartTime:a}=this.state.controller;nh()(s,r)||(this.playerStore.setControllerStateField(vl.dvrDuration,r),this.playerStore.setSkinStateField(gl.skinDVRDuration,n),this.emit("DVRDurationChange",n)),nh()(a,t)||(this.playerStore.setControllerStateField(vl.dvrStartTime,t),this.playerStore.setSkinStateField(gl.skinDVRStartTime,i),this.emit("DVRStartTimeChange",i))}setPlaybackRateCatchup(){const e=function(e,t,r,i){if(sh||!_i(e)||ze(e)||!r)return;const{controller:{playingState:n,playbackRate:s}}=e;if(n!==Sa.PLAY)return;const a=t.total;let o;if(a<2){const e=5*(a-2);o=.97+.06/(1+Math.pow(Math.E,-e))}else{const e=.02;if(Math.abs(r-i)<=e*i)o=1;else{const e=5*(r-i);o=.97+.06/(1+Math.pow(Math.E,-e))}}const l=Math.abs(s-o)<=ah,d=Math.abs(s-o)>=.06;return(l||d)&&(o=void 0),o}(this.state,this.getRemainingBufferedTime(),this.getLiveLatency(),this.targetLatency);void 0!==e&&this.isLowLatencyLive()&&this.setPlaybackRate(e,yl.PlaybackRateCatchupSelection)}handleSubtitles(){const{textTracks:e}=this.video;this.on("Destroy",(0,Vs.O)(e,"addtrack",e=>{"subtitles"===(null==e?void 0:e.track.kind)&&this.on("Destroy",(0,Vs.O)(e.track,"cuechange",()=>this.refreshSubtitles()))})),this.on("TextTrackValueChange",e=>{void 0===e?this.emptySubtitles():this.refreshSubtitles()}),this.on("Detach",()=>{for(let t=0;t<e.length;t++)Pi(e[t])&&(e[t].mode="disabled")})}refreshSubtitles(){const e=function(e){try{if(void 0===e)return[];const{activeCues:t}=e;let r=[];for(let e=0;e<((null==t?void 0:t.length)||0);e++){const i=null==t?void 0:t[e];i&&i.text&&r.push(i.text)}return r}catch(t){return[]}}(this.getCurrentTextTrack());nh()(this.currentSubtitles,e)||(this.currentSubtitles=e,this.props.onSubtitlesChange(e))}emptySubtitles(){this.currentSubtitles.length>0&&(this.currentSubtitles=[],this.props.onSubtitlesChange([]))}dispatchOnDurationChange(){const e=this.getDuration();isNaN(e)||this.state.controller.duration!==e&&this.emit("DurationChange",e)}playInternal(){const e=ki(this.video);return e.then(()=>{var e;return null==(e=this.playDeferred)?void 0:e.resolve()}).catch(e=>{var t;-1!==String(e).indexOf("no supported sources")&&this.props.onError(new ja({code:cs.UNSUPPORTED_MEDIA_TYPE,isFatal:!0})),null==(t=this.playDeferred)||t.reject(e)}),e.then(Xo.Z)}shouldLogStalledDebugInfo(){return!1}}class _h extends wh{initInternalSubscribe(){super.initInternalSubscribe(),this.on("VideoPlayingStateChange",e=>{e===Sa.PLAY?this.recoverHelper.reset("play"):e===Sa.END?this.stopLoad():e===Sa.BUFFERING&&this.tryRecoverOnBuffering()}),this.subscribeVideoBuffering()}constructor(e){super(e),this.props=e,this.engine=Cl.HLS,this.preloadSourceHLSEncoder=void 0,this.preloadSourceHandlers=[],this.preloadPosition={},this.HLSEncoder=void 0,this.lastKnownLevelDetails=void 0,this.HLSEncoderAttachTime=1/0,this.loadStarted=!1,this.recoverOnBufferingReason=null,this.initHlsEncoderPromise=void 0,this.maxHeightCapping=void 0,this.levelForcingInterval=void 0,this.bufferGoalUpdateInterval=void 0,this.stallDetector=void 0,this.gapJumpTimer=void 0,this.updateBufferGoal=()=>{this.HLSEncoder&&(this.HLSEncoder.config.maxMaxBufferLength=this.getMaxBufferLength())},this.restoreUserTracksWhenPossible=()=>{const{HLSEncoder:e}=this;if(!e)return;if(!e.levels||0===e.levels.length)return void e.once(Hls.Events.MANIFEST_LOADED,this.restoreUserTracksWhenPossible);(0,va.z)(this.HLSEncoderAttachTime)?this.restoreUserTracks():e.once(Hls.Events.MEDIA_ATTACHED,this.restoreUserTracks)},this.restoreUserTracks=()=>{this.restoreUserTextTrack(),this.restoreUserAudioTrack(),this.restoreUserVideoTrack()},this.onLevelUpdated=()=>{this.emit("VideoTypeChange",this.getVideoType());const e=this.getHlsEncoderLevelDetails();if(e&&e.fragments&&e.fragments.length>0){const[t]=e.fragments;t.programDateTime&&this.emit("ProgramDateTimeChange",1e3*this.getUtcStartTime())}},this.onSubtitleTracksUpdated=()=>{this.HLSEncoder&&this.emit("TextTracksChange",function(e){const t=[];return Array.isArray(e)&&e.forEach(e=>{const r=si(e);r&&t.push(r)}),t}(this.HLSEncoder.subtitleTracks))},this.onAudioTracksUpdated=()=>{const{HLSEncoder:e}=this;if(!e)return;const{audioTracks:t}=e;e.config.maxBufferSize=t.length>0?12e6:Hls.DefaultConfig.maxBufferSize,this.emit("AudioTracksChange",function(e){const t=[];return Array.isArray(e)?(e.forEach(e=>{const r=ni(e);r&&t.push(r)}),t):[]}(t))},(0,Kn.v)(Ti()),this.playerStore.setIsAbrSupported(!0)}getEngine(){return Cl.HLS}getFragmentsData(){const e=this.getHlsEncoderLevelDetails();if(!e)return super.getFragmentsData();const{totalduration:t,targetduration:r,fragments:i}=e,[n]=i;return n?{totalDuration:Math.min(t,this.getDuration()),fragmentDuration:r,startTime:n.start}:super.getFragmentsData()}onOnline(){this.startLoadOnce(this.video.currentTime)}onOffline(){this.stopLoad()}play(){return this.startLoadOnce(),super.play()}getUtcStartTime(){const e=this.getHlsEncoderLevelDetails();if(!e||!e.hasProgramDateTime)return 0;const[t]=e.fragments;return t&&t.programDateTime?t.programDateTime/1e3-t.start:0}getUtcPosition(){const e=this.getUtcStartTime();return e>0?e+this.getCurrentTime():super.getUtcPosition()}setVideoTrack(e){const{HLSEncoder:t}=this;if(void 0===t)return;const{levels:r}=t;if(void 0===r)return;const i=e.value===Pl.value?-1:r.findIndex(t=>t.url.some(t=>t===e.value));-1===i?this.startLevelForcingWithSizeCap():this.stopLevelForcingWithSizeCap();const n=this.isPaused();t.currentLevel=i,!n&&this.isPaused()&&(this.wasPausedAfterQualityChanged=!0,this.emit("InternalPlayingStateChange",Sa.BUFFERING))}setAudioTrack(e){const{HLSEncoder:t}=this;if(void 0===t)return;const r=t.audioTracks.find(t=>e.value===String(t.id));r&&(t.audioTrack=Number(r.id))}setTextTrack(e){const{HLSEncoder:t}=this;if(void 0===t)return;const r=this.getHlsTextTrack(e);r&&(this.emit("InternalTextTrackValueChange",e&&e.value),t.subtitleTrack=r.id)}disableTextTrack(){this.emit("InternalTextTrackValueChange",void 0)}toggleNativeSubtitles(e){super.toggleNativeSubtitles(e);const{HLSEncoder:t}=this;void 0!==t&&(t.subtitleDisplay=e)}async preloadSource(){let e=!1;const t=()=>{e=!0};this.once("Destroy",t),this.once("Detach",t);try{await Ti()}catch(yf){return void this.props.onError(ja.from(yf,{code:cs.SCRIPT_INIT_ERROR,isFatal:!1}))}if(e||this.HLSEncoder||this.initHlsEncoderPromise||this.preloadSourceHLSEncoder)return;const r=Ui({},this.getHlsJsConfig(),{liveSyncDuration:nl}),i=window.hls=this.preloadSourceHLSEncoder=new Hls(r),n=(e,t)=>{this.preloadSourceHandlers.push([e,t]),i.once(e,t)};((e,t)=>{this.preloadSourceHandlers.push([e,t]),i.on(e,t)})(Hls.Events.ERROR,(e,t)=>{if(!t)return;const r=Jr(t),n=$r(t);void 0!==n&&(this.props.onError(new ja(Ui({},n,{isFatal:!1}))),r&&(this.props.onError(new ja({code:cs.PRELOAD_SOURCE_FAILED,isFatal:!1,details:{reason:n}})),this.unsubscribePreloadSourceHandlers(),i.destroy(),this.clearPreloadSourceHlsEncoder()))});const s=()=>{this.preloadPosition=this.state.controller.startPosition,i.config.startFragPrefetch=!0,this.loadStarted=!0};n(Hls.Events.MANIFEST_PARSED,(e,t)=>{let{levels:r=[],audioTracks:a=[]}=t;const o=this.getStartVideoLevelIndex(r);i.startLevel=o,this.state.controller.isAbrEnabled||(i.loadLevel=o);this.getStartAudioTrackIndex(a)>-1&&(i.audioTrack=this.getStartAudioTrackIndex(a));const l=this.getStartLoadPosition();n(Hls.Events.LEVEL_UPDATED,(e,t)=>{let{details:r}=t;const n=this.getStartLoadPosition(r);l!==n&&void 0!==n&&i.streamController.startLoad(n),s()}),i.startLoad(l)}),i.loadSource(this.getStreamUrl())}async attachEncoder(){if(await super.attachEncoder(),!Uu){const e=new ja({code:cs.HLS_JS_NOT_SUPPORTED_ERROR});return this.props.onError(e),Promise.reject(h(e,this.state.ad.adblockDetected))}return this.initHlsEncoderPromise=this.initHlsEncoder(),await this.initHlsEncoderPromise,this.initHlsEncoderPromise=void 0,this.subscribeContentImpression(),this.startLevelForcingWithSizeCap(),this.attachMedia()}async destroyUnsafe(){await super.destroyUnsafe(),this.preloadSourceHLSEncoder&&this.preloadSourceHLSEncoder.destroy(),this.HLSEncoder&&this.HLSEncoder.destroy()}canSeek(){return void 0!==this.HLSEncoder&&Boolean(this.HLSEncoder.media)&&super.canSeek()}async detachEncoder(){var e,t;if((0,Xc.w)(this.video.textTracks).forEach(fi),this.stopLevelForcingWithSizeCap(),this.stopBufferGoalAutoUpdate(),await super.detachEncoder(),this.loadStarted=!1,this.preloadSourceHLSEncoder&&(this.preloadSourceHLSEncoder.destroy(),this.clearPreloadSourceHlsEncoder()),!this.HLSEncoder){var r,i;if(!this.initHlsEncoderPromise)return null==(r=this.stallDetector)||r.release(),void(null==(i=this.gapJumpTimer)||i.stop());await this.initHlsEncoderPromise}null==(e=this.stallDetector)||e.release(),null==(t=this.gapJumpTimer)||t.stop();const{video:n,HLSEncoder:s}=this;if(void 0!==s)return this.recoverOnBufferingReason=null,new Promise(e=>{s.media?s.once(Hls.Events.MEDIA_DETACHED,()=>{this.HLSEncoderAttachTime=1/0,e()}):e(),this.lastKnownLevelDetails=void 0,pi(n,()=>{s.destroy(),this.HLSEncoder=void 0})})}getMaxCapAllowedVideoTrack(){const{HLSEncoder:e}=this;if(!e||!e.levels||!e.autoLevelEnabled)return;const t=e.levels[e.autoLevelCapping];if(!t)return;const r=this.state.controller.videoTracks.find(e=>{let{value:r}=e;return r===t.url[0]});return r&&r.width&&r.height?{width:r.width,height:r.height}:void 0}onVideoTagError(e){if(super.onVideoTagError(e),!this.video.error||ze(this.state))return;const t=Wr(this.video);if(t.code!==Du.MEDIA_ERR_DECODE&&t.code!==Du.MEDIA_ERR_SRC_NOT_SUPPORTED)return;const r=t.code===Du.MEDIA_ERR_SRC_NOT_SUPPORTED,i=new ja({code:Du[t.code],details:t,isFatal:r});if(this.props.onError(i),r)return;const n="VideoTagError MEDIA_ERR_DECODE";xa.log(n),this.props.onExpectedStalledChange({reason:Da.MediaError,details:void 0}),this.isPaused()&&this.recoverHelper.planTask(()=>this.recoverCurrentFrag(),{reason:n,delay:1e3})}calculateDVRParams(){const{videoType:e}=this.state.controller;if(e===cl.Z.VOD||void 0===e)return super.calculateDVRParams();const{fragmentDuration:t,startTime:r,totalDuration:i}=this.getFragmentsData(),{liveOffset:n}=this.props,s=1*t,a=e===cl.Z.EVENT?n:s+n;return{fragmentDuration:t,dvrStartTime:r,dvrDuration:i,skinDVRStartTime:e===cl.Z.EVENT?r:s+r,skinDVRDuration:i-a}}onTick(e){super.onTick(e),this.updateSkinDvrParameters(e)}getStreamUrl(){const e=super.getStreamUrl(),t={session_data:"1"};return function(e){const t=mt(e).pathname;return 0===t.indexOf("/vod/")||0===t.indexOf("/live/")||0===t.indexOf("/kal/")}(e)||(t.preview="1"),Et(e,t,{saveOriginalPath:!0})}getBandwidthEstimate(){if(!this.HLSEncoder)return super.getBandwidthEstimate();const e=(0,Jn.Y)(()=>this.HLSEncoder.abrController._bwEstimator.getEstimate());return(0,va.z)(e)?{value:e,source:"hlsjs"}:super.getBandwidthEstimate()}getUtcEndTime(){const e=this.getUtcStartTime();return e?e+this.getDuration():0}stopLoad(){this.HLSEncoder&&(this.HLSEncoder.stopLoad(),this.loadStarted=!1)}tryRecoverOnBuffering(){if(!this.recoverOnBufferingReason)return;const{type:e,url:t,details:r,frag:i}=this.recoverOnBufferingReason,{controller:{bufferingRanges:n,fragmentDuration:s}}=this.state,a=this.getCurrentTime();if(n.some(e=>{let{start:t,end:r}=e;return t+s<a&&r-s>a}))return void xa.log("skip recover",{currentTime:a,bufferingRanges:n});const{recoverHelper:o}=this;o.planTask(()=>this.recoverCurrentFrag(),{reason:"HlsJs "+e,rawData:{details:r,type:e,url:t,isFatal:!0,frag:zr(i)},delay:100})}getHlsJsConfig(){const e="true"!==ud.t.getItem(Ku.WAS_WORKER_INTERNAL_ERROR);return{manifestLoadingTimeOut:Bu.d4,levelLoadingTimeOut:Bu.e8,fragLoadingTimeOut:Bu.C,fragLoadingMaxRetry:5,debug:this.props.debug,enableWorker:e,autoStartLoad:!1,capLevelToPlayerSize:!1,liveSyncDuration:this.props.liveOffset,levelLoadingMaxRetry:25,levelLoadingMaxRetryTimeout:100,enableCEA708Captions:!1,xhrSetup:(e,t)=>{this.withCredentials&&(e.withCredentials=!0);const r=St(t);("m3u8"===r||"ts"===r)&&e.open("GET",(0,Kd.c)(t),!0)},fetchSetup:(e,t)=>(this.withCredentials&&(t.credentials="include"),new Request(e.url,t)),maxMaxBufferLength:this.getMaxBufferLength()}}preparePreloadSourceHlsEncoderToAttach(){const e=this.preloadSourceHLSEncoder;if(!e)return;this.HLSEncoder=e;const{preloadPosition:t}=this;if(this.unsubscribePreloadSourceHandlers(),this.clearPreloadSourceHlsEncoder(),e.config.liveSyncDuration=this.props.liveOffset,!e.levels||0===e.levels.length)return e;this.onLevelsUpdated(),this.onLevelUpdated(),this.updateThumbnailTileMeta(),this.onAudioTracksUpdated(),this.onAudioTrackUpdated(e.audioTrack),this.onSubtitleTracksUpdated();const{videoTime:r,utc:i}=this.state.controller.startPosition;if(!(t.utc!==i||t.videoTime!==r))return e;const n=this.getStartLoadPosition(this.getHlsEncoderLevelDetails());return void 0!==n&&e.streamController.startLoad(n),e}async initHlsEncoder(){if(this.HLSEncoder)return;if(this.HLSEncoder=this.preparePreloadSourceHlsEncoderToAttach(),this.HLSEncoder)this.props.logEvent({event:Ca.UsePreloadedHlsJs,params:{}});else{try{await Ti()}catch(yf){const t=ja.from(yf,{code:cs.SCRIPT_INIT_ERROR});throw this.props.onError(t),t}this.HLSEncoder=new Hls(this.getHlsJsConfig())}const{HLSEncoder:e}=this;window.hls=e,this.subscribeHlsEncoderEvents(e),this.restoreUserTracksWhenPossible(),this.initBufferGoalAutoUpdate();const t=r=>{r!==Sa.BUFFERING&&r!==Sa.PLAY||(e.config.maxMaxBufferLength=this.getMaxBufferLength(),this.off("VideoPlayingStateChange",t))};this.on("VideoPlayingStateChange",t)}subscribeHlsEncoderEvents(e){e.subtitleDisplay=this.state.skin.useNativeSubtitles;const t=t=>{if(!e.levels)return;const r=e.levels[t];if(!r)return;const i=di(r,this.videoTrackLabels);i&&this.emit("InternalVideoTrackValueChange",i.value)};e.on(Hls.Events.LEVEL_SWITCHING,(e,r)=>{t(r.level)}),e.on(Hls.Events.LEVEL_SWITCHED,(e,r)=>{t(r.level)}),e.levels&&0!==e.levels.length||e.on(Hls.Events.MANIFEST_PARSED,(r,i)=>{let{levels:n=[],audioTracks:s=[]}=i;this.onLevelsUpdated(),this.updateThumbnailTileMeta();const a=this.getStartVideoLevelIndex(n);e.startLevel=a,this.state.controller.isAbrEnabled||(e.loadLevel=a);this.getStartAudioTrackIndex(s)>-1&&(e.audioTrack=this.getStartAudioTrackIndex(s)),e.once(Hls.Events.LEVEL_LOADED,(e,r)=>{let{level:i}=r;t(i)})}),e.on(Hls.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated),e.on(Hls.Events.AUDIO_TRACK_SWITCHING,(e,t)=>{this.onAudioTrackUpdated(t.id)}),e.on(Hls.Events.AUDIO_TRACK_SWITCHED,(e,t)=>{this.onAudioTrackUpdated(t.id)}),e.on(Hls.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated),e.on(Hls.Events.SUBTITLE_TRACK_SWITCH,(t,r)=>{const{subtitleTrack:i}=e;if(i>-1){const t=si(e.subtitleTracks.find(e=>e.id===r.id));if(!t)return;this.emit("InternalTextTrackValueChange",t.value)}else this.emit("InternalTextTrackValueChange",void 0)}),e.on(Hls.Events.FRAG_PARSING_METADATA,async(e,t)=>{const{samples:r,frag:i}=t;if(!r||0===r.length)return;const n=r.map(e=>{let{data:t}=e;return(0,Lu.parseV2Tag)(t)}).filter(e=>!1!==e&&void 0!==e.writer).map(e=>e.writer).filter(e=>void 0!==e),{data:s,index:a,reason:o}=function(e){const[t,r]=e.reduce((e,t)=>{let[r,i]=e;try{return!function(e){return"object"===typeof e&&e.id&&"number"===typeof e.offset&&(void 0===e.cutoff||"number"===typeof e.cutoff)}(JSON.parse(t))?i.push(t):r.push(t),[r,i]}catch(n){return[r,i]}},[[],[]]);if(t.length>0){const r=t[t.length-1];return{data:r,index:e.indexOf(r),reason:Qu.HasAd}}if(r.length>0){const t=r[r.length-1];return{data:t,index:e.indexOf(t),reason:Qu.NoAd}}return{data:"",index:-1,reason:Qu.NoData}}(n);xa.log("choose metadata: ",s,a,o);Math.random()<.01&&this.props.logEvent({event:Ca.StreamPlayerChooseMetadata,params:{fragmentMetadataArray:s,chosenIndex:a,chosenReason:o}}),this.emit("MetadataChange",{fragmentMetadataArray:[s],fragmentStart:i.start,fragmentDuration:i.duration,src:i?i.url:this.getStreamUrl()})}),e.on(Hls.Events.MANIFEST_LOADED,()=>{this.onLevelsUpdated(),this.forceLevel(),this.onAudioTracksUpdated(),this.onSubtitleTracksUpdated()}),e.on(Hls.Events.LEVEL_UPDATED,this.onLevelUpdated),e.on(Hls.Events.ERROR,(e,t)=>{t&&this.onEncoderError(t)}),e.on(Hls.Events.FRAG_PARSED,(e,t)=>this.handleFragParsed(e,t)),this.on("VideoPlayingStateChange",e=>{"play"!==e&&"buffering"!==e||this.startLoadOnce()})}initBufferGoalAutoUpdate(){this.stopBufferGoalAutoUpdate(),this.bufferGoalUpdateInterval=window.setInterval(()=>{this.updateBufferGoal()},1e3)}stopBufferGoalAutoUpdate(){window.clearInterval(this.bufferGoalUpdateInterval)}getStartVideoLevelIndex(e){const{userVideoTrackHeight:t,userVideoTrackName:r}=this.playerStore.getState().controller,i=hi(e,{name:r,height:t});if(i){const t=e.indexOf(i);return xa.log("User level found, start loading by index=["+t+"]"),t}return yi({levels:e,maxHeightCapping:this.maxHeightCapping,video:this.video,bandwidth:this.state.controller.isAbrEnabled?this.getBandwidthEstimate().value:1/0})}getStartAudioTrackIndex(e){const{userAudioTrackName:t,userAudioTrackLang:r}=this.playerStore.getState().controller,i=ui(e,{name:t,lang:r});if(!i)return-1;const n=e.indexOf(i);return xa.log("User audio track found, start loading by index=["+n+"]"),n}handleFragParsed(e,t){let{frag:r}=t;const{duration:i}=r;if(0===i&&this.state.controller.videoType===cl.Z.VOD){const e=this.getHlsEncoderLevelDetails(),t=e?e.fragments:[];if(t[t.length-1]===r)return}(i<=0||i>=2*this.fragDuration)&&this.props.logEvent({event:"InvalidFragDuration",params:zr(r)})}startLoadOnce(e){const{HLSEncoder:t}=this;!this.loadStarted&&void 0!==t&&this.state.controller.isOnline&&(t.levels&&t.levels.length>0?(t.startLoad(e),this.loadStarted=!0):t.once(Hls.Events.MANIFEST_PARSED,()=>{this.startLoadOnce(e)}))}getHlsEncoderLevelDetails(){const{HLSEncoder:e}=this;if(void 0===e)return;const{currentLevel:t,levels:r}=e;if(!r)return;const i=r[t];if(i&&i.details)return this.lastKnownLevelDetails=i.details,this.lastKnownLevelDetails;const n=r.find(e=>{let{details:t}=e;return Boolean(t)});if(n){const{details:e}=n;this.lastKnownLevelDetails=e}return this.lastKnownLevelDetails}computeRecoverJumpGap(){const{controller:{bufferingRanges:e}}=this.state,t=this.getCurrentTime();return Math.max(...e.map(e=>{let{end:t}=e;return t}))+1.1*this.fragDuration<t?(xa.log("use 0 as recoverJumpGap",{currentTime:t,bufferingRanges:e}),0):1.1*this.fragDuration}computeRecoverPositionFromStartPosition(){const{startPosition:e}=this.state.controller,t={},r=this.computeRecoverJumpGap();return void 0!==e.utc&&e.utc>0&&(t.utc=e.utc+r),t.videoTime=(e.videoTime||0)+r,t}computeRecoverPositionFromCurrentTime(){const e={},{lastRecoverPosition:t}=this.state.controller,r=this.getCurrentTime(),i=this.getUtcPosition(),n=this.computeRecoverJumpGap(),{utc:s=0,videoTime:a=0}=t||{};return(i>0||s>0)&&(e.utc=Math.max(i,s)+n),e.videoTime=Math.max(r,a)+n,e}async recoverCurrentFrag(){const{lastRecoverPosition:e,bufferingRanges:t}=this.state.controller,r=this.getDuration()>0||void 0!==e?this.computeRecoverPositionFromCurrentTime():this.computeRecoverPositionFromStartPosition();this.playerStore.setControllerStateField(vl.lastRecoverPosition,r),this.playerStore.setControllerStateField(vl.startPosition,r),await this.detachEncoder(),this.emit("BufferingRangesChange",t),await this.attachEncoder()}attachMedia(){xa.log("attachMedia"),this.logLoadToRum();const{video:e,HLSEncoder:t}=this;if(void 0===t){const e=new ja({code:cs.NO_HLS_JS_INSTANCE,isFatal:!1});return this.props.onError(e),Promise.reject(e)}const r=new Promise(e=>{t.once(Hls.Events.MEDIA_ATTACHED,()=>{this.HLSEncoderAttachTime=(0,Eu.no)(),t.url||t.loadSource(this.getStreamUrl()),e()})});t.once(Hls.Events.MANIFEST_PARSED,()=>{if(this.loadStarted)return;const e=this.getStartLoadPosition();t.startLoad(e),this.loadStarted=!0,t.once(Hls.Events.LEVEL_UPDATED,(r,i)=>{let{details:n}=i;const s=this.getStartLoadPosition(n);s!==e&&void 0!==s&&t.streamController.startLoad(s)})});const i=t.levels&&t.levels.length>0?Promise.resolve():new Promise(e=>{t.once(Hls.Events.MANIFEST_PARSED,()=>{e()})});return pi(this.video,()=>{t.attachMedia(e)}),this.stallDetector=new pu(this.video,()=>{this.props.logEvent({event:"HlsJsStallDetected",params:{}})}),this.gapJumpTimer=new tu(()=>{var e;null==(e=this.stallDetector)||e.poll()}).tickEvery(.25),Promise.all([r,i]).then(()=>{})}onAudioTrackUpdated(e){const{HLSEncoder:t}=this;if(!t)return;const r=ni(t.audioTracks.find(t=>t.id===e));r&&this.emit("InternalAudioTrackValueChange",r.value)}getVideoType(){const e=this.getHlsEncoderLevelDetails();if(e)return gi(e);return(this.HLSEncoder&&this.HLSEncoder.levels||[]).some(e=>{let{details:t}=e;return Boolean(t&&t.live)})||this.getDuration()===1/0?cl.Z.LIVE:cl.Z.VOD}onLevelsUpdated(){const{sessionData:e={},levels:t=[]}=this.HLSEncoder||{};this.videoTrackLabels=Ei(e),this.maxHeightCapping=function(e){const{VALUE:t=""}=e["com.yandex.video.capping.maxheight"]||{},r=parseInt(t,10);return r>0?r:void 0}(e),this.emit("VideoTracksChange",ci(t,this.videoTrackLabels))}updateThumbnailTileMeta(){const{sessionData:e={}}=this.HLSEncoder||{},t=e=>{this.props.logEvent({event:e,params:void 0})},r=ii(e,ju.LOWRES,t),i=ii(e,ju.HIGHRES,t);if(void 0===i)return;const n=r?ri(r,t):void 0,s=ri(i,t),a=function(e){const{VALUE:t=""}=e["com.yandex.video.thumbnail.version"]||{};return parseFloat(t)||0}(e);this.props.onThumbnailTileGeneralMetaInfoChange({version:a,lowRes:n,highRes:s})}onEncoderError(e){const{details:t,type:r,url:i,frag:n}=e;if(!t)return;if((s=e).networkDetails&&423===s.networkDetails.status&&s.details===Hls.ErrorDetails.LEVEL_LOAD_ERROR){this.props.logEvent({event:Ca.HlsJsForceCappingStart,params:{}});const{recoverHelper:n}=this;return void n.planTask(()=>this.recoverCurrentFrag(),{force:ti(e),reason:"HlsJs "+r,rawData:{details:t,type:r,url:i,isFatal:!1},delay:0})}var s;const a=Jr(e),o=$r(e);if(void 0!==o&&(a||r===Hls.ErrorTypes.MEDIA_ERROR))if(this.recoverHelper.allowed&&!o.isFatal){if(this.props.onError(o),ei(e)){if(this.currentState!==Sa.BUFFERING&&function(e){const{details:t}=e;return!!t&&(Hls.ErrorDetails.FRAG_LOAD_ERROR===t||Hls.ErrorDetails.FRAG_LOAD_TIMEOUT===t||Hls.ErrorDetails.FRAG_PARSING_ERROR===t||Hls.ErrorDetails.LEVEL_LOAD_TIMEOUT===t)}(e))return void(this.recoverOnBufferingReason=e);let s;e.details===Hls.ErrorDetails.INTERNAL_EXCEPTION&&"demuxerWorker"===e.event?(ud.t.setItem(Ku.WAS_WORKER_INTERNAL_ERROR,"true"),s=()=>this.recoverStream()):s=()=>this.recoverCurrentFrag(),this.recoverHelper.planTask(s,{force:ti(e),reason:"HlsJs "+r,rawData:{details:t,type:r,url:i,isFatal:a,frag:zr(n)},delay:1e3})}}else this.props.onError(new ja(Ui({},o,{isFatal:!0})))}getHlsTextTrack(e){if(this.HLSEncoder)return this.HLSEncoder.subtitleTracks.find(t=>e.value===String(t.id))}unsubscribePreloadSourceHandlers(){const{preloadSourceHLSEncoder:e}=this;e&&(this.preloadSourceHandlers.forEach(t=>{let[r,i]=t;e.off(r,i)}),this.preloadSourceHandlers.length=0)}clearPreloadSourceHlsEncoder(){this.preloadSourceHLSEncoder=void 0,this.preloadPosition={}}getStartLoadPosition(e){const{startPosition:t}=this.state.controller,{liveOffset:r}=this.props;return function(e){let{details:t,startPosition:r,liveOffset:i}=e,{videoTime:n}=r;if(void 0===t)return n;if(t.hasProgramDateTime&&mi(r.utc)){const e=t.fragments[0].programDateTime/1e3;n=r.utc-e}if(!mi(n))return;const s=gi(t)===cl.Z.VOD?0:i,[a]=t.fragments;return P(n,void 0===a?0:a.start,t.totalduration-s)}({details:e,startPosition:t,liveOffset:r})}startLevelForcingWithSizeCap(){clearInterval(this.levelForcingInterval),this.levelForcingInterval=window.setInterval(()=>{this.forceLevel()},1e3)}stopLevelForcingWithSizeCap(){clearInterval(this.levelForcingInterval)}forceLevel(){if(!this.HLSEncoder||!this.HLSEncoder.autoLevelEnabled||!this.HLSEncoder.levels||!this.HLSEncoder.levels.length)return;const{width:e,height:t,maxWidth:r,maxHeight:i}=this.getCapSizes(),n=Math.min(e,r||1/0),s=Math.min(t,i||1/0),a=Math.min(...[this.maxHeightCapping,s].filter(va.z)),{levels:o}=this.HLSEncoder,l=o.reduce((e,t,r)=>{if((t.height<e.smallestLevel.height||t.width<e.smallestLevel.width)&&(e.smallestLevel=t,e.smallestLevelIndex=r),t.height>a||t.width>n)return e;const i=(o[e.index]||{}).height||0;return t.height>i?Ui({},e,{index:r}):e},{index:-1,smallestLevel:o[0],smallestLevelIndex:0});this.HLSEncoder.autoLevelCapping=-1===l.index?l.smallestLevelIndex:l.index}}class Rh{static fromXHR(e){return new Rh(e)}constructor(e){this.status=void 0,this.status=e.status}isFatalError(){return this.isRegionLimitationError()||this.isSignatureExpiredError()||this.isBannedError()}toPlayerError(){return new ja({code:this.getErrorCode(),isFatal:this.isFatalError(),details:JSON.parse((0,Ma.Y)(this))})}isRegionLimitationError(){return 451===this.status}isSignatureExpiredError(){return Hu.includes(this.status)}isBannedError(){return 454===this.status}getErrorCode(){return this.isRegionLimitationError()?cs.REGIONAL_LIMITATION_MANIFEST:this.isSignatureExpiredError()?cs.SIGNATURE_EXPIRED_MANIFEST:this.isBannedError()?cs.BANNED_MANIFEST:cs.DEFAULT_ERROR}}var kh=r(8870);const Ph=e=>(0,Ys.H)(e)&&(0,kh.n)(cs,e);class Ih{constructor(){this.serverTimestamp=void 0,this.getElapsedTimeFromServerDate=()=>0}parseServerTime(e,t){if(!e.date&&!e["x-server-time-ms"])return;let r=NaN;if(e["x-server-time-ms"]){r=new Date(parseInt(e["x-server-time-ms"],10)).getTime()}else if(e.date){r=new Date(e.date).getTime()}(0,va.z)(r)&&(this.serverTimestamp=r+t/2,this.getElapsedTimeFromServerDate=(0,ya.u)())}getServerTime(){if(void 0!==this.serverTimestamp)return this.serverTimestamp+this.getElapsedTimeFromServerDate()}}const Ch=["loadstart","progress","durationchange","loadedmetadata","loadeddata","canplay","playing"];class Oh extends wh{subscribeVideoTracksChange(){this.addEventListener(this.video.videoTracks,"addtrack",()=>{this.emit("VideoTracksChange",Ki(this.video.videoTracks)),this.restoreUserVideoTrack()}),this.addEventListener(this.video.videoTracks,"removetrack",()=>{this.emit("VideoTracksChange",Ki(this.video.videoTracks))}),this.addEventListener(this.video.videoTracks,"change",()=>{const{videoHeight:e,videoWidth:t,videoTracks:r}=this.video,i=qi(Qi({videoTracks:r,videoHeight:e,videoWidth:t}));this.emit("InternalVideoTrackValueChange",i&&i.value)})}subscribeAudioTracksChange(){this.addEventListener(this.video.audioTracks,"addtrack",e=>{this.emit("AudioTracksChange",Gi(this.video.audioTracks)),this.actualizeNativeAudioTrack(),this.restoreUserAudioTrack()}),this.addEventListener(this.video.audioTracks,"removetrack",()=>{this.emit("AudioTracksChange",Gi(this.video.audioTracks)),this.actualizeNativeAudioTrack()}),this.addEventListener(this.video.audioTracks,"change",e=>{this.actualizeNativeAudioTrack(),this.saveUserAudioTrack(e)})}subscribeTextTracksChange(){this.addEventListener(this.video.textTracks,"addtrack",()=>{this.emit("TextTracksChange",zi(this.video.textTracks)),this.restoreUserTextTrack()})}initInternalSubscribe(){super.initInternalSubscribe(),this.subscribeVideoBuffering();const e=(0,ma.I)(()=>{this.emit("VideoTracksChange",Ki(this.video.videoTracks)),this.emit("AudioTracksChange",Gi(this.video.audioTracks)),this.emit("TextTracksChange",zi(this.video.textTracks));const{videoHeight:e,videoWidth:t,videoTracks:r}=this.video,i=qi(Qi({videoTracks:r,videoHeight:e,videoWidth:t}));i&&this.emit("InternalVideoTrackValueChange",i.value),this.setFirstAudioTrack()});this.initTextTracks(),this.once("CanPlay",e),this.once("Destroy",()=>{this.off("CanPlay",e)}),this.video.videoTracks&&this.subscribeVideoTracksChange(),this.video.audioTracks&&this.subscribeAudioTracksChange(),this.video.textTracks&&this.subscribeTextTracksChange(),this.addVideoEventListener("progress",()=>{const{videoType:e}=this.state.controller;e!==cl.Z.LIVE&&e!==cl.Z.EVENT||this.emit("DvrChange")}),this.subscribeCueChange()}constructor(e){super(e),this.props=e,this.serverTimeEstimator=void 0,this.estimatorPollingInterval=void 0,this.isRecoverablePlaylistHTTPStatus=!0,this.checkPlaylistHTTPStatusPromise=void 0,this.applyStartPosition=()=>{if(!this.canSeek())return;const e=this.getCurrentTime(),t=this.getStartPosition();(0,va.z)(t)&&e!==t&&this.seekInternal(t)},this.saveUserAudioTrack=e=>{if(!e.isTrusted)return;const t=ji(this.video);t&&this.playerStore.setUserAudioTrackParams({name:t.name||void 0,lang:t.lang||void 0})},this.actualizeNativeAudioTrack=()=>{const e=ji(this.video);this.emit("InternalAudioTrackValueChange",e&&e.value)},this.notifyTextTracksChanged=()=>{const e=function(e,t){const{textTracks:r=[]}=e;for(let i=0;i<r.length;i++){const e=r[i];if(e&&Wi(e)&&e.mode===t)return Yi(e,i)}}(this.video,this.getVisibleTextTrackMode());this.emit("InternalTextTrackValueChange",e&&e.value)},this.playerStore.setIsAbrSupported(!0),this.stateController.putIsAbrEnabled(!0),this.serverTimeEstimator=new Ih,this.estimateLatency(),this.on("VideoTypeChange",e=>{this.startLatencyPolling(e)}),this.on("Detach",()=>this.stopLatencyPolling()),this.once("Destroy",()=>this.stopLatencyPolling())}getServerTime(){const e=this.serverTimeEstimator.getServerTime();return e?e/1e3:void 0}setAudioTrack(e){if(""===e.value)return;const t=(0,Xc.w)(this.video.audioTracks),r=t.find(t=>t.id===e.value);void 0!==r&&(r.enabled=!0,t.forEach(e=>{e!==r&&(e.enabled=!1)}))}setTextTrack(e){""!==e.lang&&this.renderTextTrack(e.lang)}disableTextTrack(){this.renderTextTrack(void 0)}renderTextTrack(e){Ii(this.video.textTracks).forEach((t,r)=>{t&&(Yi(t,r).lang===e?t.mode=this.getVisibleTextTrackMode():t.mode=this.getHiddenTextTrackMode())})}seekInternal(e){Li(this.video,P(e,0,this.getDuration()||0))}getSeekableRange(){const e=this.video.seekable;return{start:e.start(0),end:e.end(e.length-1)}}getFragmentsData(){if(!this.isDvrEnabled()||!this.video||!this.video.seekable.length)return super.getFragmentsData();const{start:e,end:t}=this.getSeekableRange();return{totalDuration:t-e,fragmentDuration:nl,startTime:e}}shouldSkipVideoTagError(e){return e.code!==Du.MEDIA_ERR_DECODE&&e.code!==Du.MEDIA_ERR_ENCRYPTED&&e.code!==Du.MEDIA_ERR_SRC_NOT_SUPPORTED||ze(this.state)}async onVideoTagError(){const e=Wr(this.video);if(this.shouldSkipVideoTagError(e))return;this.video.poster=Ra,this.checkPlaylistHTTPStatus();const t=!this.recoverHelper.allowed||!this.isRecoverablePlaylistHTTPStatus,r=new ja({code:Bi(e),details:e,isFatal:t});if(!t)return this.props.onError(r),void this.recoverHelper.planTask(()=>this.recoverStream(),{delay:500,reason:"VideoTagError ["+e.code+"]["+e.message+"]"});const i=await this.checkPlaylistHTTPStatusPromise;i&&i.isFatalError()?this.props.onError(i.toPlayerError()):this.props.onError(r)}onTick(e){super.onTick(e),this.isDvrEnabled()&&this.updateSkinDvrParameters(e)}async attachEncoder(){await super.attachEncoder();const e=e=>(this.props.onError(e),Promise.reject(h(e,this.state.ad.adblockDetected)));if(this.engine===Cl.NATIVE&&!$l)return e(new ja({code:cs.NATIVE_HLS_NOT_SUPPORTED_ERROR}));const{video:t}=this;this.subscribeContentImpression();try{await this.initDrm(this.props.stream.drmConfig)}catch(yf){return e(ja.from(yf))}if(this.establishStartPosition(),this.initVideoTypeQualifier(),this.logLoadToRum(),(0,is.RW)("web_add_mms_ios")&&Iu.isYaspVideoElement(t)){const e=t,{streamsWithSupportInfo:r}=this.playerStore.getState().controller;if(r){const t=r.find(e=>{let{supportInfo:t,stream:r}=e;return od(r.url)&&t.supported});t?e.airplaySrc=t.stream.url:(e.disableRemotePlayback=!0,e.airplaySrc="")}}pi(t,()=>t.src=this.getStreamUrl()),this.startLatencyPolling(this.state.controller.videoType)}getStreamUrl(){const e=this.getStartPosition();return Ur(super.getStreamUrl(),e)}establishStartPosition(){return new Promise((e,t)=>{const r=[];Ch.forEach(t=>{r.push(this.addVideoEventListener(t,()=>{this.canSeek()&&(this.applyStartPosition(),N(r),e())},{once:!0}))}),this.once("Detach",()=>{N(r),t()})})}onOnline(){}onOffline(){}canSeek(){const{video:e}=this.props;return e.readyState>0&&e.duration>0}getStartPosition(){const{videoTime:e,utc:t}=this.state.controller.startPosition;if(!(0,va.z)(e)&&!(0,va.z)(t))return;const r=this.getUtcStartTime();return r>0&&(0,va.z)(t)&&t>0?t-r:(0,va.z)(e)?e:void 0}getUtcPosition(){const e=this.getUtcStartTime();return e>=0?e+this.getCurrentTime():super.getUtcPosition()}checkPlaylistHTTPStatus(){this.checkPlaylistHTTPStatusPromise||(this.checkPlaylistHTTPStatusPromise=this.loadPlaylistInfo().then(Rh.fromXHR).then(e=>(this.isRecoverablePlaylistHTTPStatus=!e.isFatalError(),e)).catch(()=>{}))}estimateLatency(){const e=lu();(0,el.W)({url:this.getStreamUrl(),method:"HEAD",timeout:5e3}).then(t=>{this.serverTimeEstimator.parseServerTime({"x-server-time-ms":t.getResponseHeader("x-server-time-ms"),date:t.getResponseHeader("date")},lu()-e)},()=>{})}startLatencyPolling(e){this.estimatorPollingInterval||e!==cl.Z.EVENT&&e!==cl.Z.LIVE||(this.estimatorPollingInterval=window.setInterval(()=>this.estimateLatency(),1e4))}stopLatencyPolling(){clearInterval(this.estimatorPollingInterval),this.estimatorPollingInterval=void 0}initTextTracks(){let e=!1,t=!1;const{textTracks:r}=this.video;if(!r)return;const i=(0,ma.I)(()=>{this.castTextTracksModeOnInit(),this.restoreUserTextTrack(),this.addEventListener(r,"change",this.notifyTextTracksChanged),this.notifyTextTracksChanged()}),n=()=>{e&&t&&i()};this.addEventListener(this.video,"loadedmetadata",()=>{e=!0,n()}),this.addEventListener(r,"addtrack",function(e,t,r,i){function n(){null!==s&&clearTimeout(s),s=null}3===arguments.length&&"boolean"!==typeof r&&(i=r,r=!1);let s=null,a=As.Z;const o=function(){const o=arguments;i=i||this,a=()=>{n(),a=As.Z,e.apply(i,o)},r&&null===s&&e.apply(i,o),n(),s=window.setTimeout((function(){r||e.apply(i,o),s=null}),t)};return o.cancel=n,o.now=()=>{a()},o}(()=>{t=!0,n()},0))}setFirstAudioTrack(){this.restoreUserAudioTrack();const e=ji(this.video);e&&this.emit("InternalAudioTrackValueChange",e.value)}loadPlaylistInfo(){return(0,el.W)({method:"GET",url:this.getStreamUrl()+"&xhr=1",timeout:3e3,checkStatus:()=>!0})}subscribeCueChange(){const{textTracks:e}=this.video;if(!e||"function"!==typeof e.addEventListener)return;const t=e=>{const t=e.track;t&&"metadata"===t.kind&&(t.mode="hidden",this.addEventListener(t,"cuechange",e=>{const{activeCues:t}=e.target,{length:r}=t;if(!r)return;const i=t[r-1];if(!i)return;const{value:n,startTime:s,endTime:a}=i;if(!n)return;const o="number"===typeof a&&isFinite(a)?a-s:nl,l=(0,Xc.w)(t).map(e=>{if(e&&e.value){const{data:t}=e.value;if("string"===typeof t)return t}return""});this.emit("MetadataChange",{fragmentMetadataArray:l,fragmentStart:s,fragmentDuration:o,src:this.video.src})}))};e.addEventListener("addtrack",t),this.on("Destroy",()=>e.removeEventListener("addtrack",t))}castTextTracksModeOnInit(){if(this.state.skin.useNativeSubtitles)return;void 0!==Ii(this.video.textTracks).find(e=>Boolean(e&&"disabled"===e.mode))||Ii(this.video.textTracks).forEach(e=>{e&&(e.mode="showing"===e.mode?this.getVisibleTextTrackMode():this.getHiddenTextTrackMode())})}}class Dh extends Oh{constructor(e){super(e),this.props=e,this.engine=Cl.MP4;const t=(0,ma.I)(()=>{this.emit("VideoTracksChange",function(e){const{videoWidth:t,videoHeight:r}=e;return[{name:oi({width:t,height:r}),value:"0",bitrate:bl,width:t,height:r}]}(e.video))});this.once("CanPlay",t),this.once("Destroy",()=>this.off("CanPlay",t))}async attachEncoder(){await super.attachEncoder(),xa.log("mp4 native mode")}establishStartPosition(){return new Promise((e,t)=>{const r=this.addVideoEventListener("durationchange",()=>{this.canSeek()&&(this.applyStartPosition(),r(),e())});this.once("Detach",()=>{r(),t()})})}initVideoTypeQualifier(){this.emit("VideoTypeChange",cl.Z.VOD)}initDrm(){return Promise.resolve()}setVideoTrack(){}}var Nh=r(9066);let Lh;!function(e){e.EXPIRED_SIGNATURE="EXPIRED_SIGNATURE",e.NEED_COOKIE="NEED_COOKIE",e.NEED_YATEAM_LOGIN="NEED_YATEAM_LOGIN",e.NEED_VIEW_PERMISSION="NEED_VIEW_PERMISSION"}(Lh||(Lh={}));const Mh={error:"",isFatal:!1,helpLink:""};var Fh=r(5052),xh=r(2390);class Vh extends la{constructor(e,t,r,i){var n;super(),n=this,this.drmConfig=t,this.errorCallback=r,this.withCredentials=i,this.video=void 0,this.loadCertificate=(0,ma.I)(async()=>{try{const{promise:e,abort:t}=Ji({method:"GET",url:this.drmConfig.servers["com.apple.fps.1_0"],responseType:"arraybuffer",retries:3,timeout:1e4,onRetry:this.onRequestRetry(e=>{this.onError(new ja({code:cs.FAIRPLAY_CERT_LOAD_ERROR,isFatal:!1,details:e}))}),withCredentials:this.withCredentials});this.addDestroyHandler(t);const{response:r}=await e;return new Uint8Array(r)}catch(yf){return this.onError(new ja({isFatal:!0,code:cs.FAIRPLAY_CERT_LOAD_ERROR,details:(0,ys.K)(yf)?yf:void 0})),new Uint8Array(0)}}),this.onNeedKey=async function(e){let{initData:t}=void 0===e?{}:e;const{video:r}=n;if(!t||n.isDestroyed)return;const i=n.extractContentId(t);await n.waitForLoadedMetaData(),r.webkitKeys||"function"!==typeof WebKitMediaKeys||r.webkitSetMediaKeys(new WebKitMediaKeys("com.apple.fps.1_0")),r.webkitKeys||n.onError(new ja({code:cs.FAIRPLAY_CREATE_MEDIA_KEYS_ERROR}));const s=await n.getWebKitMediaKeySessionInitData(t,i),a=n.video.webkitKeys.createSession("video/mp4",s);a||n.onError(new ja({code:cs.FAIRPLAY_CREATE_KEY_SESSION_ERROR})),n.addDestroyHandler(()=>a.close());n.addDestroyHandler((0,Vs.O)(a,"webkitkeymessage",e=>{let{message:t}=e;if(n.isDestroyed)return;const r=t||new ArrayBuffer(0),s=nn({},n.drmConfig.headers),o=(0,xh.l)();let l=0;const d=async()=>{if(n.isDestroyed)return;const{abort:e,promise:t,getStatus:c}=Ji({responseType:"json",method:"POST",url:n.drmConfig.advanced["com.apple.fps.1_0"].processSPCPath,data:JSON.stringify(nn({assetId:i,spc:btoa(sn(new Uint8Array(r)))},n.drmConfig.requestParams)),headers:s,timeout:1e4,withCredentials:n.withCredentials});n.addDestroyHandler(e);try{const{response:{ckc:e}}=await t,r=on(atob(e));return void a.update(new Uint8Array(r))}catch(yf){const t=l>=3;if(n.onError(new ja({isFatal:t,code:cs.FAIRPLAY_SPC_LOAD_ERROR,details:yf})),t)return;o.addLock((0,Fh._)(rn(c(),l++))),o.waitAndLock(d)}};o.waitAndLock(d)}));n.addDestroyHandler((0,Vs.O)(a,"webkitkeyerror",e=>{let t;const{error:r}=a;if(r){const{code:e,systemCode:i}=r;t={code:e,systemCode:i}}n.onError(new ja({code:cs.FAIRPLAY_CREATE_KEY_ERROR,isFatal:!1,details:t}))}))},this.onError=e=>{this.isDestroyed||(this.errorCallback.call(this.errorCallback,e),e.isFatal&&this.destroy())},this.onRequestRetry=e=>(t,r)=>{const i=r.status;if(418!==i)return e(t),!0;const n=tn(r.response,i);return this.onError($i(n)),!n.isFatal},this.video=e,this.addDestroyHandler((0,Vs.O)(e,"webkitneedkey",this.onNeedKey)),this.loadCertificate()}async getWebKitMediaKeySessionInitData(e,t){const r=await this.loadCertificate(),i=new Uint16Array(on(t));let n=0;const s=e.byteLength+4+i.byteLength+4+r.byteLength,a=new ArrayBuffer(s),o=new DataView(a);new Uint8Array(a,n,e.byteLength).set(new Uint8Array(e)),n+=e.byteLength,o.setUint32(n,i.byteLength,!0),n+=4;const l=new Uint16Array(a,n,i.length);l.set(i),n+=l.byteLength,o.setUint32(n,r.byteLength,!0),n+=4;return new Uint8Array(a,n,r.byteLength).set(r),new Uint8Array(a,0,a.byteLength)}extractContentId(e){const t=new Uint8Array(e),r=sn(new Uint16Array(t.buffer)),[,i]=r.split("//");return i||(this.onError(new ja({isFatal:!1,code:cs.FAIRPLAY_INVALID_CONTENT_ID})),"")}async waitForLoadedMetaData(){if(!(this.video.readyState>=HTMLMediaElement.HAVE_METADATA))return new Promise(e=>{this.addDestroyHandler((0,Vs.O)(this.video,"loadedmetadata",()=>e(),{once:!0}))})}}Vh.IS_SUPPORTED="undefined"!==typeof WebKitMediaKeys&&(0,rs.m)(WebKitMediaKeys.isTypeSupported)&&WebKitMediaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4");class Uh extends Ia.v{constructor(e){super(),this.video=void 0,this.unsubscribers=[],this.isStrmCatchUpStream=void 0,this.seekableEndFifo=new tc(2),this.destroy=()=>{N(this.unsubscribers)},this.handleProgressEvent=()=>{if(!this.video||!this.video.seekable.length)return;const e=this.video.seekable,t=e.end(e.length-1),r=this.seekableEndFifo.getAll();t!==r[r.length-1]&&(this.seekableEndFifo.push(t),this.updateVideoType({reason:"progress"}))},this.updateVideoType=e=>{let{reason:t}=e;this.emit("VideoTypeChange",{videoType:this.getVideoType(),videoTagDuration:this.video?this.video.duration:null,reason:t})},this.isStrmCatchUpStream=function(e){if(!Zt(e))return!1;const t=vt(mt(e).search);return Boolean(t.start)}(e)}setHTMLVideoElement(e){this.destroy(),this.video=e,this.unsubscribers.push((0,Vs.O)(e,"timeupdate",()=>{this.updateVideoType({reason:"timeupdate"})})),this.unsubscribers.push((0,Vs.O)(e,"durationchange",()=>{this.updateVideoType({reason:"durationchange"})})),this.unsubscribers.push((0,Vs.O)(e,"progress",this.handleProgressEvent))}getVideoType(){if(!this.video||isFinite(this.video.duration))return cl.Z.VOD;if(this.isStrmCatchUpStream)return cl.Z.EVENT;const e=this.seekableEndFifo.getAll();if(!this.video.seekable.length||e.length<2)return cl.Z.LIVE;const t=this.video.seekable.start(0);return e[1]>e[0]&&t?cl.Z.LIVE:cl.Z.EVENT}}class Bh{constructor(e){let{retries:t=3,nudgeDelay:r=2e3,nudge:i,shouldNudge:n,onNudgeFailed:s=Xo.Z}=e;this.retries=void 0,this.nudge=void 0,this.shouldNudge=void 0,this.nudgeDelay=void 0,this.onNudgeFailed=void 0,this.currentRetries=0,this.timer=void 0,this.retries=t,this.nudge=i,this.shouldNudge=n,this.nudgeDelay=r,this.onNudgeFailed=s}schedule(){this.timer||(this.currentRetries++,this.timer=window.setTimeout(()=>{this.timer=void 0,this.shouldNudge()&&(this.currentRetries>this.retries?this.onNudgeFailed():(this.nudge(),this.schedule()))},this.nudgeDelay))}clear(){this.currentRetries=0,window.clearTimeout(this.timer),this.timer=void 0}}let Hh,jh;!function(e){e.Start="Start",e.Watched4Sec="4SecWatched",e.Watched10Sec="10SecWatched",e.Watched20Sec="20SecWatched",e.Heartbeat30Sec="30SecHeartbeat",e.End="End"}(Hh||(Hh={})),function(e){e.PLAY="play",e.PAUSE="pause",e.BUFFERING="buffering",e.END="end"}(jh||(jh={}));class Wh extends Oh{initInternalSubscribe(){super.initInternalSubscribe(),this.recoverSleepMode(),this.activateVideoTagIosWorkaround(),this.subscribeStalledNudger()}constructor(e){super(e),this.props=e,this.engine=Cl.NATIVE,this.stalledNudger=void 0,this.fairPlayController=void 0,this.isLowLatencyLiveStream=!1,this.isStuck=function(e){let{getCurrentTime:t,getPlayingState:r}=e;const i=new tc(5);let n=0,s=t();return e=>{const a=t();if(r()!==jh.PLAY)return n=0,i.clear(),!1;n=e+n;let o=!1;if(n>1e3&&s!==a&&(i.push(a),n=0,5===i.size())){const e=i.getAll(),t=Math.max(...e)-Math.min(...e);o=t>0&&t<1}return s=a,o}}({getCurrentTime:()=>this.getCurrentTime(),getPlayingState:()=>this.getPlayingState()}),this.stalledNudger=new Bh({nudge:()=>{this.state.controller.playbackRate>1&&this.setPlaybackRate(1,yl.Recover),this.onNudge()},shouldNudge:()=>this.getPlayingState()===Sa.BUFFERING&&(!!this.shouldNudge()&&this.getRemainingBufferedTime().total>0),onNudgeFailed:()=>{this.props.logEvent({event:Ca.NudgeStalledFailed,params:{}})}}),(0,is.RW)("web_add_m4s_segments_for_safari")&&this.seekToLiveEdgeForSafariWithM4s()}getUtcStartTime(){const e=this.video;if(!this.video.src||0===e.readyState||"function"!==typeof e.getStartDate)return super.getUtcStartTime();const t=e.getStartDate();if(!t||"function"!==typeof t.getTime)return super.getUtcStartTime();const r=t.getTime();return isNaN(r)?super.getUtcStartTime():r/1e3}async attachEncoder(){this.emit("BufferingRangesChange",[]),await super.attachEncoder(),xa.log("hls native mode")}async detachEncoder(){await super.detachEncoder(),this.video.src&&this.video.removeAttribute("src")}shouldSkipVideoTagError(e){return super.shouldSkipVideoTagError(e)||Boolean(this.fairPlayController&&this.fairPlayController.isDestroyed)}shouldNudge(){return!ze(this.state)&&this.canSeek()}onNudge(){this.seek(this.state.controller.currentTime+.001)}getStartPosition(){const{videoTime:e,utc:t}=this.state.controller.startPosition;if((0,va.z)(e)||(0,va.z)(t)){if(this.state.controller.videoType===cl.Z.LIVE){const e=this.getUtcStartTime();if(e>0&&(0,va.z)(t)&&t>0)return t-e}return(0,va.z)(e)?e:void 0}}isDvrEnabled(){if(sh&&!rh)return!0;const{skin:{nativeControlsVisibility:e}}=this.state;return!e}setVideoTrack(){xa.log("Unable to set video track on native encoder")}getBandwidthEstimate(){return{value:NaN,source:"default"}}async initDrm(){const{stream:{drmConfig:e}}=this.props;return this.initFairPlay(e)}calculateDVRParams(){const{videoType:e}=this.state.controller;if(e===cl.Z.VOD||void 0===e)return super.calculateDVRParams();const{fragmentDuration:t,startTime:r,totalDuration:i}=this.getFragmentsData();return{fragmentDuration:t,dvrStartTime:r,dvrDuration:i,skinDVRStartTime:r,skinDVRDuration:i-nl}}getStreamUrl(){const e=super.getStreamUrl(),t=wh.isLiveStreamUrl(e);let r,i=!t||sh&&jd.major<16||sh&&16===jd.major&&jd.minor<5||rh&&Gd.major<16||rh&&16===Gd.major&&Gd.minor<5;(0,is.RW)("web_add_m4s_segments_for_safari")?(r={force_m4s:"1"},i=!0):r=i?{force_m4s:"1"}:{};let{width:n,height:s}=this.video.getBoundingClientRect();const a=vi();r.video_width=String(n*a),r.video_height=String(s*a);const o=Gd.major>=14,l=jd.major>=15,d=o||l;return this.isLowLatencyLiveStream=t&&d&&i,this.isLowLatencyLiveStream&&(r.lowlatency="1"),Et(e,r,{saveOriginalPath:!0})}isLowLatencyLive(){return this.isLowLatencyLiveStream}initVideoTypeQualifier(){const e=new Uh(this.getStreamUrl());this.once("Detach",e.destroy),e.on("VideoTypeChange",e=>{if(null==e||!e.videoType)return;const{controller:{videoType:t}}=this.props.playerStore.getState();this.checkIfRecoverNecessary(e,t)&&(this.stateController.putPlaybackRate(1,yl.Recover),this.props.onRecover({reason:"currentTime is greater than duration during LIVE / EVENT in NativeController",delay:0,attempt:1}),this.recoverStream().then(()=>{this.play()})),void 0!==t&&e.videoType!==t&&this.props.logEvent({event:Ca.NativeVideoTypeChange,params:ln({},e,{previousVideoType:t})}),this.emit("VideoTypeChange",e.videoType)}),e.setHTMLVideoElement(this.video)}onTick(e){this.handleBufferingRangesUpdate(),super.onTick(e),this.checkStuckState(e),this.checkOutOfDvr(),this.updateProgramDateTime()}checkIfRecoverNecessary(e,t){let{reason:r,videoTagDuration:i}=e;return(t===cl.Z.LIVE||t===cl.Z.EVENT)&&"durationchange"!==r&&i&&isFinite(i)}checkStuckState(e){this.video.error||this.isStuck(e)&&this.recoverHelper.planTask(()=>this.recoverStream(),{delay:100,reason:"Stuck on time "+this.getCurrentTime()})}checkOutOfDvr(){if(this.video.error)return;const e=this.getCurrentTime(),{startTime:t}=this.getFragmentsData(),{videoType:r,playingState:i}=this.state.controller;this.recoverHelper.started||e>=t||i===Sa.PLAY&&r===cl.Z.LIVE&&this.recoverHelper.planTask(()=>this.recoverStream(!0),{delay:0,reason:"Out of DVR. CurrentTime="+e+" startTime="+t})}handleBufferingRangesUpdate(){const e=Gd.major>=15,t=jd.major>=15;if(e||t){const e=this.props.video.buffered,t=this.props.video.buffered.length;if(!t)return;const r=this.state.controller.currentTime,i=this.state.controller.bufferingRanges.find(e=>r>=e.start&&r<=e.end);if(!i)return;for(let n=0;n<t;n++)if(e.start(n)<=r&&e.end(n)>r)return void(e.end(n)>i.end&&this.emit("BufferingRangesChange",(0,Gc.w)(this.props.video)))}}async initFairPlay(e){var t;if(!Tt(e))return(0,Es.Z$)("drm","none"),void this.emit("DrmSystemChange",Pd.none);if((0,Es.Z$)("drm","fairplay"),!Vh.IS_SUPPORTED)throw new ja({code:cs.FAIRPLAY_NOT_SUPPORTED});const{video:r,onError:i}=this.props;null==(t=this.fairPlayController)||t.destroy();const n=new Vh(r,e,i,this.withCredentials);this.fairPlayController=n,this.emit("DrmSystemChange",Pd.fairplay),this.once("Detach",()=>n.destroy()),this.once("Destroy",()=>n.destroy())}recoverSleepMode(){const e=f(this.getVideoOwnerDocument(),e=>{e&&this.shouldNudge()&&this.video.paused&&(this.video.currentTime-=.001)});this.once("Destroy",e)}subscribeStalledNudger(){this.on("VideoPlayingStateChange",e=>{var t,r;e===Sa.BUFFERING?null==(t=this.stalledNudger)||t.schedule():null==(r=this.stalledNudger)||r.clear()})}updateProgramDateTime(){const{videoType:e}=this.state.controller,t=this.getUtcStartTime(),r=(e===cl.Z.LIVE||e===cl.Z.EVENT)&&t?1e3*t:void 0;this.emit("ProgramDateTimeChange",r)}activateVideoTagIosWorkaround(){rh&&this.once("Destroy",(0,Vs.O)(this.video,"touchstart",()=>{this.video.paused?this.video.pause():Promise.resolve(this.video.play()).catch(Xo.Z)},{once:!0}))}handleVideoElementPlayEvent(){this.props.video.buffered.length&&super.handleVideoElementPlayEvent()}isStalledLiveEdge(){return!1}seekToLiveEdgeForSafariWithM4s(){const e=super.getStreamUrl();!wh.isLiveStreamUrl(e)||sh&&jd.major<16||sh&&16===jd.major&&jd.minor<5||rh&&Gd.major<16||rh&&16===Gd.major&&Gd.minor<5||this.addEventListener(this.props.video,"loadeddata",()=>{this.props.video.seekable.length&&this.seek(this.props.video.seekable.end(this.props.video.seekable.length-1))},{once:!0})}}var Yh=r(4893),Gh=r(2918),zh=r(7817);class qh extends la{constructor(e,t,r,i){super(),this.video=e,this.config=t,this.onEvent=i,this.session=void 0,this.initPromise=void 0,this.currentDrmKeySystem=Pd.none,this.keySystem=void 0,this.requestSync=(0,xh.l)(),this.onError=void 0,this.onError=e=>{this.isDestroyed||(e.isFatal&&this.destroy(),r(e))},this.addEventListener(this.video,"encrypted",e=>{this.logEvent("DrmEncrypted",{initDataType:e.initDataType}),this.onEncrypted(e.target)},{once:!0}),this.keySystem=null,this.logEvent("CreateDrmController",{config:t})}async getMediaKeySessionInitData(){return Promise.resolve({})}static async getMediaKeySystemAccess(e){let t=qh.mediaKeySystemAccessMap.get(e);return t||(t=await window.navigator.requestMediaKeySystemAccess(e,Nd),qh.mediaKeySystemAccessMap.set(e,t),t)}async loadCertificate(e){if(e)try{this.logEvent("DrmCertificateLoad",{url:e});const t=(0,ya.u)(),{response:r}=await this.requestDrmProxy({method:"get",responseType:"arraybuffer",url:e,withCredentials:this.config.withCredentials},0);return this.logEvent("DrmCertificateLoadEnd",{url:e,requestTime:Math.round(t())}),r}catch(yf){const t=ja.from(yf);this.onError(new ja(un({},t.toJSON(),{code:"DRM_CERT_LOAD_ERROR",message:"Failed to get certificate via direct link: "+t,isFatal:!1})))}return new ArrayBuffer(0)}async init(){return this.initPromise||(this.initPromise=this.initInternal()),this.initPromise}async initInternal(){var e,t,r;if(this.currentDrmKeySystem!==Pd.none)return;if(!this.video)return;if(this.keySystem=null!=(e=this.config.servers)&&e[Id.ly]?Id.ly:null!=(t=this.config.servers)&&t[Id.xE]?Id.xE:null,!this.keySystem)return void this.onError(new ja({code:"DRM_NO_SUPPORTED_KEY_SYSTEM",message:"No supported drm server specified",isFatal:!0}));if(this.video.mediaKeys)return;const{serverCertificateUrl:i}=(null==(r=this.config.advanced)?void 0:r[this.keySystem])||{},n=this.loadCertificate(i);let s;try{const e=await qh.getMediaKeySystemAccess(this.keySystem);s=await e.createMediaKeys()}catch(yf){const t=(0,ys.K)(yf)?yf.message:(0,Ys.H)(yf)?yf:"";return void this.onError(ja.from(yf,{code:"DRM_FAILED_TO_CREATE_CDM",message:"Failed to create mediaKeys: "+t,isFatal:!0}))}try{if(this.isDestroyed)return;await this.video.setMediaKeys(s)}catch(yf){const t=(0,ys.K)(yf)?yf.message:(0,Ys.H)(yf)?yf:"";return void this.onError(ja.from(yf,{code:"DRM_FAILED_TO_SET_MEDIA_KEYS",message:"Failed set mediaKeys: "+t,isFatal:!0}))}const a=await n;a.byteLength&&await s.setServerCertificate(a),this.currentDrmKeySystem=function(e){switch(e){case Id.ly:return Pd.widevine;case Id.xE:return Pd.playready;default:return Pd.none}}(this.keySystem)}async onEncrypted(e){var t;if(this.isDestroyed)return;if(await this.initPromise,!e.mediaKeys||!this.keySystem)return void this.onError(new ja({code:"DRM_INIT_ERROR",message:"MediaKeys not inited",isFatal:!0}));const r=null==(t=this.config.servers)?void 0:t[this.keySystem];if(r){try{this.session=e.mediaKeys.createSession()}catch(yf){const t=(0,ys.K)(yf)?yf.message:(0,Ys.H)(yf)?yf:"";return void this.onError(ja.from(yf,{code:"DRM_FAILED_TO_CREATE_SESSION",message:"Failed to create session: "+t,isFatal:!0}))}if(this.session){this.addEventListener(this.session,"message",async e=>{let{message:t}=e;try{var i;this.logEvent("DrmProxyRequest",{requestParams:this.config.requestParams,url:r,keySystem:this.keySystem});const e=(0,ya.u)(),{response:n}=await this.handleSessionMessage(this.keySystem,r,this.config.requestParams,t);if(this.logEvent("DrmProxyRequestEnd",{url:r,requestTime:Math.round(e()),keySystem:this.keySystem}),this.isDestroyed)return;await(null==(i=this.session)?void 0:i.update(n))}catch(yf){var n;const t=ja.from(yf),r=null!=(n=t.details)&&n.drmProxyError?t.code:"DRM_SESSION_ERROR";this.onError(new ja(un({},t.toJSON(),{code:r,message:"Failed to handle session message: "+t})))}},!1),this.addEventListener(this.session,"error",e=>{var t,r;this.onError(new ja(un({},e,{code:"DRM_SESSION_ERROR",message:"Session error: "+e.message,isFatal:null==(t=null==(r=e.details)?void 0:r.isFatal)||t})))});try{const e=await this.getMediaKeySessionInitData();await this.generateRequest(this.session,e)}catch(yf){return void this.onError(ja.from(yf,{code:"DRM_UNKNOWN_ERROR"}))}}else this.onError(new ja({code:"DRM_FAILED_TO_CREATE_SESSION",message:"session is "+this.session,isFatal:!0}))}else this.onError(new ja({code:"DRM_NO_LICENSE_SERVER",message:"No valid url to license server",isFatal:!0}))}async generateRequest(e,t){let{initData:r,initDataType:i}=t;if(!this.isDestroyed)if(r)try{const t=Gh.P.fromBase64(r).buffer;await e.generateRequest(i,t)}catch(yf){const t=(0,ys.K)(yf)?yf.message:(0,Ys.H)(yf)?yf:"";this.onError(ja.from(yf,{code:"DRM_FAILED_TO_GENERATE_REQUEST",message:"Failed to generate request: "+t+"}",isFatal:!0}))}else this.onError(new ja({code:"DRM_NO_INIT_DATA",message:"No drm initialization data in initialization info",isFatal:!0}))}addEventListener(e,t,r,i){const n=(0,Vs.O)(e,t,r,i);this.addDestroyHandler(n)}requestDrmProxy(e,t){return this.requestSync.waitAndLock(()=>new Promise((r,i)=>{(0,Nh.W)(un({},e,{onSuccess:r,onError:(e,r)=>{const n=tn(zh.x.fromUTF8(r.response),r.status),s=rn(r.status,t);return this.requestSync.addLock((0,Fh._)(s)),i($i(n))}}))}))}handleSessionMessage(e,t,r,i,n){void 0===n&&(n=0);let s=i;const a={method:"post",data:"",responseType:"arraybuffer",url:t,withCredentials:this.config.withCredentials};if(e===Id.xE){const e=this.unpackPlayReadyRequest(i);a.headers=un({},e.headers,a.headers),delete a.headers["Content-Type"],s=e.data}return a.data=(()=>{if(!r)return s;const e=un({},r,{rawLicenseRequestBase64:Gh.P.toBase64(new Uint8Array(s))});return zh.x.toUTF8(JSON.stringify(e))})(),this.requestDrmProxy(a,n).catch(s=>{var a;const o=ja.from(s),l=new ja(un({},o.toJSON(),{isFatal:o.isFatal||n>3,code:null!=(a=o.details)&&a.drmProxyError?o.code:"DRM_SESSION_ERROR",message:"Failed to handle session message: "+o}));if(this.onError(l),l.isFatal)throw l;return this.handleSessionMessage(e,t,r,i,n+1)})}unpackPlayReadyRequest(e){const t=zh.x.fromUTF16(e,!0,!0),r={};let i=e;if(!t.includes("PlayReadyKeyMessage"))return{headers:r,data:i};const n=(new DOMParser).parseFromString(t,"application/xml"),s=n.getElementsByTagName("HttpHeader");for(let o=0;o<s.length;++o){const e=s[o].getElementsByTagName("name")[0],t=s[o].getElementsByTagName("value")[0];e.textContent&&t.textContent&&(r[e.textContent]=t.textContent)}const a=n.getElementsByTagName("Challenge")[0];return a&&"base64encoded"===a.getAttribute("encoding")&&(i=Gh.P.fromBase64(a.textContent).buffer),{headers:r,data:i}}async destroy(){super.destroy(),this.logEvent("DestroyDrmControllerCalled",void 0),this.currentDrmKeySystem=Pd.none;try{var e,t;const r=Ea(1e3).promise;await Promise.race([Promise.all([null==(e=this.session)?void 0:e.closed,null==(t=this.session)?void 0:t.close()]),r])}catch(yf){}if(this.session=void 0,""===this.video.src)try{await this.video.setMediaKeys(null)}catch(yf){}this.logEvent("DestroyDrmController",void 0)}logEvent(e,t){this.onEvent({name:e,data:t})}}qh.mediaKeySystemAccessMap=new Map;class Kh extends qh{constructor(e,t,r){super(e,t,r,t=>{null==e.yaspDispatchEvent||e.yaspDispatchEvent("yasp-event",t)}),this.drmInfoReceivedDeferred=new ka.B,this.addEventListener(this.video,"yasp-drmInfoReceived",t=>{const r=t.detail.map(e=>{let{keySystem:t}=e;return t});null==e.yaspDispatchEvent||e.yaspDispatchEvent("yasp-event",{name:"DrmInfoReceived",data:{keySystems:r}}),this.drmInfoReceivedDeferred.resolve(t)},{once:!0})}async getMediaKeySessionInitData(){var e,t;const r=(await this.drmInfoReceivedDeferred.promise).detail.find(e=>e.keySystem===this.keySystem);if(!r)throw new ja({code:cs.DRM_INIT_ERROR,message:"No drm initialization info",isFatal:!0});if(null==(e=r.initData)||null==(t=e[0])||!t.initData)throw new ja({code:cs.DRM_INIT_ERROR,message:"No drm initialization data in initialization info",isFatal:!0});return r.initData[0]}}const Qh={sourceLimit:Number.MAX_SAFE_INTEGER},Zh=5*Math.random();var Jh=r(1841);const Xh=document.createElement("canvas"),$h=Xh.getContext("2d");var ep=r(6702);class tp extends Oh{constructor(e,t){super(e),this.props=e,this.engine=Cl.YASP,this.yaspVideoElement=null,this.preloader=void 0,this.unsubscribers=[],this.initEncoderPromise=void 0,this.drmController=void 0,this.targetLatency=(0,ep.c)(7),this.handleVideoTypeChange=e=>{let{detail:t}=e;const r=t;r&&this.emit("VideoTypeChange",r);const i=1e3*this.getUtcStartTime();switch(r){case cl.Z.LIVE:this.emit("ProgramDateTimeChange",0);break;case cl.Z.EVENT:this.emit("ProgramDateTimeChange",i);break;default:this.emit("ProgramDateTimeChange",i||void 0)}},this.handleYaspEvent=e=>{let{detail:{name:t,data:r}}=e;this.props.logEvent({event:t,params:r}),"YaspLargeGap"===t&&xa.log("-> Yasp LargeGapEvent",r)},this.handleTargetLatencyUpdate=e=>{let{detail:t}=e;this.targetLatency=t},this.handleDebug=e=>{let{detail:t}=e;"string"===typeof t&&xa.log("[PLAYER] [YASP]",t)},this.reportEmsg=e=>{const{startTime:t,messageData:r,segmentDuration:i}=e.detail,n=(0,Lu.parseV2Tag)(r);n&&n.writer&&this.emit("MetadataChange",{fragmentMetadataArray:[n.writer],fragmentStart:t,fragmentDuration:i,src:this.getStreamUrl()})},this.reportError=e=>{const t=e.detail;if("YASP_FETCH_SEGMENT_BAD_HTTP_STATUS"===t.code||"YASP_FETCH_MANIFEST_BAD_HTTP_STATUS"===t.code){const e=(r=t.details.status,i="YASP_FETCH_MANIFEST_BAD_HTTP_STATUS"===t.code,451===r?i?cs.REGIONAL_LIMITATION_MANIFEST:cs.REGIONAL_LIMITATION_SEGMENT:Hu.includes(r)?i?cs.SIGNATURE_EXPIRED_MANIFEST:cs.SIGNATURE_EXPIRED_SEGMENT:454===r?i?cs.BANNED_MANIFEST:cs.BANNED_SEGMENT:404===r&&i?cs.MANIFEST_NOT_FOUND:void 0);e&&(t.code=e,t.category=u(e),t.isFatal=!0)}var r,i;this.props.onError(ja.from(t))},function(e){try{if(!navigator.requestMediaKeySystemAccess)return;const t=cn(e);if(t===window)return;if(!t.navigator.requestMediaKeySystemAccess)return;navigator.requestMediaKeySystemAccess=function(){return t.navigator.requestMediaKeySystemAccess(...arguments)}}catch(t){}}(this.video),this.initDetachedVideoElementErrorHandling(),this.preloader=t}async requestDebugInfo(){return this.yaspVideoElement&&this.yaspVideoElement.yasp?this.yaspVideoElement.yaspRequestDebugInfo():{noYasp:!0}}initTextTracks(){var e;const t=null==(e=this.yaspVideoElement)?void 0:e.textTracks;t&&(this.unsubscribers.push((0,Vs.O)(t,"change",()=>{this.notifyTextTracksChanged()})),this.notifyTextTracksChanged())}subscribeVideoTracksChange(){this.addEventListener(this.video.videoTracks,"addtrack",()=>{this.emit("VideoTracksChange",Ki(this.video.videoTracks))}),this.addEventListener(this.video.videoTracks,"removetrack",()=>{this.emit("VideoTracksChange",Ki(this.video.videoTracks))}),this.addEventListener(this.video.videoTracks,"change",()=>{const{videoHeight:e,videoWidth:t,videoTracks:r}=this.video,i=qi(Qi({videoTracks:r,videoHeight:e,videoWidth:t}));this.emit("InternalVideoTrackValueChange",i&&i.value)})}async attachEncoder(){this.initEncoderPromise=this.preventPauseAsync(this.video,async()=>{if(this.yaspVideoElement=Iu.attach(this.video,hn({},Qh,{perfLogUrl:this.props.perfLogUrl})),this.configureSource(this.getYaspConfig()),this.initTextTracks(),this.subscribeVideoTracksChange(),this.subscribeAudioTracksChange(),this.subscribeTextTracksChange(),this.unsubscribers.push((0,Vs.O)(this.yaspVideoElement,"yasp-videotracksadded",()=>this.restoreUserVideoTrack())),this.yaspVideoElement.addEventListener("yasp-event",this.handleYaspEvent),this.yaspVideoElement.addEventListener("yasp-error",this.reportError),this.yaspVideoElement.addEventListener("yasp-debug",this.handleDebug),this.yaspVideoElement.addEventListener("yasp-videoTypeChange",this.handleVideoTypeChange),this.yaspVideoElement.addEventListener("yasp-emsg",this.reportEmsg),(0,is.RW)("web_yasp_target_latency_updater")&&this.yaspVideoElement.addEventListener("yasp-updateTargetLatency",this.handleTargetLatencyUpdate),await super.attachEncoder(),this.preventPauseState){const e=this.yaspVideoElement.checkShouldPlay();this.preventPauseState.shouldPlayAfterEnd=null!=e?e:this.preventPauseState.shouldPlayAfterEnd}this.playerStore.setControllerStateField(vl.preloadDetails,void 0===this.preloader?void 0:{preloadingMethod:this.preloader.getType(),preloaded:this.preloader.preloaded}),this.initVideoSizesUpdater()}),await this.initEncoderPromise,this.initEncoderPromise=void 0}async play(){return this.yaspVideoElement?(this.yaspVideoElement.yaspSetVideoElementSizes(this.getVideoElementSizes()),this.yaspVideoElement.play()):super.play()}async detachEncoder(){var e,t,r,i;if(this.isRecoverablePlaylistHTTPStatus=!0,null==(e=this.yaspVideoElement)||e.removeEventListener("yasp-event",this.handleYaspEvent),null==(t=this.yaspVideoElement)||t.removeEventListener("yasp-error",this.reportError),null==(r=this.yaspVideoElement)||r.removeEventListener("yasp-debug",this.handleDebug),null==(i=this.yaspVideoElement)||i.removeEventListener("yasp-videoTypeChange",this.handleVideoTypeChange),this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.initEncoderPromise)try{await this.initEncoderPromise}catch(yf){}await this.preventPauseAsync(this.video,async()=>{var e;await(null==(e=this.yaspVideoElement)?void 0:e.detach()),this.yaspVideoElement=null,await super.detachEncoder()})}isStalledLiveEdge(e){if(!this.yaspVideoElement)return super.isStalledLiveEdge(e);const t=this.yaspVideoElement.getStreamEndTime();if(!t)return!1;const{controller:{videoType:r}}=this.state,{currentTime:i}=this.yaspVideoElement,n=e===Sa.BUFFERING,s=r===cl.Z.EVENT||r===cl.Z.LIVE;return n&&s&&t-i<2.5}handleVideoElementPlayEvent(){if(0!==this.video.buffered.length)return super.handleVideoElementPlayEvent()}async destroyUnsafe(){var e;const t=this.getStreamUrl();await super.destroyUnsafe(),await Iu.releaseSrc(t),this.video.src&&this.video.removeAttribute("src"),await(null==(e=this.drmController)?void 0:e.destroy())}initDetachedVideoElementErrorHandling(){Iu.messenger.on("yasp-error",e=>{this.props.onError(ja.from(e))}),this.once("Destroy",()=>Iu.messenger.off("yasp-error"))}initInternalSubscribe(){super.initInternalSubscribe(),this.on("InternalPlayingStateChange",e=>{var t;e===Sa.END&&(null==(t=this.yaspVideoElement)||t.forceTimeUpdate())}),this.addVideoEventListener("resize",()=>{const{videoTracks:e,videoWidth:t,videoHeight:r}=this.video,i=qi(Qi({videoTracks:e,videoWidth:t,videoHeight:r}));this.emit("InternalVideoTrackValueChange",i?i.value:void 0)}),this.addVideoEventListener("loadedmetadata",()=>{this.currentState===Sa.END&&this.video.paused&&0===this.video.currentTime&&this.seek(0)}),this.once("ContentImpression",()=>{var e,t;this.emit("DrmSystemChange",null!=(e=null==(t=this.drmController)?void 0:t.currentDrmKeySystem)?e:Pd.none)})}setVideoTrack(e){if(!this.yaspVideoElement||!this.yaspVideoElement.videoTracks)return;const t=this.yaspVideoElement.videoTracks.getTrackById(e.value);t&&(t.selected=!0,this.stateController.putIsAbrEnabled(e.value===Pl.value),this.configureSource({userQuality:(0,Yh.nK)(),maxAutoQuality:this.props.defaultQuality}))}getStreamUrl(){return Br(super.getStreamUrl())}async initDrm(e){var t,r;if(!this.yaspVideoElement)return;if(!e)return void this.addEventListener(this.yaspVideoElement,"encrypted",()=>{this.props.onError(new ja({code:cs.NO_DRM_CONFIG,isFatal:!0}))},{once:!0});(0,is.RW)("web_preload_while_drm_init")&&this.preloadSource();const i=(null==(t=this.playerStore.getState().controller.errorInfo.error)?void 0:t.category)===ds.q.DRM;if(this.drmController&&!i)return;await(null==(r=this.drmController)?void 0:r.destroy());const n=hn({},e,{withCredentials:this.withCredentials});this.drmController=new Kh(this.video,n,e=>{this.props.onError(e)}),await this.drmController.init()}getMaxCapAllowedVideoTrack(){if("function"!==typeof Iu.getStats)return super.getMaxCapAllowedVideoTrack();const e=Iu.getStats()||{},{maxCapAllowedVideoTrack:t}=e;return t||super.getMaxCapAllowedVideoTrack()}seekInternal(e){const{start:t,end:r}=this.getSeekableRange();Li(this.video,P(e,t,r||0))}getSeekableRange(){if(!this.video.seekable.length)return{start:0,end:this.getDuration()||0};return{start:this.video.seekable.start(0),end:this.video.seekable.end(0)}}updateSkinDvrParameters(e){const t=e/1e3,{skin:{skinDVRStartTime:r,skinDVRDuration:i},controller:{videoType:n,dvrDuration:s}}=this.state;if(n===cl.Z.LIVE){const e=r+t;this.playerStore.setSkinStateField(gl.skinDVRStartTime,e),this.emit("DVRStartTimeChange",e)}else if(n===cl.Z.EVENT){const e=Math.min(i+t,s);this.playerStore.setSkinStateField(gl.skinDVRDuration,e),this.emit("DVRDurationChange",e)}}startLatencyPolling(){}getDuration(){return this.video.duration}isLowLatencyLive(){return this.yaspVideoElement?this.yaspVideoElement.isLowLatencyLive():super.isLowLatencyLive()}getUtcStartTime(){if(!this.yaspVideoElement)return super.getUtcStartTime();const e=this.yaspVideoElement.getStartDate();if(!e)return super.getUtcStartTime();const t=e.getTime();return isNaN(t)?super.getUtcStartTime():t/1e3}onTick(e){const{controller:{videoType:t}}=this.state;t&&super.onTick(e)}getServerTime(){return this.yaspVideoElement?this.yaspVideoElement.getServerTime():super.getServerTime()}getFragmentsData(){const{start:e,end:t}=this.getSeekableRange();return{totalDuration:t-e,fragmentDuration:nl,startTime:e}}isDvrEnabled(){return!0}getBandwidthEstimate(){if("function"!==typeof Iu.getStats)return super.getBandwidthEstimate();const e=Iu.getStats()||{},{bandwidth:t}=e;if(t){const e=Cr(t);if(e&&(0,va.z)(e.value))return e}return super.getBandwidthEstimate()}canSeek(){const{video:e}=this.props;return e.readyState>0&&e.duration>0}async onVideoTagError(){if(this.state.controller.encoderState!==ol.Attached)return super.onVideoTagError();const e=this.video.error;if(!e||!e.yaspError)return super.onVideoTagError();this.video.poster=Ra,this.checkPlaylistHTTPStatus();const t=ja.from(e.yaspError),r=await this.checkPlaylistHTTPStatusPromise;r&&r.isFatalError()?this.props.onError(r.toPlayerError()):this.props.onError(t)}initVideoTypeQualifier(){}configureSource(e){Iu.configureSource(this.getStreamUrl(),e)}async preloadSource(){if(this.isDestroyed||this.preloader&&!this.preloader.isDestroyed)return;const e=jr({source:this.props,engine:this.engine,getState:()=>this.state,getCapSizes:()=>this.getCapSizes(),getVideoElementSizes:()=>this.getVideoElementSizes(),defaultQuality:this.props.defaultQuality});e&&(this.preloader=e,e.on("Destroy",()=>{this.preloader=void 0}),await e.preload(this.getYaspConfig()))}getYaspConfig(){var e;return{defaultBandwidthEstimate:null!=(e=Iu.getStats().bandwidth)?e:this.getBandwidthEstimate(),presentationDelay:1e3*(this.props.liveOffset+Zh),userQuality:(0,Yh.nK)(),maxAutoQuality:this.props.defaultQuality,withCredentials:this.props.sourceParams.withCredentials,skippableFragments:this.props.sourceParams.skippableFragments,maxStartTime:(0,Jh.p)()}}captureScreenshot(){return(e=>{if(!$h||0===e.videoHeight||0===e.videoWidth)return Promise.reject();Xh.width=e.videoWidth,Xh.height=e.videoHeight;try{$h.drawImage(e,0,0,e.videoWidth,e.videoHeight)}catch(t){return Promise.reject(t)}return new Promise((e,r)=>{try{Xh.toBlob(t=>{if(null===t)return r(new Error("Empty blob"));e(t)},"image/jpeg")}catch(t){r(t)}})})(this.video).then(e=>{this.previousScreenshotBlobUrl=URL.createObjectURL(e)}).catch(()=>{this.previousScreenshotBlobUrl=void 0}).then(()=>this.previousScreenshotBlobUrl)}initVideoSizesUpdater(){var e;let t=NaN,r=NaN;null==(e=this.yaspVideoElement)||e.yaspSetVideoElementSizes(this.getVideoElementSizes());const i=setInterval(()=>{var e;const i=this.getVideoElementSizes(),{width:n,height:s}=i;n===t&&s===r||(t=n,r=s,null==(e=this.yaspVideoElement)||e.yaspSetVideoElementSizes(i))},1e3);this.once("Detach",()=>{clearInterval(i)})}shouldLogStalledDebugInfo(){return!0}estimateLatency(){}}const rp=i(window),ip={};var np=r(4661),sp=r.n(np);const ap=r(8139),op=["object"===typeof document&&document&&"onfreeze"in document?"pagehide":"beforeunload","unload"];var lp=r(2741);const dp=En((e,t)=>{e.callbacks.onAdblockDetected(t)}),cp=En((e,t)=>{e.callbacks.onVideoSizeChange(t)}),up=En((e,t,r)=>{const i=e.getState();t.callbacks.onAudioTrackChange(He(i))}),hp=En((e,t)=>{e.callbacks.onAudioTracksChange(t)}),pp=En((e,t)=>{e.callbacks.onBufferingRangesChange(t)}),fp=En((e,t,r)=>{t.callbacks.onFullScreenChange(r),Tn(e,t),An(e,t)}),mp=En((e,t)=>{e.callbacks.onTextTracksChange(t)}),gp=En((e,t)=>{e.callbacks.onChangeStream(t)}),vp=En((e,t)=>{e.callbacks.onStreamsWithSupportInfoChange(t)}),yp=En((e,t)=>{e.callbacks.onVideoTypeChange(t)}),Ep=En((e,t)=>{t||e.updateVideoControllerNativeControlsVisibility()}),Sp=[Oa.midroll,Oa.postroll,Oa.preroll],Ap=En((e,t,r)=>{const i=function(e){const{ad:{nextAdInfo:t},controller:{videoType:r}}=e;if(void 0!==t&&("postroll"!==t.adBreakType||r===cl.Z.VOD))return t.remainingTime}(e.getState());t.callbacks.onNextAdRemainingTimeChange(i)}),Tp=En((e,t,r)=>{t.callbacks.onStartStageChange(r)}),bp=["ewma","hlsjs","yabro"],wp=En((e,t,r)=>{const{controller:{isOnline:i}}=e.getState();i?bp.includes(r.source)&&t.callbacks.onBandwidthEstimateChange(r):t.callbacks.onBandwidthEstimateChange({value:0,source:"default"})}),_p=En((e,t,r)=>{r||wp(e,t,{value:0,source:"default"}),t.callbacks.onNetworkStatusChange({isOnline:r})});var Rp=r(4204);let kp=0;var Pp=r(6394);const Ip=En(async(e,t)=>{if(!t)return;e.callbacks.onResourcesIdle(),e.callbacks.logEvent({event:Ca.ResourcesIdle,params:{}}),await(0,Rp._)(5e3);const r=(0,_u.Y)(()=>(0,Pp.getGpu)()),i=wt();e.callbacks.logEvent({event:Ca.ClientInfo,params:{gpu:r?{renderer:r.renderer,vendor:r.vendor}:null,codecs:i}})}),Cp=function e(t,r){void 0===r&&(r={preserveConstructors:!0});let i=t;if(na(t)){return t.map(t=>e(t,r))}return Rn(t)?new Date(t.getTime()):(!(0,rs.m)(t)&&(0,ys.K)(t)&&(i=r.preserveConstructors?Object.create(t):{},(0,td.M)(t,(t,n)=>{i[n]=e(t,r)})),i)};var Op=r(7333);class Dp{constructor(e){let{playerApi:t,store:r}=e;this.playerApi=void 0,this.store=void 0,this.destroyed=!1,this.lastSourceId=void 0,this.prevVolumeInfoPayload=void 0,this.prevIsAbrEnabled=void 0,this.prevVideoTrackValue=void 0,this.waitingForVideoTracks=!1,this.currentPostPauserollInterval=void 0,this.watchedTimeCounter=void 0,this.putVolumeInfo=e=>{var t,r;(this.store.setVolumeInfo(e),t=this.prevVolumeInfoPayload,r=e,t.volume!==r.volume||t.muted!==r.muted)&&(this.prevVolumeInfoPayload=e,function(e,t){let{volume:r,muted:i,changeReason:n}=t;e.callbacks.onVolumeChange({volume:r,muted:i,changeReason:n})}(this.playerApi,e),Tn(this.store,this.playerApi))},this.updateAdInfo=En(e=>{const{ad:{adInfo:t}}=this.store.getState();this.putAdInfo(e),function(e,t,r){r&&t&&r.adType!==t.adType?(e.callbacks.onAdStateChange({state:Gl.NOT_PLAYING,type:r.adType,adParams:{}}),e.callbacks.onAdStateChange({state:Gl.PLAYING,type:t.adType,adParams:{}})):r&&!t?e.callbacks.onAdStateChange({state:Gl.NOT_PLAYING,type:r.adType,adParams:{}}):!r&&t&&e.callbacks.onAdStateChange({state:Gl.PLAYING,type:t.adType,adParams:{}})}(this.playerApi,e,t),void 0!==e&&J(e)&&this.requestMetaInfo(e,el.W)}),this.putInStreamPlayingState=En(e=>{this.store.setAdStateField(ml.inStreamPlayingState,e),this.handlePlayingStateChange()},rl.inStreamPlayingState),this.putPlayingState=En(e=>{this.store.setControllerStateField(vl.playingState,e),this.handlePlayingStateChange(),this.handleMidroll(),Tn(this.store,this.playerApi),this.handlePostPauseroll()},ll.playingState),this.putCurrentTime=En(e=>{this.store.setControllerStateField(vl.currentTime,e),this.updateWatchedTime(),bn(this.store,this.playerApi),this.playerApi.callbacks.onCurrentTimeChange(e),this.store.setControllerStateField(vl.currentTimeLowGranularity,wn(e))}),this.handleMidroll=function(e){let t=!1;return async function(){if(!t){t=!0;try{await e(...arguments)}finally{t=!1}}}}(async()=>{const e=this.store.getState(),{controller:{currentTimeLowGranularity:t,duration:r,videoType:i,watchedTime:n}}=e;if(isNaN(r))return;const s=this.playerApi.getMultiroll(),a={watchedTime:n,sourceWatchedTime:n,currentTime:t,duration:r,videoType:i||cl.Z.VOD},o=await s.midroll.loadViewers(a);if(this.destroyed)return;const l=s.getNextAdInfo(a);this.putNextAdInfo(l),o.length<=0||await this.playerApi.playAdViewers(Oa.midroll,G(o,Oa.midroll),{})}),this.handlePostPauseroll=function(e){let t;const r=e=>{t=e};return function(){t&&(t(),t=void 0);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return e(r,...n)}}(e=>{const{controller:{duration:t,playingState:r,watchedTime:i}}=this.store.getState();if(isNaN(t)||0===i||r!==Sa.PAUSE)return;if(ze(this.store.getState()))return;const n=(0,ya.u)();let s;const a=async()=>{const e=n()/1e3,t=await this.playerApi.getMultiroll().postPauseroll.loadViewers({pausedTime:e});this.destroyed||this.currentPostPauserollInterval===s&&(0===t.length||this.playerApi.planAdViewers(G(t,Oa.postPauseroll)))};a(),s=window.setInterval(()=>{a()},15e3),e(()=>{clearInterval(s),this.currentPostPauserollInterval=void 0}),this.currentPostPauserollInterval=s}),this.putResourcesIdle=e=>{Ip(this.playerApi,e)},this.playerApi=t,this.store=r;const{controller:{volume:i,muted:n,isAbrEnabled:s,videoTrackValue:a}}=this.store.getState();this.prevVideoTrackValue={isAbrEnabled:s,videoTrackValue:a},this.prevIsAbrEnabled=s,this.prevVolumeInfoPayload={volume:i,muted:n,changeReason:void 0},this.watchedTimeCounter=new Op.p}refreshCue(e){let{cueId:t,start:r,end:i}=e;const{ad:{originalBroadcastAdCues:n}}=this.store.getState(),s=Cp(n),a=s[t]||{start:r,end:i};void 0!==r&&(a.start=r),void 0!==i&&(a.end=i),s[t]=a,this.putOriginalBroadcastAdCues(s)}putOriginalBroadcastAdCues(e){this.store.setAdStateField(ml.originalBroadcastAdCues,e),this.updateOriginalAdState()}putIsAbrEnabled(e){if(this.prevIsAbrEnabled===e)return;this.prevIsAbrEnabled=e,this.store.setIsAbrEnabled(e);const{controller:{videoTrackValue:t}}=this.store.getState();this.putVideoTrackParams({videoTrackValue:t,isAbrEnabled:e})}putVideoTracks(e){const t=[...e].sort(Pn);this.store.setControllerStateField(vl.videoTracks,t),this.waitingForVideoTracks&&this.handleVideoTrackChange(),this.playerApi.callbacks.onVideoTracksChange(t)}putVideoTrackParams(e){let{isAbrEnabled:t,videoTrackValue:r}=e;const i={isAbrEnabled:t,videoTrackValue:r};if(nh()(i,this.prevVideoTrackValue))return;this.store.setVideoTrackParams({videoTrackValue:r,isAbrEnabled:t}),this.prevVideoTrackValue=i;const{controller:{videoTracks:n}}=this.store.getState();0!==n.length||void 0===i.videoTrackValue?this.handleVideoTrackChange():this.waitingForVideoTracks=!0}async handleVideoTrackChange(){this.waitingForVideoTracks=!1,await(0,Rp._)(0),this.playerApi.callbacks.onVideoTrackChange(Ye(this.store.getState()))}handlePlayingStateChange(){const{controller:{playingState:e},ad:{inStreamPlayingState:t}}=this.store.getState();this.updateWatchedTime(),void 0===t||t===Sa.END?this.playerApi.callbacks.onStateChange(e):this.playerApi.callbacks.onStateChange(t)}async requestMetaInfo(e,t){if(await(0,Rp._)(5e3),this.destroyed)return;const r=this.store.getState(),{ad:{adInfo:i},controller:{stream:n}}=r,s=function(e){const{controller:{stream:t}}=e;if(t)return void 0!==t.metaInfoUrl?t.metaInfoUrl:Zt(t.url)?kn(t.url).metaInfoUrl:void 0}(r);if(!i||!J(i)||i.params.startTimestamp!==e.params.startTimestamp||!n||!s)return;const{startProgramDateTime:a,startVideoTime:o,startTimestamp:l}=i.params,d=a+o,c=d+300,u=Math.round(1e3*(d+(Date.now()/1e3-l))),h=function(e,t,r){return e.replace(new RegExp("{{"+t+"}}","gm"),encodeURIComponent(r))}(s,"video-timestamp",String(u));let p;try{if(p=await t({method:"GET",url:h}),this.destroyed)return}catch(y){return this.playerApi.callbacks.onError(new ja({code:cs.META_INFO_REQUEST_FAILED,details:{url:h},isFatal:!1}).toJSON()),void this.refreshCue({end:c,cueId:i.params.cueId})}const f=function(e){try{return(0,Ys.H)(e)?JSON.parse(e):void 0}catch(yf){return}}(p.responseText);if(!(0,ys.K)(f))return;const{cutoff:m,cue_id:g}=f;if(g!==i.params.cueId)return;const v=(0,va.z)(m)?(u+m)/1e3:c;this.refreshCue({end:v,cueId:g}),this.requestMetaInfo(e,t)}updateWatchedTime(){const{controller:{currentTime:e,playingState:t,playbackRate:r,sourceId:i}}=this.store.getState();this.lastSourceId!==i&&(this.watchedTimeCounter.restoreLastUpdate(),this.lastSourceId=i);const n=function(e){let{ad:{adInfo:t}}=e;return void 0!==t&&Sp.includes(t.adType)}(this.store.getState());this.watchedTimeCounter.calc(e,r,t===Sa.PLAY&&!n),this.putWatchedTime(this.watchedTimeCounter.get())}async handlePostroll(){const e=this.playerApi.getMultiroll(),t=await e.postroll.loadViewers({});this.destroyed||(t.length>0&&await this.playerApi.playAdViewers(Oa.postroll,G(t,Oa.postroll),{}),(0,is.RW)("web_send_end_after_pause")?(this.playerApi.stop(),this.putPlayingState(Sa.END)):(this.putPlayingState(Sa.END),this.playerApi.stop()))}handleVideoTagPlayingStateChange(e){const{controller:{playingState:t,watchedTime:r}}=this.store.getState();if(t===e||t===Sa.END&&e===Sa.PAUSE)return;if(e===Sa.BUFFERING)return void this.putPlayingState(Sa.BUFFERING);if(t===Sa.BUFFERING&&e===Sa.PAUSE&&0===r||this.putStartStage(al.started),e!==Sa.END)return void this.putPlayingState(e);const i=this.store.getState(),{ad:{adInfo:n}}=i;ze(i)?xa.log("putPlayingState("+Sa.END+") has not been dispatched because ad("+(n&&n.adType)+") is playing"):this.handlePostroll()}putAdblockDetected(e){this.store.setAdStateField(ml.adblockDetected,e),dp(this.playerApi,e)}putVideoSize(e){this.store.setVideoSize(e),cp(this.playerApi,e)}putPlaybackRate(e,t){this.store.setControllerStateField(vl.playbackRate,e),t!==yl.PlaybackRateCatchupSelection&&function(e,t){e.callbacks.onPlaybackRateChange(t)}(this.playerApi,e)}enableTextTrack(){Sn(this.store,this.playerApi)}putAudioTrackValue(e){this.store.setControllerStateField(vl.audioTrackValue,e),up(this.store,this.playerApi,e)}putAudioTracks(e){this.store.setControllerStateField(vl.audioTracks,e),hp(this.playerApi,e)}putBufferingRanges(e){this.store.setControllerStateField(vl.bufferingRanges,e),pp(this.playerApi,e)}putErrorInfo(e){this.store.setControllerStateField(vl.errorInfo,e),function(e,t){let{error:r}=t;if(void 0===r)return;const{code:i,isFatal:n,details:s}=r;n?(xa.error(i,s),e.setFullscreen(!1)):xa.warn(i,s),e.callbacks.onError(r.toJSON())}(this.playerApi,e)}putIsFullscreen(e){this.store.setControllerStateField(vl.isFullscreen,e),fp(this.store,this.playerApi,e)}putIsPip(e){this.store.setControllerStateField(vl.isPip,e),An(this.store,this.playerApi)}putTextTrackEnabled(e){this.store.setControllerStateField(vl.textTrackEnabled,e),An(this.store,this.playerApi)}putNativeTextTrackVisibility(e){this.store.setControllerStateField(vl.nativeTextTrackVisible,e),An(this.store,this.playerApi)}putTextTracks(e){this.store.setControllerStateField(vl.textTracks,e),mp(this.playerApi,e)}putStream(e){this.store.setControllerStateField(vl.stream,e),gp(this.playerApi,e)}putLastKnownBandwidthEstimate(e){this.store.setControllerStateField(vl.lastKnownBandwidthEstimate,e),wp(this.store,this.playerApi,e)}putIsOnline(e){this.store.setControllerStateField(vl.isOnline,e),_p(this.store,this.playerApi,e)}putStreamsWithSupportInfo(e){this.store.setControllerStateField(vl.streamsWithSupportInfo,e),vp(this.playerApi,e)}putVideoType(e){this.store.setControllerStateField(vl.videoType,e),yp(this.playerApi,e)}putAdInfo(e){this.store.setAdStateField(ml.adInfo,e),Ep(this.playerApi,e)}putNextAdInfo(e){this.store.setAdStateField(ml.nextAdInfo,e),Ap(this.store,this.playerApi,e)}putWatchedTime(e){this.store.setControllerStateField(vl.watchedTime,e),this.handleMidroll()}putStartStage(e){this.store.setControllerStateField(vl.startStage,e),Tp(this,this.playerApi,e)}putEncoderState(e){this.store.setControllerStateField(vl.encoderState,e),function(e,t){const{controller:{encoderState:r}}=e.getState();r===ol.Attached&&_n(e,t)}(this.store,this.playerApi)}putAutoplay(e){this.store.setControllerStateField(vl.autoplay,e),_n(this.store,this.playerApi)}updateOriginalAdState(){!function(e,t){const r=e.getState(),{ad:{adInfo:i,originalBroadcastAdCueId:n},controller:{watchedTime:s}}=r,a=$(r);if(a&&J(i)){const n=X(r,a);if(n){const{startProgramDateTime:r,startVideoTime:s,startTimestamp:a}=i.params,o=n.end+15,l=Date.now()/1e3-a,d=r+s;if(o<l+d){const r={utc:d+l,videoTime:(0,va.z)(s)?s+l:void 0};return e.setControllerStateField(vl.startPosition,r),void t.stopAd({stopAdReason:La.CutOff})}}}if(a===n)return;let o;e.setAdStateField(ml.originalBroadcastAdCueId,a),void 0!==a?kp=s:o=s-kp,t.callbacks.onOriginalBroadcastAdStateChange({cueId:a,originalBroadcastAdDuration:o})}(this.store,this.playerApi)}destroy(){this.destroyed=!0,clearInterval(this.currentPostPauserollInterval)}}let Np;!function(e){e.ExternalApi="ExternalApi",e.InternalApi="InternalApi"}(Np||(Np={}));class Lp{constructor(e){let{initialState:t}=e;this.state=void 0,this.state=t}getState(){return this.state}removeCue(e){const{ad:t}=this.state,r=Cp(t.originalBroadcastAdCues);delete r[e],t.originalBroadcastAdCues=r}updateSourceId(){const{controller:e}=this.state;e.sourceId=e.sourceId+1}setVolumeInfo(e){let{volume:t,muted:r}=e;const{controller:i}=this.state;i.volume=t,i.muted=r}setVideoSize(e){let{videoWidth:t,videoHeight:r}=e;const{controller:i}=this.state;i.videoWidth=t,i.videoHeight=r}setIsAbrEnabled(e){const{controller:t}=this.state;t.isAbrEnabled=t.isAbrSupported&&e}setIsAbrSupported(e){const{controller:t}=this.state;t.isAbrSupported=e,t.isAbrEnabled=t.isAbrEnabled&&e}setVideoTrackParams(e){let{isAbrEnabled:t,videoTrackValue:r}=e;const{controller:i}=this.state;i.videoTrackValue=r,i.isAbrEnabled=t&&i.isAbrSupported}setUserAudioTrackParams(e){let{name:t,lang:r}=e;const{controller:i}=this.state;i.userAudioTrackName=t,i.userAudioTrackLang=r}setUserTextTrackParams(e){let{enabled:t,name:r,lang:i}=e;const{controller:n}=this.state;n.userTextTrackEnabled=t,n.userTextTrackName=r,n.userTextTrackLang=i}setUserVideoTrackParams(e){let{name:t,height:r}=e;const{controller:i}=this.state;i.userVideoTrackName=t,i.userVideoTrackHeight=r}setErrorInfo(e){const{controller:t}=this.state;var r;(!e||(r=e,!(0,js.Z)(r).length)||e.error&&e.error.isFatal)&&(t.errorInfo=e)}setSkinStateField(e,t){this.state.skin[e]=t}setAdStateField(e,t){this.state.ad[e]=t}setControllerStateField(e,t){const{controller:r}=this.state;r[e]=t}}const Mp=(0,Ms.N)(),Fp=!_a&&Xl("video/webm")?"data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAByhFNm3RAHU27i1OrhBVJqWZTrIHlTbuMU6uEFlSua1OsggEj7AEAAAAAAAC5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAADIq17GDD0JATYCNTGF2ZjU3Ljc2LjEwMFdBjUxhdmY1Ny43Ni4xMDBEiYhASwAAAAAAABZUrmsBAAAAAAAAYq4BAAAAAAAAWdeBAXPFgQGcgQAitZyDdW5khoZBX09QVVNWqoNjLqBWu4QExLQAg4EC4QEAAAAAAAARn4ECtYhA53AAAAAAAGJkgSBjopNPcHVzSGVhZAECOAGAuwAAAAAAH0O2dQEAAAAAAAAt54EAo4eBAACA/P/+o4eBABWA/P/+oAEAAAAAAAAPoYeBACkA/P/+daKDa3KD":"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAMm1kYXTeBABMYXZjNTcuMTA3LjEwMABCIAjBGDghEARgjBwhEARgjBwhEARgjBwAAAMbbW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAAAEsAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAkV0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAAEsAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAA1AAAEAAABAAAAAAG9bWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAADgZVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABaG1pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABLHN0YmwAAABqc3RzZAAAAAAAAAABAAAAWm1wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAANmVzZHMAAAAAA4CAgCUAAQAEgICAF0AVAAAAAAH0AAAAEYwFgICABRGQVuUABoCAgAECAAAAMHN0dHMAAAAAAAAABAAAAAEAAAQAAAAAAQAABBgAAAABAAAEAAAAAAEAAAHuAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAAEAAAAAQAAACRzdHN6AAAAAAAAAAAAAAAEAAAAGAAAAAYAAAAGAAAABgAAABRzdGNvAAAAAAAAAAEAAAAsAAAAGnNncGQBAAAAcm9sbAAAAAIAAAAB//8AAAAcc2JncAAAAAByb2xsAAAAAQAAAAQAAAABAAAAYnVkdGEAAABabWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAtaWxzdAAAACWpdG9vAAAAHWRhdGEAAAABAAAAAExhdmY1Ny44My4xMDA=";let xp;const Vp=function(e){return void 0===e&&(e=window),xp||(xp=e.document.createElement("div")),xp}(window),Up=(e,t)=>{const r="undefined"!==typeof Vp.style[e];if(r&&t&&(0,Ys.H)(t))try{Vp.style.cssText=e+": "+t+";";const r=Boolean(Vp.style.cssText);return Vp.style.cssText="",r}catch(yf){return!1}return r},Bp=["","webkit","moz","o","ms"],Hp={},jp=function(e){return void 0===e&&(e=""),Hp[e]||function(e){const t=""+e[0].toUpperCase()+e.slice(1);for(let r=0;r<Bp.length;r++){const i=Bp[r],n=i?""+i+t:e;if(Up(n))return Hp[e]=n}return Hp[e]=e}(e)},Wp=document.createElement("video"),Yp=Ls(window);class Gp extends Ia.v{get state(){return this.playerStore.getState()}constructor(e,t,r,n){var s;super(),s=this,this.plannedAdViewers=[],this.callbacks=void 0,this.videoController=void 0,this.multiroll=Jd,this.defineAutoplaySettingsDeferred=new ka.B,this.abortRequestAutoplaySettings=Xo.Z,this.onlineMonitor=new ic,this.playbackProgressStorage=new sc,this.visualState=void 0,this.container=void 0,this.video=void 0,this.videoSizeSensor=void 0,this.div=void 0,this.adDiv=void 0,this.playbackQualityController=void 0,this.playerStore=void 0,this.stateController=void 0,this.broadcastAd=void 0,this.playCallbacks=[],this.config=void 0,this.mediaInternalsHistory=void 0,this.currentAdPlaybackQueue=void 0,this.stopLoadSource=Xo.Z,this.onReady=void 0,this.preloaders=[],this.cachePreloaders=[],this.playDeferred=void 0,this.becameStarting=!1,this.canMuteForPlay=!0,this.destroyed=!1,this.handleAdEnd=void 0,this.stopAd=()=>Promise.resolve(),this.setHiddenControls=e=>{e.indexOf(Aa.ALL)>-1?this.playerStore.setSkinStateField(gl.hiddenControls,Ta):this.playerStore.setSkinStateField(gl.hiddenControls,e),this.videoController&&!this.playerStore.getState().ad.adInfo&&this.videoController.updateNativeControlsVisibility()},this.setPlaybackRate=e=>{var t;const{max:r,min:i}=Ge(this.state);null==(t=this.videoController)||t.setPlaybackRate(P(e,i,r),yl.Other)},this.seek=function(e,t){let{videoTime:r,utc:i}=e;if(void 0===t&&(t=!1),"number"===typeof i){const e=i-s.videoController.getUtcStartTime();s.seekToVideoPosition(e,t)}else"number"===typeof r&&s.seekToVideoPosition(r,t)},this.setVolume=e=>{if(void 0===this.videoController)return this.stateController.putVolumeInfo({muted:this.state.controller.muted,volume:e,changeReason:Ql.SetVolume}),void this.abortRequestAutoplaySettings(El.VolumeChange);const{muted:t,volume:r}=this.state.controller;let i=e,n=t;if(0===e){const{userVolume:e}=this.state.controller;i=e||r||1,n=!0}this.stateController.putVolumeInfo({volume:i,muted:n,changeReason:Ql.SetVolume}),this.currentAdPlaybackQueue&&ze(this.state)?this.currentAdPlaybackQueue.setVolume(e):this.videoController&&(this.videoController.setVolume(i),this.videoController.setMuted(n))},this.setMuted=e=>{const t={volume:this.state.controller.volume,muted:e,changeReason:Ql.SetMuted};if(!this.videoController)return this.stateController.putVolumeInfo(t),void this.abortRequestAutoplaySettings(El.MuteChange);this.stateController.putVolumeInfo(t),this.currentAdPlaybackQueue&&ze(this.state)?this.currentAdPlaybackQueue.setVolume(e?0:this.state.controller.volume):this.videoController&&this.videoController.setMuted(e)},this.playInrollAd=e=>{this.multiroll.inroll.schedule(Fn({},e,{timeOffset:(null==e?void 0:e.timeOffset)||0}))},this.playAdViewers=async(e,t,r,i)=>{xe("player.adsdk.empty."+e),xe("player.adsdk.start."+e),xe("player.adsdk.fail."+e);try{await this.initAdPlaybackQueue(e),await this.playAdViewersInternal(e,t,r,i)}catch(yf){xe("player.adsdk.fail."+e),it({reason:"PLAY_AD_VIEWERS_ERROR",adSdkVersion:oe(),adSdkLoaderVersion:ae(),adblockDetected:this.state.ad.adblockDetected,adType:e,bandwidth:tr(void 0)}),this.onError(ja.from(yf,{code:cs.PLAY_AD_VIEWERS_ERROR,isFatal:!1,details:{adType:e,adViewersWithData:t,adDisplayConfig:r}}))}},this.defineAutoplaySettingsAndLoadSource=()=>{const e=this.config.source,t=this.playerStore.getState(),{initialAutoplay:r,allowMuted:i,muted:n,volume:a,togglePlaybackOnVisibilityChangeSetting:o}=t.controller;this.defineAutoplaySettings(this.video,{autoplay:r,muted:n||0===a,allowMuted:!(!o||!o.forceAutoplay)||i}),this.loadSource(e,{shouldSaveProgress:!1}).catch(e=>{xa.error("load source error",e),cr(e,zl.INIT),this.onError(e)}).then(()=>{this.onReady(),this.state.controller.autoplay||this.stateController.putResourcesIdle(!0)}).then(()=>{void 0!==e.params.adConfig&&(ss.I?(0,el.W)({method:"GET",url:tl.z,retries:2,checkStatus:e=>e>=200&&e<400}).then(e=>{if(-1===e.responseText.trim().indexOf('<VAST version="3.0">'))throw new Error("Invalid XML in response from ["+tl.z+"]")}):Promise.resolve()).catch((function(e){let{message:t}=void 0===e?{}:e;s.stateController.putAdblockDetected(!0),s.onError(new ja({code:cs.STRM_ABD_INVALID_RESPONSE,isFatal:!0,details:{reason:t}}))}))})},this.subscribeHandlers=()=>{this.onlineMonitor.on("Online",()=>{this.playerStore.setControllerStateField(vl.isOnline,!0),ze(this.state)||this.videoController&&this.videoController.onOnline(),this.callbacks.onExpectedStalledChange({reason:Da.Offline,details:void 0})}),this.onlineMonitor.on("Offline",()=>{this.playerStore.setControllerStateField(vl.isOnline,!1),this.videoController&&this.videoController.onOffline()}),this.on("VideoTypeChange",e=>{this.stateController.putVideoType(e)}),this.on("DurationChange",e=>{this.playerStore.setControllerStateField(vl.duration,e),this.videoController.updateDVRParams(),this.updateVideoInfo()}),this.on("DvrChange",()=>{this.updateVideoInfo()}),this.on("ProgramDateTimeChange",e=>{this.playerStore.setControllerStateField(vl.programDateTime,e)}),this.on("CurrentTimeChange",this.handleVideoControllerCurrentTimeChange),this.on("BufferingRangesChange",e=>{this.stateController.putBufferingRanges(e)}),this.on("VideoTrackValueChange",e=>{this.stateController.putVideoTrackParams({videoTrackValue:e,isAbrEnabled:this.state.controller.isAbrEnabled})}),this.on("VideoTracksChange",e=>{this.stateController.putVideoTracks(e)}),this.on("AudioTrackValueChange",e=>{this.stateController.putAudioTrackValue(e)}),this.on("AudioTracksChange",e=>{this.stateController.putAudioTracks(e)}),this.on("TextTrackValueChange",e=>{const{controller:{textTrackEnabled:t,textTrackValue:r}}=this.state,i=void 0!==e,n=void 0===e?r:e;this.stateController.putTextTrackEnabled(i),this.playerStore.setControllerStateField(vl.textTrackValue,n);if((t?r:void 0)===(i?e:void 0))return;const s=i?je(this.state):void 0;this.callbacks.onTextTrackChange(s)}),this.on("TextTracksChange",e=>{this.stateController.putTextTracks(e)}),this.on("VideoPlayingStateChange",e=>{this.stateController.handleVideoTagPlayingStateChange(e)});const e=this.logCanPlay(zl.INIT);this.once("CanPlay",e),this.once("SetSource",()=>this.off("CanPlay",e));const t=this.logLoadStartHavingCurrentData(zl.INIT);this.once("LoadedData",t),this.once("SetSource",()=>this.off("LoadedData",t)),this.once("Destroy",()=>{this.off("ContentImpression")});const r=f(this.getContainerDocument(),e=>{this.playerStore.setControllerStateField(vl.isDocumentVisible,e)});var i;this.once("Destroy",r),this.once("Destroy",(i=e=>{this.callbacks.logEvent({event:Ca.DrmSystemsSupportDetected,params:e})},void 0===xd?(Fd.push(i),()=>{const e=Fd.indexOf(i);-1!==e&&Fd.splice(e,1)}):(i(xd),Xo.Z)))},this.setBackgroundImage=e=>{this.div.style.backgroundImage=e?"url('"+e+"')":""},this.setBackgroundVisibility=e=>{this.div.style.backgroundSize=e?"contain":"0  0"},this.shouldCaptureScreenshot=()=>{var e;return(0,is.RW)("web_yasp_screenshot_capturing")&&this.videoController&&this.videoController.engine===Cl.YASP&&this.state.controller.videoType===cl.Z.VOD&&!(null!=(e=this.state.controller.stream)&&e.drmConfig)},this.playAdViewersInternal=async(e,t,r,i)=>{if(!this.currentAdPlaybackQueue)return;const n=this.currentAdPlaybackQueue,{ad:{adInfo:s}}=this.state,a=this.getAdViewersWithData(t),o=a.map(e=>{let{adViewer:t}=e;return t}),l=function(e){return e.reduce((e,t)=>e+Math.max(Math.floor(t.getAdPodsCount())),Math.max(Math.floor(0)))}(o);if(0===l)return Ve("player.adsdk.empty."+e),it({reason:"NO_AD_PODS_TO_PLAY_AD",adSdkVersion:oe(),adSdkLoaderVersion:ae(),adblockDetected:this.state.ad.adblockDetected,adType:e,bandwidth:tr(void 0)}),void this.callbacks.logEvent({event:"NoAdPodsToPlayAd",params:void 0});s&&!i&&this.onError(new ja({code:cs.AD_IS_ALREADY_PLAYING,isFatal:!1,details:{currentAdType:s.adType,adType:e}})),this.prepareBeforeOrAfterAd(!1,e),this.callbacks.logEvent({event:"PlayAdViewers",params:{adType:e,adPodsCount:l}});const d=e===Oa.inroll?{cueId:this.getAdViewersCueId(e,t),startProgramDateTime:this.state.controller.programDateTime/1e3,startVideoTime:this.videoController?this.videoController.getCurrentTime():this.state.controller.currentTime,startTimestamp:Date.now()/1e3}:{};let c=!1;const u=(0,ma.I)(async t=>{let{stopAdReason:r}=t;this.shouldCaptureScreenshot()&&(this.resetPosterFitStyle(),this.setBackgroundVisibility(!0),this.once("CanPlay",()=>{this.setBackgroundImage(),this.videoController.clearScreenshot()}));const i=this.state.ad.inStreamPlayingState;c=!0,this.currentAdPlaybackQueue&&(this.currentAdPlaybackQueue.destroy(r),this.currentAdPlaybackQueue=void 0),this.stateController.updateAdInfo(void 0),this.callbacks.onExpectedStalledChange({reason:Da.AdEnd,details:{adType:e}}),this.prepareBeforeOrAfterAd(!0,e);const n=async()=>{xe("encoder.attach");try{await this.attachEncoder()}catch(yf){xa.error(yf)}finally{Ve("encoder.attach",{additional:{engine:this.state.controller.engine}})}};r!==La.LoadSource&&r!==La.PlayerDestroy&&await n(),e!==Oa.postroll&&(xa.log("videoController.play()"),i!==Sa.PAUSE&&(0,Kn.v)(this.videoController.play()))});this.stopAd=u;const h=Q(o)+n.getQueueDuration(),p=this.currentAdPlaybackQueue.getUtcPositionBeforeAd(),f=this.getSeekPositionAfterAd({adType:e,adViewersDuration:h,utcPosition:p});this.playerStore.setControllerStateField(vl.startPosition,f),this.prepareBeforeAd(e),(()=>{this.stateController.updateAdInfo({adType:e,params:d})})(),c||(a.forEach(t=>{let{adViewer:i,additionalData:s,adType:a}=t;n.playAdViewers({adType:e,adPodType:a,adViewer:i,additionalData:s,adDisplayConfig:r,adElement:this.adDiv,posterUrl:this.getPosterUrlForAd()})}),this.plannedAdViewers=[],await n.getDestroyPromise(),this.handleAdEnd&&await this.handleAdEnd(),c||await this.stopAd({stopAdReason:La.AdCompleted}))},this.handleVideoControllerCurrentTimeChange=e=>{if(this.state.controller.encoderState!==ol.Attached)return;!(e<.5&&this.state.controller.engine===Cl.NATIVE&&this.state.controller.videoType===cl.Z.LIVE)&&(this.stateController.putCurrentTime(e),this.playerStore.getState().ad.adInfo||this.playbackProgressStorage.saveProgress(e)),this.videoController.updateDVRParams(),this.updateVideoInfo()},this.handleVisualStateChange=e=>{let{isPip:t,isFullScreen:r,isVisible:i}=e;this.stateController.putIsFullscreen(r);const{isSupportedPipMode:n,isYandexPipMode:s,isVisibilitySupported:a}=this.visualState;this.emit("VisualStateChange",Fn({isPip:t,isVisible:i,isFullScreen:r,isSupportedPipMode:n,isYandexPipMode:s,isVisibilitySupported:a},this.videoSizeSensor.getSize())),n&&!s&&(this.stateController.putIsPip(t),a&&this.playerStore.setControllerStateField(vl.isVisible,i))},this.onRecover=e=>{this.callbacks.onRecover(Fn({},e,this.getSyncDebugInfo()))},this.logLoadStartHavingCurrentData=e=>()=>{if(!xs){if(this.video.readyState<this.video.HAVE_CURRENT_DATA){const t=this.logLoadStartHavingCurrentData(e);return this.once("LoadedData",t),void this.once("SetSource",()=>this.off("LoadedData",t))}this.isCanPlayAndStartHavingCurrentDataLog()&&this.emit("ContentImpression")}},this.logCanPlay=e=>()=>{xs||this.isCanPlayAndStartHavingCurrentDataLog()&&(this.callbacks.logEvent({event:Ca.CanPlay,params:{stage:e}}),this.emit("ContentImpression"))},this.isCanPlayAndStartHavingCurrentDataLog=()=>!this.state.ad.hasPreroll&&this.state.controller.preload,this.startStream=()=>this.state.controller.encoderState===ol.Attached?Promise.resolve():this.attachEncoder().catch(xa.error),this.handleFirstContentImpression=()=>{this.resetPosterFitStyle();const{controller:e}=this.playerStore.getState(),t=e.videoTracks.find(t=>{let{value:r}=t;return r===e.videoTrackValue});(0,Es.I8)({browserRtt:nr(Y()),calcRtt:nr(mr())}),at(this.videoController.engine,{videoType:e.videoType,bandwidth:tr(t&&t.bitrate),startWithCapping:Xe(t,this.videoController)},this.state.ad.adSyncInit),this.callbacks.logEvent({event:Ca.ContentImpression,params:{}}),this.callbacks.onContentImpression({hasPreroll:this.state.ad.adSyncInit,engine:this.state.controller.engine}),this.stateController.putResourcesIdle(!0),this.hidePoster()},this.setMaxListeners(14),this.container=e,this.config=t,this.onReady=(0,ma.I)(n);const a=t.source,{params:o}=a,{additionalParams:l}=o,d=t.volume,{togglePlaybackOnVisibilityChange:c}=t;this.callbacks=t.callbacks;const{autoplay:u}=t,h=t.hidden;t.debug&&xa.enableConsole(),this.div=document.createElement("div"),this.div.className=sp().locals.StreamPlayer,(0,Ys.H)(t.backgroundColor)&&(this.div.style.backgroundColor=t.backgroundColor),this.adDiv=document.createElement("div"),this.adDiv.className=sp().locals.StreamPlayer_ui,this.div.tabIndex=-1,this.container.appendChild(this.div),this.container.appendChild(this.adDiv);const m=Boolean(t.allowMuted),g=Fn({},t);delete g.callbacks;const v={controller:Fn({},ll,{autoplay:u,initialAutoplay:u,allowMuted:m,preload:t.preload,from:l.from,vsid:l.vsid,volume:t.volume,muted:t.muted,userVolume:void 0===t.volume?NaN:d,isFullscreen:!1,togglePlaybackOnVisibilityChangeSetting:c,isDocumentVisible:p(this.getContainerDocument()),isOnline:!0,isAbrEnabled:t.autoQuality,defaultQuality:t.defaultQuality,feed:t.feed,preview:o.preview,posterStyle:o.posterStyle,playerConfig:g}),ad:Fn({},rl,{adblockDetected:ss.I,nativeAdControlsVisibility:t.useNativeAdControls}),skin:Fn({},dl,{hiddenControls:h,useNativeSubtitles:!0,nativeControlsVisibility:!j(h)})},y=new Lp({initialState:v}),E=new Dp({store:y,playerApi:this});this.playerStore=y,this.stateController=E,this.once("Destroy",()=>this.stateController.destroy()),this.updateRumInfo();const S=this.container.getElementsByTagName("video")[0]||function(){const e=document.createElement("video");return window.parent&&window.parent.HTMLVideoElement&&ap(HTMLMediaElement.prototype,window.parent.HTMLVideoElement.prototype),e}();this.video=S,S.poster||(S.poster=Ra),this.playbackQualityController=new Dc(S),this.mediaInternalsHistory=new rc(S);const A=gr(S);this.div.appendChild(S),A();const T=this.getContainerDocument().getElementsByTagName("head")[0];!function(e,t){const r=document.createElement("style");r.textContent+=e,t?t.appendChild(r):i(window).appendChild(r)}(sp().toString(),T),D(S,sp().locals.player__video),this.videoSizeSensor=new pa(S),(0,Jn.Y)(()=>window.Ya.Rum.sendHeroElement()),S.setAttribute("playsinline","playsinline"),S.setAttribute("webkit-playsinline","webkit-playsinline"),this.visualState=r.visualState,this.visualState.setVideoElement(S),this.on("VisualStateChange",e=>{e&&this.callbacks.onVisualStateChange(e)});const b=function(e,t,r){let i,n=0;const s=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];e.call(r,...i)};return function(){const e=Date.now(),r=e-n;clearTimeout(i);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];r<t?i=window.setTimeout(s,t-r,...o):(n=e,s(...o))}}(e=>{let{width:t,height:r}=e;this.emit("VisualStateChange",Fn({},this.visualState.getState(),{width:t,height:r}))},500);this.videoSizeSensor.onResize.add(e=>{let{width:t,height:r}=e;return b({width:t,height:r})}),b(this.videoSizeSensor.getSize()),this.once("Destroy",()=>this.videoSizeSensor.destroy()),c&&this.visualState.isYandexPipMode&&hr(window,!1,this.video),this.visualState.observe(this.handleVisualStateChange),this.handleVisualStateChange(this.visualState.getState()),this.defineAutoplaySettingsAndLoadSource(),this.initTelemetryTracking(),(0,is.RW)("web_ios_landscape_fix")&&this.iosLandscapeScreenOrientationWorkaround(),Promise.resolve().then(()=>{this.initEventSubscribes(t,S)})}initTelemetryTracking(){this.callbacks.onCapSizeChange(this.getMaxCapAllowedVideoTrack());const e=()=>{const e=this.getMaxCapAllowedVideoTrack();this.callbacks.onCapSizeChange(e)},t=()=>{const e=this.getBandwidthEstimate();e&&this.callbacks.onBandwidthEstimateChange(e)},r=e=>{this.callbacks.onPlaybackQualityUpdate(e)};this.once("Destroy",()=>{this.off("CanPlay",t),this.off("CanPlay",e),this.off("VideoTracksChange",e),this.off("VisualStateChange",e),this.off("VideoTrackValueChange",e),this.off("PlaybackQualityUpdate",r)}),this.on("PlaybackQualityUpdate",r),this.on("CanPlay",t),this.on("CanPlay",e),this.on("VideoTracksChange",e),this.on("VisualStateChange",e),this.on("VideoTrackValueChange",e)}recoverStream(){return this.videoController?this.videoController.recoverStream():Promise.resolve()}getRecoverHelper(){var e;if(this.videoController)return null==(e=this.videoController)?void 0:e.recoverHelper}toggleNativeSubtitles(e){var t;null==(t=this.videoController)||t.toggleNativeSubtitles(e)}updateVideoControllerNativeControlsVisibility(){var e;null==(e=this.videoController)||e.updateNativeControlsVisibility()}getMultiroll(){return this.multiroll}setPictureInPictureEnabled(e){hr(window,e,this.video)}getRemainingBufferedTime(){var e,t;return null!=(e=null==(t=this.videoController)?void 0:t.getRemainingBufferedTime())?e:{total:0}}getVideoPlaybackQuality(){return this.playbackQualityController.getPlaybackQuality()}getCapSizes(){var e;return null==(e=this.videoController)?void 0:e.getCapSizes()}getMaxCapAllowedVideoTrack(){if(this.videoController)return this.videoController.getMaxCapAllowedVideoTrack()}getContainerSize(){var e;const t=null!=(e=this.visualState.getPipWindowSize())?e:this.videoSizeSensor.getSize();return{width:t.width*devicePixelRatio,height:t.height*devicePixelRatio}}getVideoTrack(){return Ye(this.state)}getAudioTrack(){return He(this.state)}getTextTrack(){return function(e){const{textTrackEnabled:t}=e.controller;if(t)return je(e)}(this.state)}setNativeTextTrackVisibility(e){this.stateController.putNativeTextTrackVisibility(e)}setNativeAdControlsVisibility(e){this.playerStore.setAdStateField(ml.nativeAdControlsVisibility,e)}getLiveLatency(){var e;return null==(e=this.videoController)?void 0:e.getLiveLatency()}getVideoType(){return this.state.controller.videoType}getTimelineInfo(){const{controller:{duration:e,currentTime:t},skin:{skinDVRStartTime:r,skinDVRDuration:i}}=this.state;return{currentTime:t,duration:e,utcStartTime:this.getUtcStartTime(),dvrStartTime:r,dvrDuration:i}}getPreloadDetails(){const{preloadDetails:e}=this.state.controller;if((null==e?void 0:e.preloadingMethod)!==Yl.Internal)return e}getBandwidthEstimate(){var e,t;return null!=(e=null==(t=this.videoController)?void 0:t.getBandwidthEstimate())?e:this.state.controller.lastKnownBandwidthEstimate}setVideoStyle(e){this.playerStore.setControllerStateField(vl.videoElementStyle,e),Mn(this.video,e)}setSource(e,t){let{shouldSaveProgress:r=!1}=void 0===t?{}:t;this.loadSource(e,{shouldSaveProgress:r}).catch(e=>{cr(e,zl.SET_SOURCE),this.onError(e)}),this.emit("SetSource",e);const i=this.logCanPlay(zl.SET_SOURCE);this.once("CanPlay",i),this.once("SetSource",()=>this.off("CanPlay",i));const n=this.logLoadStartHavingCurrentData(zl.SET_SOURCE);this.once("LoadedData",n),this.once("SetSource",()=>this.off("LoadedData",n))}getSourceId(){return this.playerStore.getState().controller.sourceId}getUtcPosition(){var e,t;return null!=(e=null==(t=this.videoController)?void 0:t.getUtcPosition())?e:0}planAdViewers(e){this.plannedAdViewers=e}play(){var e,t;if(this.performPlayCallbacks(),(0,Kn.v)(this.video.play()),this.state.controller.startStage!==al.started&&this.stateController.putStartStage(this.becameStarting?al.starting:al.init),this.currentAdPlaybackQueue&&ze(this.state))return this.currentAdPlaybackQueue.resumeAd(),null==(e=this.playDeferred)||e.resolve(),Promise.resolve();if(this.plannedAdViewers.length>0)return this.playAdViewers(Oa.postPauseroll,this.plannedAdViewers,{}),null==(t=this.playDeferred)||t.resolve(),Promise.resolve();if(this.state.controller.autoplay||(this.stateController.putAutoplay(!0),this.abortRequestAutoplaySettings(El.ApiPlay)),!this.videoController||this.state.controller.encoderState!==ol.Attached)return this.playDeferred||(this.playDeferred=new ka.B,this.playDeferred.promise.catch(Xo.Z).then(()=>this.playDeferred=void 0)),this.playDeferred.promise;const r=this.videoController.getCurrentTime(),i=this.videoController.getDuration();i>0&&r>=i&&this.seek({videoTime:0}),xa.log("StreamPlayer.play() -> videoController.play()");const n=this.state.controller.startStage===al.starting||this.state.controller.startStage===al.started?this.videoController.play():this.tryToPlay(this.videoController);return n.then(()=>{var e;return null==(e=this.playDeferred)?void 0:e.resolve()},()=>{var e;null==(e=this.playDeferred)||e.reject(void 0),this.state.controller.startStage===al.init&&this.stateController.putStartStage(al.waitForUserPlay)}),n}pause(){var e;rt(),this.stateController.putResourcesIdle(!0),this.emit("PauseCalled"),this.video.pause(),this.state.controller.startStage!==al.started&&(this.stateController.putAutoplay(!1),this.stateController.putStartStage(al.waitForUserPlay)),null==(e=this.playDeferred)||e.reject(new Error("playing rejected cause of #pause()")),this.currentAdPlaybackQueue&&ze(this.state)?this.currentAdPlaybackQueue.pauseAd():(this.stateController.putAutoplay(!1),this.videoController&&this.state.controller.encoderState===ol.Attached&&this.videoController.pause())}setVideoTrack(e){const t=this.getVideoTrack();if(yn(t,e))return;this.stateController.putIsAbrEnabled(e===Pl.value);const r=e===Pl.value&&this.state.controller.isAbrSupported?Pl:this.state.controller.videoTracks.find(t=>t.value===String(e));if(r===Pl&&(0,is.RW)("web_userquality_ttl")&&lp.ZP.removeItem("videoplayer-user-quality-choice"),r&&r!==Pl&&r.height&&r.width){const e={height:Math.min(r.height,r.width),width:Math.max(r.height,r.width)};(0,is.RW)("web_userquality_ttl")&&(e.timestamp=Date.now()),lp.ZP.setItem("videoplayer-user-quality-choice",JSON.stringify(e))}this.playerStore.setUserVideoTrackParams({name:r&&r.value!==Pl.value&&r.name||void 0,height:r&&r.height?r.height:void 0}),r&&(this.videoController.setVideoTrack(r),this.callbacks.onExpectedStalledChange({reason:Da.VideoTrackChange,details:{newTrack:r,oldTrack:t}}),xa.log("SELECTED VIDEO TRACK: ",r))}setAudioTrack(e){const t=this.getAudioTrack();if(yn(t,e))return;const r=this.state.controller.audioTracks.find(t=>t.value===String(e));r&&(this.playerStore.setUserAudioTrackParams({name:r.name||void 0,lang:r.lang||void 0}),this.videoController.setAudioTrack(r),this.callbacks.onExpectedStalledChange({reason:Da.AudioTrackChange,details:{newTrack:r,oldTrack:t}}),xa.log("SELECTED AUDIO TRACK: ",r))}getSyncDebugInfo(){var e,t;return{recoverHelperState:null!=(e=null==(t=this.videoController)?void 0:t.getRecoverHelperState())?e:ql.OFF,state:this.state,remainingBufferedTime:Ke(this.state),mediaInternalsHistory:this.mediaInternalsHistory.getHistory()}}async requestDebugInfo(){return Fn({},this.getSyncDebugInfo(),{videoController:this.videoController?await this.videoController.requestDebugInfo():{noController:!0}})}getState(){return this.state}setTextTrack(e){const{textTracks:t,userTextTrackLang:r,userTextTrackName:i,textTrackEnabled:n,textTrackValue:s}=this.state.controller;if(n&&s===e)return;if(e===kl.A)return void this.stateController.enableTextTrack();const a=void 0===e?void 0:t.find(t=>t.value===e),o={enabled:Boolean(a),lang:a?a.lang||void 0:r,name:a?a.name||void 0:i};this.playerStore.setUserTextTrackParams(o),a?(this.videoController.setTextTrack(a),xa.log("SELECTED TEXT TRACK: ",a)):(this.videoController.disableTextTrack(),xa.log("DISABLE TEXT TRACK"))}setFullscreen(e){if(e)try{this.visualState.changeFullscreenState({isFullScreen:!0})}catch(yf){xa.error("Request fullscreen for element:",yf)}else try{this.visualState.changeFullscreenState({isFullScreen:!1})}catch(yf){xa.error("Exit fullscreen for element:",yf)}}async destroy(){this.stopAd({stopAdReason:La.PlayerDestroy}),this.stopLoadSource(Kl.destroy),this.multiroll.destroy(),this.currentAdPlaybackQueue&&this.currentAdPlaybackQueue.destroy(La.PlayerDestroy),this.onlineMonitor.destroy(),this.visualState.destroy(),this.mediaInternalsHistory.destroy(),this.playbackQualityController.destroy(),this.destroyed=!0,this.emit("Destroy"),await this.destroyVideoController(),await Iu.destroy(),function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(this.container)}skipAdPod(){var e;null==(e=this.currentAdPlaybackQueue)||e.skipAdPod()}stop(){this.seek({videoTime:0}),this.pause(),this.videoController.engine===Cl.NATIVE&&0===this.video.buffered.length&&this.video.load()}preloadSource(e){this.callbacks.logEvent({event:Ca.PreloadSource,params:{source:e,reason:Np.ExternalApi},sourceIndex:e.sourceIndex});let t=Xo.Z,r=Xo.Z,i=!1;return{promise:this.preloadSourceImpl(e,()=>i,e=>t=e,e=>r=e),abort:()=>{i||(i=!0,t())},end:()=>r()}}initEventSubscribes(e,t){this.waitForPlayOccurred().then(()=>{const{startStage:e}=this.state.controller;[al.started,al.broken,al.destroyed].includes(e)||(this.stateController.putStartStage(al.starting),this.becameStarting=!0)}).catch(Xo.Z),Fs&&this.once("Destroy",mn(()=>this.destroy())),Iu.messenger.on("yasp-event",e=>{let{name:t,data:r}=e;return this.callbacks.logEvent({event:t,params:r})}),this.once("Destroy",(0,Vs.O)(this.div,"selectstart",e=>{e.preventDefault(),e.stopPropagation()})),this.once("Destroy",x(()=>{this.stateController.updateOriginalAdState()})),this.once("Destroy",(0,Vs.O)(this.getMainContainer(),"click",t=>{this.state.controller.watchedTime>0||void 0===this.state.ad.inStreamPlayingState&&e.shouldPlayOnFirstClick&&this.play()},{once:!0})),Fs&&this.once("Destroy",mn(()=>this.destroy())),this.once("Destroy",()=>this.off("VisualStateChange")),this.once("Destroy",(0,Vs.O)(this.video,"volumechange",()=>{(this.videoController||this.currentAdPlaybackQueue)&&this.updateVolumeInfo()})),this.subscribeHandlers()}updateRumInfo(){const{controller:e}=this.state;(0,Es.I8)({apiVersion:2,bundle:"modern",slowConnection:this.config.slowConnection,vsid:e.vsid,from:e.from,saveData:(0,ec.R)()})}requestAutoplaySettings(e,t){const r={stopped:!1},i=()=>{r.stopped=!0},n=Nn(e,{initialMuted:t.muted,checkUnmuted:t.autoplay&&!t.muted,checkMuted:t.autoplay&&(t.muted||t.allowMuted),process:r});return ga(n)?{promise:n.then(e=>({autoplay:e.allowed,muted:e.muted||t.muted,detectionMethod:e.detectionMethod})),abort:i}:{promise:{autoplay:n.allowed,muted:n.muted||t.muted,detectionMethod:n.detectionMethod},abort:i}}defineAutoplaySettings(e,t){if(this.state.controller.autoplay&&!this.state.controller.isDocumentVisible)return this.stateController.putStartStage(al.waitForDocumentVisibility),this.stateController.putAutoplay(!1),void this.defineAutoplaySettingsDeferred.resolve();let r;A("detect.autoplay");const{promise:i,abort:n}=this.requestAutoplaySettings(e,t);ga(i)?i.then(()=>{T("detect.autoplay")}):T("detect.autoplay");const{promise:s,clear:a}=Ea(500);s.then(()=>{this.state.controller.startStage===al.init&&this.stateController.putStartStage(al.waitForUserPlay)});const o=(0,ya.u)();this.abortRequestAutoplaySettings=e=>{void 0===r&&this.callbacks.logEvent({event:"PlayWithoutRAAResults",params:{delay:o(),reason:e}}),a(),n()};const l=e=>{r=e,this.callbacks.logEvent({event:e.autoplay?"AutoplayAllowed":"AutoplayDisabled",params:{message:JSON.stringify(null!=e?e:t),autoplaySettingsRequestResult:e,initialAutoplayParams:t}}),a();const{isVisible:i}=this.state.controller;xa.log("Autoplay settings defined",r);const{muted:n,autoplay:s,autoplayImpossible:o,requireAllowMutedToAutoplay:l}=(()=>{const i=e.muted&&(t.muted||t.allowMuted),n=e.autoplay&&(e.muted?i:t.autoplay);return Fn({},r,{muted:i,autoplay:n})})();this.stateController.putVolumeInfo({muted:n,volume:this.state.controller.volume,changeReason:Ql.RequestAutoplaySettings});const d=function(e){const{controller:{togglePlaybackOnVisibilityChangeSetting:t,muted:r}}=e;return!!t&&!(t.onlyMuted&&!r)}(this.state)&&!1===i;d&&this.callbacks.logEvent({event:"HiddenAutoplayPrevented",params:{autoplaySettingsRequestResult:r}});const c=s&&!d&&this.state.controller.autoplay;var u;(xa.log("autoplay status:",s),xa.log("isVisible",i),xa.log("preventHiddenAutoplay",d),c||this.stateController.putStartStage(al.waitForUserPlay),c)?this.playerStore.setControllerStateField(vl.preload,!0):(rt(),null==(u=this.playDeferred)||u.reject(new Error("playing rejected cause of autoplay-false")));if(this.playerStore.setControllerStateField(vl.autoplay,c),o){this.playerStore.setControllerStateField(vl.autoplayImpossible,!0),this.callbacks.logEvent({event:"AutoplayImpossible",params:{message:JSON.stringify(r),autoplaySettingsRequestResult:r}});try{console.warn("Cannot autoplay video"+(l?" with sound":"")+" in this environment."+(l?" Use autoplay={allowMuted: true} if you prefer mute video and enable autoplay.":""))}catch(h){}}};if(ga(i))i.then(l).catch(Xo.Z).then(()=>{this.defineAutoplaySettingsDeferred.resolve()});else try{l(i)}finally{this.defineAutoplaySettingsDeferred.resolve()}}createVideoController(e,t){let{stream:r,supportInfo:i}=e;const n={playerStore:this.playerStore,stateController:this.stateController,video:this.video,videoSizeSensor:this.videoSizeSensor,stream:r,sourceParams:t,debug:this.config.debug,liveOffset:this.config.liveOffset,slowConnection:this.config.slowConnection,maxBufferLength:this.config.maxBufferLength,defaultQuality:this.state.controller.defaultQuality,skippableFragments:t.skippableFragments,bandwidthEstimateOffset:this.config.bandwidthEstimateOffset,perfLogUrl:this.config.perfLogUrl,setPlayerBackgroundImage:this.setBackgroundImage,setPlayerBackgroundVisibility:this.setBackgroundVisibility,onError:e=>this.onError(e),onRecover:this.onRecover,logEvent:this.callbacks.logEvent,onSubtitlesChange:this.callbacks.onSubtitlesChange,onThumbnailTileGeneralMetaInfoChange:this.callbacks.onThumbnailTileGeneralMetaInfoChange,onExpectedStalledChange:this.callbacks.onExpectedStalledChange,getPipWindowSize:()=>this.visualState.getPipWindowSize()},s=(a=i.engine,o=n,l=this.getPreloader(r,t),a===Cl.HLS?new _h(o):a===Cl.MP4?new Dh(o):a===Cl.YASP?new tp(o,l):new Wh(o));var a,o,l;this.cleanCachePreloaders();const d=e=>{this.videoController=e,this.playerStore.setControllerStateField(vl.engine,i.engine),this.callbacks.onEngineChange(i.engine,this.playerStore.getState().controller.sourceId),(0,Es.Z$)("engine",i.engine),e.on("VideoPlayingStateChange",e=>this.emit("VideoPlayingStateChange",e)),e.on("MetadataChange",e=>this.emit("MetadataChange",e)),e.on("CurrentTimeChange",e=>this.emit("CurrentTimeChange",e)),e.on("DurationChange",e=>this.emit("DurationChange",e)),e.on("DvrChange",()=>this.emit("DvrChange")),e.on("DVRDurationChange",e=>this.callbacks.onDVRDurationChange(e)),e.on("DVRStartTimeChange",e=>this.callbacks.onDVRStartTimeChange(e)),e.on("ProgramDateTimeChange",e=>this.emit("ProgramDateTimeChange",e)),e.on("BufferingRangesChange",e=>this.emit("BufferingRangesChange",e)),e.on("CanPlay",()=>this.emit("CanPlay")),e.on("ContentImpression",()=>this.emit("ContentImpression")),e.on("DrmSystemChange",this.callbacks.onDrmSystemChange),e.on("LoadedData",()=>this.emit("LoadedData")),e.on("VideoTypeChange",e=>this.emit("VideoTypeChange",e)),e.on("VideoTrackValueChange",e=>{this.emit("VideoTrackValueChange",e)}),e.on("AudioTrackValueChange",e=>this.emit("AudioTrackValueChange",e)),e.on("TextTrackValueChange",e=>this.emit("TextTrackValueChange",e)),e.on("VideoTracksChange",e=>this.emit("VideoTracksChange",e)),e.on("AudioTracksChange",e=>this.emit("AudioTracksChange",e)),e.on("TextTracksChange",e=>this.emit("TextTracksChange",e))};return ga(s)?Promise.resolve().then(async()=>d(await s)):d(s)}cleanCachePreloaders(){for(;this.cachePreloaders.length>0&&this.config.cacheSourcesCount<this.cachePreloaders.length;)this.cachePreloaders[0].destroy(),this.cachePreloaders.splice(0,1)}getPreloader(e,t){const r=rr(e.url),i=this.preloaders.filter(e=>rr(e.getSource().stream.url)===r);var n;i.push(...this.cachePreloaders.filter(e=>rr(e.getSource().stream.url)===r)),i.sort((n=t.startPosition.videoTime||0,function(e,t){const{total:r,audio:i,video:s}=Wt(e.getBufferedInfo(),n),{total:a,audio:o,video:l}=Wt(t.getBufferedInfo(),n);return r!==a?a-r:s!==l?l-s:o-i}));const s=i[0];if(void 0===s)return;let a=this.preloaders.indexOf(s);return a>-1?this.preloaders.splice(a,1):(a=this.cachePreloaders.indexOf(s),a>-1&&this.cachePreloaders.splice(a,1)),s}getPreparedSourceParams(e,t,r){return Fn({},Tl,t,{startPosition:this.getInitialStartPosition(t,r),withCredentials:ir(e,t)})}getInitialStartPosition(e,t){const r=e&&e.startPosition||Tl.startPosition;if(r){if((0,js.Z)(r).some(e=>(0,va.z)(r[e])))return r}const i=null==t?void 0:t.getProgress();return void 0===i?r:{videoTime:i}}async loadSource(e,t){let{shouldSaveProgress:r}=t;xa.log("loadSource start",e),this.callbacks.onEngineChange(void 0,this.playerStore.getState().controller.sourceId),this.callbacks.onDrmSystemChange(void 0);const i=r?"LoadSourceWithSaveProgress":"LoadSource";this.callbacks.logEvent({event:i,params:{source:e}}),nt(),this.shouldCaptureScreenshot()&&(this.setBackgroundImage(),this.setBackgroundVisibility(!1),this.videoController.clearScreenshot()),this.stopAd({stopAdReason:La.LoadSource}),this.plannedAdViewers=[],this.stopLoadSource(Kl.setSource),this.playbackProgressStorage.clearVideoContentId(),this.stateController.putStreamsWithSupportInfo(void 0),this.stateController.putStream(void 0),this.playerStore.setControllerStateField(vl.sourceParams,void 0),this.playerStore.setControllerStateField(vl.streams,e.streams),this.stateController.putResourcesIdle(!1);const{preferredAudioLangs:n,preferredTextLangs:s}=e.params.preferredTracks;n.length>0&&this.playerStore.setUserAudioTrackParams({lang:n[0],name:void 0}),s.length>0&&this.playerStore.setUserTextTrackParams({lang:s[0],name:void 0,enabled:!0});const a=new eo;this.stopLoadSource=e=>a.stop(e);try{this.multiroll.destroy()}catch(S){!function(e,t){(0,Jn.Y)(()=>window.Ya.Rum.logError(Je({},e,{additional:(0,Es.B6)()}),(0,ys.K)(t)?t:new Error("NOT_AN_OBJECT_ERROR")))}({message:"Can not destroy multiroll instance",method:"loadSource",source:"multiroll",sourceMethod:"destroy",type:"logic"},S)}this.multiroll=Jd;const o=!this.videoController,{streams:l}=e,d=Ht({streams:l,video:this.video,preferNative:this.config.preferNative}),c=er(e.params),u=function(e){return(0,ys.K)(e)&&!1===e.hasPreroll}(c);this.playerStore.setAdStateField(ml.adSyncInit,(0,ys.K)(c)&&(!u||!1!==c.hasPreroll));let h=u?null:this.initMultirollModule(c,a);(0,Es.Z$)("hasPreroll",!u);const p=this.destroyVideoController(),f=await d;if(this.stateController.putStreamsWithSupportInfo(f.streamsWithSupportInfo),a.stopReason)return void this.callbacks.logEvent({event:Ca.StreamStopWhileChoosingStream,params:void 0});if("error"===f.status)throw f.error;const{supportedStream:m}=f;fn(m,{perfLogUrl:this.config.perfLogUrl});const{stream:g}=m;this.playbackProgressStorage.setVideoContentId(this.config.restoreTabSessionPlaybackProgress?e.params.videoInfo.videoContentId:void 0);const v=this.getPreparedSourceParams(g,e.params,this.playbackProgressStorage);if(await p,a.stopReason)return void this.callbacks.logEvent({event:Ca.StreamStopWhileDestroyVideoController,params:void 0});if(this.resetPlayerStore(g,v,{shouldSaveProgress:r,isFirstLoad:o}),await Promise.race([this.defineAutoplaySettingsDeferred.promise,a.stopPromise]),a.stopReason)return void this.callbacks.logEvent({event:Ca.StreamStopDuringDefineAutoplaySettings,params:void 0});const y=this.createVideoController(m,v);if(ga(y)&&(await Promise.race([y,a.stopPromise]),a.stopReason))return;(0,Es.Z$)("bandwidthEstimate",tr(this.videoController.getBandwidthEstimate().value/1e3)),(0,Es.Z$)("drm","none"),o?(Promise.resolve().then(()=>{this.initBroadcastAd()}),Xt(g.url,Boolean(v.withCredentials)).then(e=>{this.stateController.putAdblockDetected(e||ss.I)}),this.setMuted(this.state.controller.muted),this.setVolume(this.state.controller.volume)):this.prepareNextSource(g,v),this.playerStore.getState().skin.nativeControlsVisibility&&this.setPosterFitStyle(),this.once("ContentImpression",this.handleFirstContentImpression),this.once("SetSource",()=>this.off("ContentImpression",this.handleFirstContentImpression));const E=async()=>{h||(h=this.initMultirollModule(c,a));const e=await h;if(a.stopReason)return this.callbacks.logEvent({event:Ca.StreamStopWhileLoadingMultiroll,params:{streamStopReason:a.stopReason}}),void e.destroy();this.multiroll=e};if(u){const{adInitOffset:e=0}=c||{};new Promise(t=>{let r=!1;const i=()=>{this.off("CurrentTimeChange",n),this.off("ContentImpression",s)},n=()=>{if(!r)return;this.state.controller.watchedTime<=e||(i(),t())},s=()=>r=!0;this.on("ContentImpression",s),this.on("CurrentTimeChange",n),this.once("SetSource",i)}).then(()=>{a.stopReason||E()})}else await E();a.stopReason||this.startPrerollAndContent(a,o)}async preloadSourceImpl(e,t,r,i){const{streams:n}=e,s=Ht({streams:n,video:Wp,preferNative:this.config.preferNative}),a=await s;if(t())throw new Error("abort preloadSource");if("error"===a.status)throw a.error;const{supportedStream:o}=a,{stream:l,supportInfo:d}=o,c=new sc;c.setVideoContentId(this.config.restoreTabSessionPlaybackProgress?e.params.videoInfo.videoContentId:void 0);const u=this.getPreparedSourceParams(l,e.params,c),h=sr({stream:l,sourceParams:u}),p=this.preloaders.find(e=>sr(e.getSource())===h);if(p)return r(()=>p.destroy()),i(()=>p.destroy()),p.preload();fn(o,{perfLogUrl:this.config.perfLogUrl});const f=jr({engine:d.engine,source:{stream:l,sourceParams:u},getState:()=>this.playerStore.getState(),getCapSizes:()=>{var e;return null==(e=this.videoController)?void 0:e.getCapSizes()},getVideoElementSizes:()=>{var e;return null==(e=this.videoController)?void 0:e.getVideoElementSizes()},defaultQuality:this.config.defaultQuality});if(!f)throw new Error("can not create preloader");return this.preloaders.splice(0,0,f),this.preloaders=this.preloaders.filter(e=>!e.isDestroyed).slice(0,10),r(()=>f.destroy()),i(()=>f.destroy()),f.preload()}async initMultirollModule(e,t){let r=Jd;if(!e)return r;st("AD",!0);try{const i=Be(window,e,this.state.controller.vsid,ss.I),n=await Promise.race([i,t.stopPromise.then(()=>{})]);if(void 0===n)return r;const{loadMultiroll:s}=n,a=s(Fn({},e,{secureMode:"Safe"}),{preroll:{shouldPreload:()=>{const{preload:e,startStage:t}=this.state.controller;return e&&(t===al.waitForUserPlay||t===al.waitForDocumentVisibility)}},midroll:{preloadOffset:20,preloadMinTime:5},postroll:{preloadOffset:20,preloadMinTime:5},getPreloadParams:()=>{const e={videoSlot:this.video},t=this.getBandwidthEstimate();return null!=t&&t.value?Fn({},e,{desiredBitrate:t.value/1e3}):e},adLoaded:e=>{let{adBreakType:t}=e;const r=(()=>{switch(t){case Oa.preroll:return Oa.preroll;case Oa.midroll:return Oa.midroll;case Oa.postroll:return Oa.postroll;case Oa.inroll:return Oa.inroll;case Oa.postPauseroll:return Oa.postPauseroll}})();void 0!==r&&this.callbacks.onAdLoaded({adType:r})}});(0,Kn.v)(t.stopPromise.then(()=>a).then(e=>e.destroy()));const o=await Promise.race([a,t.stopPromise.then(()=>{})]);if(void 0===o)return r;r=o}catch(i){it({reason:"MULTIROLL_INIT_ERROR",adSdkVersion:oe(),adSdkLoaderVersion:ae(),adblockDetected:this.state.ad.adblockDetected,bandwidth:tr(void 0)});const t=new ja({isFatal:(0,rs.m)(Yp)&&(!(0,ys.K)(i)||"0"===String(i.code)||!i.code),code:cs.MULTIROLL_INIT_ERROR,details:{error:i,adConfig:e}});this.callbacks.onAdError(Fn({},t,{code:String(t.code)})),this.onError(t)}return r}async startPrerollAndContent(e,t){xa.log("startPrerollAndContent");let r=[];const i=(0,ma.I)(()=>this.startStream()),n=(0,ma.I)(async()=>{this.multiroll!==Jd&&xe("adsdk.loadviewers.preroll");const t=this.multiroll.preroll.loadViewers({}),i=await Promise.race([t,e.stopPromise.then(()=>{})]);if(void 0===i)return;r=i,this.multiroll!==Jd&&Ve("adsdk.loadviewers.preroll");const n=r.length>0;this.playerStore.setAdStateField(ml.hasPreroll,n),n&&this.callbacks.logEvent({event:Ca.PrerollInit,params:{}})}),{startStage:s,preload:a}=this.state.controller;if(s===al.waitForUserPlay||s===al.waitForDocumentVisibility){if(xa.log("Waiting for "+(s===al.waitForUserPlay?"user gesture":"document visibility")),this.callbacks.logEvent({event:s===al.waitForUserPlay?Ca.WaitForUserGesture:Ca.WaitForDocumentVisibility,params:{preload:a}}),a){if(xa.log("Preload preroll in player"),await Promise.race([n(),e.stopPromise]),e.stopReason)return void this.callbacks.logEvent({event:Ca.StreamStopWhilePreloadingPreroll,params:{streamStopReason:e.stopReason}});this.state.ad.hasPreroll||(xa.log("No preroll, preload content"),i())}if(s===al.waitForDocumentVisibility&&await function(e,t){return p(e)===t?Promise.resolve():new Promise(r=>{f(e,e=>{e===t&&r()})})}(this.getContainerDocument(),!0),this.state.controller.startStage===al.waitForUserPlay&&await this.waitForPlay(),e.stopReason)return void this.callbacks.logEvent({event:s===al.waitForUserPlay?Ca.StreamStopWhileWaitingForPlay:Ca.StreamStopWhileWaitingForDocumentVisibility,params:{streamStopReason:e.stopReason}})}if(xa.log("Start playing"),t&&this.stateController.putAutoplay(!0),await Promise.race([n(),e.stopPromise]),e.stopReason)this.callbacks.logEvent({event:Ca.StreamStopWhileLoadingPreroll,params:{streamStopReason:e.stopReason}});else{if(!this.state.ad.hasPreroll)return await i(),void this.logPlayAfterWaitingForDocumentVisibility();this.playerStore.setControllerStateField(vl.preload,!0),xa.log("Start preroll"),this.playAdViewers(Oa.preroll,G(r,Oa.preroll),{videoSlotCanAutoPlay:s!==al.waitForDocumentVisibility||void 0})}}waitForPlay(){const e=(0,ya.u)();return new Promise(t=>{this.waitForPlayOccurred().then(r=>{this.callbacks.logEvent({event:Ca.WaitForPlayCompleted,params:{reason:r,timeout:e()}}),t()}).catch(Xo.Z),this.playCallbacks.push(t)})}async waitForPlayOccurred(){return new Promise((e,t)=>{let r=Xo.Z,i=Xo.Z,n=0;const s=()=>{r(),i(),clearInterval(n)},a=t=>{void 0!==this.videoController&&(s(),e(t))};this.video.paused?(r=(0,Vs.O)(this.video,"play",()=>{a(Il.VideoPlayEvent)}),i=(0,Vs.O)(this.video,"timeupdate",()=>{this.video.paused||a(Il.DetectByInterval)}),n=window.setInterval(()=>{this.video.paused||a(Il.DetectByInterval)},100),this.once("Destroy",()=>{s(),t()})):a(Il.VideoIsNotPausedOnInit)})}initBroadcastAd(){const{video:e}=this;if(this.broadcastAd=new $a({video:e,slot:e.parentElement,playerApi:this,stateController:this.stateController,onError:e=>this.onError(e),playerStore:this.playerStore}),this.videoController&&this.videoController.engine===Cl.NATIVE){let t=0;e.addEventListener("timeupdate",()=>{const{currentTime:r}=e;this.state.controller.videoType===cl.Z.LIVE&&r<t&&this.broadcastAd&&this.stateController.putOriginalBroadcastAdCues({}),t=r})}this.on("MetadataChange",e=>{const{fragmentMetadataArray:t,fragmentStart:r}=e;if(xa.log("receive metadata: ",t),!this.broadcastAd)return;const{programDateTime:i}=this.state.controller;if(void 0===i)return;const n=i+1e3*r;let s;Math.random()<.01&&this.callbacks.logEvent({event:Ca.StreamPlayerReceivedMetadata,params:e}),t.forEach(e=>{try{const t=JSON.parse(e);if(!function(e){return(0,ys.K)(e)&&(0,Ys.H)(e.cue_id)&&(0,va.z)(e.offset)}(t))return;s=Fn({},t,{pts:n})}catch(yf){xa.log("metadata is not valid ["+e+"]")}}),s&&(this.callbacks.onInrollFrame(s),this.state.ad.adConfig&&this.broadcastAd.handleInrollFrame(s).catch(e=>{xa.error(e),this.onError(new ja(Fn({},e,{code:cs.BROADCAST_AD_BLOCK_INIT_ERROR,isFatal:!1,details:{code:e.code,message:e.message,id:e.id,details:e.details,stack:e.stack,metadata:{cueId:s.cue_id,podStart:n+s.offset}}})))}))}),this.broadcastAd.on("AdIntervalRemoved",e=>{this.playerStore.removeCue(e)}),this.broadcastAd.on("AdIntervalUpdated",e=>{let{cueId:t,start:r,end:i}=e;this.stateController.refreshCue({cueId:t,start:r/1e3,end:i/1e3})}),this.broadcastAd.on("InrollAdPlayRequest",e=>{this.playAdViewers(Oa.inroll,e,{})})}getPosterUrlForAd(){var e;const t=null==(e=this.state.controller.sourceParams)?void 0:e.preview;return t&&t!==Ra?t:null}prepareBeforeOrAfterAd(e,t){this.broadcastAd&&t!==Oa.inroll&&this.broadcastAd.setEnabled(e)}getSeekPositionAfterAd(e){let{adType:t,adViewersDuration:r,utcPosition:i}=e;if(t===Oa.inroll){return{utc:i?i+r:void 0,videoTime:this.state.controller.currentTime+r}}return t===Oa.preroll?this.state.controller.startPosition:t===Oa.midroll||t===Oa.postPauseroll?{utc:i||void 0,videoTime:this.state.controller.currentTime}:t===Oa.postroll?{videoTime:0}:{}}getAdViewersWithData(e){const{controller:{isFullscreen:t,isPip:r}}=this.state,i=t&&H(this.getContainerDocument().defaultView,this.video)===this.video;return i||r?e.filter(e=>{const{adViewer:t}=e;return t.filterAdPodsIndependentOnHtmlControls("StreamPlayer can't play CPC ads: ["+(r?"PiP":i?"FullScreen":"unknown")+"] mode"),t.getAdPodsCount()>0}):e}getAdViewersCueId(e,t){var r;if(e!==Oa.inroll)return this.state.ad.originalBroadcastAdCueId;const i=t.find(e=>e.additionalData.cueId);return null!=(r=null==i?void 0:i.additionalData.cueId)?r:this.state.ad.originalBroadcastAdCueId}prepareBeforeAd(e){const{ad:{adInfo:t}}=this.state;t||(this.handleAdEnd=(0,ma.I)(async()=>{xe("adsdk.player.start."+e),Iu.isYaspVideoElement(this.video)&&await this.video.detach(),this.once("ContentImpression",()=>{Ve("adsdk.player.start."+e),this.handleAdEnd=void 0})}))}async initAdPlaybackQueue(e){if(this.currentAdPlaybackQueue)return;const{ad:{adSyncInit:t}}=this.state,r=[(0,Vs.O)(this.video,"firstframedecoded",()=>{ot("AD",{},t)},{once:!0}),(0,Vs.O)(this.video,"firstframeshown",()=>{lt("AD",{},t)},{once:!0})],i=this.getUtcPosition();e!==Oa.preroll&&(this.shouldCaptureScreenshot()&&(xe("capture.screenshot"),this.videoController.captureScreenshot().then(e=>{Ve("capture.screenshot"),e&&(this.setBackgroundImage(e),this.setBackgroundVisibility(!1))})),xe("encoder.detach")),await this.detachEncoder(),e!==Oa.preroll&&Ve("encoder.detach",{additional:{engine:this.state.controller.engine}});let n=!1;const s=new Ya({video:(()=>Iu.isSupported()&&(0,is.RW)("yasp_enable_for_ad")?Iu.attach(this.video,Qh):this.video)(),utcPositionBeforeAd:i,onAdStartRejected:e=>{var t;null==(t=this.playDeferred)||t.reject(e)},onAdSkippableStateChange:e=>{this.callbacks.onAdSkippableStateChange(e)},onAdPodCloseStateChange:e=>{this.callbacks.onAdPodCloseStateChange(e)},onAdVolumeAvailabilityStateChange:e=>{this.callbacks.onAdVolumeAvailabilityStateChange(e)},onAdPodError:e=>{this.callbacks.onAdError(e)},onAdPodDurationChange:e=>{this.callbacks.onAdPodDurationChange(e)},onAdPodCurrentTimeChange:e=>{this.callbacks.onAdPodCurrentTimeChange(e)},onAdPodTimeToSkipChange:e=>{this.callbacks.onAdPodTimeToSkipChange(e)},onAdInteraction:()=>{this.callbacks.onAdInteraction()},onFirstAdPodStarted:()=>{var t;at("AD",{adblockDetected:this.state.ad.adblockDetected,adType:e,bandwidth:tr(void 0)},this.state.ad.adSyncInit),Ve("player.adsdk.start."+e),this.hidePoster(),e!==Oa.postroll&&this.preloadVideoControllerSource({whileAd:!0}),null==(t=this.playDeferred)||t.resolve()},onLastAdPodStopped:e=>{this.multiroll.dispatchEvent({event:"AdBreakEnd",data:e})},onBeforeAdPodStart:e=>{this.callbacks.onBeforeAdPodStart(e)},onAdPodStarted:()=>{this.stateController.putResourcesIdle(!0),this.callbacks.onAdPodStart(),n&&Ve("adsdk.creative.switch."+e)},onAdPodSkipped:()=>{this.callbacks.onAdPodSkip()},onAdPodStopped:()=>{N(r),n=!0,xe("adsdk.creative.switch."+e),this.stateController.putInStreamPlayingState(void 0),this.callbacks.onAdPodEnd()},onAdPodPlayingStateChange:e=>{let{playingState:t,expectedStalledReason:r,adType:i}=e;t===Sa.BUFFERING&&this.callbacks.onExpectedStalledChange({reason:r,details:{adType:i}}),this.stateController.putInStreamPlayingState(t)},onAdClickThru:()=>{this.callbacks.onAdPodClick()},onAdSizeChange:e=>{this.stateController.putVideoSize({videoWidth:void 0===e.width?NaN:e.width,videoHeight:void 0===e.height?NaN:e.height})},onRequestFullscreenStateChange:e=>{this.callbacks.onRequestFullscreenChange(e)},getControlsSettings:()=>function(e){const{ad:{nativeAdControlsVisibility:t}}=e;return{controlsVisibility:t?{}:{mute:!1,timeline:!1,play:!1,loader:!1}}}(this.playerStore.getState()),logEvent:this.callbacks.logEvent,onError:e=>{this.onError(e)},adConfig:this.state.ad.adConfig,playerContainer:vn(this.state.controller.vsid,window.parent.document),lang:this.config.lang});this.currentAdPlaybackQueue=s}updateVideoInfo(){ze(this.state)?this.playbackQualityController.persist():(this.playbackQualityController.update(),this.emit("PlaybackQualityUpdate",this.playbackQualityController.getPlaybackQuality()))}resetPlayerStore(e,t,r){let{shouldSaveProgress:i,isFirstLoad:n}=r;this.playerStore.updateSourceId(),this.stateController.putStream(e),this.playerStore.setControllerStateField(vl.sourceParams,t);const s=this.getStartPositionForLoadSource(t,{shouldSaveProgress:i});if(this.playerStore.setControllerStateField(vl.startPosition,s),this.playerStore.getState().controller.autoplay||this.playerStore.setControllerStateField(vl.autoplay,function(e){let{playingState:t}=e;return t===Sa.BUFFERING||t===Sa.PLAY}(this.playerStore.getState().controller)),i||(this.playerStore.setControllerStateField(vl.duration,ll.duration),this.playerStore.setControllerStateField(vl.dvrDuration,ll.dvrDuration),this.playerStore.setSkinStateField(gl.skinDVRDuration,dl.skinDVRDuration),this.stateController.watchedTimeCounter=new Op.p,this.stateController.putWatchedTime(ll.watchedTime)),this.stateController.putCurrentTime(Math.max(0,s.videoTime||ll.currentTime)),!n){const{additionalParams:e=Al}=t,{from:r=Sl}=e;this.playerStore.setControllerStateField(vl.from,r),this.playerStore.setControllerStateField(vl.preview,t.preview||Tl.preview),this.stateController.putBufferingRanges(ll.bufferingRanges),this.stateController.putVideoType(void 0),this.playerStore.setControllerStateField(vl.programDateTime,void 0),this.playerStore.setControllerStateField(vl.dvrStartTime,ll.dvrStartTime),this.playerStore.setSkinStateField(gl.skinDVRStartTime,dl.skinDVRStartTime),this.stateController.putVideoTracks(ll.videoTracks),this.stateController.putAudioTrackValue(ll.audioTrackValue),this.stateController.putAudioTracks(ll.audioTracks),this.stateController.putTextTrackEnabled(ll.textTrackEnabled),this.playerStore.setControllerStateField(vl.textTrackValue,ll.textTrackValue),this.stateController.putTextTracks(ll.textTracks),this.callbacks.onSubtitlesChange([]),this.callbacks.onThumbnailTileGeneralMetaInfoChange(void 0),this.stateController.putOriginalBroadcastAdCues({}),this.state.controller.playingState===Sa.END&&(this.stateController.putPlayingState(Sa.PAUSE),this.stateController.putAutoplay(!1)),this.stateController.putInStreamPlayingState(void 0),this.playerStore.setAdStateField(ml.hasPreroll,!1),this.stateController.putNextAdInfo(void 0),this.playerStore.setControllerStateField(vl.preload,!0),this.playerStore.setControllerStateField(vl.preloadDetails,ll.preloadDetails)}this.playerStore.setAdStateField(ml.adConfig,er(t))}prepareNextSource(e,t){this.stateController.putErrorInfo({}),this.emit("DurationChange",NaN),this.playerStore.setControllerStateField(vl.preload,!0),this.playbackQualityController.reset(),this.playCallbacks=[],this.stateController.putVideoTrackParams({videoTrackValue:ll.videoTrackValue,isAbrEnabled:this.state.controller.isAbrEnabled}),this.broadcastAd&&this.stateController.putOriginalBroadcastAdCues({})}performPlayCallbacks(){this.playCallbacks.length>0&&(N(this.playCallbacks),this.playCallbacks=[])}seekToVideoPosition(e,t){Number.isNaN(e)||(ze(this.state)&&!t?this.playerStore.setControllerStateField(vl.startPosition,{videoTime:e}):this.videoController.seek(e))}getStartPositionForLoadSource(e,t){let{shouldSaveProgress:r}=t;const{controller:{currentTime:i,watchedTime:n}}=this.state,s=this.getUtcStartTime(),a=void 0===s?void 0:s+i,o=(0,ys.K)(e.startPosition)?e.startPosition:{};return r&&n>0?{videoTime:i,utc:a}:o}getUtcStartTime(){const{controller:{programDateTime:e}}=this.state;return void 0===e?void 0:e/1e3}onError(e){const t=e instanceof ja?e:new ja(Fn({},e,{code:e.code||cs.DEFAULT_ERROR}));this.stateController.putErrorInfo({error:t}),t.isFatal&&(this.callbacks.logEvent({event:"MediaInternalsHistoryOnFatal",params:{history:this.mediaInternalsHistory.getHistory()}}),!ze(this.state)&&this.currentAdPlaybackQueue&&this.currentAdPlaybackQueue.destroy(La.PlayerError),this.stateController.handleVideoTagPlayingStateChange(Sa.PAUSE),this.destroyVideoController())}async detachEncoder(){this.videoController&&(await this.videoController.detachEncoder(),this.stateController.putEncoderState(ol.Detached))}async attachEncoder(){this.state.controller.isOnline||await new Promise(e=>this.onlineMonitor.once("Online",e)),this.stateController.putEncoderState(ol.Attaching);try{await this.videoController.attachEncoder()}catch(r){throw this.stateController.putEncoderState(ol.Detached),r}finally{const e=this.getPreloadDetails();this.callbacks.onPreloadDetailsUpdate("none"===(null==e?void 0:e.preloaded)?void 0:this.getPreloadDetails())}this.stateController.putEncoderState(ol.Attached),this.updateVolumeInfo();const e=this.state.controller.playingState,t=this.videoController.getPlayingState();t&&e!==t&&this.emit("VideoPlayingStateChange",t)}async destroyVideoController(){this.videoController&&(this.cacheVideoController(),await this.videoController.destroy(),this.stateController.putEncoderState(ol.Detached))}cacheVideoController(){if(this.config.cacheSourcesCount<=0)return;if(!this.videoController)return;if(this.state.controller.videoType!==cl.Z.VOD)return;const e=this.videoController.createCachePreloader();if(!e)return;const t=rr(this.videoController.getStreamUrl()),r=this.cachePreloaders.findIndex(e=>rr(e.getSource().stream.url)===t);r>-1&&(this.cachePreloaders[r].destroy(),this.cachePreloaders.splice(r,1)),this.cachePreloaders.push(e)}async tryToPlay(e){var t;let r=!1;this.once("PauseCalled",()=>r=!0);try{return void await e.play()}catch(i){}if(this.destroyed)return Promise.reject();if(r)return Promise.reject();if(null!=(t=this.state.controller.errorInfo.error)&&t.isFatal)return Promise.reject();if(this.video.muted)return Promise.reject();if(!this.state.controller.allowMuted)return Promise.reject();if(!this.canMuteForPlay)return Promise.reject();if(this.setMuted(!0),qd&&!sh){const e=new Promise(e=>{this.once("Destroy",(0,Vs.O)(this.video,"volumechange",e,{once:!0}))}),t=new Promise((e,t)=>{this.once("Destroy",t)});await Promise.race([e,t])}try{return void await e.play()}catch(n){return this.canMuteForPlay=!1,this.setMuted(!1),Promise.reject()}}async logPlayAfterWaitingForDocumentVisibility(){const{videoController:e}=this,{startStage:t,initialAutoplay:r}=this.state.controller;t===al.waitForDocumentVisibility&&r&&e&&this.callbacks.logEvent({event:Ca.PlayAfterWaitingForDocumentVisibility,params:{}})}getContainerDocument(){return this.container.ownerDocument||document}getMainContainer(){return this.container}setPosterFitStyle(){var e,t;const{videoElementStyle:r,posterStyle:i}=this.playerStore.getState().controller,n=null!=(e=null!=(t=null==r?void 0:r.objectFit)?t:null==i?void 0:i.objectFit)?e:"cover";Mn(this.video,Fn({},this.playerStore.getState().controller.videoElementStyle,{objectFit:n}))}resetPosterFitStyle(){Mn(this.video,Fn({objectFit:"contain"},this.playerStore.getState().controller.videoElementStyle))}hidePoster(){this.video.poster=Ra}preloadVideoControllerSource(e){let{whileAd:t}=e;void 0!==this.videoController&&(this.callbacks.logEvent({event:Ca.PreloadSource,params:{reason:Np.InternalApi,whileAd:t}}),(0,Kn.v)(this.videoController.preloadSource()))}updateVolumeInfo(){this.stateController.putVolumeInfo({volume:this.video.volume,muted:this.video.muted,changeReason:Ql.VolumeChangeEvent})}iosLandscapeScreenOrientationWorkaround(){if(!rh)return;const e=()=>{if(this.state.controller.currentTime<=0)return;this.off("CurrentTimeChange",e);(0,Jn.Y)(()=>0===screen.orientation.type.indexOf("landscape-"))&&(D(this.video,sp().locals.StreamPlayer_iosLandscapeWorkaround),setTimeout(()=>$s(this.video,sp().locals.StreamPlayer_iosLandscapeWorkaround),10))};this.on("CurrentTimeChange",e)}}class zp{constructor(e,t){void 0===e&&(e=window),this.handlers=[],this.names=void 0,this.namesOnVideo=void 0,this.onDestroy=new da,this.win=void 0,this.video=void 0,this.fullscreenElement=null,this.setFullScreenElementFromAPI=()=>{const e=H(this.win,this.video);this.setFullscreenElement(e)},this.win=e,this.video=t,t&&rh&&(this.onDestroy.addOne((0,Vs.O)(t,"webkitbeginfullscreen",()=>{this.setFullscreenElement(t)})),this.onDestroy.addOne((0,Vs.O)(t,"webkitendfullscreen",()=>{this.setFullscreenElement(null)}))),this.names=B(e,t),this.namesOnVideo=U(e,t)[0],this.names&&(this.onDestroy.addOne((0,Vs.O)(this.win.document,this.names.events.change,this.setFullScreenElementFromAPI)),this.setFullScreenElementFromAPI())}requestFullscreenForElement(e,t){if(void 0===this.names)throw new this.win.Error("Fullscreen is not supported");{const{request:r}=this.names;if(!(r in e))throw new this.win.Error("Fullscreen is not supported");e[r](t)}}isFullscreen(){return null!==this.fullscreenElement}exit(){if(void 0===this.names)throw new Error("Fullscreen is not supported");{let e,t=this.names;this.video&&this.fullscreenElement===this.video?(e=this.video,t=this.namesOnVideo||t):e=this.win.document;try{(0,Kn.v)(e[t.exit]().catch(e=>{xa.error("Exit fullscreen for element:",e)}))}catch(yf){xa.error("Exit fullscreen for element:",yf)}}}getFullscreenElement(){return this.fullscreenElement}addHandler(e){if("function"!==typeof e)throw new this.win.Error("Fullscreen handler must be a function");this.handlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e)}destroy(){this.handlers.length=0,this.onDestroy.dispatch(void 0)}setFullscreenElement(e){this.fullscreenElement=e,this.handlers.forEach(t=>t(e))}}let qp;!function(e){e.PiP="PiP",e.YaBroEarly="YaBroEarly",e.YaBroAttrLegacy="YaBroAttrLegacy",e.YaBroAttrCurrent="YaBroAttrCurrent",e.OperaPopOut="OperaPopOut",e.SafariPresentationMode="SafariPresentationMode"}(qp||(qp={}));const Kp={[qp.PiP]:{isSupported:e=>{if("pictureInPictureEnabled"in e.document){if(Vn()){const t=xn(e);return 20===t.major&&t.minor>4||t.major>20}return!0}return!1},getCurrent:e=>e.document.pictureInPictureElement||null,observe:(e,t,r)=>t?(t.addEventListener("enterpictureinpicture",r),t.addEventListener("leavepictureinpicture",r),()=>{t.removeEventListener("enterpictureinpicture",r),t.removeEventListener("leavepictureinpicture",r)}):Xo.Z,getPipWindow:e=>e.pictureInPictureWindow||null},[qp.YaBroEarly]:{isSupported:(e,t)=>"broughtOut"in t,getCurrent:(e,t)=>t&&"broughtOut"in t&&t.broughtOut?t:null,observe:(e,t,r)=>t?(t.addEventListener("oowvideobringin",r),t.addEventListener("oowvideobringout",r),()=>{t.removeEventListener("oowvideobringin",r),t.removeEventListener("oowvideobringout",r)}):Xo.Z},[qp.YaBroAttrCurrent]:{isSupported:e=>{if(Vn()){const t=xn(e);return 18===t.major&&t.minor>=6||t.major>18}return!1}},[qp.YaBroAttrLegacy]:{isSupported:e=>Vn()&&xn(e).major<18},[qp.SafariPresentationMode]:{isSupported:(e,t)=>"webkitPresentationMode"in t,getCurrent:(e,t)=>t&&"picture-in-picture"===t.webkitPresentationMode?t:null,observe:(e,t,r)=>t?(t.addEventListener("webkitpresentationmodechanged",r),()=>t.removeEventListener("webkitpresentationmodechanged",r)):Xo.Z},[qp.OperaPopOut]:{isSupported:(e,t)=>"onoperadetachedviewcontrol"in t&&"onoperadetachedviewchange"in t}},Qp=[qp.PiP,qp.YaBroEarly,qp.YaBroAttrCurrent,qp.YaBroAttrLegacy,qp.SafariPresentationMode,qp.OperaPopOut];class Zp extends Ia.v{constructor(e,t){void 0===e&&(e=window),super(),this.api=null,this.apiName=null,this.window=void 0,this.pipWindow=null,this.currentElement=null,this.unsubscribeFromApi=Xo.Z,this.handlePipEvent=e=>{var t;const r=e.target;this.digestCurrentElement(r);const i=Boolean(this.getCurrentElement());this.pipWindow=(null==(t=this.api)||null==t.getPipWindow?void 0:t.getPipWindow(e))||null,this.emit("Change",i)},this.window=e;const r=t||window.HTMLVideoElement.prototype;for(let i=0;i<Qp.length;i++){const e=Qp[i],t=Kp[e];try{if(t.isSupported(this.window,r)){this.api=t,this.apiName=e;break}}catch(yf){}}this.digestCurrentElement(t),this.api&&this.api.observe&&(this.unsubscribeFromApi=this.api.observe(this.window,t,this.handlePipEvent))}getSupportedApiName(){return this.apiName}getCurrentElement(){return this.currentElement}addHandler(e){return this.api&&this.api.observe?(this.on("Change",e),()=>this.off("Change",e)):null}getPipWindowSize(){if(!this.pipWindow)return null;const{width:e,height:t}=this.pipWindow;return e&&t?{width:e,height:t}:null}destroy(){this.currentElement=null;const e=this.window.document;null!=e&&e.pictureInPictureElement&&(null==e.exitPictureInPicture||e.exitPictureInPicture()),this.off("Change"),this.unsubscribeFromApi()}digestCurrentElement(e){this.api&&this.api.getCurrent&&(this.currentElement=this.api.getCurrent(this.window,e))}}class Jp extends Ia.v{constructor(e,t){super(),this.isSupportedPipMode=!0,this.isYandexPipMode=!1,this.isVisibilitySupported=void 0,this.window=void 0,this.element=void 0,this.fullscreenApi=void 0,this.pipApi=void 0,this.video=void 0,this.state={isPip:!1,isFullScreen:!1,isVisible:!0},this.observe=e=>(this.on("Change",e),()=>this.off("Change")),this.fireVisualStateHandlers=()=>{const{isPip:e,isVisible:t,isFullScreen:r}=this.state,i={isPip:e,isVisible:t,isFullScreen:r,isSupportedPipMode:this.isSupportedPipMode,isVisibilitySupported:this.isVisibilitySupported,isYandexPipMode:this.isYandexPipMode};this.emit("Change",i)},this.handleVisibilityChange=e=>{this.state.isVisible!==e&&(this.state.isVisible=e,this.fireVisualStateHandlers())},this.handlePipChange=e=>{this.state.isPip!==e&&(this.state.isPip=e,this.state.isFullScreen=this.getFullscreenStateProperty(this.fullscreenApi.getFullscreenElement()),this.fireVisualStateHandlers())},this.getFullscreenStateProperty=e=>Un(this.video.ownerDocument,this.video)||this.video===e,this.handleFullscreenChange=e=>{const t=this.getFullscreenStateProperty(e);this.state.isFullScreen!==t&&(this.state.isFullScreen=t,this.fireVisualStateHandlers())},this.element=e,this.window=cn(this.element),this.isVisibilitySupported=t}setVideoElement(e){void 0===this.video&&(this.video=e,this.observeFullscreen(),this.observePip())}setExternalVisibility(e){this.handleVisibilityChange(e)}setExternalFullscreen(e){this.state.isFullScreen!==e&&(this.state.isFullScreen=e,this.fireVisualStateHandlers())}changeFullscreenState(e){e.isFullScreen!==this.state.isFullScreen&&(e.isFullScreen?this.fullscreenApi.requestFullscreenForElement(this.video,{navigationUI:"hide"}):this.fullscreenApi.exit())}changePipState(e){e.isPip!==this.state.isPip&&(e.isPip||this.pipApi.destroy())}destroy(){this.emit("Destroy"),this.off("Destroy")}getState(){const{isPip:e,isVisible:t,isFullScreen:r}=this.state;return{isPip:e,isVisible:t,isFullScreen:r,isSupportedPipMode:this.isSupportedPipMode,isVisibilitySupported:this.isVisibilitySupported,isYandexPipMode:this.isYandexPipMode}}getPipWindowSize(){return this.pipApi.getPipWindowSize()}observePip(){this.pipApi=new Zp(cn(this.video),this.video),this.pipApi.addHandler(this.handlePipChange),this.once("Destroy",()=>{this.pipApi.destroy()});const e=this.pipApi.getSupportedApiName();this.isSupportedPipMode=e!==qp.OperaPopOut,this.isYandexPipMode=e===qp.YaBroAttrCurrent||e===qp.YaBroAttrLegacy}observeFullscreen(){this.fullscreenApi=new zp(this.window,this.video),this.fullscreenApi.addHandler(this.handleFullscreenChange),this.once("Destroy",()=>{this.fullscreenApi.destroy()})}}let Xp;!function(e){e.Unknown="Unknown",e.ExternalApi="ExternalApi",e.VisiblePlayback="VisiblePlayback",e.PlayRejected="PlayRejected",e.RestoreAfterInsertInto="RestoreAfterInsertInto",e.WaitForSourceConfigUpdate="WaitForSourceConfigUpdate",e.CompletedRecoverSourceConfig="CompletedRecoverSourceConfig",e.StartPlayingAnotherPlayer="StartPlayingAnotherPlayer"}(Xp||(Xp={}));const $p=e=>{let t=e;return na(e)?[].concat(e).map(e=>$p(e)):Rn(e)?new Date(e.getTime()):(!(0,rs.m)(e)&&(0,ys.K)(e)&&(t={},(0,td.M)(e,(e,r)=>{t[r]=$p(e)})),t)};let ef;!function(e){e.play="play",e.pause="pause",e.seek="seek",e.setSource="setSource",e.preloadSource="preloadSource",e.abortPreloadSource="abortPreloadSource",e.setVolume="setVolume",e.setMuted="setMuted",e.setFullscreen="setFullscreen",e.setPictureInPicture="setPictureInPicture",e.setPlaybackRate="setPlaybackRate",e.setVideoTrack="setVideoTrack",e.setAudioTrack="setAudioTrack",e.setTextTrack="setTextTrack",e.setNativeTextTrackVisibility="setNativeTextTrackVisibility",e.setNativeAdControlsVisibility="setNativeAdControlsVisibility",e.setHiddenControls="setHiddenControls",e.setVideoStyle="setVideoStyle",e.setPictureInPictureEnabled="setPictureInPictureEnabled",e.setExternalVisualState="setExternalVisualState",e.getExternalVisualState="getExternalVisualState",e.requestDebugInfo="requestDebugInfo",e.xhrRequest="xhrRequest",e.stopAd="stopAd",e.playInrollAd="playInrollAd",e.skipAdPod="skipAdPod",e.playAdViewers="playAdViewers",e.destroy="destroy",e.logDelta="logDelta"}(ef||(ef={}));class tf extends Ia.v{constructor(e){let{id:t,sender:r,receiver:i,internal:n=!1}=e;super(),this.id=void 0,this.sender=void 0,this.receiver=void 0,this.id=t,this.sender=r,this.receiver=i;i["handle_event_"+t]=e=>this.emit("Event",e);const s=n?e=>this.emit("Command",$p(e)):e=>this.emit("Command",e);i["handle_command_"+t]=s}sendEvent(e,t){let{sourceId:r=NaN,data:i}=t;try{this.sender["handle_event_"+this.id]({eventName:e,data:i,sourceId:r})}catch(n){}}sendCommand(e,t){try{this.sender["handle_command_"+this.id]({commandName:e,params:t,sendAnswer:$n.Z})}catch(r){}}sendRequest(e,t){return new Promise(r=>{try{this.sender["handle_command_"+this.id]({commandName:e,params:t,sendAnswer:r})}catch(i){}})}destroy(){this.receiver["handle_event_"+this.id]=void 0,this.receiver["handle_command_"+this.id]=void 0,this.off("Command"),this.off("Event")}}const rf=e=>void 0===e?void 0:String(e),nf={sourceId:NaN,data:void 0},sf={state:Gl.NOT_PLAYING,type:void 0,adParams:{}};w("internal_start");const af=c(window.location),of=af.vsid,lf=af.vpuid;let df;const cf=new tf({id:of,sender:window.parent,receiver:window,internal:!0}),uf=e=>{cf.sendEvent("onLogEvent",{sourceId:-1,data:e})},hf=e=>{const t=Bn(e),r=t.isFatal?h(t,ff):void 0,i=Bn(new ja(Wn({},t,{messageDetails:r})));cf.sendEvent("onError",{sourceId:qn(),data:i})};let pf=Xp.Unknown,ff=ss.I,mf=jh.PAUSE,gf=sf;Qe(window).playerJsLoaded=!0;const vf={};try{const e={onDrmSystemChange:e=>{cf.sendEvent("onDrmSystemChange",{sourceId:qn(),data:e})},onChangeStream:e=>{cf.sendEvent("onChangeStream",{sourceId:qn(),data:e}),e&&jn({},e.url)},onError:hf,onRecover:e=>{cf.sendEvent("onRecover",{sourceId:qn(),data:e})},onStateChange:e=>{const t=qn();cf.sendEvent("onStateChange",{sourceId:t,data:{playingState:e,reason:pf}}),mf!==e&&(mf=e,pf=Xp.Unknown)},onAdStateChange:e=>{gf.state!==e.state&&(pf=Xp.Unknown);const t=Wn({},gf);gf=e,cf.sendEvent("onAdStateChange",{sourceId:qn(),data:{nextAdState:e,prevAdState:t}})},onAdLoaded:e=>{cf.sendEvent("onAdLoaded",{sourceId:qn(),data:e})},onAdError:e=>{cf.sendEvent("onAdError",{sourceId:qn(),data:e})},onBeforeAdPodStart:e=>{cf.sendEvent("onBeforeAdPodStart",{sourceId:qn(),data:e})},onAdPodStart:()=>{cf.sendEvent("onAdPodStart",{sourceId:qn(),data:void 0})},onAdPodClick:()=>{cf.sendEvent("onAdPodClick",{sourceId:qn(),data:void 0})},onAdPodSkip:()=>{cf.sendEvent("onAdPodSkip",{sourceId:qn(),data:void 0})},onAdPodEnd:()=>{cf.sendEvent("onAdPodEnd",{sourceId:qn(),data:void 0})},onAdSkippableStateChange:e=>{cf.sendEvent("onAdSkippableStateChange",{sourceId:qn(),data:e})},onAdPodCloseStateChange:e=>{cf.sendEvent("onAdPodCloseStateChange",{sourceId:qn(),data:e})},onAdPodDurationChange:e=>{cf.sendEvent("onAdPodDurationChange",{sourceId:qn(),data:e})},onAdPodCurrentTimeChange:e=>{cf.sendEvent("onAdPodCurrentTimeChange",{sourceId:qn(),data:e})},onAdPodTimeToSkipChange:e=>{cf.sendEvent("onAdPodTimeToSkipChange",{sourceId:qn(),data:e})},onAdVolumeAvailabilityStateChange:e=>{cf.sendEvent("onAdVolumeAvailabilityStateChange",{sourceId:qn(),data:e})},onAdInteraction:()=>{cf.sendEvent("onAdInteraction",{sourceId:qn(),data:void 0})},onVideoTypeChange:e=>{cf.sendEvent("onVideoTypeChange",{sourceId:qn(),data:e})},onDVRStartTimeChange:()=>{void 0!==df&&cf.sendEvent("onTimelineInfoChange",{sourceId:qn(),data:Yn(df)})},onDVRDurationChange:()=>{void 0!==df&&cf.sendEvent("onTimelineInfoChange",{sourceId:qn(),data:Yn(df)})},onCurrentTimeChange:()=>{void 0!==df&&(cf.sendEvent("onPositionChange",{sourceId:qn(),data:{time:df.getState().controller.currentTime,utcTime:df.getUtcPosition(),watchedTime:df.getState().controller.watchedTime,videoPlaybackQuality:df.getVideoPlaybackQuality(),liveLatency:df.getLiveLatency()}}),cf.sendEvent("onTimelineInfoChange",{sourceId:qn(),data:Yn(df)}))},onFullScreenChange:e=>{cf.sendEvent("onFullScreenChange",{sourceId:qn(),data:e})},onVolumeChange:e=>{cf.sendEvent("onVolumeChange",{sourceId:qn(),data:e})},onVideoTrackChange:e=>{var t;cf.sendEvent("onVideoTrackChange",{sourceId:qn(),data:e}),cf.sendEvent("onCapSizeChange",{sourceId:qn(),data:null==(t=df)?void 0:t.getMaxCapAllowedVideoTrack()})},onVideoTracksChange:e=>{cf.sendEvent("onVideoTracksChange",{sourceId:qn(),data:e})},onAudioTrackChange:e=>{cf.sendEvent("onAudioTrackChange",{sourceId:qn(),data:e})},onAudioTracksChange:e=>{cf.sendEvent("onAudioTracksChange",{sourceId:qn(),data:e})},onTextTrackChange:e=>{cf.sendEvent("onTextTrackChange",{sourceId:qn(),data:e})},onTextTracksChange:e=>{cf.sendEvent("onTextTracksChange",{sourceId:qn(),data:e})},onSubtitlesChange:e=>{cf.sendEvent("onSubtitlesChange",{sourceId:qn(),data:e})},onPlaybackRateChange:e=>{cf.sendEvent("onPlaybackRateChange",{sourceId:qn(),data:e})},onThumbnailTileGeneralMetaInfoChange:e=>{cf.sendEvent("onThumbnailTileGeneralMetaInfoChange",{sourceId:qn(),data:e})},onOriginalBroadcastAdStateChange:e=>{cf.sendEvent("onOriginalBroadcastAdStateChange",{sourceId:qn(),data:e})},onAdblockDetected:e=>{ff=e,(0,Jn.Y)(()=>{window.Ya.Rum.updateErrors({blocker:ff}),window.Ya.Rum.setVars({"-blocker":ff}),w(vs,window.Ya.Rum.getTime(),!1,{[vs]:Number(ff)})})},onContentImpression:e=>{cf.sendEvent("onContentImpression",{sourceId:qn(),data:e})},onResourcesIdle:()=>{cf.sendEvent("onResourcesIdle",{sourceId:qn(),data:void 0})},onVisualStateChange:e=>{cf.sendEvent("onVisualStateChange",{sourceId:qn(),data:e})},onBufferingRangesChange:e=>{void 0!==df&&cf.sendEvent("onBufferingRangesChange",{sourceId:qn(),data:Gn(df,e)})},onStartStageChange:e=>{cf.sendEvent("onStartStageChange",{sourceId:qn(),data:e})},onVideoSizeChange:e=>{cf.sendEvent("onVideoSizeChange",{sourceId:qn(),data:e})},onNextAdRemainingTimeChange:e=>{cf.sendEvent("onNextAdRemainingTimeChange",{sourceId:qn(),data:e})},logEvent:uf,onStreamsWithSupportInfoChange:e=>{cf.sendEvent("onStreamsWithSupportInfoChange",{sourceId:qn(),data:e})},onEngineChange:(e,t)=>{cf.sendEvent("onEngineChange",{sourceId:t,data:e})},onNetworkStatusChange:e=>{cf.sendEvent("onNetworkStatusChange",{sourceId:qn(),data:e})},onBandwidthEstimateChange:e=>{cf.sendEvent("onBandwidthEstimateChange",{sourceId:qn(),data:e})},onCapSizeChange:e=>{cf.sendEvent("onCapSizeChange",{sourceId:qn(),data:e})},onPlaybackQualityUpdate:e=>{cf.sendEvent("onPlaybackQualityUpdate",{sourceId:qn(),data:e})},onExpectedStalledChange:e=>{cf.sendEvent("onExpectedStalledChange",{sourceId:qn(),data:e})},onRequestFullscreenChange:e=>{cf.sendEvent("onRequestFullscreenChange",{sourceId:qn(),data:e})},onInrollFrame:e=>{cf.sendEvent("onInrollFrame",{sourceId:qn(),data:e})},onPreloadDetailsUpdate:e=>{cf.sendEvent("onPreloadDetailsUpdate",{sourceId:qn(),data:{details:e}})}},t=$p(Rl.initialStreamPlayerParams),r=Wn({},t,{perfLogUrl:t.perfLogUrl,device:t.device,bandwidthEstimateOffset:t.bandwidthEstimateOffset,maxBufferLength:t.maxBufferLength,skinConfig:t.skinConfig,backgroundColor:t.backgroundColor,togglePlaybackOnVisibilityChange:t.togglePlaybackOnVisibilityChange,callbacks:e});cf.sendEvent("onInit",nf);const i=function(e){const t=window.parent.document.getElementById(gn(of));if(!t)throw new ja({code:us.PLAYER_CONTAINER_NOT_FOUND,isFatal:!1,details:e,message:"Player container was not found"});return t}(r);(function(e){return void 0===e&&(e=window),(0,Xc.w)(e.document.querySelectorAll("style[data-ya-player-style]"))})().forEach(e=>function(e,t){dn(e)!==dn(t)&&t.appendChild(e)}(e,i));const n=new Jp(i,Rl.isVisibilitySupported||!1);df=new Gp(i,r,{visualState:n},()=>cf.sendEvent("onReady",nf)),w(gs),cf.on("Command",e=>{switch(e.commandName){case ef.pause:pf=e.params,void 0!==df&&df.pause(),e.sendAnswer();break;case ef.play:pf=e.params,df?df.play().then(()=>{e.sendAnswer(!0)}).catch(()=>{e.sendAnswer(!1)}):e.sendAnswer(!1);break;case ef.seek:df.seek({videoTime:zn(df,e.params)});break;case ef.setPlaybackRate:df.setPlaybackRate(e.params);break;case ef.setSource:const{sourceConfig:a,shouldSaveProgress:o}=e.params;if(!a)throw new ja("setSource method receives an object");e.sendAnswer(),jn(a,a.streams[0].url),df.setSource(a,{shouldSaveProgress:o});break;case ef.preloadSource:const{sourceConfig:l,requestId:d}=e.params,{promise:c,abort:u,end:h}=df.preloadSource(l);vf[d]=u,c.then(()=>{cf.sendEvent("onPreloadSourceResolve",{sourceId:-1,data:d})}).catch(()=>{cf.sendEvent("onPreloadSourceReject",{sourceId:-1,data:d})}).then(()=>{h(),delete vf[d]});break;case ef.abortPreloadSource:const p=vf[e.params];(0,rs.m)(p)&&(p(),delete vf[e.params]);break;case ef.setVolume:e.params>0&&df.setMuted(!1),df.setVolume(e.params);break;case ef.setMuted:df.setMuted(e.params);break;case ef.setVideoTrack:df.setVideoTrack(e.params);break;case ef.setAudioTrack:df.setAudioTrack(e.params);break;case ef.setTextTrack:df.setTextTrack(e.params);break;case ef.setNativeTextTrackVisibility:df.setNativeTextTrackVisibility(e.params);break;case ef.setNativeAdControlsVisibility:df.setNativeAdControlsVisibility(e.params);break;case ef.setFullscreen:df.setFullscreen(e.params);break;case ef.setPictureInPicture:n.changePipState({isPip:e.params});break;case ef.setHiddenControls:df.setHiddenControls(e.params);break;case ef.setVideoStyle:df.setVideoStyle(e.params);break;case ef.setPictureInPictureEnabled:df.setPictureInPictureEnabled(e.params);break;case ef.requestDebugInfo:(async function(){var e;let t={};return void 0!==df&&(t=await df.requestDebugInfo()),Wn({},t,{adState:gf,playingState:mf,vsid:of,vpuid:lf,version:"1.0-11679",utcPosition:df.getUtcPosition(),currentTime:null==(e=df)?void 0:e.getState().controller.currentTime,system:xr(),clientTimestamp:Date.now(),internalInitialConfig:r})})().then(t=>e.sendAnswer(t));break;case ef.stopAd:df.stopAd({stopAdReason:La.InsertIntoCalled}).then(()=>{e.sendAnswer()});break;case ef.playInrollAd:df.playInrollAd(e.params);break;case ef.skipAdPod:df.skipAdPod();break;case ef.playAdViewers:const{adType:f,adViewers:g}=e.params;df.playAdViewers(f,g,{},!0).then(()=>{e.sendAnswer({success:!0})}).catch(()=>{e.sendAnswer({success:!1})});break;case ef.destroy:n.destroy(),void 0!==df&&df.destroy().catch($n.Z).then(()=>{e.sendAnswer(e.params)}),e.sendAnswer(e.params);break;case ef.setExternalVisualState:"boolean"===typeof e.params.isVisible&&n.setExternalVisibility(e.params.isVisible),"boolean"===typeof e.params.isFullscreen&&n.setExternalFullscreen(e.params.isFullscreen);break;case ef.logDelta:t=e.params.deltaId,i=e.params.value,void 0===(s=e.params.params)&&(s={}),m()&&(0,Jn.Y)(()=>{const{additional:e,initSubpage:r=!1}=s,n=S(s,Rs);if(r&&y()>0)return;const a=v(),o=(0,ys.K)(a)?a.additional:void 0;window.Ya.Rum.sendDelta(t,i,E({},a,n,{"-additional":(0,ys.K)(e)?(0,Es.B6)(E({},o,e)):(0,Es.B6)(o)}))});break;default:throw new Error("IFrameApi Error: unexpected command in MessageEvent: "+e.commandName)}var t,i,s}),A("detect.visibility"),"boolean"===typeof Rl.initialVisibility?(n.setExternalVisibility(Rl.initialVisibility),T("detect.visibility")):cf.sendRequest(ef.getExternalVisualState,void 0).then(e=>{let{isVisible:t}=e;n.setExternalVisibility(t),T("detect.visibility")})}catch(Ef){cf.sendEvent("onInitError",{sourceId:1,data:Bn(new ja(Wn({},Ef,{isFatal:"boolean"!==typeof Ef.isFatal||Ef.isFatal,code:Ef.code||us.ON_PLAYER_INIT_ERROR})))})}},3603:(e,t,r)=>{"use strict";r.d(t,{s:()=>o});var i=r(8468),n=r(3496),s=r(3525);const a=r(8139);class o extends Error{constructor(e,t){void 0===t&&(t={});const r="object"===typeof e?e:{message:String(e||s.J.message)};super(),this.message=void 0,this.code=void 0,this.category=void 0,this.isFatal=void 0,this.details=void 0,this.stack=void 0,this.toString=void 0,this.toJSON=void 0,a(this,o.prototype),this.message=t.message||r.message||s.J.message,this.code=t.code||r.code||r.id||s.J.code,this.category=t.category||r.category||s.J.category,this.isFatal=Boolean((0,n.d)([t.isFatal,r.isFatal,s.J.isFatal])),this.details=t.details||r.details||s.J.details,Object.defineProperty(this,"stack",{enumerable:!0});const l=t.stack||r.stack||function(e){const{url:t,line:r,col:i,fileName:n,columnNumber:s,lineNumber:a}=e;return(t||n||"?")+":"+(r||a||"?")+":"+(i||s||"?")}(r);let d=l===s.J.stack?this.stack:l;if(d&&d!==s.J.stack)this.stack=d;else if(!this.stack)try{throw new Error(this.message)}catch(c){this.stack=d=c.stack||s.J.stack}this.toString=()=>(0,i.Y)(this.toJSON())||"{}",this.toJSON=()=>({message:this.message,code:this.code,isFatal:this.isFatal,details:this.details,category:this.category,stack:d})}}},3525:(e,t,r)=>{"use strict";r.d(t,{J:()=>i});const i={message:"DEFAULT_ERROR_MESSAGE",code:0,details:"",stack:"?:?:?",isFatal:!0,category:"DEFAULT"}},914:(e,t,r)=>{"use strict";r.d(t,{i:()=>i});const i=function(e){void 0===e&&(e=window);const t=e.Object;try{const e={};return t.defineProperty(e,"sentinel",{}),"sentinel"in e}catch(r){return!1}}},520:(e,t,r)=>{"use strict";function i(e){const t=e.map(e=>{let{start:t,end:r}=e;return{start:t,end:r}}).sort((e,t)=>e.start-t.start);if(t.length<=1)return t;const r=[t[0]];return t.slice(1).forEach((e,t)=>{const i=r[r.length-1];i.end<e.start?r.push(e):i.end<e.end&&(i.end=e.end)}),r}r.d(t,{l:()=>i})},3480:(e,t,r)=>{"use strict";function i(e){void 0===e&&(e=window);const t=(0,n.RW)("web_add_mms_ios")&&e.ManagedMediaSource||e.MediaSource||e.WebKitMediaSource;return t&&(0,s.m)(t.isTypeSupported)&&!function(e){void 0===e&&(e=window);const t=e.SourceBuffer||e.WebKitSourceBuffer;return!!t&&!(t.prototype&&(0,s.m)(t.prototype.appendBuffer)&&(0,s.m)(t.prototype.remove))}(e)?t:void 0}r.d(t,{Q:()=>i});var n=r(2178),s=r(4754)},3635:(e,t,r)=>{"use strict";function i(e,t){let r=e[t];if(!(0,n.t)(r)){const n=r;try{delete e[t];const i=e[t];"function"===typeof i&&(r=i),e[t]=n}catch(i){}}return r}r.d(t,{C:()=>i});var n=r(2839)},7974:(e,t,r)=>{"use strict";function i(e,t,r){for(const i in e)(0,n.n)(e,i)&&t.call(r,e[i],i,e)}r.d(t,{M:()=>i});var n=r(8870)},9298:(e,t,r)=>{"use strict";function i(e){if("function"===typeof Object.keys)return Object.keys(e);const t=[];for(const r in e)(0,n.n)(e,r)&&t.push(r);return t}r.d(t,{Z:()=>i});var n=r(8870)},2615:(e,t,r)=>{"use strict";function i(e){const t=Object.values;if("function"===typeof t)return t(e);const r=[];for(const i in e)(0,n.n)(e,i)&&r.push(e[i]);return r}r.d(t,{z:()=>i});var n=r(8870)},8870:(e,t,r)=>{"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}r.d(t,{n:()=>i})},5689:(e,t,r)=>{"use strict";function i(e){const t=typeof e;return Boolean(e)&&("object"===t||"function"===t)}r.d(t,{K:()=>i})},6295:(e,t,r)=>{"use strict";r.d(t,{h:()=>i});const i=(e,t,r)=>{const i=[];for(let n=0;n<e.length;n++){const s=e[n];t.call(r,s,n,e)&&i.push(s)}return i}},5002:(e,t,r)=>{"use strict";r.d(t,{s:()=>s});var i=r(2839);const n=[].find,s=(0,i.t)(n)?(e,t)=>n.call(e,t):(e,t)=>{for(let r=0;r<e.length;r++){const i=e[r];if(t(i,r,e))return i}}},3496:(e,t,r)=>{"use strict";function i(e){const[t]=(0,n.h)(e,e=>void 0!==e);return t}r.d(t,{d:()=>i});var n=r(6295)},8243:(e,t,r)=>{"use strict";function i(e,t,r,i){const a=function(e){let t=!1,r=!1,i=!1;return!0===e?t=!0:"object"===typeof e&&(t=Boolean(e.capture),r=Boolean(e.passive),i=Boolean(e.once)),{capture:t,passive:r,once:i}}(i),o=s.FF?a:a.capture,l=a.once&&!s.vE?function(e){d(),r.call(this,e)}:r,d=()=>{(0,n.f)(e,t,l,o)};return(0,n.h)(e,t,l,o),d}r.d(t,{O:()=>i});var n=r(3751),s=r(895)},3751:(e,t,r)=>{"use strict";r.d(t,{f:()=>a,h:()=>s});var i=r(3635),n=r(4754);let s=function(e,t,r){(0,n.m)(e.attachEvent)&&e.attachEvent("on"+t,r)},a=function(e,t,r){(0,n.m)(e.detachEvent)&&e.detachEvent("on"+t,r)};(0,i.C)(EventTarget.prototype,"addEventListener")&&(0,i.C)(EventTarget.prototype,"removeEventListener")&&(s=function(e,t,r,n){const s=e&&(0,i.C)(e,"addEventListener");s&&s.call(e,t,r,n)},a=function(e,t,r,n){const s=e&&(0,i.C)(e,"removeEventListener");s&&s.call(e,t,r,n)})},895:(e,t,r)=>{"use strict";r.d(t,{FF:()=>l,vE:()=>a});var i=r(914),n=r(4612),s=r(3751);let a=!1,o=!1,l=!1;try{if((0,i.i)()){const e=document.createElement("div"),t={};Object.defineProperty(t,"once",{get:()=>a=!0}),Object.defineProperty(t,"passive",{get:()=>o=!0}),Object.defineProperty(t,"capture",{get:()=>l=!0}),(0,s.h)(e,"click",n.Z,t)}}catch(d){}},1153:(e,t,r)=>{"use strict";function i(e){let t=function(){let r;return t=()=>r,r=e.apply(this,arguments),r};return function(){return t.apply(this,arguments)}}r.d(t,{I:()=>i})},9117:(e,t,r)=>{"use strict";function i(e){return e instanceof Error||"Error"===(0,n.M)(e)}r.d(t,{V:()=>i});var n=r(9951)},4754:(e,t,r)=>{"use strict";function i(e){return"function"===typeof e||"Function"===(0,n.M)(e)}r.d(t,{m:()=>i});var n=r(9951)},5214:(e,t,r)=>{"use strict";function i(e){if(!e)return[];const t=[];for(let r=0;r<e.length;r++)t.push(e[r]);return t}r.d(t,{w:()=>i})},6252:(e,t,r)=>{"use strict";function i(e){e&&"function"===typeof e.catch&&e.catch(e=>{})}r.d(t,{v:()=>i})},9066:(e,t,r)=>{"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function n(e){const{method:t,url:r,async:d=!0,data:c,responseType:u="text",onBeforeSend:h=a.Z,onRetry:p=a.Z,checkStatus:f=(e=>l===e),headers:m={},xhrConstructor:g=XMLHttpRequest,retries:v=0,timeout:y=0,withCredentials:E,onAbort:S,onSetup:A}=e;if(!g)return;const T=e.onSuccess?(0,s.I)(e.onSuccess):a.Z,b=e.onError?(0,s.I)(e.onError):a.Z;let w,_=!1,R=0,k=e=>{_=!0,k=a.Z,w=e,P(new Error("Abort request")),"function"===typeof S&&S(e)};const P=t=>{I.onerror=null,I.onreadystatechange=null,R&&clearTimeout(R);if(R&&4!==I.readyState||_)try{I.abort()}catch(r){}if(!_)if(v>0){const r=p(t,I);if("boolean"!==typeof r||r||k(),_)return;n(i({},e,{onSetup:e=>{let{abort:t}=e;k=e=>t(e),_&&t(w)},retries:v-1}))}else k=a.Z,b(t,I)},I=new g;try{I.open(t,r,d)}catch(C){return void P(C)}if(I.responseType=u,I.withCredentials=Boolean(E),(0,o.M)(m,(e,t)=>{try{I.setRequestHeader(t,e)}catch(C){}}),y>0&&isFinite(y)&&(R=window.setTimeout(()=>{P(new Error("Request timeout, "+r))},y)),I.onerror=P,I.onreadystatechange=()=>{if(4===I.readyState){const{status:e}=I;f(e)?(k=a.Z,clearTimeout(R),T(I)):P(new Error("Invalid request status "+e+", "+r))}},("function"!==typeof A||(A({abort:e=>k(e)}),!_))&&(h(I,e),!_))try{I.send(c)}catch(C){P(C)}}r.d(t,{W:()=>n});var s=r(1153),a=r(4612),o=r(7974);const l=200},7668:(e,t,r)=>{"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function n(e){return new Promise((t,r)=>{(0,s.W)(i({},e,{onSuccess:t,onError:r}))})}r.d(t,{W:()=>n});var s=r(9066)},4612:(e,t,r)=>{"use strict";function i(){}r.d(t,{Z:()=>i})},7989:(e,t,r)=>{"use strict";function i(e){return"number"===typeof e&&isFinite(e)}r.d(t,{z:()=>i})},3125:(e,t,r)=>{"use strict";function i(e){void 0===e&&(e=n.no);const t=e();return()=>Math.max(0,e()-t)}r.d(t,{u:()=>i});var n=r(8584)},4204:(e,t,r)=>{"use strict";r.d(t,{_:()=>i});const i=async(e,t)=>{let r;try{await new Promise((i,n)=>{t&&t.then(i,n),r=window.setTimeout(i,e)})}finally{window.clearTimeout(r)}}},9899:(e,t,r)=>{"use strict";function i(e){return"string"===typeof e}r.d(t,{H:()=>i})},8712:(e,t,r)=>{"use strict";function i(e,t){try{return e()}catch(r){"function"===typeof t&&t(r)}}r.d(t,{Y:()=>i})},6971:(e,t,r)=>{"use strict";let i;r.d(t,{q:()=>i}),function(e){e.DEFAULT="DEFAULT",e.MEDIA="MEDIA",e.NETWORK_MEDIA="NETWORK_MEDIA",e.NETWORK_PLAYER="NETWORK_PLAYER",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NO_CODECS="NO_CODECS",e.CANNOT_PLAY="CANNOT_PLAY",e.UNSUPPORTED_ENV="UNSUPPORTED_ENV",e.EXCEPTION="EXCEPTION",e.ADS="ADS",e.CONFIG="CONFIG",e.REGIONAL="REGIONAL",e.DRM="DRM",e.ACCESS="ACCESS",e.BANNED="BANNED"}(i||(i={}))},5636:(e,t,r)=>{"use strict";r.d(t,{B:()=>n});var i=r(55);class n{constructor(){this.resolve=void 0,this.reject=void 0,this.promise=void 0;let e=i.Z,t=i.Z;this.promise=new Promise((r,i)=>{e=r,t=i}),this.resolve=e,this.reject=t}}},45:(e,t,r)=>{"use strict";let i;r.d(t,{v:()=>i}),function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",e[e.PARSE_ERROR=-32700]="PARSE_ERROR",e[e.INVALID_REQUEST=-32600]="INVALID_REQUEST",e[e.METHOD_NOT_FOUND=-32601]="METHOD_NOT_FOUND",e[e.INVALID_PARAMS=-32602]="INVALID_PARAMS",e[e.INTERNAL_ERROR=-32603]="INTERNAL_ERROR"}(i||(i={}))},5605:(e,t,r)=>{"use strict";function i(e){return(0,n.H)(e.tagName)}r.d(t,{m:()=>i});var n=r(9899)},8836:(e,t,r)=>{"use strict";function i(e){return Object.prototype.toString.call(e)===n}r.d(t,{F:()=>i,u:()=>n});const n="[object Window]"},8468:(e,t,r)=>{"use strict";function i(e,t){return e+"/"+t}function n(e){if("string"===typeof e&&(e={message:e}),"object"===typeof e&&null!==e||(e={}),"function"===typeof e.toJSON)try{return{__stringifyError:e.toJSON()}}catch(n){}const{name:t,message:r,stack:i}=e;return{__stringifyError:{name:t,message:r,stack:i}}}function s(e,t,r,n){const s=o(e[t],i(r,t),n);return void 0===s?"null":s}function a(e){return JSON.stringify(e)}function o(e,t,r){switch(typeof e){case"boolean":return e?"true":"false";case"string":return a(e);case"undefined":return;case"bigint":return a(e.toString());case"function":return a("[Function"+("string"===typeof e.name&&e.name.length>0?" "+e.name:"")+"]");case"symbol":return a("[Symbol]");case"number":return isNaN(e)||!isFinite(e)?"null":String(e);case"object":if(null===e)return"null";if((0,u.F)(e))return a(u.u);if((0,c.m)(e))return a("[DOMNode "+e.tagName+"]");if((0,h.f)(e)){const{name:t}=e.constructor;return a("["+(t||"TypedArray")+"("+(e.byteLength||0)+")]")}const l=r.get(e);if(void 0!==l)return a("[Circular "+l+"]");r.set(e,t);return(0,p.k)(e)?function(e,t,r){if(0===e.length)return"[]";let i="["+s(e,0,t,r);for(let n=1;n<e.length;n++)i+=","+s(e,n,t,r);return i+"]"}(e,t,r):function(e,t,r){if("function"===typeof e.toJSON){let s;try{s=e.toJSON()}catch(d){s=n(d)}return o(s,i(t,"toJSON"),r)}let s="{",l=!0;for(let c in e){if(!Object.prototype.hasOwnProperty.call(e,c))continue;let u;try{u=e[c]}catch(d){u=n(d)}const h=o(u,i(t,c),r);void 0!==h&&(l?l=!1:s+=",",s+=a(c)+":"+h)}return s+"}"}(e,t,r)}}function l(e){try{return o(e,"~",function(){const e="undefined"!==typeof WeakMap?new WeakMap:void 0,t=[];return{set:(r,i)=>{if(void 0!==e)try{e.set(r,i)}catch(n){t.push({path:i,value:r})}else t.push({path:i,value:r})},get:r=>{const i=(0,d.s)(t,e=>e.value===r);return void 0!==e&&void 0===i?e.get(r):i?i.path:void 0}}}())}catch(t){return JSON.stringify(n(t))}}r.d(t,{Y:()=>l});var d=r(5002),c=r(5605),u=r(8836),h=r(6028),p=r(2364)},2364:(e,t,r)=>{"use strict";r.d(t,{k:()=>i});const i="function"===typeof Array.isArray?Array.isArray:function(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}},6028:(e,t,r)=>{"use strict";function i(e){return"undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&ArrayBuffer.isView(e)}r.d(t,{f:()=>i})},55:(e,t,r)=>{"use strict";function i(){}r.d(t,{Z:()=>i})},9329:(e,t,r)=>{"use strict";r.d(t,{v:()=>i});class i{constructor(){this.handlers=Object.create(null),this.onceHandlers=Object.create(null),this.maxEventListeners=10}setMaxListeners(e){!isFinite(e)||e<=0||(this.maxEventListeners=e)}on(e,t){this.getHandlers(e).push(t),this.checkSubscriptions(e)}once(e,t){this.getOnceHandlers(e).push(t),this.checkSubscriptions(e)}off(e,t){const r=this.getHandlers(e),i=this.getOnceHandlers(e);if(void 0===t)return r.length=0,void(i.length=0);this.removeHandler(t,r),this.removeHandler(t,i)}emit(e,t){const r=this.getHandlers(e),i=this.getOnceHandlers(e).slice();this.getOnceHandlers(e).length=0,r.slice().concat(i).forEach(e=>{try{e(t)}catch(r){setTimeout(()=>{throw r},0)}})}getHandlers(e){return void 0===this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e]}getOnceHandlers(e){return void 0===this.onceHandlers[e]&&(this.onceHandlers[e]=[]),this.onceHandlers[e]}checkSubscriptions(e){const t=this.getHandlers(e).length+this.getOnceHandlers(e).length;t>this.maxEventListeners&&console.warn("There are "+t+" subscriptions on event named "+String(e))}removeHandler(e,t){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}}},2390:(e,t,r)=>{"use strict";function i(e){function t(){return i.length<e}function r(e){function r(){i.splice(i.indexOf(s),1),function(){if(!t())return;const e=n.shift();e&&e()}()}const s=e.then(r,r);return i.push(s),e}void 0===e&&(e=1);const i=[],n=[];return{waitAndLock:function(e){return t()?r(e()):new Promise(t=>{n.push(()=>{t(r(e()))})})},addLock:r,isFree:t}}r.d(t,{l:()=>i})},5809:(e,t,r)=>{"use strict";r.d(t,{q:()=>n,z:()=>i});const i="https://strm.yandex.net/int/enc/srvr.xml",n="int/enc/srvr.xml"},5357:(e,t,r)=>{"use strict";r.d(t,{I:()=>n});var i=r(5809);const n=-1===i.z.indexOf(i.q)},9150:(e,t,r)=>{"use strict";function i(e){const t=[];for(let i=0;i<e.buffered.length;i++)try{t.push({start:e.buffered.start(i),end:e.buffered.end(i)})}catch(r){}return(0,n.l)(t)}r.d(t,{w:()=>i});var n=r(520);r(7881)},4519:(e,t,r)=>{"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function n(){return g||(!function(){try{m=encodeURIComponent(JSON.stringify(i({},p,f)))}catch(e){}}(),g=!0),m}function s(){return i({},p,f)}function a(){try{return JSON.parse(window.Ya.Rum._vars["-additional"])}catch(e){return{}}}function o(){try{return window.Ya.Rum.setVars({"-additional":JSON.stringify(p)})}catch(e){}}function l(){try{return window.Ya.Rum.updateErrors({additional:i({},p)})}catch(e){}}function d(e){return void 0===e||void 0===e.additional?n():encodeURIComponent(JSON.stringify(i({},p,f,e.additional)))}function c(e){p=i({},a(),e),o(),l(),g=!1}function u(e,t){p=i({},a(),{[e]:t}),o(),l(),g=!1}function h(e){f=e,g=!1}r.d(t,{B6:()=>d,I8:()=>c,Pj:()=>h,Vk:()=>s,Z$:()=>u});let p={},f={},m="",g=!1},8493:(e,t,r)=>{"use strict";r.d(t,{S:()=>i,e:()=>n});r(7881);const i=1e6,n=1e5},9787:(e,t,r)=>{"use strict";r.d(t,{T:()=>i});r(7881);const i=360},3564:(e,t,r)=>{"use strict";function i(e){const t=new URL(e);return t.searchParams.set(n,String(Date.now())),t.href}r.d(t,{c:()=>i,j:()=>n});const n="t"},6513:(e,t,r)=>{"use strict";function i(e,t,r){let{videoWidth:i,videoHeight:n}=e;const{width:s,height:a}=r;if(!i||!n)return{width:s,height:a};switch(t){case"none":return{width:i,height:n};case"cover":{const e=Math.floor(n*s/i);return e>=a?{width:s,height:e}:{height:a,width:Math.floor(i*a/n)}}case"contain":case"scale-down":{const e=Math.floor(n*s/i);return e<=a?{width:s,height:e}:{height:a,width:Math.floor(i*a/n)}}case"fill":default:return{width:s,height:a}}}r.d(t,{k:()=>i});r(7881)},4893:(e,t,r)=>{"use strict";r.d(t,{k:()=>s,nK:()=>a});var i=r(9396),n=r(2178);const s={width:null,height:null,timestamp:null},a=()=>{const e=i.t.getItem("videoplayer-user-quality-choice");if(!e)return s;try{const t=JSON.parse(e);return t?(0,n.RW)("web_userquality_ttl")&&(t.timestamp||(t.timestamp=Date.now()-2592e6+Math.round(6048e4*Math.random()),i.t.setItem("videoplayer-user-quality-choice",JSON.stringify(t))),t.timestamp+2592e6<Date.now())?s:t:s}catch(t){return s}}},442:(e,t,r)=>{"use strict";r.d(t,{C:()=>s,d4:()=>i,e8:()=>n});r(7881);const i=8e3,n=1e4,s=1e4},2248:(e,t,r)=>{"use strict";r.d(t,{T:()=>i});const i=["strm.yandex.net","strm.yandex.ru","strm-ott.akamaized.net","media.strm.yandex.net","cdn.ngenix.net","streaming.tst.strm.yandex.net"]},8682:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});const i="auto"},2786:(e,t,r)=>{"use strict";function i(e){void 0===e&&(e=window);const{navigator:t}=e,{connection:r={}}=t;return Boolean(r.saveData)}r.d(t,{R:()=>i})},7922:(e,t,r)=>{"use strict";r.d(t,{D:()=>n,h9:()=>s,ly:()=>i,oo:()=>a,xE:()=>o});const i="com.widevine.alpha",n="com.apple.fairplay",s="com.apple.fps.1_0",a="com.apple.fps.2_0",o="com.microsoft.playready"},3984:(e,t,r)=>{"use strict";r.d(t,{I:()=>a});r(7881);class i{constructor(e){this.alpha=void 0,this.estimate=0,this.totalWeight=0,this.setHalfLife(e)}sample(e,t){const r=Math.pow(this.alpha,e),i=t*(1-r)+r*this.estimate;isNaN(i)||(this.estimate=i,this.totalWeight+=e)}getEstimate(){const e=1-Math.pow(this.alpha,this.totalWeight);return this.estimate/e}setHalfLife(e){this.alpha=Math.exp(Math.log(.5)/e)}}const n={fast:2,slow:5},s={fast:1,slow:2};class a{constructor(e){void 0===e&&(e=!1),this.useConstWeight=e,this.fast=void 0,this.slow=void 0,this.bytesSampled=0,this.fast=new i(n.fast),this.slow=new i(n.slow)}sample(e,t,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=16e3),e<=0||t<(r?2e3:i))return;this.setHalfLife(r?s:n);let a=8*t/(e/1e3);const o=this.useConstWeight?.1:e/1e3;this.bytesSampled=this.bytesSampled+t,this.fast.sample(o,a),this.slow.sample(o,a)}getBandwidthEstimate(e){return this.hasGoodEstimate()?{value:this.getCurrentEstimate(),source:"ewma"}:e}hasGoodEstimate(){return this.bytesSampled>=128e3}getCurrentEstimate(){return Math.min(this.fast.getEstimate(),this.slow.getEstimate())}setHalfLife(e){this.fast.setHalfLife(e.fast),this.slow.setHalfLife(e.slow)}}},4834:(e,t,r)=>{"use strict";r.d(t,{a:()=>i});r(7881);const i=5},4910:(e,t,r)=>{"use strict";function i(e){return void 0===e?"":function(e){try{const t=new URL(e);return t.searchParams.delete(s.g),t.href}catch(t){return e}}(e).replace(/#.+$/,"")}function n(e){try{return new URL(e).searchParams.get(s.g)}catch(t){return null}}r.d(t,{Hi:()=>i,IN:()=>n});var s=r(123)},153:(e,t,r)=>{"use strict";r.d(t,{K:()=>i});const i=500},1911:(e,t,r)=>{"use strict";r.d(t,{d:()=>i});class i{constructor(e){this.buffer=[],this.head=0,this.capacity=void 0,this.capacity=e}push(e){this.buffer.length<this.capacity?this.buffer.push(e):this.buffer[this.head]=e,this.head=(this.head+1)%this.capacity}toArray(){return this.buffer.length<this.capacity?[...this.buffer]:[...this.buffer.slice(this.head),...this.buffer.slice(0,this.head)]}}},7817:(e,t,r)=>{"use strict";r.d(t,{x:()=>i});class i{static fromUTF8(e){if(!e)return"";let t=new Uint8Array(e);239===t[0]&&187===t[1]&&191===t[2]&&(t=t.subarray(3));let r=i.fromCharCode(t),n=escape(r);try{return decodeURIComponent(n)}catch(s){throw new Error("BAD_ENCODING")}}static fromUTF16(e,t,r){if(void 0===r&&(r=!1),!e)return"";if(!r&&e.byteLength%2!==0)throw new Error("BAD_ENCODING: Data has an incorrect length, must be even");let n;if(e instanceof ArrayBuffer)n=e;else{let t=new Uint8Array(e.byteLength);t.set(new Uint8Array(e)),n=t.buffer}let s=Math.floor(e.byteLength/2),a=new Uint16Array(s),o=new DataView(n);for(let i=0;i<s;i++)a[i]=o.getUint16(2*i,t);return i.fromCharCode(a)}static fromBytesAutoDetect(e){let t=new Uint8Array(e);if(239===t[0]&&187===t[1]&&191===t[2])return i.fromUTF8(t);if(254===t[0]&&255===t[1])return i.fromUTF16(t.subarray(2),!1);if(255===t[0]&&254===t[1])return i.fromUTF16(t.subarray(2),!0);const r=function(e,t){return e.byteLength<=t||e[t]>=32&&e[t]<=126};if(0===t[0]&&0===t[2])return i.fromUTF16(e,!1);if(0===t[1]&&0===t[3])return i.fromUTF16(e,!0);if(r(t,0)&&r(t,1)&&r(t,2)&&r(t,3))return i.fromUTF8(e);throw new Error("UNABLE_TO_DETECT_ENCODING")}static toUTF8(e){let t=encodeURIComponent(e),r=unescape(t),i=new Uint8Array(r.length);for(let n=0;n<r.length;++n)i[n]=r.charCodeAt(n);return i.buffer}static toUTF16(e,t){const r=new Uint8Array(2*e.length),i=new DataView(r.buffer);for(let n=0;n<e.length;++n){const r=e.charCodeAt(n);i.setUint16(2*n,r,t)}return r.buffer}static fromCharCode(e){if(!i.fromCharCodeImpl){const e=e=>{try{const t=new Uint8Array(e);return String.fromCharCode.apply(null,t).length>0}catch(t){return!1}};for(let t=65536;t>0;t/=2)if(e(t)){i.fromCharCodeImpl=e=>{let r="";for(let i=0;i<e.length;i+=t){const n=e.subarray(i,i+t);r+=String.fromCharCode.apply(null,n)}return r};break}}if(!i.fromCharCodeImpl)throw new Error("Unable to create a fromCharCode method");return i.fromCharCodeImpl(e)}static resetFromCharCode(){i.fromCharCodeImpl=null}}i.fromCharCodeImpl=null},2918:(e,t,r)=>{"use strict";r.d(t,{P:()=>n});var i=r(7817);class n{static concat(){let e=0;for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(let a=0;a<r.length;++a)e+=r[a].length;let n=new Uint8Array(e),s=0;for(let a=0;a<r.length;++a)n.set(r[a],s),s+=r[a].length;return n}static toHex(e){let t="";for(let r=0;r<e.length;++r){let i=e[r].toString(16);1===i.length&&(i="0"+i),t+=i}return t}static fromHex(e){let t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substr(r,2),16);return t}static toBase64(e,t){void 0===t&&(t=!0);let r=i.x.fromCharCode(e),n=btoa(r).replace(/\+/g,"-").replace(/\//g,"_");return t?n:n.replace(/=*$/,"")}static fromBase64(e){let t=atob(e.replace(/-/g,"+").replace(/_/g,"/")),r=new Uint8Array(t.length);for(let i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}static equal(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}}},9473:(e,t,r)=>{"use strict";function i(e,t){return(0,n.V)(e,t,(e,t)=>e-t)}r.d(t,{U:()=>i});var n=r(7177)},7177:(e,t,r)=>{"use strict";function i(e,t,r){if(e.length<1)return;let[i]=e,n=t(i);for(let s=1;s<e.length;s++){const a=e[s],o=t(a);r(o,n)<0&&(i=a,n=o)}return i}r.d(t,{V:()=>i})},6702:(e,t,r)=>{"use strict";function i(e){const t=(0,n.jS)("web_yasp_target_latency_debug");return-1===t?e:(0,s.z)(t)?t:e}r.d(t,{c:()=>i});r(7881);var n=r(2178),s=r(7989)},1841:(e,t,r)=>{"use strict";function i(){const e=(0,n.r0)("web_yasp_time_to_start");if(!e||"null"===e)return;const t=parseFloat(e);return(0,s.z)(t)?t:void 0}r.d(t,{p:()=>i});r(7881);var n=r(2178),s=r(7989)},5052:(e,t,r)=>{"use strict";function i(e){return new Promise(t=>setTimeout(t,e))}r.d(t,{_:()=>i})},1106:(e,t,r)=>{"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}r.d(t,{w:()=>s});var n=r(3603);class s extends n.s{constructor(e,t){super(i({isFatal:!1},e),t),this.category=void 0,this.toJSON=void 0,this.category=(null==t?void 0:t.category)||e.category,this.toJSON=()=>({message:this.message,code:this.code,isFatal:this.isFatal,details:this.details,stack:this.stack,category:this.category})}}},5887:(e,t,r)=>{"use strict";r.d(t,{C:()=>i});r(7881);const i=1},1647:(e,t,r)=>{"use strict";function i(e,t){void 0===t&&(t=[]);for(const r in e)s.some(t=>{var i;return null!=(i=(0,n.Y)(()=>e[r]instanceof t))&&i})?t.push(e[r]):null!==e[r]&&"object"===typeof e[r]&&i(e[r],t);return t}r.d(t,{_:()=>i});var n=r(8712);const s=[..."undefined"!==typeof MediaSourceHandle?[MediaSourceHandle]:[]]},7926:(e,t,r)=>{"use strict";function i(e){let{id:t,method:r,params:i}=e;return t?{jsonrpc:"2.0",id:t,method:r,params:i}:{jsonrpc:"2.0",method:r,params:i}}function n(e){if(!("params"in e))return[];if(Array.isArray(e.params))return e.params;if((0,u.K)(e.params))return e.params;throw new Error("Expect #params to be an array or an object if present in "+JSON.stringify(e))}function s(e){return a(e)}function a(e){if((0,c.z)(e.id)){if(Math.floor(e.id)!==e.id)throw new Error("Expect #id to be an integer if it's a number in "+JSON.stringify(e));return e.id}if((0,h.H)(e.id)||null===e.id)return e.id;throw new Error("Expect #id to be an integer, string or null (not recommended) in "+JSON.stringify(e))}function o(e){if(!("id"in e))throw new Error("Expect #id to present in rpc response "+JSON.stringify(e));return a(e)}function l(e){if("object"!==typeof e.error||null===e.error)throw new Error("Expect #error to be an object in "+JSON.stringify(e));const t=e.error;if(!(0,c.z)(t.code))throw new Error("Expect #error#code to be an number in "+JSON.stringify(e));if(!(0,h.H)(t.message))throw new Error("Expect #error#message to be an string in "+JSON.stringify(e));return"data"in t?{code:t.code,message:t.message,data:t.data}:{code:t.code,message:t.message}}function d(e){const t=function(e){if(!(0,u.K)(e))throw new Error("Can't parse \""+e+'" as object');return e}(e);if(!function(e){return"2.0"===e.jsonrpc}(t))throw new Error("Expect "+((0,p.Y)(()=>JSON.stringify(e))||e)+" to be a json-rpc v2 message");if((0,h.H)(t.method))return function(e){return"id"in e?{jsonrpc:e.jsonrpc,method:e.method,params:n(e),id:s(e)}:{jsonrpc:e.jsonrpc,method:e.method,params:n(e)}}(t);if("result"in t)return function(e){return{jsonrpc:e.jsonrpc,result:e.result,id:o(e)}}(t);if("error"in t)return function(e){return{jsonrpc:e.jsonrpc,error:l(e),id:o(e)}}(t);throw new Error("Expect "+((0,p.Y)(()=>JSON.stringify(e))||e)+" to be a json-rpc v2 message")}r.d(t,{A:()=>T});var c=r(7989),u=r(5689),h=r(9899),p=r(8712),f=r(45),m=r(8139),g=r.n(m);class v extends Error{constructor(e,t,r){void 0===t&&(t=f.v.UNKNOWN_ERROR),super(e),this.message=void 0,this.stack=void 0,this.toJSON=void 0,this.code=void 0,g()(this,v.prototype),this.message=e,this.code=t,this.stack=null!=r?r:this.stack,this.toJSON=()=>({code:this.code,message:this.message,data:this.stack})}toString(){return JSON.stringify(this.toJSON())}}r(7881);var y=r(4513),E=r(55);class S extends y.M{constructor(e){super(),this.lastRpcRequestId=1,this.waiters=Object.create(null),this.send=void 0,this.onRun=void 0,this.serialize=void 0,this.deserialize=void 0,this.send=e.send,this.onRun=e.onRun,this.serialize=e.serialize,this.deserialize=e.deserialize}destroy(){super.destroy(),this.onRun=E.Z;for(const e in this.waiters)this.waiters[e](new Error("Stop on destroy"))}request(e,t){let{method:r,params:n}=e;void 0===t&&(t=3e4);const s=this.getUniqueRpcRequestId();return this.sendMessage(i({id:s,method:r,params:n})),this.waitForResponse(s,t,r)}sendEvent(e){let{method:t,params:r}=e;return this.sendMessage(i({method:t,params:r})),Promise.resolve()}getUniqueRpcRequestId(){return String(this.lastRpcRequestId++)}waitForResponse(e,t,r){const i=setTimeout(()=>{const i=this.waiters[e];void 0!==i&&i(new Error("Timeout fired ("+t+"ms) on method "+r+" for id="+e+"."))},t),n=()=>{clearTimeout(i),delete this.waiters[e]};return new Promise((t,r)=>{this.waiters[e]=(e,i)=>(n(),null!==e?r(e):t(i))})}sendMessage(e){this.send(this.serialize(e))}handleRpcRequest(e){let{id:t,method:r,params:i}=e;this.onRun({method:r,params:i},(e,r)=>{t&&this.sendMessage(function(e){let{id:t,error:r,result:i}=e;return r?{jsonrpc:"2.0",id:t,error:r.toJSON()}:{jsonrpc:"2.0",id:t,result:void 0===i?null:i}}({id:t,error:e,result:r}))})}handleRpcResponse(e){const t=this.waiters[e.id];if(void 0!==t)if("error"in e){t(new v(e.error.message,e.error.code,"string"===typeof e.error.data?e.error.data:void 0))}else t(null,e.result);else this.emit("Warn",new Error("Response for missed waiter for id="+JSON.stringify(e.id)))}handleMessage(e){try{const t=d(this.deserialize(e));"result"in t||"error"in t?this.handleRpcResponse(t):"method"in t&&this.handleRpcRequest(t)}catch(t){this.emit("Error",t)}}}var A=r(2178);class T{constructor(e){this.jsonRpcMessenger=void 0,this.handlers={},this.staticHandlers={};this.jsonRpcMessenger=new S({send:e,onRun:async(e,t)=>{if(!(e.method in this.handlers)&&!(e.method in this.staticHandlers))return t(new v("Unknown method: "+e.method,f.v.METHOD_NOT_FOUND));if(this.handlers[e.method])for(const i of this.handlers[e.method])try{const{done:r,value:n}=await i(e.params);if(r)return t(null,n)}catch(r){return t(new v((0,u.K)(r)?r.message:"",f.v.INTERNAL_ERROR,(0,u.K)(r)?r.stack:""))}if(this.staticHandlers[e.method]){let i=!1;for(const n of this.staticHandlers[e.method])try{const{done:r,value:s}=await n(e.params);if(r){if(!(0,A.RW)("yasp_share_worker"))return t(null,s);i||(i=!0,t(null,s))}}catch(r){return t(new v((0,u.K)(r)?r.message:"",f.v.INTERNAL_ERROR,(0,u.K)(r)?r.stack:""))}if(i)return}return t(new v("No handler for existed method: "+e.method,f.v.INVALID_REQUEST))},serialize:e=>e,deserialize:e=>e}),this.jsonRpcMessenger.on("Warn",console.warn),this.jsonRpcMessenger.on("Error",console.error)}registerHandler(e,t){var r;this.handlers[e]=null!=(r=this.handlers[e])?r:[],this.handlers[e].push(t)}registerStaticHandler(e,t){var r;this.staticHandlers[e]=null!=(r=this.staticHandlers[e])?r:[],this.staticHandlers[e].push(t)}removeHandler(e,t){for(const r of["handlers","staticHandlers"])this[r][e]&&(this[r][e]=void 0===t?[]:this[r][e].filter(e=>e!==t),0===this[r][e].length&&delete this[r][e])}request(e){let{method:t,params:r}=e;return this.jsonRpcMessenger.request({method:String(t),params:r})}sendEvent(e){let{method:t,params:r}=e;return this.jsonRpcMessenger.sendEvent({method:String(t),params:r})}destroy(){this.jsonRpcMessenger.destroy()}handleMessage(e){this.jsonRpcMessenger.handleMessage(e.data)}}},9622:(e,t,r)=>{"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function n(e,t){return i(e,{currentTime:t.currentTime,duration:t.duration}),e}function s(e){const t=[];for(const r of e)t.push(r);return t}function a(){return(a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function d(e){return e.replace(/&(amp|quot|apos|lt|gt);/g,(e,t)=>{var r;return null!=(r=lt[t])?r:e})}function c(){return(c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function u(e){const t=e.children.every(e=>"string"===typeof e),r=t?e.children.join("\n"):"";return c({},e,{nodeType:t?3:1,textContent:r})}function h(e,t){return(0,wt.V)(e,t,(e,t)=>t-e)}function p(){return(p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function f(e,t){return p({},t,{start:e.start,end:t.end})}function m(e){const t=[];return e.forEach(e=>{t.push(...e)}),function(e,t){void 0===t&&(t=f);const r=[...e];r.sort((e,t)=>e.start-t.start||e.end-t.end);for(let i=1;i<r.length;i++){const e=r[i],n=r[i-1];n.end>=e.start&&(r.splice(i,1),r[i-1]=t(n,e),i--)}return r}(t)}function g(e,t){const r=[];let i=0;return e.forEach(e=>{let{start:n,end:s}=e;for(let a=i;a<t.length;a++){if(t[a].start>s)return;i=a,t[a].end<n||r.push({start:Math.max(t[a].start,n),end:Math.min(t[a].end,s)})}}),r}function v(e){return(0,Rt.z)(e.reduce((e,t)=>(e[t.height]?t.bitrate>e[t.height].bitrate&&(e[t.height]=t):e[t.height]=t,e),{})).sort((e,t)=>t.bitrate-e.bitrate)}function y(e,t){if(!e||!t)return!1;const r=e.mimeType===t.mimeType,i=e.codecs,n=t.codecs,s=i===n,a=function(e,t){const r=e.split(".")[0];if(0===t.indexOf(r))return!0;const i=It[r];return!!i&&i.some(e=>0===t.indexOf(e))}(i,n);return s||a&&r}function E(e){return"function"===typeof Object.entries?Object.entries(e):(0,Ct.Z)(e).map(t=>[t,e[t]])}function S(){return(S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function A(e,t){const r=parseInt(e.attributes.timescale||"1",10);if(isNaN(r))throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected SegmentTemplate[timescale]",details:{node:e},category:ct.q.MEDIA});const i=e.attributes.media;if(!i)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected missed SegmentTemplate[media]",details:{node:e},category:ct.q.MEDIA});let n=Math.floor(Math.max(0,parseInt(e.attributes.startNumber||"1",10)));if(!Number.isFinite(n)||!Number.isInteger(n))throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected SegmentTemplate[startNumber]",details:{node:e},category:ct.q.MEDIA});const s=parseInt(e.attributes.presentationTimeOffset||"0",10),a=s;if(isNaN(a))throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected SegmentTemplate[presentationTimeOffset]",details:{node:e},category:ct.q.MEDIA});const o=e.attributes.availabilityTimeOffset?parseFloat(e.attributes.availabilityTimeOffset):0;t.availabilityTimeOffset=Math.min(t.availabilityTimeOffset,1e3*o);const l=e.children.find(e=>{let{tagName:t}=e;return"SegmentTimeline"===t}),c=[];let u=Math.max(Math.floor(0)),h=0,p=Math.max(Math.floor(0));if(l){const i=l.children.filter(e=>{let{tagName:t}=e;return"S"===t});for(let a=0;a<i.length;a++){var f;const o=i[a],l=c[c.length-1],d=parseInt(o.attributes.t,10),h=parseInt(o.attributes.d||e.attributes.duration,10);if("string"===typeof o.attributes.t&&isNaN(d))throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected S[t]",details:{node:e},category:ct.q.MEDIA});const p=d||(l?l.originalValues.time+l.originalValues.duration*l.count:0),m=1e3*d/r||(l?l.time+l.duration*l.count:0),g=1e3*h/r;t.maxSegmentDuration=t.maxSegmentDuration?Math.max(t.maxSegmentDuration,g):g;const v=Math.max(Math.floor(parseInt(o.attributes.r||"0",10)));if(isNaN(g))throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected S[d]",details:{node:e},category:ct.q.MEDIA});if(isNaN(v))throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected S[r]",details:{node:e},category:ct.q.MEDIA});const y=v+Math.max(Math.floor(1));u+=y;const E=n+Math.max(Math.floor(u-1)),S=m+g*y;t.maxSegmentEndTime=t.maxSegmentEndTime?Math.max(t.maxSegmentEndTime,S):S,t.minSegmentStartTime=Math.min(null!=(f=t.minSegmentStartTime)?f:1/0,m),t.minSegmentStartTime=t.minSegmentStartTime?Math.min(t.minSegmentStartTime,m):m,c.push({endNumber:E,time:m,duration:g,count:y,originalValues:{time:p,duration:h,trackPresentationTimeOffset:s}})}p=n+Math.max(Math.floor(u-1))}else{var m,g;if(null===t.duration&&!t.isDynamic)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Can't compute presentation duration",details:{node:e},category:ct.q.MEDIA});let i=0;const a=1e3*parseInt(e.attributes.duration,10)/r;if(isNaN(a))throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected S[d]",details:{node:e},category:ct.q.MEDIA});let o=Math.abs(null!=(m=t.duration)?m:t.nowWithOffset);if(isFinite(t.segmentAvailabilityDuration)){var v;const e=t.nowWithOffset-(null!=(v=t.presentationStartTime)?v:0),r=Math.max(e-t.segmentAvailabilityDuration,0),s=Math.ceil(r/a);n+=s,i=s*a,o=Math.max(e-i,0)}u=Math.floor(o/a),p=n+Math.max(Math.floor(u-1),0),h=p*a,t.maxSegmentEndTime=Math.max(t.maxSegmentEndTime||0,h),t.minSegmentStartTime=Math.min(null!=(g=t.minSegmentStartTime)?g:1/0,i),t.maxSegmentDuration=Math.max(t.maxSegmentDuration||0,a),c.push({endNumber:p,time:i,duration:a,count:u,originalValues:{time:i,duration:parseInt(e.attributes.duration,10),trackPresentationTimeOffset:s}});const l=t.duration?t.duration-h:0,d=Math.abs(Math.floor(1));l&&c.push({endNumber:p+d,time:h,duration:l,count:d,originalValues:{time:h,duration:l,trackPresentationTimeOffset:s}})}const y=c[c.length-1];return t.maxPresentationTimeOffset=void 0!==t.maxPresentationTimeOffset?Math.max(t.maxPresentationTimeOffset,a):t.maxPresentationTimeOffset,{timescale:r,initialization:e.attributes.initialization?d(e.attributes.initialization):null,media:d(i),startNumber:n,startTime:c[0].time,endNumber:y.endNumber,endTime:y.time+y.duration*y.count,presentationTimeOffset:a,segmentSequences:c}}function T(e,t){const r=e.attributes.mimeType,i=e.attributes.contentType||(null==r?void 0:r.split("/")[0]);if(!i)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected empty AdaptationSet[contentType] and AdaptationSet[mimeType]",details:{node:e},category:ct.q.MEDIA});t.maxHeight||(t.maxHeight=function(e){const t=e.find(e=>{var t;return"SupplementalProperty"===e.tagName&&"urn:mpeg:yandex:capping:maxheight"===(null==(t=e.attributes)?void 0:t.schemeIdUri)});return t?parseInt(t.attributes.value,10):null}(e.children));const n=e.children.filter(e=>"ContentProtection"===e.tagName);let s=new Ft(t.parser).parse(n);const a="true"===e.attributes.segmentAlignment,o=e.children.find(e=>"SegmentTemplate"===e.tagName);return{type:i,segmentAlignment:a,segmentTemplate:o?A(o,t):void 0,mimeType:r,contentProtection:s}}function b(e,t,r){var i;const n=e.attributes.id;if(!n)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected missed id on Representation",details:{node:e},category:ct.q.MEDIA});const s=null!=(i=e.attributes.codecs)?i:null;let a=parseInt(e.attributes.bandwidth,10);if(isNaN(a)||a<0){if("text"!==r)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected missed Representation[bandwidth]",details:{node:e},category:ct.q.MEDIA});a=10}const o=e.attributes.mimeType,l=e.children.find(e=>{let{tagName:t}=e;return"SegmentTemplate"===t}),d=l?A(l,t):void 0,c=e.children.filter(e=>{let{tagName:t}=e;return"InbandEventStream"===t});return"text"!==r&&c.forEach(e=>t.emsgSchemeIdUris[r].add(e.attributes.schemeIdUri)),{id:n,codecs:s,bandwidth:a,segmentTemplate:d,mimeType:o}}function w(){return(w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function _(e,t){const r=parseInt(e.attributes.width,10),i=parseInt(e.attributes.height,10),n=Math.max(parseFloat(e.attributes.frameRate),0);if(isNaN(r))throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",details:{node:e},message:"Unexpected Representation[width]",isFatal:!0,category:ct.q.MEDIA});if(isNaN(i))throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",details:{node:e},message:"Unexpected Representation[height]",isFatal:!0,category:ct.q.MEDIA});const s=b(e,t,"video"),a=s.codecs;if(!a)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",details:{node:e},message:"Unexpected missed codecs on Representation",isFatal:!0,category:ct.q.MEDIA});return w({},s,n?{frameRate:n}:{},{codecs:a,width:r,height:i})}function R(e,t){return t.bandwidth-e.bandwidth}function k(e,t,r){const i=e.children.filter(e=>{let{tagName:t}=e;return"Representation"===t}),n=[];for(let s=0;s<i.length;s++){const e=i[s];n.push(t(e,r))}return n.sort(R)}function P(){return(P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function I(e,t,r){const{segmentTemplate:i,mimeType:n}=t,s=function(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(t,xt),a=parseInt(e.attributes.maxWidth,10),o=parseInt(e.attributes.maxHeight,10),l=Math.max(parseFloat(e.attributes.maxFrameRate),0),d=k(e,_,r).map(t=>{var r,s;const a=null!=(r=t.segmentTemplate)?r:i,o=null!=(s=t.mimeType)?s:n;if(!a)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected missed Representation>SegmentTemplate",details:{node:e},category:ct.q.MEDIA});if(!o)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected missed Representation>mimeType",details:{node:e},category:ct.q.MEDIA});return P({},t,{segmentTemplate:a,mimeType:o})});if(isNaN(a))throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected AdaptationSet[maxWidth]",details:{node:e},category:ct.q.MEDIA});if(isNaN(o))throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected AdaptationSet[maxHeight]",details:{node:e},category:ct.q.MEDIA});return P({},s,l?{maxFrameRate:l}:{},{maxWidth:a,maxHeight:o,representations:d,keyId:void 0,encrypted:t.contentProtection.drmInfos.length>0})}function C(){return(C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function O(e,t){const r=Math.max(parseFloat(e.attributes.audioSamplingRate),0);if(isNaN(r))throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected Representation[audioSamplingRate]",details:{node:e},category:ct.q.MEDIA});const i=b(e,t,"audio"),n=i.codecs;if(!n)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected missed codecs on Representation",details:{node:e},category:ct.q.MEDIA});return C({},i,{codecs:n,audioSamplingRate:r})}function D(){return(D=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function N(e,t,r){var i,n;const{segmentTemplate:s,mimeType:a}=t,o=function(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(t,Vt),l=null!=(i=e.attributes.lang)?i:"und",d=null!=(n=e.attributes.label)?n:null;if(""===l)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected AdaptationSet[lang]",details:{node:e},category:ct.q.MEDIA});const c=k(e,O,r).map(t=>{var r,i;const n=null!=(r=t.segmentTemplate)?r:s,o=null!=(i=t.mimeType)?i:a;if(!n)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected missed Representation>SegmentTemplate",details:{node:e},category:ct.q.MEDIA});if(!o)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected missed Representation>mimeType",details:{node:e},category:ct.q.MEDIA});return D({},t,{segmentTemplate:n,mimeType:o})}),u=function(e,t){const r=t.findChildren(e,"AudioChannelConfiguration");for(const i of r){const e=i.attributes.schemeIdUri;if(!e)continue;const t=i.attributes.value;if(t)switch(e){case"urn:mpeg:dash:outputChannelPositionList:2012":return t.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":{const e=parseInt(t,10);if(!e)continue;return e}case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":{let e=parseInt(t,16);if(!e)continue;let r=0;for(;e;)1&e&&++r,e>>=1;return r}case"urn:mpeg:mpegB:cicp:ChannelConfiguration":{const e=0,r=[e,1,2,3,4,5,6,8,2,3,4,7,8,24,8,12,10,12,14,12,14],i=parseInt(t,10);if(!i)continue;if(i>e&&i<r.length)return r[i];continue}default:continue}}}(e,r.parser);return D({},o,{lang:l,label:d,representations:c,keyId:void 0,encrypted:t.contentProtection.drmInfos.length>0,channels:u})}function L(){return(L=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function M(e,t){const r=b(e,t,"text"),i=[];return e.children.forEach(e=>{let{tagName:t,children:r}=e;if("BaseURL"===t){const e=r[0];if(!e)return;i.push(d(e))}}),L({},r,{baseUrl:i[0]})}function F(){return(F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function x(e,t,r){var i,n,s,a;const{segmentTemplate:o,mimeType:l}=t,d=function(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(t,Ut),c=e.children.filter(e=>{let{tagName:t}=e;return"Role"===t});let u=null;c.forEach(e=>{["caption","subtitle"].includes(e.attributes.value)&&(u=e)});const h=null!=(i=e.attributes.lang)?i:"und",p=null!=(n=e.attributes.label)?n:null,f=k(e,M,r).map(e=>F({},e,{segmentTemplate:e.segmentTemplate||o,mimeType:e.mimeType||l}));return F({},d,{role:u?{schemeIdUri:null!=(s=u.attributes.schemeIdUri)?s:null,value:null!=(a=u.attributes.value)?a:null}:null,lang:h,label:p,representations:f,keyId:void 0,encrypted:t.contentProtection.drmInfos.length>0,segmentAlignment:!1})}function V(e,t){const r=T(e,t);switch(r.type){case"video":return I(e,r,t);case"audio":return N(e,r,t);case"text":return x(e,r,t);default:throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected AdaptationSet[contentType="+r.type+"]",details:{node:e},category:ct.q.MEDIA})}}function U(e,t){var r,i,n,s,a,o;const l=t.type.charCodeAt(0)-e.type.charCodeAt(0);if(0!==l)return l;switch(t.type){case"video":return t.maxHeight-e.maxHeight||(null!=(r=t.maxFrameRate)?r:0)-(null!=(i=e.maxFrameRate)?i:0)||(null!=(n=t.mimeType)?n:"").localeCompare(null!=(s=e.mimeType)?s:"");case"audio":case"text":return(null!=(a=t.mimeType)?a:"").localeCompare(null!=(o=e.mimeType)?o:"")}return 0}function B(e,t){const r=e.children.filter(e=>{let{tagName:t}=e;return"AdaptationSet"===t}),i=[];for(let n=0;n<r.length;n++){const e=V(r[n],t);e&&i.push(e)}return i.sort(U)}function H(e){if(!e)return null;const t=new RegExp("^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$").exec(e);if(!t)return null;const r=31536e3*Number(t[1]||null)+2592e3*Number(t[2]||null)+86400*Number(t[3]||null)+3600*Number(t[4]||null)+60*Number(t[5]||null)+Number(t[6]||null);return isFinite(r)?1e3*r:null}function j(e){if(!e)return null;/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z");let t=Date.parse(e);return isNaN(t)?null:Math.floor(t)}function W(e,t,r){var i,n,s;const a=e.find(e=>{let{tagName:t}=e;return"MPD"===t});if(void 0===a)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected missed MPD",details:{node:{tagName:"root",attributes:{},children:e}},category:ct.q.MEDIA});const o={periods:[],baseUrls:[],maxHeight:null,isDynamic:"dynamic"===(null==(i=a.attributes)?void 0:i.type),videoType:Bt.Z.LIVE,updatePeriod:5e3,minBufferTime:0,presentationStartTime:null,segmentAvailabilityDuration:1/0,maxSegmentDuration:4e3,presentationDelay:0,availabilityTimeOffset:0,clockOffset:0,minSegmentStartTime:null,maxSegmentEndTime:null,presentationTimeOffset:0,publishTime:0,minPeriodStartTime:0,locationUrl:null},l=a.children.filter(e=>{let{tagName:t}=e;return"BaseURL"===t});for(let d=0;d<l.length;d++){const{children:e}=l[d];1===e.length&&o.baseUrls.push(e[0])}o.baseUrls.length||o.baseUrls.push(function(e){try{const t=new URL(e);t.search="";const r=t.pathname.split("/");return r[r.length-1]="",t.pathname=r.join("/"),t.href}catch(t){return""}}(t)||t);const c=a.children.filter(e=>{let{tagName:t}=e;return"Period"===t});if(void 0===c||0===c.length)throw new dt.w({code:"YASP_PARSE_MANIFEST_ERROR",isFatal:!0,message:"Unexpected missed Period",details:{node:a},category:ct.q.MEDIA});if(o.isDynamic){var u,h,p,f,m;o.minBufferTime=H(null==(u=a.attributes)?void 0:u.minBufferTime)||o.minBufferTime,o.updatePeriod=H(null==(h=a.attributes)?void 0:h.minimumUpdatePeriod)||o.updatePeriod,o.presentationStartTime=j(null==(p=a.attributes)?void 0:p.availabilityStartTime),o.segmentAvailabilityDuration=H(null==(f=a.attributes)?void 0:f.timeShiftBufferDepth)||o.segmentAvailabilityDuration,o.maxSegmentDuration=H(null==(m=a.attributes)?void 0:m.maxSegmentDuration)||o.maxSegmentDuration;const e=H(a.attributes.suggestedPresentationDelay),t=Math.max(1e4,1.5*o.minBufferTime);o.presentationDelay=null!=e?e:t;const r=a.children.find(e=>{let{tagName:t}=e;return"UTCTiming"===t});o.clockOffset=function(e){if(!e)return 0;const t=e.attributes.schemeIdUri,r=e.attributes.value;switch(t){case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":{const e=Date.parse(r);return isNaN(e)?0:e-Date.now()}default:return 0}}(r)}const g={maxHeight:null,duration:H(null==a?void 0:a.attributes.mediaPresentationDuration),maxPresentationTimeOffset:0,minPeriodStartTime:1/0,segmentAvailabilityDuration:o.segmentAvailabilityDuration,nowWithOffset:Date.now()+o.clockOffset,parser:r,availabilityTimeOffset:1/0,isDynamic:o.isDynamic,emsgSchemeIdUris:{audio:new Set,video:new Set},presentationStartTime:o.presentationStartTime};var v,y,E,S;(o.periods.push((v=c[0],(y=g).minPeriodStartTime=Math.min(H(v.attributes.start)||0,y.minPeriodStartTime),{adaptationSets:B(v,y)})),g.maxPresentationTimeOffset&&(o.segmentAvailabilityDuration=1/0,o.presentationTimeOffset=g.maxPresentationTimeOffset,o.videoType=Bt.Z.EVENT),g.maxSegmentDuration&&g.maxSegmentEndTime)&&(o.maxSegmentDuration=Math.max(g.maxSegmentDuration,o.maxSegmentDuration),o.minSegmentStartTime=null!=(E=g.minSegmentStartTime)?E:null,o.maxSegmentEndTime=null!=(S=g.maxSegmentEndTime)?S:null);g.maxHeight&&(o.maxHeight=g.maxHeight),isFinite(g.availabilityTimeOffset)&&(o.availabilityTimeOffset=g.availabilityTimeOffset),o.publishTime=j(null==(n=a.attributes)?void 0:n.publishTime)||o.publishTime,o.emsgSchemeIdUris=g.emsgSchemeIdUris;const A=a.children.find(e=>{let{tagName:t}=e;return"Location"===t});return A&&A.children.length&&(o.locationUrl=d(A.children[0])),o.minPeriodStartTime=isFinite(g.minPeriodStartTime)?g.minPeriodStartTime:null!=(s=g.minSegmentStartTime)?s:o.minPeriodStartTime,o}function Y(e){try{const t=new XMLHttpRequest;return t.open("GET","https://yandex.ru"),t.responseType=e,t.responseType===e?e:""}catch(t){return""}}function G(){return(G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function z(e,t){void 0===t&&(t=.5);return(e<10?2**e*100:6e4)*(1+(2*Math.random()-1)*t)}function q(){return(q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function K(e,t){e.adaptationSets.forEach(e=>{e.representations.forEach(r=>{switch(e.type){case"audio":t.obtainTimelineTrack(q({},r,r.segmentTemplate,{bitrate:r.bandwidth,language:e.lang,name:e.label,label:e.label,channels:e.channels,type:"audio"}));break;case"video":t.obtainTimelineTrack(q({},r,r.segmentTemplate,{bitrate:r.bandwidth,language:"unknown",type:"video"}));break;case"text":t.obtainTimelineTrack(function(e,t,r){var i,n,s,a;const o=t.segmentTemplate,l=q({},t,{kind:(null==(i=r.role)?void 0:i.value)||"subtitles",label:r.label,language:r.lang,bitrate:t.bandwidth,type:"text"});if(o)return q({},l,o);const d=e.getSeekableRange();return q({},l,{media:t.baseUrl,initialization:null,timescale:1,startNumber:Math.ceil(Math.abs(1)),endNumber:Math.ceil(Math.abs(1)),startTime:null!=(n=null==d?void 0:d.start)?n:0,endTime:null!=(s=null==d?void 0:d.end)?s:0,presentationTimeOffset:0,segmentSequences:[{time:0,duration:null!=(a=e.getDuration())?a:0,count:Math.ceil(Math.abs(1)),endNumber:Math.ceil(Math.abs(1)),originalValues:{time:0,duration:e.getDuration(),trackPresentationTimeOffset:0}}]})}(t,r,e))}})}),t.updateSelectedVideoTracks()}function Q(e){if(!e.length)return 1/0;let t=0;return e.forEach(e=>{t+=e.bandwidth}),t/e.length}function Z(e,t){return e+"; codecs="+JSON.stringify(t)}function J(e){return(0,sr.Q)(self).isTypeSupported(Z(e.mimeType,e.codecs))}function X(e){const t=[],r=[];for(let i of e)J(i)?t.push(i):r.push(i);return{supported:t,unsupported:r}}function $(e){const t=new Map;for(const r of e.representations){const e=r.height,i=r.bandwidth;t.set(e,i)}return t}function ee(e,t){let r=0,i=0,n=0;for(const s of e.keys()){const a=e.get(s),o=t.get(s);a&&o&&(n++,r+=a,i+=o)}return i/n<r/n?t:e}function te(){return(te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function re(e,t){const r={audio:[],video:[],text:[]},i={video:!1,audio:!1},n={video:new Set,audio:new Set};e.forEach(e=>{if("video"===e.type){i.video=!0;const{selected:t,unsupported:s}=function(e){const t={};let r=0;const{supported:i,unsupported:n}=X(e);i.forEach(e=>{r=Math.max(r,e.height);const i=e.codecs.split(".")[0];t[i]?t[i].push(e):t[i]=[e]}),E(t).forEach(e=>{let[i,n]=e;n.some(e=>e.height===r)||delete t[i]});const s=(0,Ct.Z)(t);return s.length?(s.length>1&&s.sort((e,r)=>Q(t[e])-Q(t[r])),{selected:t[s[0]],unsupported:n}):{selected:void 0,unsupported:n}}(e.representations);if(!t)return void s.forEach(e=>n.video.add(Z(e.mimeType,e.codecs)));r[e.type].push(te({},e,{representations:t,maxHeight:t[0].height,maxWidth:t[0].width}))}else if("audio"===e.type){i.audio=!0;const{selected:t,unsupported:s}=function(e){const t={},{supported:r,unsupported:i}=X(e);r.forEach(e=>{const r=e.codecs.split(".")[0];t[r]?t[r].push(e):t[r]=[e]});const n=(0,Ct.Z)(t);return n.length?(n.length>1&&n.sort((e,r)=>Q(t[e])-Q(t[r])),{selected:t[n[0]],unsupported:i}):{selected:void 0,unsupported:i}}(e.representations);if(!t)return void s.forEach(e=>n.audio.add(Z(e.mimeType,e.codecs)));r[e.type].push(te({},e,{representations:t}))}else r[e.type].push(e)});const s=(0,Ct.Z)(i).filter(e=>i[e]&&!r[e].length);if(s.length){const e=s.reduce((e,t)=>(e[t]=Array.from(n[t]),e),{});throw new dt.w({message:"For some types of adaptation sets, no supported codec was found.",code:"YASP_NO_CODECS",details:e,isFatal:!0,category:ct.q.NO_CODECS})}return E(r).reduce((e,t)=>{let[r,i]=t;if("video"===r){const t=function(e){if(!e.length)return null;if(1===e.length)return e[0];let t=0,r=$(e[t]);for(let i=1;i<e.length;i++){const n=$(e[i]);r=ee(r,n),t=r===n?i:t}return e[t]}(i);t&&e.push(t)}else i.forEach(t=>e.push(t));return e},[])}function ie(e){if(!(0,Ie.K)(e))return!1;const t=e;return(0,st.H)(t.code)&&(0,st.H)(t.category)&&"boolean"===typeof t.isFatal}function ne(e,t){let r,i=0;for(let n=0;n<e.length;n++){const{start:s,end:a}=e[n];if(!(a<t)){if(void 0!==r&&s-r>=.1)break;i+=a-Math.max(s,t),r=a}}return i}function se(){return(se=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function ae(e,t,r){var i;return e.replace(/\$RepresentationID\$/g,t.id).replace(/\$Bandwidth\$/g,String(t.bitrate)).replace(/\$Number\$/g,String(null!=(i=null==r?void 0:r.number)?i:"")).replace(/\$Time\$/g,String((0,br.z)(null==r?void 0:r.originalStart)?r.originalStart:"")).replace(/\$\$/g,"$")}function oe(){return(oe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function le(e,t,r){const i=1e3*r;let n=t,s=!0,a=!1;for(;s;)s=!1,e.forEach(e=>{e.forEach(e=>{e.start<=n&&n<e.end&&(n=e.end,a=!0,s=!0)})});return n>=i&&a?-1:n}function de(e){if(-1===e.indexOf("#"))return null;let t;return e.split("#").pop().split("&").some(e=>{const[r,i]=e.split("=",2).map(decodeURIComponent);return"t"===r&&(t=i,!0)}),function(e){if("string"!==typeof e)return null;try{if(e.match(/^-?\d+(\.\d+)?$/))return ce(parseFloat(e));if(e.includes("npt:")){const t=e.split("npt:")[1];return ce(parseFloat(t))}if(e.includes(":")){const t=e.split(":"),r=parseInt(t[0],10)||0,i=parseInt(t[1],10)||0,n=parseFloat(t[2])||0;return ce(3600*r+60*i+n)}const t=e.match(/^npt:(\d+(\.\d+)?)$/);if(t)return ce(parseFloat(t[1]))}catch(t){}return null}(t)}function ce(e){return isNaN(e)?null:e}function ue(){return(ue=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function he(e,t){return e.trace.map(e=>e.result.map(e=>e[t]).filter(Boolean).join("-")).filter(Boolean).join("_")}function pe(e,t,r){const i=(null==e?void 0:e.length)>0?e:[void 0],n=(null==t?void 0:t.length)>0?t:[void 0],s=(null==r?void 0:r.length)>0?r[0].bitrate:0,a=[];return i.forEach(e=>{n.forEach((t,r)=>{(function(e){let{width:t,height:r}=e;const i=Math.max(t,r),n=Math.min(t,r);if(i<=0)return 0;let s=jr[0];for(let a=0;a<jr.length;a++){const e=jr[a],t=Wr[e];if(i>=1.3*Math.floor(16*t/9)||n>=1.3*t)return s;s=e}return jr[jr.length-1]})({width:(null==e?void 0:e.width)||0,height:(null==e?void 0:e.height)||0})>360&&r>0||a.push({video:e,audio:t,bandwidth:((null==e?void 0:e.bitrate)||0)+(((null==t?void 0:t.bitrate)||0)+s)})})}),a}function fe(e,t,r){const i=function(e){return e.filter(me)}(e);if(i.length<=1)return e;const n=[],s=function(e,t,r){const i=function(e,t,r){const{videoMaxWidthResolutionWithTrueRatio:i,videoMaxHeightResolutionWithTrueRatio:n}=function(e,t,r){const i=ge(e[0].video.width,e[0].video.height),{videoMaxWidthResolution:n,videoMaxHeightResolution:s}=function(e,t){const{defaultLongSideResolution:r,userCappingResolution:i}=t||{};let n=0,s=0;i&&i.width&&i.height&&(n=i.width,s=i.height);const a=Math.max(n,s),o=(0,Jr.R)(r),{cappedWidthResolution:l,cappedHeightResolution:d}=function(e){const{width:t=1/0,height:r=1/0,dpi:i=1}=e;return{cappedWidthResolution:t*i,cappedHeightResolution:r*i}}(e),c=a||Math.min(o,l),u=a||Math.min(o,d);return{videoMaxWidthResolution:c,videoMaxHeightResolution:u}}(t,r),a=ge(n,s);return i>a?{videoMaxWidthResolutionWithTrueRatio:n,videoMaxHeightResolutionWithTrueRatio:e[0].video.height*(n/e[0].video.width)}:{videoMaxWidthResolutionWithTrueRatio:e[0].video.width*(s/e[0].video.height),videoMaxHeightResolutionWithTrueRatio:s}}(e,t,r);return i*n}(e,t,r);return(0,Zr.U)(e.slice().reverse(),e=>{let{video:{width:t,height:r}}=e;return Math.abs(i-t*r)})}(i,t,r);for(const a of i)if(n.push(a),s===a)break;return n}function me(e){return(0,Ie.K)(e.video)&&(0,br.z)(e.video.width)&&(0,br.z)(e.video.height)}function ge(e,t){return e/t}function ve(){return(ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function ye(){return(ye=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function Ee(e,t,r){return e&&"number"===typeof e?e+t-r:e}function Se(e){return"function"===typeof e||"Function"===(0,Fi.M)(e)}function Ae(e){var t,r,i,n;return null!=(t=null==(r=e.performance)?void 0:r.timeOrigin)?t:null==(i=e.performance)||null==(n=i.timing)?void 0:n.navigationStart}function Te(){return(Te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function be(){return(be=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function we(e){function t(e){if(!u)throw new Error("Source Manager not inited!");return u.takeSource(e)}function r(e,r){const i=t(e);if(void 0===i)throw new Error("["+r+"] Unknown source "+e+".");return i}function i(){return m.getCommonOptions().maxAutoQuality}function n(){return m.getCommonOptions().userQuality}function s(){return m.getCommonOptions().defaultBandwidthEstimate}function a(e){const{method:t,params:r}=e;if(!["updateBufferedInfo","updateSeekableRange"].includes(t)){let e=be({},r);if("objectUrl"in e){e=function(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,Gi)}f.push({method:t,params:e,time:Date.now()})}return d.sendEvent(e)}function o(e,t){d.registerHandler(e,r=>(p.push({method:e,params:r,time:Date.now()}),t(r)))}function l(t){var r,o,l;const h=null!=(r=null==(o=u)?void 0:o.takeSource(t))?r:(()=>{const r=(0,Oe.Hi)(t),o=new Pe,l=o;new Ce(r,e,o);const u=new Oi(c,t,l,{getMaxAutoQuality:i,getUserQuality:n,getDefaultBandwidth:s}),h=m.extract(r);h&&u.configure(h),u.on("Error",e=>{a({method:"error",params:{source:t,error:JSON.stringify(e)}})}),u.on("BufferedInfoChanged",e=>{a({method:"updateBufferedInfo",params:{bufferedInfo:e,source:t}})}),u.on("Event",e=>{a({method:"event",params:be({source:t},e)})}),u.on("VideoTypeChange",e=>{a({method:"changeVideoType",params:{source:t,videoType:e}})}),u.on("IsLowLatencyChange",e=>{a({method:"changeIsLowLatency",params:{source:t,isLowLatency:e}})}),u.on("EmsgDetected",e=>{a({method:"emsg",params:{source:t,emsg:e}})}),u.on("SegmentLoaded",e=>{a({method:"logSegmentLoaded",params:{source:t,info:e}})}),u.on("TargetLatencyUpdated",e=>{a({method:"updateTargetLatency",params:{source:t,latency:e}})}),u.on("UtcStartTimeUpdate",e=>{a({method:"updateUtcStartTime",params:{source:t,time:e}})}),u.on("SeekableRangeUpdate",e=>{let{start:r,end:i}=e;a({method:"updateSeekableRange",params:{source:t,start:r,end:i}})}),u.on("CuesAdded",e=>{let{cues:r,label:i}=e;a({method:"cuesAdded",params:{source:t,cues:r,label:i}})}),u.on("UpdateUrlObject",e=>{a({method:"urlObjectUpdated",params:{source:t,objectUrl:e}})});const p=e=>{let{source:t,devicePixelRatio:i}=e;return(0,Oe.Hi)(t)!==r?{done:!1,value:void 0}:(o.devicePixelRatio=i,{done:!0,value:void 0})};return d.registerHandler("setDevicePixelRatio",p),u.on("Destroy",()=>{d.removeHandler("setDevicePixelRatio",p)}),u})();return null==(l=u)||l.putSource(t,h),h}const d=new Ni.A(t=>{e.postMessage(t,(0,Mi._)(t))}),c=new Di;let u,h;const p=new Hi.d(ji.K),f=new Hi.d(ji.K),m=new Yi((function(e){const t=new dt.w({code:e.code===Li.v.METHOD_NOT_FOUND?"YASP_UNKNOWN_METHOD":"YASP_UNKNOWN_ERROR",details:{error:e},isFatal:!1,category:ct.q.EXCEPTION,message:e.message});a({method:"error",params:{source:null,error:JSON.stringify(t)}})}));return c.start(),d.registerHandler("initWorker",e=>{var t;return(0,mr.Vc)(e),u=new De(e.sourceLimit),setTimeout(()=>{a({method:"event",params:{name:"undefined"===typeof document?"YaspWorkerEnabled":"YaspWorkerDisabled",data:void 0,shouldLogWhenDetached:!0}})}),void 0!==(t=e.perfLogUrl)&&void 0===h&&"undefined"===typeof document&&(h=new Ui({sendLog:(e,r)=>{const i=(0,Bi.Y)(e);if(!i)return;const n=new URL(t);E(r).forEach(e=>{let[t,r]=e;void 0!==r&&n.searchParams.set(t,r)}),Qt(n.href,{method:"POST",keepalive:!0,body:i})}}),h.attach(self)),{done:!0,value:""}}),o("detach",e=>{let{source:r}=e;const i=t(r);return i&&(i.off("VideoTrackChange"),i.off("AudioLanguageChange"),i.off("TextTrackChange"),i.off("BandwidthEstimateUpdate"),i.off("MaxCapAllowedVideoTrackUpdate"),i.off("ServerTimeChange"),i.detach()),{done:!0,value:void 0}}),o("destroy",e=>{let{source:r}=e;var i;t(r)&&(null==(i=u)||i.removeSource(r));return{done:!0,value:void 0}}),o("requestDebugInfo",e=>{let{source:t}=e;return u?{done:!0,value:{yaspSrc:null!=t?t:null,sources:u.getAllSources().map(e=>e.getDebugInfo()),outgoingHistory:f.toArray(),incomingHistory:p.toArray(),configStorage:m.getDebugInfo()}}:{done:!0,value:void 0}}),o("setVideoTrack",e=>{let{source:t,trackId:i}=e;return r(t,"setVideoTrack").setVideoTrack(i),{done:!0,value:void 0}}),o("setAudioTrack",e=>{let{source:t,language:i}=e;return r(t,"setAudioTrack").setAudioTrack(i),{done:!0,value:void 0}}),o("setTextTrack",e=>{let{source:t,track:i}=e;return r(t,"setTextTrack").setTextTrack(i),{done:!0,value:void 0}}),o("setVideoElementSizes",e=>{let{source:r,videoSizes:i}=e;const n=t(r);return null==n||n.setVideoElementSizes(i),{done:!0,value:void 0}}),o("configureSource",e=>{let{source:t,config:i}=e;try{const e=r(t,"configureSource");m.updateCommonOptions(i),e.configure(i)}catch(n){const e=(0,Oe.Hi)(t);m.add(e,i)}return{done:!0,value:void 0}}),o("attach",async e=>{let{source:t}=e;const r=l(t);r.on("VideoTrackChange",e=>{a({method:"changeSelectedVideoTrack",params:{source:t,trackId:e}})}),r.on("AudioLanguageChange",e=>{a({method:"changeSelectedAudioLanguage",params:{source:t,language:e}})}),r.on("BandwidthEstimateUpdate",e=>{a({method:"updateBandwidthEstimate",params:{bandwidth:e}})}),r.on("MaxCapAllowedVideoTrackUpdate",e=>{a({method:"updateMaxCapAllowedVideoTrack",params:{maxCapAllowedVideoTrack:e}})}),r.on("DrmInfoReceived",e=>{a({method:"applyDrmInfos",params:{source:t,drmInfos:e}})}),r.on("FlushMediaPipelineRequested",()=>{a({method:"flushMediaPipeline",params:{source:t}})}),r.on("ServerTimeChange",e=>{a({method:"updateServerTime",params:{source:t,time:e}})}),r.on("StreamEndTimeUpdate",e=>{d.sendEvent({method:"updateStreamEndTime",params:{source:t,time:e}})});const i=await r.attach(t);return a({method:"setStartInfo",params:{source:t,objectUrl:i,startPosition:r.getStartPosition()}}),r.getVideoTracks().forEach((e,r,i)=>{a({method:"addVideoTrack",params:{source:t,track:be({},e,{bitrate:e.bitrate?e.bitrate/1e3:void 0}),length:i.length}})}),r.getAudioTracks().forEach(e=>{a({method:"addAudioTrack",params:{source:t,track:be({},e,{bitrate:e.bitrate?e.bitrate/1e3:void 0})}})}),r.getTextTracks().forEach(e=>{a({method:"addTextTrack",params:{source:t,track:{id:e.id,kind:e.kind,label:e.label,language:e.language||"unknown"}}})}),{done:!0,value:void 0}}),o("load",async e=>{let{source:t}=e;const r=l(t);return await r.load(),{done:!0,value:void 0}}),o("seeking",async e=>{let{source:t}=e;const r=l(t);return await r.handleSeek(),{done:!0,value:void 0}}),e.addEventListener("message",e=>{"object"===typeof e.data&&("string"!==typeof e.data.method||"object"===typeof e.data.params&&null!==e.data.params)&&d.handleMessage(e)}),Promise.resolve()}function _e(e){void 0===e&&(e=self),we(e)}r.d(t,{Z:()=>zi});r(7881);var Re=r(4513);class ke{constructor(){this.timeRanges=[]}get length(){return this.timeRanges.length}start(e){if(this.timeRanges.length<=e)throw new Error("Failed to execute 'start' on 'TimeRanges': The index provided ("+e+") is greater than the maximum bound ("+this.timeRanges.length+").");return this.timeRanges[e][0]}end(e){if(this.timeRanges.length<=e)throw new Error("Failed to execute 'end' on 'TimeRanges': The index provided ("+e+") is greater than the maximum bound ("+this.timeRanges.length+").");return this.timeRanges[e][1]}update(e){this.timeRanges=e}}class Pe extends Re.M{constructor(){super(),this.currentTime=void 0,this.duration=void 0,this.videoSize=void 0,this.containerSize=void 0,this.devicePixelRatio=void 0,this.buffering=void 0,this.buffered=void 0,this.paused=void 0,this.loop=void 0,this.playbackRate=void 0,this.frames=void 0,this.objectFit=void 0,this.currentTime=null,this.duration=Math.max(0,0),this.videoSize=null,this.containerSize=null,this.buffering=!0,this.buffered=new ke,this.paused=!0,this.loop=!1,this.devicePixelRatio=1,this.playbackRate=1,this.frames={total:Math.max(Math.floor(0)),dropped:Math.max(Math.floor(0))},this.objectFit=null}}var Ie=r(5689);class Ce{constructor(e,t,r){this.sourceKey=void 0,this.videoState=void 0,this.worker=void 0,this.buffered=void 0,this.handleEvent=(e,t)=>{switch(e){case"updateBuffering":return this.videoState.buffering=t,void this.videoState.emit("BufferingChange",t);case"updateCurrentTime":return void(this.videoState.currentTime=t);case"updateFrames":return void(this.videoState.frames=t);case"updateDevicePixelRatio":return void(this.videoState.devicePixelRatio=t);case"updateDuration":return void(this.videoState.duration=t);case"updateLoop":return void(this.videoState.loop=t);case"updatePaused":return void(this.videoState.paused=t);case"updatePlaybackRate":return void(this.videoState.playbackRate=t);case"updateVideoSize":return void(this.videoState.videoSize=t);case"updateBuffered":return void this.buffered.update(t);case"updateContainerSize":return void(this.videoState.containerSize=t);case"updateObjectFit":return void(this.videoState.objectFit=t)}},this.sourceKey=e,this.videoState=r,this.buffered=new ke,this.videoState.buffered=this.buffered,this.worker=t,this.worker.addEventListener("message",e=>{let{data:t}=e;(0,Ie.K)(t)&&"string"===typeof t.method&&t.sourceKey===this.sourceKey&&this.handleEvent(t.method,t.params)})}}var Oe=r(4910);class De{constructor(e){void 0===e&&(e=1),this.limit=e,this.sources=new Map}takeSource(e){return this.sources.get((0,Oe.Hi)(e))}putSource(e,t){const r=(0,Oe.Hi)(e);for(this.sources.delete(r),this.sources.set(r,t);this.sources.size>this.limit;){const e=this.sources.entries().next().value;if(!e)break;const[t,r]=e;De.destroySource(r),this.sources.delete(t)}}removeSource(e){const t=(0,Oe.Hi)(e),r=this.sources.get(t);return!!r&&(De.destroySource(r),this.sources.delete(t))}getAllSources(){return Array.from(this.sources.values())}static destroySource(e){null==e||e.destroy()}}var Ne=r(9329);class Le extends Ne.v{constructor(e){super(),this.id=void 0,this.bitrate=void 0,this.language=void 0,this.type=void 0,this.initialization=void 0,this.timescale=void 0,this.media=void 0,this.mimeType=void 0,this.startNumber=void 0,this.startTime=void 0,this.endNumber=void 0,this.endTime=void 0,this.presentationTimeOffset=void 0,this.segmentSequences=void 0,this.init=null,this.segmentRanges=[],this.segments=new Map,this.id=e.id,this.bitrate=e.bitrate,this.language=e.language,this.type=e.type,this.initialization=e.initialization,this.timescale=e.timescale,this.media=e.media,this.mimeType=e.mimeType,this.startNumber=e.startNumber,this.startTime=e.startTime,this.endNumber=e.endNumber,this.endTime=e.endTime,this.presentationTimeOffset=e.presentationTimeOffset,this.segmentSequences=e.segmentSequences}updateTrack(e){this.startNumber=e.startNumber,this.startTime=e.startTime,this.endNumber=e.endNumber,this.endTime=e.endTime,this.presentationTimeOffset=e.presentationTimeOffset,this.segmentSequences=e.segmentSequences,this.bitrate=e.bitrate,this.initialization=e.initialization,this.media=e.media}getFullMimeType(){return this.mimeType}appendSegment(e){e.isInitSegment?this.init=e:this.segments.set(e.number,e);const t=()=>{e.isInitSegment?this.init=null:(this.segments.delete(e.number),this.updateSegmentRanges())};this.updateSegmentRanges(),e.finished?this.parseSegment(e):(e.once("Failed",t),e.once("Finish",()=>{this.parseSegment(e),this.updateSegmentRanges()}))}parseSegment(e){}hasSegment(e){return this.segments.has(e)}getInitSegment(){return this.init}getSegment(e){return s(this.segments.values()).find(t=>void 0!==t&&(t.number===this.endNumber&&e===this.endTime-this.presentationTimeOffset||t.start<=e&&e<t.end))||null}getBufferedRanges(e){var t;return void 0===e&&(e=!1),null===this.initialization||null!=(t=this.init)&&t.finished?e?this.segmentRanges.map(e=>{let{start:t,end:r}=e;return{start:t,end:r}}):this.segmentRanges.filter(e=>{let{finished:t}=e;return t}).map(e=>{let{start:t,end:r}=e;return{start:t,end:r}}):[]}getSeekableRanges(){return[{start:this.startTime-this.presentationTimeOffset,end:this.endTime-this.presentationTimeOffset}]}getSegmentsDebugInfo(e){let t=0,r=0,i=0,n=0;return this.segments.forEach(s=>{e>s.end-this.presentationTimeOffset?(t+=s.loadedRawSize,r+=1):(i+=s.loadedRawSize,n+=1)}),{playedRawSize:t,playedSegmentCount:r,activeRawSize:i,activeSegmentCount:n}}getDebugInfo(){return{id:this.id,bitrate:this.bitrate,language:this.language,type:this.type,initialization:this.initialization,timescale:this.timescale,media:this.media,mimeType:this.mimeType,startNumber:this.startNumber,startTime:this.startTime,endNumber:this.endNumber,endTime:this.endTime,presentationTimeOffset:this.presentationTimeOffset,initSegment:this.init,segmentSequences:this.segmentSequences,seekableRanges:this.getSeekableRanges(),segmentRanges:this.segmentRanges,segments:Array.from(this.segments.entries()).reduce((e,t)=>(e[t[0]]=t[1].getDebugInfo(),e),{})}}updateSegmentRanges(){const e=this.segmentRanges;this.segmentRanges=[];const t=s(this.segments.values()).sort((e,t)=>e.start-t.start);if(0===t.length)return void(0!==e.length&&this.emit("BufferedInfoChanged"));let r={start:t[0].start,startNumber:t[0].number,end:t[0].end,endNumber:t[0].number,finished:t[0].finished};for(let i=1;i<t.length;i++){const e=t[i];e.finished===r.finished&&e.start===r.end?(r.end=e.end,r.endNumber=e.number):(this.segmentRanges.push(r),r={start:e.start,startNumber:e.number,end:e.end,endNumber:e.number,finished:e.finished})}this.segmentRanges.push(r),this.emit("BufferedInfoChanged")}clear(e,t){return this.clearForParallel(e,t)}clearForParallel(e,t){let r=!1;s(this.segments.values()).forEach(i=>{i.start>=e&&i.end<=t&&(r=!0,i.destroy(),this.segments.delete(i.number))}),r&&this.updateSegmentRanges()}}class Me extends Le{constructor(e){super(e),this.type="audio",this.codecs=void 0,this.label=void 0,this.channels=void 0,this.codecs=e.codecs,this.label=e.name,this.channels=e.channels}getFullMimeType(){return this.mimeType+"; codecs="+JSON.stringify(this.codecs)}getDebugInfo(){return a({},super.getDebugInfo(),{codecs:this.codecs,label:this.label})}}class Fe extends Le{constructor(e){super(e),this.height=void 0,this.width=void 0,this.type="video",this.codecs=void 0,this.frameRate=void 0,this.label=void 0,this.height=e.height,this.width=e.width,this.codecs=e.codecs,this.frameRate=e.frameRate;const t=this.parseMediaAttribute(e.media||"");this.label=t.label||this.height+"p"}getDebugInfo(){return o({},super.getDebugInfo(),{height:this.height,width:this.width,codecs:this.codecs})}getFullMimeType(){return this.mimeType+"; codecs="+JSON.stringify(this.codecs)}parseMediaAttribute(e){const t={};return e.split(",").map(e=>{const r=e.split("=");r.length>0&&(t[r[0]]=r[1])}),t}}var xe=r(7817);let Ve,Ue,Be,He,je,We,Ye,Ge,ze,qe,Ke,Qe,Ze,Je;!function(e){e[e.BIG_ENDIAN=0]="BIG_ENDIAN",e[e.LITTLE_ENDIAN=1]="LITTLE_ENDIAN"}(Ve||(Ve={}));class Xe{constructor(e,t){this.dataView=e,this.littleEndian=void 0,this.position=0,this.littleEndian=t===Ve.LITTLE_ENDIAN}getDataView(){return this.dataView}hasMoreData(){return this.position<this.dataView.byteLength}getPosition(){return this.position}getLength(){return this.dataView.byteLength}readUint8(){try{let e=this.dataView.getUint8(this.position);return this.position+=1,e}catch(e){throw this.throwOutOfBounds()}}readUint16(){try{let e=this.dataView.getUint16(this.position,this.littleEndian);return this.position+=2,e}catch(e){throw this.throwOutOfBounds()}}readUint32(){try{let e=this.dataView.getUint32(this.position,this.littleEndian);return this.position+=4,e}catch(e){throw this.throwOutOfBounds()}}readInt32(){try{let e=this.dataView.getInt32(this.position,this.littleEndian);return this.position+=4,e}catch(e){throw this.throwOutOfBounds()}}readUint64(){let e,t;try{this.littleEndian?(e=this.dataView.getUint32(this.position,!0),t=this.dataView.getUint32(this.position+4,!0)):(t=this.dataView.getUint32(this.position,!1),e=this.dataView.getUint32(this.position+4,!1))}catch(r){throw this.throwOutOfBounds()}if(t>2097151)throw new Error("JS_INTEGER_OVERFLOW");return this.position+=8,t*Math.pow(2,32)+e}readBytes(e){this.position+e>this.dataView.byteLength&&this.throwOutOfBounds();let t=new Uint8Array(this.dataView.buffer,this.dataView.byteOffset+this.position,e);return this.position+=e,t}skip(e){if(this.position+e>this.dataView.byteLength)throw this.throwOutOfBounds();this.position+=e}rewind(e){if(this.position<e)throw this.throwOutOfBounds();this.position-=e}seek(e){if(e<0||e>this.dataView.byteLength)throw this.throwOutOfBounds();this.position=e}readTerminatedString(){let e=this.position;for(;this.hasMoreData();){if(0===this.dataView.getUint8(this.position))break;this.position+=1}let t=new Uint8Array(this.dataView.buffer,this.dataView.byteOffset+e,this.position-e);return this.position+=1,xe.x.fromUTF8(t)}throwOutOfBounds(){return new Error("BUFFER_READ_OUT_OF_BOUNDS")}readUUID(){const e=this.readBytes(16);return(Xe.byteToHex[e[0]]+Xe.byteToHex[e[1]]+Xe.byteToHex[e[2]]+Xe.byteToHex[e[3]]+"-"+Xe.byteToHex[e[4]]+Xe.byteToHex[e[5]]+"-"+Xe.byteToHex[e[6]]+Xe.byteToHex[e[7]]+"-"+Xe.byteToHex[e[8]]+Xe.byteToHex[e[9]]+"-"+Xe.byteToHex[e[10]]+Xe.byteToHex[e[11]]+Xe.byteToHex[e[12]]+Xe.byteToHex[e[13]]+Xe.byteToHex[e[14]]+Xe.byteToHex[e[15]]).toLowerCase()}}Xe.byteToHex=Array.from({length:256},(e,t)=>(t+256).toString(16).substr(1)),function(e){e[e.BASIC_BOX=0]="BASIC_BOX",e[e.FULL_BOX=1]="FULL_BOX"}(Ue||(Ue={}));class $e{constructor(){this.headers=[],this.boxDefinitions=[],this.done=!1}box(e,t){let r=$e.typeFromString(e);return this.headers[r]=Ue.BASIC_BOX,this.boxDefinitions[r]=t,this}fullBox(e,t){let r=$e.typeFromString(e);return this.headers[r]=Ue.FULL_BOX,this.boxDefinitions[r]=t,this}stop(){this.done=!0}parse(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);let i=new Uint8Array(e),n=new Xe(new DataView(i.buffer,i.byteOffset,i.byteLength),Ve.BIG_ENDIAN);for(this.done=!1;n.hasMoreData()&&!this.done;)this.parseNext(0,n,t,r)}parseNext(e,t,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1);let n=t.getPosition();if(i&&n+8>t.getLength())return void(this.done=!0);let s=t.readUint32(),a=t.readUint32();switch(s){case 0:s=t.getLength()-n;break;case 1:if(i&&t.getPosition()+8>t.getLength())return void(this.done=!0);s=t.readUint64()}let o=this.boxDefinitions[a];if(o){let l=null,d=null;if(this.headers[a]===Ue.FULL_BOX){let e=t.readUint32();l=e>>>24,d=16777215&e}let c=n+s,u=!0;if(r&&c>t.getLength()&&(c=t.getLength(),u=!1),i&&c>t.getLength())return void(this.done=!0);let h=c-t.getPosition(),p=h>0?t.readBytes(h):new Uint8Array(0);o({parser:this,partialOkay:r||!1,version:l,flags:d,reader:new Xe(new DataView(p.buffer,p.byteOffset,p.byteLength),Ve.BIG_ENDIAN),size:s,loadedSize:t.getPosition()-n,start:n+e,isComplete:u})}else{const e=Math.min(n+s-t.getPosition(),t.getLength()-t.getPosition());t.skip(e)}}static children(e){const t=null!==e.flags?12:8;for(;e.reader.hasMoreData()&&!e.parser.done;)e.parser.parseNext(e.start+t,e.reader,e.partialOkay)}static sampleDescription(e){const t=null!==e.flags?12:8;for(let r=e.reader.readUint32();r>0&&!e.parser.done;r-=1)e.parser.parseNext(e.start+t,e.reader,e.partialOkay)}static allData(e){return function(t){const r=t.reader.getLength()-t.reader.getPosition();e(t.reader.readBytes(r))}}static typeFromString(e){let t=0;for(let r=0;r<e.length;r++)t=t<<8|e.charCodeAt(r);return t}static typeToString(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)}}class et{parseInit(e){}parseMedia(e,t){return[]}}class tt{constructor(e){this.data_=void 0,this.position_=void 0,this.data_=e,this.position_=0}atEnd(){var e;return this.position_===(null==(e=this.data_)?void 0:e.length)}readLine(){return this.readRegexReturnCapture_(/(.*?)(\n|$)/gm,1)}readWord(){return this.readRegexReturnCapture_(/[^ \t\n]*/gm,0)}skipWhitespace(){this.readRegex(/[ \t]+/gm)}readRegex(e){let t=this.indexOf_(e);return this.atEnd()||null===t||t.position!==this.position_?null:(this.position_+=t.length,t.results)}readRegexReturnCapture_(e,t){if(this.atEnd())return null;let r=this.readRegex(e);return r?r[t]:null}indexOf_(e){e.lastIndex=this.position_;let t=e.exec(this.data_);return null===t?null:{position:t.index,length:t[0].length,results:t}}}class rt{static defaultEquals(e,t){return!("number"!==typeof e||"number"!==typeof t||!isNaN(e)||!isNaN(t))||e===t}static equal(e,t,r){if(void 0===r&&(r=rt.defaultEquals),e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1;return!0}static remove(e,t){let r=e.indexOf(t);r>-1&&e.splice(r,1)}}class it{constructor(e,t,r){this.startTime=void 0,this.endTime=void 0,this.payload=void 0,this.direction=We.HORIZONTAL_LEFT_TO_RIGHT,this.region=new nt,this.position=null,this.positionAlign=Be.AUTO,this.size=0,this.textAlign=He.CENTER,this.writingMode=Ye.HORIZONTAL_TOP_TO_BOTTOM,this.lineInterpretation=Ge.LINE_NUMBER,this.line=null,this.lineHeight="",this.lineAlign=ze.START,this.displayAlign=je.AFTER,this.color="",this.backgroundColor="",this.backgroundImage="",this.fontSize="",this.fontWeight=qe.NORMAL,this.fontStyle=Ke.NORMAL,this.fontFamily="",this.textDecoration=[],this.wrapLine=!0,this.id="",this.nestedCues=[],this.lineBreak=!1,this.spacer=!1,this.cellResolution={columns:32,rows:15},this.border="",this.letterSpacing="",this.linePadding="",this.opacity=1,this.startTime=e,this.endTime=t,this.payload=r}clone(){const e=new it(0,0,"");for(const t in this)e[t]=this[t],e[t]&&e[t].constructor===Array&&(e[t]=e[t].slice());return e}static equal(e,t){for(const r in e)if("nestedCues"===r){if(!rt.equal(e.nestedCues,t.nestedCues,it.equal))return!1}else if("region"===r||"cellResolution"===r){for(const i in e[r])if(e[r][i]!==t[r][i])return!1}else if(Array.isArray(e[r])){if(!rt.equal(e[r],t[r]))return!1}else if(e[r]!==t[r])return!1;return!0}}!function(e){e.LEFT="line-left",e.RIGHT="line-right",e.CENTER="center",e.AUTO="auto"}(Be||(Be={})),function(e){e.LEFT="left",e.RIGHT="right",e.CENTER="center",e.START="start",e.END="end"}(He||(He={})),function(e){e.BEFORE="before",e.CENTER="center",e.AFTER="after"}(je||(je={})),function(e){e.HORIZONTAL_LEFT_TO_RIGHT="ltr",e.HORIZONTAL_RIGHT_TO_LEFT="rtl"}(We||(We={})),function(e){e.HORIZONTAL_TOP_TO_BOTTOM="horizontal-tb",e.VERTICAL_LEFT_TO_RIGHT="vertical-lr",e.VERTICAL_RIGHT_TO_LEFT="vertical-rl"}(Ye||(Ye={})),function(e){e[e.LINE_NUMBER=0]="LINE_NUMBER",e[e.PERCENTAGE=1]="PERCENTAGE"}(Ge||(Ge={})),function(e){e.CENTER="center",e.START="start",e.END="end"}(ze||(ze={})),function(e){e[e.NORMAL=400]="NORMAL",e[e.BOLD=700]="BOLD"}(qe||(qe={})),function(e){e.NORMAL="normal",e.ITALIC="italic",e.OBLIQUE="oblique"}(Ke||(Ke={})),function(e){e.UNDERLINE="underline",e.LINE_THROUGH="lineThrough",e.OVERLINE="overline"}(Qe||(Qe={}));class nt{constructor(){this.id="",this.viewportAnchorX=0,this.viewportAnchorY=0,this.regionAnchorX=0,this.regionAnchorY=0,this.width=100,this.height=100,this.heightUnits=Ze.PERCENTAGE,this.widthUnits=Ze.PERCENTAGE,this.viewportAnchorUnits=Ze.PERCENTAGE,this.scroll=Je.NONE}}!function(e){e[e.PX=0]="PX",e[e.PERCENTAGE=1]="PERCENTAGE",e[e.LINES=2]="LINES"}(Ze||(Ze={})),function(e){e.NONE="",e.UP="up"}(Je||(Je={}));var st=r(9899);const{parse:at}=r(3741);class ot{constructor(){this.namespaces={}}parse(e){const t=at(e),r=Array.isArray(t)?t:[];return r.forEach(e=>{e.attributes&&Object.keys(e.attributes).forEach(t=>{if(t.startsWith("xmlns")){const[,r]=t.split(":");this.namespaces[e.attributes[t]]=r||"__global"}})}),r}static getChildren(e){return Array.from(e.children).filter(e=>!(0,st.H)(e))}getAttributeNS(e,t,r){const i=this.namespaces[t]+":"+r;return i in e.attributes?e.attributes[i]:null}getAttributeNSList(e,t,r){for(const i of t){const t=this.getAttributeNS(e,i,r);if(t)return t}return null}findChildrenNS(e,t,r){return e.children.filter(e=>{const i=this.namespaces[t]+":"+r;return"string"!==typeof e&&e.tagName===i})}findChildren(e,t){return e.children?e.children.filter(e=>"string"!==typeof e&&e.tagName===t):[]}getContents(e){var t;return(0,st.H)(e)?e:e.children.every(st.H)&&null!=(t=e.children[0].trim())?t:null}findChildNS(e,t,r){let i=this.findChildrenNS(e,t,r);return 1!==i.length?null:i[0]}static getElementsByTagName(e,t){let r=[];const i=e=>{e.tagName===t&&r.push(e);for(const t of e.children)"string"!==typeof t&&i(t)};return i(e),r}static getElementByTagName(e,t){let r=null;const i=e=>{if(null===r)if(e.tagName!==t)for(const t of e.children)"string"!==typeof t&&i(t);else r=e};return i(e),r}static setParent(e){const t=l(e,{parent:null}),r=e=>{for(const t of e.children)"string"!==typeof t&&(t.parent=e,r(t))};return r(t),t}static getTextContent(e){let t="";const r=e=>{for(const i of e.children)"string"===typeof i?t+=i:r(i)};return r(e),t}}const lt={amp:"&",quot:'"',apos:"'",lt:"<",gt:">"};var dt=r(1106),ct=r(6971);class ut extends et{constructor(){super()}parseInit(e){}parseMedia(e,t){const r=new ot,i=ut.parameterNs,n=ut.styleNs,s=xe.x.fromUTF8(e),a=[];let o=null;if(!s)return a;try{o=r.parse(function(e){return e.replace(/<br\s*><\/br\s*>/gi,"<br />")}(s))}catch(R){throw new dt.w({isFatal:!1,category:ct.q.MEDIA,code:"YASP_INVALID_SUBTITLES_XML",message:"Failed to parse TTML. "+R,details:{}})}if(!o||!o.length)throw new dt.w({isFatal:!1,category:ct.q.MEDIA,code:"YASP_INVALID_SUBTITLES_XML",message:"Failed to parse TTML.",details:{}});const l=o.filter(e=>"tt"===e.tagName),d=ot.setParent(l[0]);if(!d)throw new dt.w({isFatal:!1,category:ct.q.MEDIA,code:"YASP_INVALID_SUBTITLES_XML",message:"TTML does not contain <tt> tag.",details:{}});const c=ot.getElementByTagName(d,"body");if(!c)return[];const u=r.getAttributeNS(d,i,"frameRate"),h=r.getAttributeNS(d,i,"subFrameRate"),p=r.getAttributeNS(d,i,"frameRateMultiplier"),f=r.getAttributeNS(d,i,"tickRate"),m=r.getAttributeNS(d,i,"cellResolution"),g=d.attributes["xml:space"]||"default",v=r.getAttributeNS(d,n,"extent");if("default"!==g&&"preserve"!==g)throw new dt.w({isFatal:!1,category:ct.q.MEDIA,code:"YASP_INVALID_SUBTITLES_XML",message:"Invalid xml:space value: "+g,details:{}});const y="default"===g,E=new ht(u,h,p,f),S=ut.getCellResolution(null!=m?m:""),A=ot.getElementByTagName(d,"metadata"),T=A?ot.getChildren(A).filter(e=>!(0,st.H)(e)):[],b=ot.getElementsByTagName(d,"style"),w=ot.getElementsByTagName(d,"region"),_=[];for(const k of w){const e=ut.parseCueRegion(k,b,v,r);e&&_.push(e)}if(r.findChildren(c,"p").length)throw new dt.w({category:ct.q.MEDIA,code:"YASP_INVALID_SUBTITLES_XML",isFatal:!1,message:"<p> can only be inside <div> in TTML",details:{}});for(const k of r.findChildren(c,"div")){if(r.findChildren(k,"span").length)throw new dt.w({isFatal:!1,category:ct.q.MEDIA,code:"YASP_INVALID_SUBTITLES_XML",message:"<span> can only be inside <p> in TTML",details:{}});for(const e of r.findChildren(k,"p")){const i=ut.parseCue({cueNode:e,offset:t.periodStart,rateInfo:E,metadataElements:T,styles:b,regionElements:w,cueRegions:_,whitespaceTrim:y,isNested:!1,cellResolution:S,xmlUtils:r,parentNode:k});i&&a.push(i)}}return a}static parseCue(e){let t,{cueNode:r,offset:i,rateInfo:n,metadataElements:s,styles:a,regionElements:o,cueRegions:l,whitespaceTrim:c,isNested:h,cellResolution:p,xmlUtils:f,parentNode:m}=e,g=null;if(t=(0,st.H)(r)?u(function(e,t){return{tagName:"span",attributes:{},children:[e],parent:t}}(r,m)):u(r),g=t.parent,!g)return null;let v=u(g);const y=/\S/.test(t.textContent),E=t.textContent&&!y,S=Boolean(t.children.length),A="br"===t.tagName,T=t.attributes.begin||t.attributes.end||t.attributes.dur;if(!T&&E&&!A){if(!h)return null;if(c)return null}if(!y&&!S&&!T&&!A)return null;let{start:b,end:w}=ut.parseTime(t,n);for(;1===(null==(_=v)?void 0:_.nodeType)&&"tt"!==(null==(R=v)?void 0:R.tagName);){var _,R;({start:b,end:w}=ut.resolveTime(v,n,b,w));const e=v.parent;if(!e)break;v=u(e)}if(null===b&&(b=0),b+=i,null===w?w=1/0:w+=i,"br"===t.tagName){const e=new it(b,w,"");return e.lineBreak=!0,e}let k="";const P=[];if(3===t.nodeType)k=d(t.textContent),c&&(k=k.trim(),k=k.replace(/\s+/g," "));else for(const d of t.children){const e=ut.parseCue({cueNode:d,offset:i,rateInfo:n,metadataElements:s,styles:a,regionElements:o,cueRegions:l,whitespaceTrim:c,isNested:!0,cellResolution:p,xmlUtils:f,parentNode:t});e&&P.push(e)}const I=new it(b,w,k);I.nestedCues=P,p&&(I.cellResolution=p);const C=ut.getElementsFromCollection(t,"region",o,"",f)[0];if(C&&C.attributes["xml:id"]){const e=C.attributes["xml:id"];I.region=l.filter(t=>t.id===e)[0]}const O=ut.getElementsFromCollection(t,"backgroundImage",s,"#",f,ut.smpteNs)[0],D=0===P.length;return ut.addStyle(I,t,C,O,a,h,D,f),I}static parseCueRegion(e,t,r,i){const n=new nt,s=e.attributes["xml:id"];if(!s)return null;n.id=s;let a=null;r&&(a=ut.percentValues.exec(r)||ut.pixelValues.exec(r));const o=a?Number(a[1]):null,l=a?Number(a[2]):null;let d=null,c=null;const u=ut.getStyleAttributeFromRegion(e,t,"extent",i);u&&(c=ut.percentValues.exec(u),d=c||ut.pixelValues.exec(u),null!==d&&(n.width=null!==o?100*Number(d[1])/o:Number(d[1]),n.height=null!==l?100*Number(d[2])/l:Number(d[2]),n.widthUnits=c||null!==o?Ze.PERCENTAGE:Ze.PX,n.heightUnits=c||null!==l?Ze.PERCENTAGE:Ze.PX));const h=ut.getStyleAttributeFromRegion(e,t,"origin",i);return h&&(c=ut.percentValues.exec(h),d=c||ut.pixelValues.exec(h),null!==d&&(n.viewportAnchorX=null!==l?100*Number(d[1])/l:Number(d[1]),n.viewportAnchorY=null!==o?100*Number(d[2])/o:Number(d[2]),n.viewportAnchorUnits=c||null!==o?Ze.PERCENTAGE:Ze.PX)),n}static addStyle(e,t,r,i,n,s,a,o){const l=i?u(i):i,d=s||a;"rtl"===ut.getStyleAttribute(t,r,n,"direction",d,o)&&(e.direction=We.HORIZONTAL_RIGHT_TO_LEFT);const c=ut.getStyleAttribute(t,r,n,"writingMode",d,o);"tb"===c||"tblr"===c?e.writingMode=Ye.VERTICAL_LEFT_TO_RIGHT:"tbrl"===c?e.writingMode=Ye.VERTICAL_RIGHT_TO_LEFT:"rltb"===c||"rl"===c?e.direction=We.HORIZONTAL_RIGHT_TO_LEFT:c&&(e.direction=We.HORIZONTAL_LEFT_TO_RIGHT);const h=ut.getStyleAttribute(t,r,n,"textAlign",d,o);h?(e.positionAlign=ut.textAlignToPositionAlign[h],e.lineAlign=ut.textAlignToLineAlign[h],e.textAlign=He[h.toUpperCase()]):e.textAlign=He.START;const p=ut.getStyleAttribute(t,r,n,"displayAlign",d,o);p&&(e.displayAlign=je[p.toUpperCase()]);const f=ut.getStyleAttribute(t,r,n,"color",d,o);f&&(e.color=f);const m=ut.getStyleAttribute(t,r,n,"backgroundColor",d,o);m&&(e.backgroundColor=m);const g=ut.getStyleAttribute(t,r,n,"border",d,o);g&&(e.border=g);const v=ut.getStyleAttribute(t,r,n,"fontFamily",d,o);v&&(e.fontFamily=v);const y=ut.getStyleAttribute(t,r,n,"fontWeight",d,o);y&&"bold"===y&&(e.fontWeight=qe.BOLD);const E=ut.getStyleAttribute(t,r,n,"wrapOption",d,o);e.wrapLine=!E||"noWrap"!==E;const S=ut.getStyleAttribute(t,r,n,"lineHeight",d,o);S&&S.match(ut.unitValues)&&(e.lineHeight=S);const A=ut.getStyleAttribute(t,r,n,"fontSize",d,o);if(A){(A.match(ut.unitValues)||A.match(ut.percentValue))&&(e.fontSize=A)}const T=ut.getStyleAttribute(t,r,n,"fontStyle",d,o);if(T&&(e.fontStyle=Ke[T.toUpperCase()]),l){const t=l.attributes.imagetype,r=l.attributes.encoding,i=l.textContent.trim();"PNG"===t&&"Base64"===r&&i&&(e.backgroundImage="data:image/png;base64,"+i)}const b=ut.getStyleAttribute(t,r,n,"letterSpacing",d,o);b&&b.match(ut.unitValues)&&(e.letterSpacing=b);const w=ut.getStyleAttribute(t,r,n,"linePadding",d,o);w&&w.match(ut.unitValues)&&(e.linePadding=w);const _=ut.getStyleAttribute(t,r,n,"opacity",d,o);_&&(e.opacity=parseFloat(_));const R=ut.getStyleAttributeFromRegion(r,n,"textDecoration",o);R&&ut.addTextDecoration(e,R);const k=ut.getStyleAttributeFromElement(t,n,"textDecoration",o);k&&ut.addTextDecoration(e,k)}static addTextDecoration(e,t){for(const r of t.split(" "))switch(r){case"underline":e.textDecoration.includes(Qe.UNDERLINE)||e.textDecoration.push(Qe.UNDERLINE);break;case"noUnderline":e.textDecoration.includes(Qe.UNDERLINE)&&rt.remove(e.textDecoration,Qe.UNDERLINE);break;case"lineThrough":e.textDecoration.includes(Qe.LINE_THROUGH)||e.textDecoration.push(Qe.LINE_THROUGH);break;case"noLineThrough":e.textDecoration.includes(Qe.LINE_THROUGH)&&rt.remove(e.textDecoration,Qe.LINE_THROUGH);break;case"overline":e.textDecoration.includes(Qe.OVERLINE)||e.textDecoration.push(Qe.OVERLINE);break;case"noOverline":e.textDecoration.includes(Qe.OVERLINE)&&rt.remove(e.textDecoration,Qe.OVERLINE);break;default:continue}}static getStyleAttribute(e,t,r,i,n,s){void 0===n&&(n=!0);const a=ut.getStyleAttributeFromElement(e,r,i,s);return a||(n?ut.getStyleAttributeFromRegion(t,r,i,s):null)}static getStyleAttributeFromRegion(e,t,r,i){const n=ut.styleNs;if(!e)return null;const s=i.getAttributeNS(e,n,r);return s||ut.getInheritedStyleAttribute(e,t,r,i)}static getStyleAttributeFromElement(e,t,r,i){const n=ut.styleNs,s=i.getAttributeNS(e,n,r);return s||ut.getInheritedStyleAttribute(e,t,r,i)}static getInheritedStyleAttribute(e,t,r,i){const n=ut.styleNs,s=ut.styleEbuttsNs,a=ut.getElementsFromCollection(e,"style",t,"",i);let o=null;for(let l=0;l<a.length;l++){let e=i.getAttributeNS(a[l],s,r);e||(e=i.getAttributeNS(a[l],n,r)),e||(e=ut.getStyleAttributeFromElement(a[l],t,r,i)),e&&(o=e)}return o}static getElementsFromCollection(e,t,r,i,n,s){const a=[];if(!e||r.length<1)return a;const o=ut.getInheritedAttribute(e,t,n,s);if(o){const e=o.split(" ");for(const t of e)for(const e of r)if(i+e.attributes["xml:id"]===t){a.push(e);break}}return a}static getInheritedAttribute(e,t,r,i){let n=null;for(;e&&(n=i?r.getAttributeNS(e,i,t):e.attributes[t],!n);){const t=e.parent;if(null===t)break;e=t}return n}static resolveTime(e,t,r,i){const n=ut.parseTime(e,t);return null===r?r=n.start:null!==n.start&&(r+=n.start),null===i?i=n.end:null!==n.start&&(i+=n.start),{start:r,end:i}}static parseTime(e,t){const r=ut.parseTimeAttribute(e.attributes.begin,t);let i=ut.parseTimeAttribute(e.attributes.end,t);const n=ut.parseTimeAttribute(e.attributes.dur,t);return null===i&&null!==n&&(i=r+n),{start:r,end:i}}static parseTimeAttribute(e,t){let r=null;if(ut.timeColonFormatFrames.test(e))r=ut.parseColonTimeWithFrames(t,e);else if(ut.timeColonFormat.test(e))r=ut.parseTimeFromRegex(ut.timeColonFormat,e);else if(ut.timeColonFormatMilliseconds.test(e))r=ut.parseTimeFromRegex(ut.timeColonFormatMilliseconds,e);else if(ut.timeFramesFormat.test(e))r=ut.parseFramesTime(t,e);else if(ut.timeTickFormat.test(e))r=ut.parseTickTime(t,e);else if(ut.timeHMSFormat.test(e))r=ut.parseTimeFromRegex(ut.timeHMSFormat,e);else if(e)throw new dt.w({isFatal:!1,category:ct.q.MEDIA,code:"YASP_INVALID_TEXT_CUE",details:{},message:"Could not parse cue time range in TTML"});return r}static parseFramesTime(e,t){const r=ut.timeFramesFormat.exec(t);if(!r)return null;return Number(r[1])/e.frameRate}static parseTickTime(e,t){const r=ut.timeTickFormat.exec(t);if(!r)return null;return Number(r[1])/e.tickRate}static parseColonTimeWithFrames(e,t){const r=ut.timeColonFormatFrames.exec(t);if(!r)return null;const i=Number(r[1]),n=Number(r[2]);let s=Number(r[3]),a=Number(r[4]);return a+=(Number(r[5])||0)/e.subFrameRate,s+=a/e.frameRate,s+60*n+3600*i}static parseTimeFromRegex(e,t){const r=e.exec(t);if(null===r||""===r[0])return null;const i=Number(r[1])||0,n=Number(r[2])||0,s=Number(r[3])||0;return(Number(r[4])||0)/1e3+s+60*n+3600*i}static getCellResolution(e){if(!e)return null;const t=/^(\d+) (\d+)$/.exec(e);if(!t)return null;return{columns:parseInt(t[1],10),rows:parseInt(t[2],10)}}}ut.styleNs="http://www.w3.org/ns/ttml#styling",ut.parameterNs="http://www.w3.org/ns/ttml#parameter",ut.percentValues=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,ut.percentValue=/^(\d{1,2}(?:\.\d+)?|100)%$/,ut.unitValues=/^(\d+px|\d+em|\d*\.?\d+c)$/,ut.pixelValues=/^(\d+)px (\d+)px$/,ut.timeColonFormatFrames=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ut.timeColonFormat=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,ut.timeColonFormatMilliseconds=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,ut.timeFramesFormat=/^(\d*(?:\.\d*)?)f$/,ut.timeTickFormat=/^(\d*(?:\.\d*)?)t$/,ut.timeHMSFormat=new RegExp(["^(?:(\\d*(?:\\.\\d*)?)h)?","(?:(\\d*(?:\\.\\d*)?)m(?!s))?","(?:(\\d*(?:\\.\\d*)?)s)?","(?:(\\d*(?:\\.\\d*)?)ms)?$"].join("")),ut.smpteNs="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",ut.styleEbuttsNs="urn:ebu:tt:style",ut.textAlignToLineAlign={left:ze.START,center:ze.CENTER,right:ze.END,start:ze.START,end:ze.END},ut.textAlignToPositionAlign={left:Be.LEFT,center:Be.CENTER,right:Be.RIGHT};class ht{constructor(e,t,r,i){if(this.frameRate=void 0,this.subFrameRate=void 0,this.tickRate=void 0,this.frameRate=Number(e)||30,this.subFrameRate=Number(t)||1,this.tickRate=Number(i),0===this.tickRate&&(this.tickRate=e?this.frameRate*this.subFrameRate:1),r){const e=/^(\d+) (\d+)$/g.exec(r);if(e){const t=Number(e[1])/Number(e[2]);this.frameRate*=t}}}}class pt{constructor(){this.parser=new ut}parseInit(e){let t=!1;if((new $e).box("moov",$e.children).box("trak",$e.children).box("mdia",$e.children).box("minf",$e.children).box("stbl",$e.children).fullBox("stsd",$e.sampleDescription).box("stpp",e=>{t=!0,e.parser.stop()}).parse(e),!t)throw new Error("Can not parseInt while subtitles processing")}parseMedia(e,t){let r=!1,i=[];if((new $e).box("mdat",$e.allData(e=>{r=!0,i=i.concat(this.parser.parseMedia(e,t))})).parse(e,!1),!r)throw new Error("Can not parseInt while subtitles processing.");return i}}var ft=r(2918);class mt extends et{constructor(){super()}parseInit(e){}parseMedia(e,t){let r=xe.x.fromUTF8(e);r=r.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n");let i=r.split(/\n{2,}/m);if(!/^WEBVTT($|[ \t\n])/m.test(i[0]))throw new Error("INVALID_TEXT_HEADER");let n=t.segmentStart;null===n&&(n=0);let s=[],a=i[0].split("\n");for(let l=1;l<a.length;l++)if(/^Region:/.test(a[l])){let e=mt.parseRegion_(a[l]);s.push(e)}let o=[];for(let l=1;l<i.length;l++){a=i[l].split("\n");let e=mt.parseCue_(a,n,s);e&&o.push(e)}return o}static parseRegion_(e){let t=new tt(e),r=new nt;t.readWord(),t.skipWhitespace();let i=t.readWord();for(;i;)mt.parseRegionSetting_(r,i),t.skipWhitespace(),i=t.readWord();return r}static parseCue_(e,t,r){if(1===e.length&&!e[0])return null;if(/^NOTE($|[ \t])/.test(e[0]))return null;if("STYLE"===e[0])return null;let i=null;e[0].includes("--\x3e")||(i=e[0],e.splice(0,1));let n=new tt(e[0]),s=mt.parseTime_(n),a=n.readRegex(/[ \t]+-->[ \t]+/g),o=mt.parseTime_(n);if(null===s||null===a||null===o)return null;t&&(s+=t,o+=t);let l=e.slice(1).join("\n").trim(),d=new it(s,o,l);n.skipWhitespace();let c=n.readWord();for(;c;)mt.parseCueSetting(d,c,r),n.skipWhitespace(),c=n.readWord();return null!==i&&(d.id=i),d}static parseCueStyles(e,t){const r="<span>"+e+"</span>",i=(new ot).parse(r);if(i){const r=[],n=i;if(1===n.length){if(3===u(n[0]).nodeType)return void(t.payload=e)}for(const e of n)mt.generateCueFromElement(e,t,r);t.nestedCues=r}else t.payload=e}static generateCueFromElement(e,t,r){const i=u(e),n=t.clone();if(1===i.nodeType&&i.tagName){const t=qe.BOLD,r=Ke.ITALIC,i=Qe.UNDERLINE,s=e.tagName.split(/[ .]+/);for(const e of s)switch(e){case"b":n.fontWeight=t;break;case"i":n.fontStyle=r;break;case"u":n.textDecoration.push(i);break;default:continue}}if(3===i.nodeType)n.payload=i.textContent,r.push(n);else for(const s of i.children)(0,st.H)(s)||mt.generateCueFromElement(s,n,r)}static parseCueSetting(e,t,r){let i=null;if(i=/^align:(start|middle|center|end|left|right)$/.exec(t))mt.setTextAlign_(e,i[1]);else if(i=/^vertical:(lr|rl)$/.exec(t))mt.setVerticalWritingMode_(e,i[1]);else if(i=/^size:([\d.]+)%$/.exec(t))e.size=Number(i[1]);else if(i=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(t))e.position=Number(i[1]),i[2]&&mt.setPositionAlign_(e,i[2]);else{if(!(i=/^region:(.*)$/.exec(t)))return mt.parsedLineValueAndInterpretation_(e,t);{let t=mt.getRegionById_(r,i[1]);t&&(e.region=t)}}return!0}static getRegionById_(e,t){let r=e.filter((function(e){return e.id===t}));return r.length?r[0]:null}static parseRegionSetting_(e,t){let r=null;if(r=/^id=(.*)$/.exec(t))e.id=r[1];else if(r=/^width=(\d{1,2}|100)%$/.exec(t))e.width=Number(r[1]);else if(r=/^lines=(\d+)$/.exec(t))e.height=Number(r[1]),e.heightUnits=Ze.LINES;else if(r=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(t))e.regionAnchorX=Number(r[1]),e.regionAnchorY=Number(r[2]);else if(r=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(t))e.viewportAnchorX=Number(r[1]),e.viewportAnchorY=Number(r[2]);else{if(!(r=/^scroll=up$/.exec(t)))return!1;e.scroll=Je.UP}return!0}static setTextAlign_(e,t){e.textAlign="middle"===t?He.CENTER:He[t.toUpperCase()]}static setPositionAlign_(e,t){e.positionAlign="line-left"===t||"start"===t?Be.LEFT:"line-right"===t||"end"===t?Be.RIGHT:Be.CENTER}static setVerticalWritingMode_(e,t){e.writingMode="lr"===t?Ye.VERTICAL_LEFT_TO_RIGHT:Ye.VERTICAL_RIGHT_TO_LEFT}static parsedLineValueAndInterpretation_(e,t){let r=null;if(r=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(t))e.lineInterpretation=Ge.PERCENTAGE,e.line=Number(r[1]),r[2]&&(e.lineAlign=ze[r[2].toUpperCase()]);else{if(!(r=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(t)))return!1;e.lineInterpretation=Ge.LINE_NUMBER,e.line=Number(r[1]),r[2]&&(e.lineAlign=ze[r[2].toUpperCase()])}return!0}static parseTime_(e){let t=e.readRegex(/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g);if(null===t)return null;let r=Number(t[1])||0,i=Number(t[2]),n=Number(t[3]),s=Number(t[4]);return i>59||n>59?null:s/1e3+n+60*i+3600*r}}class gt extends et{constructor(){super(),this.timescale=null,this.parseInit=e=>{let t=!1;if((new $e).box("moov",$e.children).box("trak",$e.children).box("mdia",$e.children).fullBox("mdhd",e=>{0===e.version?(e.reader.skip(4),e.reader.skip(4),this.timescale=e.reader.readUint32(),e.reader.skip(4)):(e.reader.skip(8),e.reader.skip(8),this.timescale=e.reader.readUint32(),e.reader.skip(8)),e.reader.skip(4)}).box("minf",$e.children).box("stbl",$e.children).fullBox("stsd",$e.sampleDescription).box("wvtt",()=>{t=!0}).parse(e),!this.timescale)throw new Error("Can not get vtt timescale");if(!t)throw new Error("No WVTT box was found")}}parseMedia(e,t){if(!this.timescale)throw new Error("No init segment for MP4+VTT!");let r=0,i=[],n=new Uint8Array,s=[],a=!1,o=!1,l=!1,d=null;if((new $e).box("moof",$e.children).box("traf",$e.children).fullBox("tfdt",e=>{a=!0,0!==e.version&&1!==e.version||(r=0===e.version?e.reader.readUint32():e.reader.readUint64())}).fullBox("tfhd",e=>{null!==e.flags&&(d=gt.parseTFHD(e.flags,e.reader))}).fullBox("trun",(function(e){o=!0,null!==e.version&&null!==e.flags&&(i=i.concat(gt.parseTRUN(e.version,e.flags,e.reader)))})).box("mdat",$e.allData(e=>{l=!0,n=ft.P.concat(n,e)})).parse(e),!l&&!a&&!o||!n.length)throw new Error("Can not parse mp4 vtt because required box is missing.");let c=r;const u=new DataView(n.buffer,n.byteOffset,n.byteLength),h=new Xe(u,Ve.BIG_ENDIAN);return i.forEach(e=>{let i=e.duration||d,n=e.timeOffset?r+e.timeOffset:c;c=n+(i||0);let a=0;do{let e=h.readUint32();a+=e;let r=h.readUint32(),o=$e.typeToString(r),l=null;if("vttc"===o?e>8&&(l=h.readBytes(e-8)):h.skip(e-8),i&&l){if(null===this.timescale)throw new Error("No initial vtt segment");const e=gt.parseVTTC(l,t.periodStart+n/this.timescale,t.periodStart+c/this.timescale);s.push(e)}}while(e.sampleSize&&a<e.sampleSize)}),s.filter(Boolean)}static parseTFHD(e,t){return t.skip(4),1&e&&t.skip(8),2&e&&t.skip(4),8&e?t.readUint32():null}static parseTRUN(e,t,r){let i=r.readUint32();1&t&&r.skip(4),4&t&&r.skip(4);let n=[];for(let s=0;s<i;s++){let i={duration:null,sampleSize:null,timeOffset:null};256&t&&(i.duration=r.readUint32()),512&t&&(i.sampleSize=r.readUint32()),1024&t&&r.skip(4),2048&t&&(i.timeOffset=0===e?r.readUint32():r.readInt32()),n.push(i)}return n}static parseVTTC(e,t,r){let i,n,s="";return(new $e).box("payl",$e.allData(e=>{i=xe.x.fromUTF8(e)})).box("iden",$e.allData(e=>{n=xe.x.fromUTF8(e)})).box("sttg",$e.allData(e=>{s=xe.x.fromUTF8(e)})).parse(e),i?gt.assembleCue(i,n,s,t,r):null}static assembleCue(e,t,r,i,n){let s=new it(i,n,e);if(mt.parseCueStyles(e,s),t&&(s.id=t),r){let e=new tt(r),t=e.readWord();for(;t;)mt.parseCueSetting(s,t,[]),e.skipWhitespace(),t=e.readWord()}return s}}class vt{constructor(){this.parser=null,this.timestampOffset=0,this.appendWindowStart=0,this.appendWindowEnd=1/0,this.bufferStart=null}static registerParser(e,t){vt.parserMap[e]=t}initParser(e){if("application/cea-608"===e)return;let t=vt.parserMap[e];this.parser=new t}appendBuffer(e,t,r){return Promise.resolve().then(()=>{if(!this.parser)return;if(null===t||null===r)return void this.parser.parseInit(e);const i={periodStart:this.timestampOffset,segmentStart:t,segmentEnd:r},n=this.parser.parseMedia(e,i).filter(e=>e.startTime>=this.appendWindowStart&&e.startTime<this.appendWindowEnd);return null===this.bufferStart&&(this.bufferStart=Math.max(t,this.appendWindowStart)),n})}}vt.parserMap={},vt.registerParser("text/vtt",mt),vt.registerParser('text/vtt; codecs="vtt"',mt),vt.registerParser('text/vtt; codecs="wvtt"',mt),vt.registerParser("application/ttml+xml",ut),vt.registerParser('application/mp4; codecs="stpp"',pt),vt.registerParser('application/mp4; codecs="stpp.ttml.im1t"',pt),vt.registerParser('application/mp4; codecs="stpp.TTML.im1t"',pt),vt.registerParser('application/mp4; codecs="wvtt"',gt);class yt extends Le{constructor(e){super(e),this.kind=void 0,this.label=void 0,this.type="text",this.codecs=void 0,this.kind=yt.parseKind(e.kind),this.codecs=e.codecs,this.label=e.label||e.language||"Yasp Text Track"}static parseKind(e){switch(e){case"subtitle":return"subtitles";default:return e}}getFullMimeType(){return this.codecs?this.mimeType+"; codecs="+JSON.stringify(this.codecs):this.mimeType}appendInitSegment(e){this.init=e,this.parseSegment(e)}parseSegment(e){yt.textEngine.initParser(this.getFullMimeType());const t=e.isInitSegment,r=t?null:e.start,i=t?null:e.end,n=e.getChunks();let s=0;n.forEach(e=>{s+=e.length});const a=new Uint8Array(s);let o=0;n.forEach(e=>{a.set(e,o),o+=e.length}),yt.textEngine.appendBuffer(a,r,i).then(e=>{if(e){const t=this.presentationTimeOffset/1e3,r=e=>(e.startTime-=t,e.endTime-=t,e.nestedCues&&(e.nestedCues=e.nestedCues.map(r)),e),i=e.map(r);this.emit("CuesAdded",i)}})}}yt.textEngine=new vt;var Et=r(3106);class St extends Re.M{constructor(e){void 0===e&&(e=Et.identity),super(),this.destroyed=!1,this.closing=!1,this.closed=!1,this.paused=!0,this.flushing=!1,this.concatBuffer=void 0,this.buffer=[],this.flushBuffer=()=>{if(this.flushing)return;this.flushing=!0;let e=0;for(;!this.paused&&e<this.buffer.length;)this.emit("Data",this.buffer[e]),e++;this.buffer.splice(0,e),this.flushing=!1,e>0&&0===this.buffer.length&&this.emit("Drain")},this.on("Resume",this.flushBuffer),this.once("Destroy",()=>{this.destroyed=!0}),this.concatBuffer=e}isClosing(){return this.closing&&!this.destroyed}isClosed(){return this.closed&&!this.destroyed}isDestroyed(){return this.destroyed}asWritable(){return this}asReadable(){return this}write(e){if(this.destroyed)throw new Error("Unexpected write after destroy");if(this.closing)throw new Error("Unexpected write after close");return this.buffer.push(e),this.buffer=this.concatBuffer(this.buffer),this.flushBuffer(),!this.paused&&0===this.buffer.length}async read(){if(this.destroyed)throw new Error("Unexpected read after destroy");return this.closed?Promise.resolve({value:void 0,done:!0}):new Promise((e,t)=>{const r=()=>{t(new Error("Unexpected destroy while read"))},i=()=>{e({value:void 0,done:!0})};this.once("Data",t=>{this.pause(),e({value:t,done:!1}),this.off("Destroy",r),this.off("Close",i)}),this.once("Destroy",r),this.once("Close",i),this.resume()})}pause(){this.paused=!0,this.emit("Pause")}resume(){this.paused=!1,this.emit("Resume")}destroy(){this.buffer=[],super.destroy()}close(){this.closing||(this.closing=!0,this.buffer.length>0?this.once("Drain",()=>{this.closed=!0,this.emit("Close")}):(this.closed=!0,this.emit("Close")))}}var At=r(4364),Tt=r(371);class bt extends Re.M{static concatChunks(e){return e.length<2?e:"string"===typeof e[0]?[e.join("")]:[ft.P.concat(...e)]}constructor(e){let{start:t,end:r,number:i,isInitSegment:n,trackId:s,bitrate:a,width:o,height:l,originalStart:d}=e;super(),this.trackId=void 0,this.isInitSegment=void 0,this.number=void 0,this.start=0,this.end=0,this.duration=0,this.bitrate=void 0,this.originalStart=void 0,this.width=0,this.height=0,this.expectedSize=void 0,this.loadedRawSize=0,this.getLoadingDuration=null,this.chunks=[],this.finishedSegment=!1,this.failedSegment=!1,this.chunkStream=null,this.start=t,this.end=r,this.duration=Math.max(r-t,0),this.number=i,this.bitrate=a,this.expectedSize=a*(this.duration/1e3)/8,this.width=o,this.height=l,this.isInitSegment=n,this.trackId=s,this.originalStart=d,this.loadedRawSize=0}loadingStarted(){this.getLoadingDuration=(0,Tt.u)()}get finished(){return this.finishedSegment}get failed(){return this.failedSegment}setExpectedSize(e){isNaN(e)||(this.expectedSize=e)}append(e){var t;this.chunks.push(e),null==(t=this.chunkStream)||t.write(e)}finish(){var e;this.finishedSegment=!0,null==(e=this.chunkStream)||e.close(),this.chunkStream=null,this.emit("Finish")}fail(){this.failedSegment=!0,this.emit("Failed"),this.chunkStream&&this.chunkStream.destroy()}getExpectedTimeToLoad(){if(null===this.getLoadingDuration)return this.duration;const e=this.getLoadingDuration();return 0===this.loadedRawSize?this.duration:e*(Math.max(this.expectedSize,this.loadedRawSize)/this.loadedRawSize)-e}getChunkStream(){this.chunkStream||(this.chunkStream=new St(bt.concatChunks));const e=this.chunkStream;return this.chunks.forEach(t=>null==e?void 0:e.write(t)),this.finished&&(0===this.chunks.length&&(0,At.L)(new Error("Finished empty segment")),e.close(),this.chunkStream=null),e.asReadable()}getChunks(){return this.chunks}getDebugInfo(){return{chunksCount:this.chunks.length,chunksSize:this.chunks.reduce((e,t)=>e+t.length,0),start:this.start,end:this.end,duration:this.duration,finishedSegment:this.finishedSegment,number:this.number,expectedSize:this.expectedSize,loadingDuration:this.getLoadingDuration?this.getLoadingDuration():null,hasChunkStream:null!==this.chunkStream}}}var wt=r(7177),_t=r(8682),Rt=r(2615),kt=r(3125);class Pt extends Re.M{constructor(e){let{timeline:t,videoState:r}=e;super(),this.timeline=void 0,this.videoState=void 0,this.history=[],this.currentBuffering=null,this.currentTargetLatency=7e3,this.timeline=t,this.videoState=r,r.on("BufferingChange",e=>{this.setBuffering(e)})}destroy(){super.destroy(),this.videoState.off("BufferingChange")}notifyTargetLatency(){this.emit("TargetLatencyUpdate",this.currentTargetLatency)}checkIsLiveEdge(){const{currentTime:e}=this.videoState;if(!e)return!1;const t=1e3*e,r=this.checkForType("audio",t);return this.checkForType("video",t)||r}checkForType(e,t){const{segment:r}=this.timeline.getSegment(e,t);if(!r)return!1;const i=this.timeline.getLastSegmentNumber(e);if(!i)return!1;const n=this.timeline.getMaxSegmentDuration(),s=Math.ceil(7e3/n);return r.number>=i-s}setBuffering(e){if(e){if(this.currentBuffering||!this.checkIsLiveEdge())return;this.currentBuffering={start:Date.now(),getTime:(0,kt.u)()}}else{var t;if(!this.currentBuffering)return;const e=null==(t=this.currentBuffering)?void 0:t.getTime();this.history.push({start:this.currentBuffering.start,end:this.currentBuffering.start+e,duration:e}),this.currentBuffering=null,this.checkHistory()}}getAverageStalledDuration(){return this.history.reduce((e,t)=>e+t.duration,0)/this.history.length}checkHistory(){const e=Date.now();this.history=this.history.filter(t=>e-t.end<=2e4),this.history.length>=2&&(this.currentTargetLatency=this.currentTargetLatency+this.getAverageStalledDuration(),this.notifyTargetLatency(),this.timeline.setTargetLatency(this.currentTargetLatency),this.history=[])}}const It={avc1:["avc3"],avc3:["avc1"]};var Ct=r(9298),Ot=r(6702);class Dt extends Re.M{constructor(){super(),this.audio=[],this.text=[],this.video=[],this.bufferedInfoChangedPromise=null,this.selectedVideoTrackHeight=void 0,this.selectedVideoTracks=[],this.selectedAudioLanguage=void 0,this.selectedTextTrack=void 0,this.targetLatency=void 0,this.mpd=void 0,this.externalPresentationDelay=void 0;const e=(0,Ot.c)(7);this.targetLatency=1e3*e}checkTrackAvailableToLoad(e,t){var r;switch(t){case"text":return(null==(r=this.selectedTextTrack)?void 0:r.id)===e;case"video":return 0===this.selectedVideoTracks.length||this.selectedVideoTracks.some(t=>e===t.id);case"audio":if(!this.selectedAudioLanguage)return!0;const i=this.findTrackById(e,t);return(null==i?void 0:i.language)===this.selectedAudioLanguage;default:return!1}}setVideoTrack(e){const t=this.findTrackById(e,"video"),r=t?t.height:void 0;r!==this.selectedVideoTrackHeight&&(this.selectedVideoTrackHeight=r,this.updateSelectedVideoTracks(),this.emit("VideoTrackChange",t?e:"auto"))}updateSelectedVideoTracks(){this.selectedVideoTracks=this.selectedVideoTrackHeight?this.video.filter(e=>e.height===this.selectedVideoTrackHeight):v(this.video)}setAudioLanguage(e){const t=this.audio.find(e=>e.language===this.selectedAudioLanguage),r=this.audio.find(t=>t.language===e);if(!r||e===this.selectedAudioLanguage)return;const i=y(t,r);this.selectedAudioLanguage=e,i||this.emit("CodecsChange",r),this.emit("AudioLanguageChange",e)}setTextTrack(e){var t;if(this.selectedTextTrack&&this.selectedTextTrack.clear(0,1/0),!e)return void(this.selectedTextTrack=void 0);let r=this.text.find(t=>t.language===e.language);r&&(null==r?void 0:r.language)!==(null==(t=this.selectedTextTrack)?void 0:t.language)&&(this.selectedTextTrack=r||this.selectedTextTrack,this.emit("TextTrackChange",this.selectedTextTrack))}getVideoTracksInfo(){return[{id:_t.A,selected:void 0===this.selectedVideoTrackHeight,kind:"main",language:"unknown",label:""},...v(this.video).map(e=>({selected:e.height===this.selectedVideoTrackHeight,width:e.width,height:e.height,bitrate:e.bitrate,label:e.label,language:e.language,frameRate:e.frameRate,id:e.id,kind:"main"}))]}getAudioTracksInfo(){const e={};return this.audio.forEach(t=>{const r=t.language;r&&(e[r]?t.bitrate>e[r].bitrate&&(e[r].bitrate=t.bitrate):e[r]={selected:r===this.selectedAudioLanguage,id:t.id,label:t.label||"",language:r,kind:"main",bitrate:t.bitrate,channels:t.channels})}),(0,Rt.z)(e)}getTextTracksInfo(){return this.text}getTracksMeta(e,t){if(null===e)return[];switch(t){case"video":return this.selectedVideoTracks.map(t=>this.getSegmentMeta(e,t)).filter(Boolean);case"audio":return this.audio.filter(e=>{var t;return e.language===(null!=(t=this.selectedAudioLanguage)?t:e.language)}).map(t=>this.getSegmentMeta(e,t)).filter(Boolean);case"text":return this.text.filter(e=>{var t,r;return e.label===(null==(t=this.selectedTextTrack)?void 0:t.label)||e.language===(null==(r=this.selectedTextTrack)?void 0:r.language)}).map(t=>this.getSegmentMeta(e,t)).filter(Boolean);default:return[]}}getSegmentMeta(e,t){if(t.endTime===e+t.presentationTimeOffset)return this.getLastSegmentMeta(t);let r=Math.max(Math.floor(0)),i=0;const n=t.segmentSequences.find((n,s)=>{i=s;const a=n.time-t.presentationTimeOffset,o=a+n.duration*n.count,l=a<=e&&e<o;return l||(r+=n.count),l});if(!n)return;const s=n.time-t.presentationTimeOffset,a=e-s,o=Math.max(0,Math.floor(a/n.duration+1e-4)),l=t.startNumber+(r+o),d=Math.max(s+n.duration*o,0),c=l===n.endNumber,u=t.segmentSequences[i+1],h=Math.max(c&&u?u.time-t.presentationTimeOffset:s+n.duration*(o+1),0),p=t.bitrate,f=n.originalValues.time-n.originalValues.trackPresentationTimeOffset+n.originalValues.duration*o;return new bt({start:d,end:h,bitrate:p,trackId:t.id,number:l,originalStart:f,isInitSegment:!1,width:"width"in t?t.width:0,height:"height"in t?t.height:0})}clear(e,t){this.audio.forEach(r=>r.clear(e,t)),this.video.forEach(r=>r.clear(e,t)),this.text.forEach(r=>r.clear(e,t))}getDuration(){var e,t;const r=null!=(e=this.video[0])?e:this.audio[0];if(void 0!==r)return null!=(t=this.mpd)&&t.isDynamic?1/0:r.endTime-r.startTime}getMimeTypes(){return{audio:Array.from(new Set(this.audio.map(e=>e.getFullMimeType()))),video:Array.from(new Set(this.video.map(e=>e.getFullMimeType())))}}getBufferedRanges(e){void 0===e&&(e=!1);let t=this.audio,r=this.selectedVideoTracks,i=this.text;return this.selectedAudioLanguage&&(t=t.filter(e=>e.language===this.selectedAudioLanguage)),{audio:t.map(t=>t.getBufferedRanges(e)),video:r.map(t=>t.getBufferedRanges(e)),text:i.map(t=>t.getBufferedRanges(e))}}getSeekableRanges(){return[this.getSeekableRange()]}getSegment(e,t){const r=[];return("video"===e?this.selectedVideoTracks:this.audio.filter(e=>{var t;return e.language===(null!=(t=this.selectedAudioLanguage)?t:e.language)})).forEach(e=>{const i=e.getSegment(t);i&&r.push({track:e,segment:i})}),h(r,e=>{let{track:t}=e;return t.bitrate})||{track:void 0,segment:void 0}}getInitialSegment(e,t){const r=("video"===e?this.video:this.audio).find(e=>{let{id:r}=e;return r===t});return(null==r?void 0:r.getInitSegment())||void 0}obtainTimelineTrack(e){const t=this[e.type];"audio"===e.type&&(this.selectedAudioLanguage=this.selectedAudioLanguage||e.language||void 0);const r=t.find(t=>t.id===e.id);if(r)return r.updateTrack(e),r;const i=(e=>{switch(e.type){case"audio":return new Me(e);case"video":return new Fe(e);case"text":return new yt(e);default:throw new Error("Unexpected TimelineTrack#type="+e.type)}})(e);return t.push(i),i.on("BufferedInfoChanged",()=>this.emitBufferedInfoChanged()),"text"===i.type&&i.on("CuesAdded",e=>{this.emit("CuesAdded",{cues:e,label:i.label})}),i}findTrackById(e,t){return this[t].find(t=>t.id===e)}emitBufferedInfoChanged(){var e;this.bufferedInfoChangedPromise=null!=(e=this.bufferedInfoChangedPromise)?e:Promise.resolve().then(()=>{const e=this.getBufferedRanges(),t=m(e.video),r=m(e.audio);this.emit("BufferedInfoChanged",{video:t.map(e=>{let{start:t,end:r}=e;return{start:t/1e3,end:r/1e3}}),audio:r.map(e=>{let{start:t,end:r}=e;return{start:t/1e3,end:r/1e3}}),total:g(t,r).map(e=>{let{start:t,end:r}=e;return{start:t/1e3,end:r/1e3}})})}).then(()=>{this.bufferedInfoChangedPromise=null})}getLastSegmentMeta(e){const t=e.segmentSequences[e.segmentSequences.length-1];if(!t)return;const r=Math.max(0,t.time-e.presentationTimeOffset+t.duration*(t.count-1)),i=Math.max(r+t.duration,0),n=e.bitrate,s=t.originalValues.time-t.originalValues.trackPresentationTimeOffset+t.originalValues.duration*(t.count-1);return new bt({start:r,end:i,bitrate:n,trackId:e.id,number:e.endNumber,originalStart:s,isInitSegment:!1,width:"width"in e?e.width:0,height:"height"in e?e.height:0})}getDebugInfo(e){var t,r,i;return{audio:this.audio.map(e=>e.getDebugInfo()),video:this.video.map(e=>e.getDebugInfo()),text:this.text.map(e=>e.getDebugInfo()),selectedVideoTracks:this.selectedVideoTracks.map(e=>e.getDebugInfo()),selectedVideoTrackHeight:null!=(t=this.selectedVideoTrackHeight)?t:null,selectedAudioLanguage:null!=(r=this.selectedAudioLanguage)?r:null,selectedTextTrack:null!=(i=this.selectedTextTrack)?i:null,mpd:this.mpd,externalPresentationDelay:this.externalPresentationDelay,isLive:this.getIsDynamic(),isLowLatency:this.isLowLatencyLive(),segmentDebugInfo:void 0!==e?this.getSegmentsDebugInfo(e):void 0}}updateStreamEndTime(){var e;const t=null!=(e=this.video[0])?e:this.audio[0];t.endTime&&this.emit("StreamEndTimeUpdate",t.endTime-t.presentationTimeOffset)}applyMpd(e){var t;this.mpd=S({},e,{presentationDelay:null!=(t=this.externalPresentationDelay)?t:e.presentationDelay}),this.updateStreamEndTime()}getIsDynamic(){var e;return(null==(e=this.mpd)?void 0:e.isDynamic)||!1}isLowLatencyLive(){var e;return this.getIsDynamic()&&0!==(null==(e=this.mpd)?void 0:e.availabilityTimeOffset)}getLiveEdge(){var e;if(null==(e=this.mpd)||!e.isDynamic)return this.getDuration()||0;if(null===this.mpd.presentationStartTime)throw new Error("Cannot compute live edge without presentationStartTime");return Date.now()+this.mpd.clockOffset-this.mpd.maxSegmentDuration-this.mpd.presentationStartTime}getMaxSegmentDuration(){var e;return(null==(e=this.mpd)?void 0:e.maxSegmentDuration)||5e3}getSeekableRange(){return{start:this.getSeekRangeStart(),end:this.getSeekRangeEnd()}}getSeekRangeStart(){var e;if(null==(e=this.mpd)||!e.isDynamic)return 0;const t=this.mpd.minSegmentStartTime;if(!isFinite(this.mpd.segmentAvailabilityDuration))return t-this.mpd.publishTime;const r=this.getLiveEdge()+this.mpd.availabilityTimeOffset-this.mpd.segmentAvailabilityDuration+this.mpd.minBufferTime;return Math.max(t,r)}getSeekRangeEnd(){var e;if(null==(e=this.mpd)||!e.isDynamic)return this.getDuration()||0;const t=this.isLowLatencyLive()?0:this.mpd.presentationDelay,r=this.getLiveEdge()+this.mpd.availabilityTimeOffset-t;if(!this.isLowLatencyLive())return Math.max(0,r);const i=r+this.mpd.presentationStartTime,n=Date.now()+this.mpd.clockOffset;return Math.min(i,n-this.targetLatency)-this.mpd.presentationStartTime}getUtcStartTime(){var e,t,r;return null!=(e=this.mpd)&&e.isDynamic?this.mpd.isDynamic&&!isFinite(this.mpd.segmentAvailabilityDuration)?this.mpd.publishTime:0:null!=(t=null==(r=this.mpd)?void 0:r.publishTime)?t:0}setPresentationDelay(e){var t;this.externalPresentationDelay=null!=(t=this.externalPresentationDelay)?t:e}getEmsgSchemeIdUris(){var e;return null==(e=this.mpd)?void 0:e.emsgSchemeIdUris}getLastSegmentNumber(e){const t=this[e][0];return t?t.endNumber:null}setTargetLatency(e){this.targetLatency=e}getSegmentsDebugInfo(e){return{audio:this.getSegmentsDebugInfoByType("audio",e),video:this.getSegmentsDebugInfoByType("video",e)}}getSegmentsDebugInfoByType(e,t){return this[e].reduce((e,r)=>(E(r.getSegmentsDebugInfo(t)).forEach(t=>{let[r,i]=t;e[r]+=i}),e),{playedRawSize:0,playedSegmentCount:0,activeRawSize:0,activeSegmentCount:0})}}var Nt=r(7922);const Lt=(new Map).set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",Nt.ly).set("urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",Nt.xE).set("urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95",Nt.xE),Mt=(e,t)=>({keySystem:e,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:null!=t?t:[]});class Ft{constructor(e){this.parser=e}parse(e){let t=this.parseElements(e),r=null,i=[],n=[];const s=new Set(t.map(e=>e.keyId).filter(e=>null!==e));if(s.size>1)throw new dt.w({code:"YASP_DASH_CONFLICTING_KEY_IDS",isFatal:!0,message:"Dash manifest has conflicting ids: "+Array.from(s).join(","),details:{},category:ct.q.DRM});n=t.filter((function(e){return"urn:mpeg:dash:mp4protection:2011"!==e.schemeUri||(r=e.init||r,!1)})),n.length&&(i=this.convertElements(r,n));return{defaultKeyId:Array.from(s)[0]||null,defaultInit:r,drmInfos:i}}convertElements(e,t){const r=[];for(const i of t){const t=Lt.get(i.schemeUri);if(t){const n=this.getInitDataFromPro(i)||i.init||e,s=Mt(t,n);r.push(s)}}return r}parseElements(e){const t=[];for(const r of e){const e=this.parseElement(r);e&&t.push(e)}return t}getInitDataFromPro(e){const t=this.parser.findChildNS(e.node,"urn:microsoft:playready","pro");if(!t)return null;const r=this.parser.getContents(t);if(!r)return null;const i=ft.P.fromBase64(r),n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),s=this.createPssh(i,n);return s?[{initData:s,initDataType:"cenc",keyId:e.keyId}]:null}createPssh(e,t){const r=e.length,i=12+t.length+4+r,n=new ArrayBuffer(i),s=new Uint8Array(n),a=new DataView(n);let o=0;return a.setUint32(o,i),o+=4,a.setUint32(o,1886614376),o+=4,a.setUint32(o,0),o+=4,s.set(t,o),o+=t.length,a.setUint32(o,r),o+=4,s.set(e,o),o+=r,o===i?ft.P.toBase64(s):null}parseElement(e){let t=e.attributes.schemeIdUri,r=this.parser.getAttributeNS(e,"urn:mpeg:cenc:2013","default_KID");const i=this.parser.findChildrenNS(e,"urn:mpeg:cenc:2013","pssh").map(e=>this.parser.getContents(e));if(!t)return null;if(t=t.toLowerCase(),r&&(r=r.replace(/-/g,"").toLowerCase(),r.includes(" ")))throw new dt.w({code:"YASP_DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED",isFatal:!0,message:"Representation with multiple keyIds is not supported: ("+r+")",details:{},category:ct.q.DRM});const n=i.map(e=>({initDataType:"cenc",initData:e,keyId:null}));return{node:e,schemeUri:t,keyId:r,init:n.length>0?n:null}}}const xt=["segmentTemplate","mimeType"],Vt=["segmentTemplate","mimeType"],Ut=["segmentTemplate","mimeType"];var Bt=r(4651),Ht=r(6252);class jt{constructor(e,t){this.body=void 0,this.status=void 0,this.headers=void 0,this.textPromise=void 0,this.body=t,this.status=e.status,this.headers=function(e){const t=[];return e.getAllResponseHeaders().trim().split("\r\n").forEach(e=>{const[r,...i]=e.split(":");t.push([i.join(":"),r])}),{forEach(e){t.forEach(t=>{let[r,i]=t;e(r,i)})}}}(e),this.textPromise=new Promise((t,r)=>{e.addEventListener("load",()=>{t(e.response)}),e.addEventListener("abort",()=>{const e=new Error("Stretch request aborted");e.name="AbortError",r(e)})}),(0,Ht.v)(this.textPromise)}text(){return this.textPromise}}const Wt={done:!0,value:void 0};class Yt{constructor(e){this.dataStream=void 0,this.readRequest=void 0,this.storedError=void 0,this.onCancel=void 0,this.dataStream=new St,this.readRequest=null,this.storedError=null,this.onCancel=e}read(){return new Promise((e,t)=>(this.readRequest={resolve:e,reject:t},this.dataStream.isDestroyed()?t(this.storedError||new Error("Unexpected read after stream destroy")):this.dataStream.isClosed()?e(Wt):(this.dataStream.once("Data",t=>{this.dataStream.pause(),e({done:!1,value:t})}),void this.dataStream.resume())))}cancel(){this.dataStream.destroy(),this.onCancel()}throw(e){this.dataStream.isDestroyed()||this.dataStream.isClosing()||(this.storedError=e,this.dataStream.destroy(),this.readRequest&&(this.readRequest.reject(e),this.readRequest=null))}write(e){this.dataStream.isDestroyed()||this.dataStream.write(e)}close(){this.dataStream.close()}}var Gt=r(4118);const zt="undefined"!==typeof fetch&&"undefined"!==typeof ReadableStream&&"undefined"!==typeof(0,Gt.Y)(()=>new AbortController),qt=zt?"arraybuffer":Y("moz-chunked-arraybuffer")||Y("ms-stream")||"arraybuffer";class Kt{constructor(e){this.readerInited=!1,this.reader=void 0,this.xhr=void 0,this.xhr=e,this.reader=new Yt(()=>e.abort())}throwReaderError(e){return this.reader.throw(e)}getReader(){return this.initReader(this.xhr,qt),this.reader}initReader(e,t){if(this.readerInited)throw new Error("Unexpected second call StretchBody#initReader()");switch(this.readerInited=!0,e.responseType=t,t){case"arraybuffer":e.addEventListener("load",()=>{e.response&&this.reader.write(new Uint8Array(e.response)),this.reader.close()});break;case"moz-chunked-arraybuffer":e.addEventListener("progress",()=>{this.reader.write(new Uint8Array(e.response))}),e.addEventListener("load",()=>{this.reader.close()});break;case"ms-stream":e.addEventListener("readystatechange",()=>{if(e.readyState!==XMLHttpRequest.LOADING)return;let t=0;const{MSStreamReader:r}=self,i=new r;i.onprogress=()=>{i.result.byteLength>t&&(this.reader.write(new Uint8Array(i.result,t)),t=i.result.byteLength)},i.onload=this.reader.close.bind(this.reader),i.readAsArrayBuffer(e.response)})}}}const Qt=zt?fetch:function(e,t){return void 0===t&&(t={}),new Promise((r,i)=>{const{method:n="GET",body:s=null}=t,a=new XMLHttpRequest;a.open(n,e);for(const e in t.headers)t.headers.hasOwnProperty(e)&&a.setRequestHeader(e,t.headers[e]);"include"===t.credentials&&(a.withCredentials=!0);const o=new Kt(a),l=()=>{a.readyState===XMLHttpRequest.HEADERS_RECEIVED&&(a.removeEventListener("readystatechange",l),r(new jt(a,o)))};a.addEventListener("readystatechange",l);const d=()=>{a.abort();const e=new Error("request aborted");e.name="AbortError",o.throwReaderError(e),i(e)};if(t.signal){if(t.signal.aborted)return void d();t.signal.addEventListener("abort",d)}a.addEventListener("error",()=>{const e=new Error("network error");o.throwReaderError(e),i(e)}),a.send(s)})};var Zt=r(9840),Jt=r(55);const Xt={};class $t extends Zt.Z{constructor(e){if(super(),this.aborted=void 0,this.reason=void 0,this._onabort=Jt.Z,e!==Xt)throw new TypeError("Illegal constructor.");this.aborted=!1}set onabort(e){const t=this._onabort;t&&this.removeEventListener("abort",t),this._onabort=e,this.addEventListener("abort",e)}get onabort(){return this._onabort}throwIfAborted(){throw this.reason}}const er="object"===typeof self?self:window,tr=zt?er.AbortController:class{constructor(){this._signal=void 0,this._signal=new $t(Xt)}get signal(){return this._signal}abort(e){const t=this.signal;t.aborted||(t.aborted=!0,t.reason=e,t.dispatchEvent(new Event("abort")))}};var rr=r(3487),ir=r(1153);class nr extends Re.M{setIsLL(e){this.lowLatency=e}isLL(){return this.lowLatency}setBaseParams(e){void 0===e&&(e={}),this.baseParams=e}constructor(e){void 0===e&&(e={}),super(),this.baseParams=void 0,this.lowLatency=!1,this.baseParams=e}performRequest(e,t){const r=new tr,i=G({},this.baseParams,t,{headers:G({},this.baseParams.headers,t.headers),signal:r.signal}),n={canceled:!1,timeout:!1,downloadedBytes:0},s=(0,Tt.u)(),a=Qt(e,i).catch(e=>{if(n.canceled)throw new Error("Request canceled");if(n.timeout)throw new Error("Request timed out");throw e}),o="number"===typeof i.timeout?setTimeout(()=>{n.timeout=!0,r.abort()},i.timeout):void 0;return a.then(e=>{const t={};e.headers.forEach((e,r)=>{t[r]=e}),this.emit("RequestTtfb",s())}).catch(rr.Z),{abort:()=>{n.canceled=!0,o&&clearTimeout(o),r.abort()},responsePromise:a,timeoutId:o,requestState:n,signal:i.signal,getRtt:s}}parseServerTime(e,t){if(!e.date&&!e["x-server-time-ms"])return;let r=NaN;if(e["x-server-time-ms"]){r=new Date(parseInt(e["x-server-time-ms"],10)).getTime()}else if(e.date){r=new Date(e.date).getTime()}isFinite(r)&&this.emit("ServerTimeChange",r+t/2)}fetch(e,t){void 0===t&&(t={});const{abort:r,responsePromise:i,timeoutId:n,getRtt:s}=this.performRequest(e,t);return{abort:r,response:i.then(e=>{n&&clearTimeout(n);const t={};return e.headers.forEach((e,r)=>{t[r]=e}),this.parseServerTime(t,s()),{status:e.status,headers:t,body:e.text()}})}}progress(e,t,r){this.emit("Progress",{time:e,size:t,isLowLatency:r})}fetchDataStream(e,t){void 0===t&&(t={});const{abort:r,responsePromise:i,timeoutId:n,requestState:s,signal:a}=this.performRequest(e,t),o=new St;a.addEventListener("abort",()=>{o.destroy()});let l=!1;const d=()=>{l=!0,r(),o.destroy()};return{requestState:s,abort:d,response:i.then(e=>{const t={};this.on("Destroy",d),e.headers.forEach((e,r)=>{t[r]=e});const r=e.body.getReader(),i=(0,ir.I)(()=>{this.off("Destroy",d),this.emit("ResponseEnd")});o.once("Destroy",i),o.once("Close",i),this.emit("ResponseStart");const a=()=>{l||r.read().then(e=>{let{done:t,value:r}=e;l||(void 0!==r&&(s.downloadedBytes+=r.length,o.write(r)),t?(o.close(),n&&clearTimeout(n)):a())}).catch(e=>{if("AbortError"!==(null==e?void 0:e.name)&&o.destroy(),"AbortError"!==(null==e?void 0:e.name)&&"network error"!==(null==e?void 0:e.message))throw e})};return a(),{status:e.status,headers:t,body:o}})}}getDebugInfo(){return{baseParams:this.baseParams}}}var sr=r(3480),ar=r(442),or=r(3564),lr=r(9117),dr=r(5052);class cr extends Re.M{parse(e){return this.parser.parse(e)}isInitiallyLoaded(){return null!==this.mpd}setSourceIndex(e){if(null===e)return;const t=new URL(this.url);t.searchParams.set("source_index",e),this.url=t.href}constructor(e){super(),this.url=void 0,this.fetcher=void 0,this.timeline=void 0,this.parser=void 0,this.mpd=null,this.xml="",this.session="",this.attempt=0,this.baseUrls=[],this.drmInfos=[],this.playlistCapHeight=null,this.lastUpdateDuration=0,this.aborted=!1,this.abortFn=null,this.url=e.url,this.timeline=e.timeline,this.parser=new ot,this.fetcher=new nr(e.fetcherParams),this.fetcher.on("ServerTimeChange",e=>{this.emit("ServerTimeChange",e)})}getPlaylistCapHeight(){return this.playlistCapHeight}getProgramDateTime(){}isDynamicPlaylist(){var e;return(null==(e=this.mpd)?void 0:e.isDynamic)||!1}getVideoType(){if(this.mpd)return this.mpd.isDynamic?this.mpd.videoType:Bt.Z.VOD}getUpdatePeriod(){var e;return(null==(e=this.mpd)?void 0:e.updatePeriod)||null}getLastUpdateDuration(){return this.lastUpdateDuration}setFetcherBaseParams(e){this.fetcher.setBaseParams(e)}apply(e){this.xml=e;const t=this.parse(e);let r;try{r=W(t,this.url,this.parser)}catch(n){throw ie(n)&&"YASP_PARSE_MANIFEST_ERROR"===n.code&&(n.details.manifest=e),n}this.playlistCapHeight=r.maxHeight,this.baseUrls=r.baseUrls;const i=r.periods[0];return i.adaptationSets=re(i.adaptationSets),this.checkTracksLengthDifference(i.adaptationSets),this.checkDrm(i.adaptationSets),K(i,this.timeline),this.timeline.applyMpd(r),r}checkDrm(e){const t=e.find(e=>e.encrypted);t&&(this.drmInfos=t.contentProtection.drmInfos,this.mpd||this.emit("DrmInfoReceived",t.contentProtection.drmInfos))}getBaseUrls(){return this.baseUrls}getDrmInfos(){return this.drmInfos}getEmsgSchemeIdUris(){var e;return null==(e=this.mpd)?void 0:e.emsgSchemeIdUris}async update(){this.aborted=!1;const e=this.session?function(e){const t=new URL(e);return t.searchParams.delete(or.j),t.href}(this.url):(0,or.c)(this.url),t=(0,kt.u)();try{const r={};this.session&&(r["x-strm-session"]=this.session,r["x-client-timestamp"]=String(Date.now()));const{response:i,abort:n}=this.fetcher.fetch(e,{timeout:ar.d4,headers:r});this.abortFn=n;const{body:s,status:a,headers:o}=await i;this.session=o["x-strm-session"];if(!(a>=200&&a<300||304===a)){const t=this.attempt>=10;throw 0===a?new dt.w({code:"YASP_FETCH_MANIFEST_HTTP_ERROR",message:"Network Error",details:{url:e},category:ct.q.NETWORK_MEDIA,isFatal:t}):new dt.w({code:"YASP_FETCH_MANIFEST_BAD_HTTP_STATUS",message:"Error: "+a,details:{status:a,url:e},isFatal:t,category:ct.q.NETWORK_MEDIA})}this.attempt=0;const l=await s;this.abortFn=null,this.mpd=this.apply(l),this.updateManifestUrl(),this.lastUpdateDuration=t(),this.emit("ManifestUpdate")}catch(r){let t;const i=this.attempt>=10;if(this.abortFn=null,(0,lr.V)(r)){if("Request canceled"===r.message||"Abort error"===r.message)return;t=ie(r)?r:new dt.w({code:"Request timed out"===r.message?"YASP_FETCH_MANIFEST_TIMEOUT":"YASP_FETCH_MANIFEST_HTTP_ERROR",details:{url:e},message:r.message,isFatal:i,category:"Request timed out"===r.message?ct.q.NETWORK_TIMEOUT:ct.q.NETWORK_MEDIA})}else t=new dt.w({code:"YASP_UNKNOWN_ERROR",details:{url:e,error:r},message:"Unknown error. Expect error to be an instance of Error.",isFatal:i,category:ct.q.NETWORK_MEDIA});if(this.emit("Error",t),i||t.isFatal)return;const n=(0,dr._)(z(this.attempt++));if(this.aborted)return;return n.then(()=>{if(!this.aborted)return this.update()})}}abort(){this.abortFn&&this.abortFn(),this.aborted=!0}destroy(){this.abort(),super.destroy()}getDebugInfo(){return{url:this.url,xml:this.xml,attempt:this.attempt,baseUrls:this.baseUrls,mpd:this.mpd,playlistCapHeight:this.playlistCapHeight,lastUpdateDuration:this.lastUpdateDuration}}checkTracksLengthDifference(e){if(!e.length)return;const t=new Set,r={};if(e.forEach(e=>{"text"!==e.type&&e.representations.forEach(e=>{r[e.id]=e.segmentTemplate.endTime,t.add(e.segmentTemplate.endTime)})}),1===t.size)return;const i=new dt.w({code:"YASP_DIFFERENT_TRACKS_LENGTH",details:r,message:"Different track lengths detected",isFatal:!1,category:ct.q.MEDIA});this.emit("Error",i)}updateManifestUrl(){var e,t;this.url=null!=(e=null==(t=this.mpd)?void 0:t.locationUrl)?e:this.url}}class ur{constructor(e){this.manifesto=e,this.processing=!1,this.promise=null,this.timer=0}async update(){if(this.processing)return this.promise;if(!this.shouldUpdate())return;this.processing=!0;return this.promise=this.manifesto.update().then(()=>{if(!this.processing)return;this.processing=!1;const e=this.getUpdatePeriod();e&&(this.timer=self.setTimeout(()=>{this.timer=0,this.update()},e))}).catch(Jt.Z).then(()=>{this.promise=null}),this.promise}forceUpdate(){this.disableTimer(),this.update()}disable(){this.processing=!1,this.disableTimer(),this.manifesto.abort()}getDebugInfo(){return{processing:this.processing}}disableTimer(){self.clearTimeout(this.timer),this.timer=0}shouldUpdate(){return!this.timer&&(!this.manifesto.isInitiallyLoaded()||this.manifesto.isDynamicPlaylist())}getUpdatePeriod(){if(!this.manifesto.isDynamicPlaylist())return;const e=this.manifesto.getUpdatePeriod(),t=this.manifesto.getLastUpdateDuration();return e?Math.max(3e3,e-t):void 0}}const hr=(0,ir.I)(()=>55),pr=(0,ir.I)(()=>hr()+10);var fr=r(5636),mr=r(2178);const gr={type:"video",state:"idle",fat:!1,currentTrack:void 0,time:null,previousBufferingTime:null,nextTimeToSet:null,streamIsFinished:!1},vr=["Unexpected read after destroy","Unexpected destroy while read"];class yr extends Re.M{abort(){["video","audio"].forEach(e=>{this.abortForType(e)})}abortForType(e){var t,r;this.destroyed||(null==(t=(r=this.abortCallbacks)[e])||t.call(r),this.resetTime(e))}constructor(e,t,r,i){var n,s,a;super(),this.timeline=e,this.videoState=t,this.mse=r,this.destroyed=!1,this.bufferGoal=void 0,this.totalBufferSoftCap=void 0,this.totalBufferHardCap=void 0,this.streams={},this.abortCallbacks={video:null,audio:null},this.bufferGoal=null!=(n=null==i?void 0:i.bufferGoal)?n:30,this.totalBufferSoftCap=null!=(s=null==i?void 0:i.totalBufferSoftCap)?s:hr(),this.totalBufferHardCap=null!=(a=null==i?void 0:i.totalBufferHardCap)?a:pr();const{video:o,audio:l}=e.getMimeTypes();o.length>0&&(this.streams.video=se({},gr,{type:"video"})),l.length>0&&(this.streams.audio=se({},gr,{type:"audio"})),this.mse.on("Open",()=>this.run())}destroy(){this.destroyed=!0}run(){this.destroyed||["audio","video"].some(e=>{var t;return"appending"===(null==(t=this.streams[e])?void 0:t.state)})||(this.streams.video&&this.runForStream(this.streams.video),this.streams.audio&&this.runForStream(this.streams.audio))}abortUseless(){if(this.destroyed)return;const{currentTime:e}=this.videoState;"open"!==this.mse.getReadyState()||this.mse.isReloading()||null!==e&&["video","audio"].forEach(t=>{const r=this.streams[t];if(void 0===r)return;const i=this.mse.getSourceBufferBufferedRange(t);if(void 0===i)return;!i.some(t=>t.start<=e&&e<=t.end)&&this.abortForType(r.type)})}createAbortPromise(e){const t=new fr.B;return this.abortCallbacks[e]=()=>{t.reject(this.createAbortError())},t.promise}createAbortError(){return new dt.w({code:"YASP_OPERATION_ABORTED",details:{},isFatal:!1,category:ct.q.EXCEPTION,message:"AppendStream operation aborted"})}resetTime(e){const t=this.streams[e];if(!t)return;const{currentTime:r}=this.videoState;"appending"===t.state?t.nextTimeToSet=null===r?null:1e3*r:t.time=null===r?null:1e3*r}reset(){(0,Rt.z)(this.streams).forEach(e=>{e&&(this.resetTime(e.type),e.currentTrack=void 0)})}runForStream(e){if("open"!==this.mse.getReadyState()||this.mse.isReloading()||"appending"===e.state)return;const{currentTime:t,buffering:r,duration:i}=this.videoState;if(null===t)return;const n=this.mse.getSourceBufferBufferedRange(e.type);if(void 0===n)return;if(r)e.previousBufferingTime!==1e3*t&&(e.time=1e3*t,e.nextTimeToSet=null,e.previousBufferingTime=e.time);else{if(e.previousBufferingTime=null,Math.min(this.bufferGoal,i-t)<=ne(n,t))return;if(this.checkGorgedBuffer(e,n))return}const{track:s,segment:a}=this.timeline.getSegment(e.type,e.time);if(void 0===s)return;const{id:o,presentationTimeOffset:l}=s;if(o!==e.currentTrack)return this.mse.setTimestampOffset(e.type,l/1e3).catch(e=>{this.destroyed||(0,At.L)(e)}),void this.appendInitialSegment(e,o).catch(t=>{const r=ie(t)?t:new dt.w({code:"YASP_UNKNOWN_ERROR",details:{error:t},isFatal:!1,category:ct.q.MEDIA,message:"Can not append initial Segment"});if("YASP_OPERATION_ABORTED"!==r.code)this.emit("Error",r);else{const{currentTime:t}=this.videoState;e.time=null===t?null:1e3*t}}).then(()=>{});void 0!==a&&(e.nextTimeToSet=a.end,this.appendStream(e,a.getChunkStream()).then(()=>{e.time=e.nextTimeToSet,e.streamIsFinished=s.endNumber===a.number&&!this.timeline.getIsDynamic(),(0,Rt.z)(this.streams).every(e=>Boolean(null==e?void 0:e.streamIsFinished))&&this.mse.endOfStream()}).catch(t=>{if("YASP_OPERATION_ABORTED"!==t.code)"YASP_QUOTA_EXCEEDED_ERROR"===t.code?(0,mr.RW)("yasp_decrease_mse_buffer_on_quota_exceeded_error")&&this.emit("QuotaExceededError"):this.emit("Error",t);else{const{currentTime:t}=this.videoState;e.time=null===t?null:1e3*t}}))}setBufferGoal(e){this.bufferGoal=e}checkGorgedBuffer(e,t){const r=function(e){let t=0;for(let r=0;r<e.length;r++){const{start:i,end:n}=e[r];t+=n-i}return t}(t),i=e.fat;return e.fat=r>=this.totalBufferSoftCap,!!e.fat&&(i||this.emit("FatBuffer",e.type),r>=this.totalBufferHardCap&&(this.emit("GorgedBuffer",e.type),!0))}async appendInitialSegment(e,t){const r=this.timeline.getInitialSegment(e.type,t);if(void 0===r)return;const i=r.getChunkStream();await this.appendStream(e,i),e.currentTrack=t,this.run()}async appendChunk(e,t){try{await this.mse.appendBuffer(e.type,t)}catch(r){throw ie(r)?r:new dt.w({code:"YASP_UNKNOWN_ERROR",details:{error:r},isFatal:!1,category:ct.q.MEDIA,message:(0,Ie.K)(r)?r.message:"Can not append buffer"})}}async appendStream(e,t){e.state="appending",e.streamIsFinished=!1;const r=this.createAbortPromise(e.type);try{let{value:i,done:n}=await Promise.race([t.read(),r]);for(;!n;){if(this.destroyed)return;if(i&&await Promise.race([this.appendChunk(e,i),r]),this.destroyed)return;({value:i,done:n}=await Promise.race([t.read(),r]))}}catch(i){throw(0,Ie.K)(i)&&(vr.includes(i.message)||this.mse.isReloading())?this.createAbortError():ie(i)?i:new dt.w({code:"YASP_UNKNOWN_ERROR",details:{error:i},isFatal:!1,category:ct.q.MEDIA,message:"Can not append buffer"})}finally{this.abortCallbacks[e.type]=null,e.state="idle"}}getDebugInfo(){return{bufferGoal:this.bufferGoal,totalBufferSoftCap:this.totalBufferSoftCap,totalBufferHardCap:this.totalBufferHardCap,streams:this.streams}}}var Er=r(2248),Sr=r(9761),Ar=r(7668);class Tr extends Re.M{constructor(){super(),this.blacklist=new Set,this.destroyed=!1,this.checkLoopTimeoutId=void 0,this.startLoop(),this.once("Destroy",()=>{this.destroyed=!0})}destroy(){this.stopLoop(),super.destroy()}getBlacklist(){return Array.from(this.blacklist)}addHostname(e){const t=new URL(e).host;Er.T.indexOf(t)>-1||this.blacklist.has(e)||this.blacklist.add(e)}isBlacklisted(e){return this.blacklist.has(e)}async checkBlacklistedHosts(){await Promise.all(Array.from(this.blacklist).map(async e=>{try{await async function(e){await(0,Ar.W)({method:"GET",url:e,withCredentials:!1,timeout:2e3})}(function(e){const t=new URL(e).host,{lid:r}=function(e){const t={},r=e.split("?")[0];return r?(r.split("/").forEach(e=>{e.startsWith("ysign")&&e.split(",").forEach(e=>{const r=e.indexOf("=");-1!==r&&(t[e.slice(0,r)]=e.slice(r+1))})}),t):t}(e),i=r?"&lid="+r:"";return"https://"+t+"/ping?r="+(0,Sr.a)(12)+i}(e)),this.blacklist.delete(e)}catch(t){}}))}startLoop(){this.destroyed||(this.checkLoopTimeoutId=setTimeout(async()=>{this.stopLoop(),await this.checkBlacklistedHosts(),this.startLoop()},3e4))}stopLoop(){clearTimeout(this.checkLoopTimeoutId)}}var br=r(7989);const wr=Number.EPSILON||Math.pow(2,-52);var _r=r(4204);var Rr=r(123),kr=r(6223),Pr=r(5776);const Ir=(0,Pr.y)(self)||(0,kr.V)(self),Cr=Ir?1e4:5e3,Or=(0,Pr.y)(self)||(0,kr.V)(self),Dr=[429,500,502,503,504],Nr={start:Math.abs(0),end:Math.abs(0),number:Math.max(Math.floor(0)),isInitSegment:!1,bitrate:0,trackId:"unknown",width:0,height:0,originalStart:0};class Lr extends Re.M{constructor(e){let{timeline:t,videoState:r,manifesto:i,abr:n,segmentFetcher:s,bufferGoal:a,bandwidthEstimator:o,ttfbEstimator:l,sourceIndex:d}=e;super(),this.segmentFetcher=void 0,this.abr=void 0,this.timeline=void 0,this.videoState=void 0,this.manifesto=void 0,this.bandwidthEstimator=void 0,this.ttfbEstimator=void 0,this.bufferGoal=void 0,this.hostnameBlackList=new Tr,this.trackToFetchFailuresCount=new Map,this.lastNonBlockedBaseUrls=[],this.isDestroyed=!1,this.segmentsInProgress={video:[],audio:[],text:[]},this.sourceIndex=null,this.timeline=t,this.videoState=r,this.manifesto=i,this.abr=n,this.segmentFetcher=s,this.bandwidthEstimator=o,this.ttfbEstimator=l,this.bufferGoal=1e3*a,this.sourceIndex=d}abort(){["video","audio","text"].forEach(e=>{this.segmentsInProgress[e].forEach(e=>e.abort())})}setSourceIndex(e){this.sourceIndex=e}addSourceIndexInUrl(e){if(!this.sourceIndex)return e;const t=new URL(e);return t.searchParams.set(Rr.g,this.sourceIndex),t.href}abortUseless(){["video","audio","text"].forEach(e=>this.abortUselessForType(e))}abortUselessForType(e){const{currentTime:t}=this.videoState,r=1e3*(null!=t?t:-1);this.segmentsInProgress[e]=this.segmentsInProgress[e].filter(t=>{let{abort:i,segment:n,trackId:s}=t;if(n.isInitSegment)return!0;const a=n.start<=r&&r<n.end;return!(!this.timeline.checkTrackAvailableToLoad(s,e)||!a)||(i(),!1)})}run(){const e=[];try{this.runInternal(e)}finally{Promise.all(e.map(e=>e.catch(Jt.Z))).then(()=>{e.length>0&&this.emit("BandwidthEstimateUpdate",this.bandwidthEstimator.getBandwidthEstimate())})}}setVideoState(e){this.videoState=e}setBufferGoal(e){this.bufferGoal=1e3*e}canStartDownload(e){if(!this.segmentsInProgress[e].length)return!0;const{audio:t,video:r,text:i}=this.segmentsInProgress,n=this.ttfbEstimator.getMinTtfbEstimate({value:0,source:"default"}),s=t.concat(r,i);return Or?0===s.length:s.every(e=>{let{segment:t}=e;return t.getExpectedTimeToLoad()<=n.value})}runInternal(e){const{currentTime:t,duration:r,buffering:i}=this.videoState;if(null===t)return;if(!i&&r<t+.1)return;const n=1e3*t,s=this.timeline.getBufferedRanges(!0),a=s.video,o=s.audio,l=s.text,d=this.defineTracksMeta(a,n,"video"),c=this.defineTracksMeta(o,n,"audio"),u=this.defineTracksMeta(l,n,"text");if(!d.length&&!c.length&&!u.length)return;const h=Lr.syncSelectedSegments(this.abr.filterSegments(c,d,u,this.videoState),this.segmentsInProgress),p=this.getBaseUrl();p?E(h).forEach(t=>{let[r,i]=t;if(!i)return;const a=i.trackId,o=this.timeline.findTrackById(a,r);if(!o)return;let l=0;if(Number.isFinite(this.videoState.currentTime)){const e=le(s[r],n,this.videoState.duration);-1!==e&&(l=function(e,t){const r=Math.pow(10,t);return Math.round((e+wr)*r)/r}((e-n)/1e3,3))}if(!o.getInitSegment()&&o.initialization){const t=o.initialization,i={baseUrl:p,pathname:ae(t,o)},{segment:n,promise:s}=this.fetchSegment(i,a,r,oe({},Nr,{isInitSegment:!0}),l);o.appendSegment(n),e.push(s.catch(e=>{n.fail();const t=ie(e)?e:new dt.w({code:"YASP_UNKNOWN_ERROR",details:{error:e,blacklist:this.hostnameBlackList.getBlacklist()},isFatal:!0,category:ct.q.NETWORK_MEDIA});this.emitError(t)}))}const d=o.media;if(!d)return;if(o.hasSegment(i.number))return;const c={baseUrl:p,pathname:ae(d,o,i)},u={start:i.start,end:i.end,number:i.number,isInitSegment:!1,bitrate:o.bitrate,trackId:o.id,width:"width"in o?o.width:0,height:"height"in o?o.height:0,originalStart:i.originalStart,duration:i.duration},{segment:h,promise:f}=this.fetchSegment(c,a,r,u,l);o.appendSegment(h),e.push(f.catch(e=>{h.fail();const t=ie(e)?e:new dt.w({code:"YASP_UNKNOWN_ERROR",details:{error:e,blacklist:this.hostnameBlackList.getBlacklist()},isFatal:!0,category:ct.q.NETWORK_MEDIA});this.emitError(t)}))}):this.emitError(new dt.w({code:"YASP_NO_BASEURLS",details:{},isFatal:!0,category:ct.q.MEDIA}))}emitError(e){"YASP_OPERATION_ABORTED"!==e.code&&this.emit("Error",e)}fetchSegment(e,t,r,i,n){void 0===i&&(i=Nr);const s=new bt(i);let a=!1;this.handleInProgressSegment(r,s,t,()=>{a=!s.isInitSegment});const o=new Promise((o,l)=>{const d=t+"/"+i.number,c=this.trackToFetchFailuresCount.get(d)||0,u=new URL(e.pathname,e.baseUrl);n>=0&&u.searchParams.append("bufSize",String(n));(0,_r._)(z(c)).then(()=>{if(this.isDestroyed)return;let i=0;i=(0,mr.RW)("web_yasp_static_timeout_for_low_latency")&&this.timeline.isLowLatencyLive()?1e4:Cr+this.ttfbEstimator.getTtfbEstimate({value:1e3,source:"default"}).value;const n=(0,or.c)(this.addSourceIndexInUrl(u.toString())),h=this.hostnameBlackList.getBlacklist(),{chunkStream:p,promise:f,requestState:m,abort:g}=this.segmentFetcher.fetchChunkStream(n,i,s,r);a?g():this.handleInProgressSegment(r,s,t,g),f.then(t=>{if(t>=200&&t<300||304===t){p.on("Data",e=>{s.append(e)}),p.on("Close",()=>{s.finish(),o()});const t=()=>{if(null!=m&&m.canceled)return s.fail(),o();if(!s.finished){const t=null!=m&&m.timeout?"YASP_FETCH_SEGMENT_TIMEOUT":"YASP_FETCH_SEGMENT_HTTP_ERROR",r=null!=m&&m.timeout?"Request timed out":"Network Error",i=null!=m&&m.timeout?ct.q.NETWORK_TIMEOUT:ct.q.NETWORK_MEDIA;this.hostnameBlackList.addHostname(e.baseUrl),l(new dt.w({code:t,details:{url:n,blacklist:{before:h,after:this.hostnameBlackList.getBlacklist()},downloadedBytes:null!=m&&m.timeout?m.downloadedBytes:void 0},message:r,category:i,isFatal:!1}))}};return p.on("Destroy",t),p.resume(),this.trackToFetchFailuresCount.has(d)&&this.trackToFetchFailuresCount.delete(d),void(p.isDestroyed()&&t())}if(this.trackToFetchFailuresCount.set(d,c+1),Dr.includes(t))l(new dt.w({code:"YASP_FETCH_SEGMENT_BAD_HTTP_STATUS",message:"Error: "+t,details:{url:n,status:t,blacklist:{before:h,after:this.hostnameBlackList.getBlacklist()}},category:ct.q.NETWORK_MEDIA,isFatal:!1}));else{this.hostnameBlackList.addHostname(e.baseUrl);const r=c>=10;l(0===t?new dt.w({code:"YASP_FETCH_SEGMENT_HTTP_ERROR",message:"Network Error",details:{url:n,blacklist:{before:h,after:this.hostnameBlackList.getBlacklist()}},category:ct.q.NETWORK_MEDIA,isFatal:r}):new dt.w({code:"YASP_FETCH_SEGMENT_BAD_HTTP_STATUS",message:"Error: "+t,details:{url:n,status:t,blacklist:{before:h,after:this.hostnameBlackList.getBlacklist()}},category:ct.q.NETWORK_MEDIA,isFatal:r}))}}).catch(t=>{if(null!=m&&m.canceled)return void l(new dt.w({code:"YASP_OPERATION_ABORTED",details:{url:n,blacklist:{before:h,after:this.hostnameBlackList.getBlacklist()}},message:t.message,category:ct.q.NETWORK_MEDIA,isFatal:!1}));this.hostnameBlackList.addHostname(e.baseUrl),this.trackToFetchFailuresCount.set(d,c+1);const r="Request timed out"===t.message,i=!r&&c>=10;l(new dt.w({code:r?"YASP_FETCH_SEGMENT_TIMEOUT":"YASP_FETCH_SEGMENT_HTTP_ERROR",details:{url:n,blacklist:{before:h,after:this.hostnameBlackList.getBlacklist()},downloadedBytes:r?(null==m?void 0:m.downloadedBytes)||0:void 0},message:t.message,category:r?ct.q.NETWORK_TIMEOUT:ct.q.NETWORK_MEDIA,isFatal:i}))})})});return{segment:s,promise:o}}handleInProgressSegment(e,t,r,i){if(t.finished||t.failed)return;const n=this.segmentsInProgress[e].find(e=>e.segment.number===t.number&&e.trackId===r)||(()=>{const n={abort:i,segment:t,trackId:r};this.segmentsInProgress[e].push(n);const s=()=>{this.segmentsInProgress[e]=this.segmentsInProgress[e].filter(e=>e!==n),t.off("Failed",s),t.off("Finish",s)};return t.once("Failed",s),t.once("Finish",s),t.once("Destroy",s),n})(),s=n.abort;n.abort=()=>{s(),i()}}defineTracksMeta(e,t,r){if(!this.canStartDownload(r))return[];const{duration:i}=this.videoState,n=le(e,t,i);if(-1===n)return[];return n-t>this.bufferGoal?[]:this.timeline.getTracksMeta(n,r)}getDebugInfo(){return{bufferGoal:this.bufferGoal,hostnameBlackList:this.hostnameBlackList.getBlacklist(),trackToFetchFailuresCount:Array.from(this.trackToFetchFailuresCount.entries()).reduce((e,t)=>(e[t[0]]=e[t[1]],e),{}),segmentsInProgress:Object.entries(this.segmentsInProgress).reduce((e,t)=>{let[r,i]=t;return e[r]=i.map(e=>e.segment),e},{}),sourceIndex:this.sourceIndex}}static syncSelectedSegments(e,t){const r=["audio","video","text"],i=oe({},e);return r.forEach(n=>{const s=e[n];if(!s)return;let a=1/0;r.forEach(r=>{var i,s;if(r===n)return;const o=null!=(i=null==(s=e[r])?void 0:s.end)?i:0,l=t[r],d=null==l?void 0:l.reduce((e,t)=>{let{segment:r}=t;return Math.max(e,r.end)},0),c=Math.max(d,o);c&&(a=Math.min(a,c))}),isFinite(a)&&s.start>=a&&(i[n]=void 0)}),i}getBaseUrl(){var e;const t=this.manifesto.getBaseUrls().filter(e=>!this.hostnameBlackList.isBlacklisted(e));return function(e,t){const r=new Map;e.forEach((e,t)=>r.set(e,t)),e.sort((e,i)=>{const n=t(e,i);return 0!==n?n:Number(r.get(e))-Number(r.get(i))})}(t,(e,t)=>{const r=this.lastNonBlockedBaseUrls.indexOf(e),i=this.lastNonBlockedBaseUrls.indexOf(t);return-1!==r&&-1!==i?r-i:-1!==r&&-1===i?-1:-1===r&&-1!==i?1:0}),this.lastNonBlockedBaseUrls=t,null!=(e=t[0])?e:this.manifesto.getBaseUrls()[0]}destroy(){this.isDestroyed=!0,this.abort(),super.destroy()}}class Mr{constructor(e,t,r,i){this.timeline=e,this.videoState=t,this.backWatch=r,this.bufferGoal=i}setBackWatch(e){this.backWatch=e}setBufferGoal(e){this.bufferGoal=e}setVideoState(e){this.videoState=e}run(){if(null===this.videoState.currentTime)return;const{currentTime:e}=this.videoState;this.timeline.clear(0,Math.max(1e3*(e-this.backWatch),0)),this.timeline.clear(1e3*(e+this.bufferGoal),Number.MAX_SAFE_INTEGER)}getDebugInfo(){return{backWatch:this.backWatch,bufferGoal:this.bufferGoal}}}class Fr extends Re.M{constructor(e){super(),this.fetcher=void 0,this.emsgSchemeIdUris={audio:new Set,video:new Set},this.fetcher=e}fetchChunkStream(e,t,r,i){void 0===t&&(t=0);const{response:n,requestState:s,abort:a}=this.fetcher.fetchDataStream(e,{timeout:Math.max(Cr,t)}),o=new St;return{promise:new Promise(async(t,s)=>{const l=(0,Tt.u)();try{const s=await n,[d]=(s.headers["content-type"]||"").split(";"),c=parseInt(s.headers["content-length"]||"",10);switch(r.setExpectedSize(c),r.loadingStarted(),d.trim()){case"application/mp4":case"text/vtt":this.processVtt(s.body,o);break;case"audio/mp4":case"video/mp4":this.processMp4({readableStream:s.body,writableStream:o,getStartTime:l,segment:r,type:i,abort:a});break;default:switch((e=>{const t=(new URL(e).pathname.split("/").pop()||"").split(".");return t.length>1?t.pop():void 0})(e.toLocaleLowerCase())){case"vtt":this.processVtt(s.body,o);break;case"m4s":case"mp4":default:this.processMp4({readableStream:s.body,writableStream:o,getStartTime:l,segment:r,type:i,abort:a})}}t(s.status)}catch(d){o.destroy(),s(d)}}),chunkStream:o.asReadable(),requestState:s,abort:a}}processMp4(e){let t,r,i,n,{readableStream:s,writableStream:a,getStartTime:o,segment:l,type:d,abort:c}=e,u=[],h=0,p=new Uint8Array(0),f=0,m=0,g=!0,v=!0,y=0;const E=()=>{g||0===f||(v&&(u.length?(this.filterSpikes(u).forEach(e=>{let{time:t,size:r}=e;this.fetcher.progress(t,r,!0)}),u=[]):this.fetcher.progress(f,m,!0)),f=0,m=0)};let S=o,A=0,T=0;const b=e=>{if(g)if(A+=e.length,this.fetcher.isLL()){const e=S();(e>=100||A>=16e3)&&(this.fetcher.progress(e,A),S=(0,Tt.u)(),A=0)}else if(A>0){const e=S();this.fetcher.progress(e,A),S=(0,Tt.u)(),A=0}},w=(e,s)=>{p=ft.P.concat(p,e);let a=!1,o=0;const c=e=>{o=e.size+e.start,a=!0,T++};if((new $e).box("uuid",e=>{if(!e.isComplete)return;o=e.size+e.start,a=!0;const s=e.reader.readUUID(),l=e.reader.readUint64();if("c4eac1fc-0ad8-4676-9656-69552eb3252f"===s&&g)t=l,r=Date.now(),i=r,g=!1;else if("bcfca253-398b-4a5b-9a92-ec8f7d89e61d"===s){n=l-t,t=l}}).box("moov",e=>{e.isComplete&&(o=e.size+e.start,a=!0)}).box("moof",e=>{e.isComplete&&(m+=e.size)}).box("mdat",e=>{if(g){if(!e.isComplete)return;c(e)}else{if(v){v=!1,y=e.loadedSize;const t=Date.now(),r=t-i;i=t,r>=n?(f+=r-n,m+=e.loadedSize):n<50&&(f+=r,m+=e.loadedSize)}else{const t=Date.now()-r;f+=t;const i=e.loadedSize-y;y=e.loadedSize;const n=i;if(m+=n,!l.isInitSegment)if(0===t)if(u.length){const e=u[u.length-1];e.size=e.size+n}else h=n;else u.push({time:t,size:n+h}),h=0}r=Date.now(),e.isComplete&&(v=!0,l.isInitSegment||E(),c(e))}}).fullBox("emsg",e=>{e.isComplete&&(this.parseEMSG(e,l,d),o=e.size+e.start,a=!0)}).parse(p,!0,!0),b(e),E(),!a)return;const S=p.subarray(0,o);p=p.subarray(o),s(S)};s.on("Data",e=>{l.loadedRawSize+=e.byteLength;try{w(e,e=>a.write(e))}catch(t){if(t instanceof RangeError)return c(),void("text"!==d&&this.emit("BufferAllocationError",{error:t,type:d}));throw t}}),s.on("Close",()=>{a.close(),this.emitSegmentLoaded(d,l,T)}),s.on("Destroy",()=>{a.destroy()}),s.resume()}emitSegmentLoaded(e,t,r){"text"===e||t.isInitSegment||this.emit("SegmentLoaded",{type:e,cmaf:r>1,number:t.number})}processVtt(e,t){let r=new Uint8Array(0);e.on("Data",e=>{r=ft.P.concat(r,e)}),e.on("Close",()=>{t.write(r),t.close()}),e.on("Destroy",()=>{t.destroy()}),e.resume()}setEmsgSchemeIdUris(e){this.emsgSchemeIdUris=null!=e?e:this.emsgSchemeIdUris}parseEMSG(e,t,r){if("text"===r)return;const i=t.start/1e3,n=e.reader.readTerminatedString(),s=e.reader.readTerminatedString(),a=e.reader.readUint32(),o=e.reader.readUint32(),l=e.reader.readUint32(),d=e.reader.readUint32(),c=e.reader.readBytes(e.reader.getLength()-e.reader.getPosition()),u=i+o/a,h=u+l/a,p=t.duration/1e3;if(this.emsgSchemeIdUris[r].has(n))if("urn:mpeg:dash:event:2012"===n)this.emit("ManifestUpdateRequired");else{const e={startTime:u,endTime:h,schemeIdUri:n,value:s,timescale:a,presentationTimeDelta:o,eventDuration:l,id:d,segmentDuration:p,messageData:c};this.emit("EmsgDetected",e)}}filterSpikes(e){if(e.length<2)return e;e.sort((e,t)=>e.time-t.time);const t=e[Math.floor(e.length/4)].time,r=e[Math.floor(e.length*(3/4))].time,i=r+3*(r-t);return e.filter(e=>e.time<i)}}class xr{constructor(e,t,r,i){this.mse=e,this.videoState=t,this.backWatch=r,this.bufferGoal=i,this.locked=!1}setBufferGoal(e){this.bufferGoal=e}run(){this.locked||(this.locked=!0,this.runInternal().catch(Jt.Z).then(()=>{this.locked=!1}))}async runInternal(){if("open"!==this.mse.getReadyState())return;const{currentTime:e}=this.videoState;if(null===e)return;const t=[this.clear(e+this.bufferGoal,this.videoState.duration)];return e>this.backWatch&&t.push(this.clear(0,e-this.backWatch)),Promise.all(t)}forceRun(e){void 0===e&&(e=null);const t=[];return(0,mr.RW)("yasp_no_source_abort_on_fake_seek")&&null!==e&&["video","audio"].forEach(r=>{this.mse.getBufferedRangesByType(r).some(t=>t.start<=e&&t.end>=e)?t.push(Promise.resolve()):t.push(this.clear(e,this.videoState.duration))}),0===t.length&&t.push(this.clear(0,this.videoState.duration)),Promise.all(t)}clear(e,t){return e>=t?Promise.all([Promise.resolve()]):Promise.all([this.mse.clearBuffer("video",e,t),this.mse.clearBuffer("audio",e,t)])}getDebugInfo(){return{locked:this.locked}}}var Vr=r(4834),Ur=r(8584);class Br extends Re.M{constructor(){super(),this.accumulatedSize=0,this.timer=null,this.parallelRequests=0,this.bandwidthInfoBatch=[],this.handleProgress=e=>{this.accumulatedSize=this.accumulatedSize+e.size},this.handleResponseStart=()=>{if(this.parallelRequests++,!this.timer){let e=(0,kt.u)();this.timer=setInterval(()=>{if(0===this.parallelRequests&&0===this.accumulatedSize)return clearInterval(this.timer),void(this.timer=null);const{accumulatedSize:t}=this;if(0===t)return;this.accumulatedSize=0;const r=e();e=(0,kt.u)(),this.emit("Progress",{time:r,size:t})},100)}},this.handleResponseEnd=()=>{this.parallelRequests=Math.max(this.parallelRequests-1,0)},(0,mr.RW)("web_yasp_enable_network_traces")&&this.on("Progress",e=>{this.bandwidthInfoBatch.push(ue({},e,{clientTimestamp:(0,Ur.no)()})),this.bandwidthInfoBatch.length>=30&&(this.emit("NetworkTrace",this.bandwidthInfoBatch),this.bandwidthInfoBatch=[])})}appendFetcher(e){e.on("Progress",this.handleProgress),e.on("ResponseStart",this.handleResponseStart),e.on("ResponseEnd",this.handleResponseEnd)}removeFetcher(e){e.off("Progress",this.handleProgress),e.off("ResponseStart",this.handleResponseStart),e.off("ResponseEnd",this.handleResponseEnd)}isLL(){return!1}}class Hr{constructor(){this.trace=void 0,this.trace=[]}getTrace(){return this.trace}addDecision(e,t,r){const i=[];for(const a of t){var n,s;const e=null==(n=a.audio)?void 0:n.trackId,t=null==(s=a.video)?void 0:s.trackId;i.push({audio:e,video:t})}return r?this.trace.push({name:e,result:i,input:r}):this.trace.push({name:e,result:i}),this.trace}}const jr=[4320,2880,2160,1440,1080,720,480,360,240,144,0],Wr=jr.reduce((e,t)=>(e[t]=t,e),Object.create(null));class Yr extends Re.M{constructor(e){let{rules:t=[]}=e;super(),this.rules=void 0,this.videoSizes=void 0,this.abrDecisionsHashCode={video:"",audio:""},this.lastAbrDecisionsLog=null,this.rules=t}setVideoElementSizes(e){this.videoSizes=e}filterSegments(e,t,r,i){let n;const s=pe(t,e,r),a=function(e,t){const r={};for(const i of e)r[i.trackId]||(r[i.trackId]={type:"audio",bitrate:i.bitrate});for(const i of t)r[i.trackId]||(r[i.trackId]={type:"video",bitrate:i.bitrate,height:i.height,width:i.width});return r}(e,t),o=new Hr,l=this.rules.reduce((e,t)=>{const r=t.filter(e,i,this.videoSizes);if(t.isCappingRule()){var a,l,d,c;const e=t.filter(s,i,this.videoSizes),r=e[e.length-1];n?null!=(a=n.video)&&a.height&&null!=(l=r.video)&&l.height&&(null==(d=n.video)?void 0:d.height)>(null==(c=r.video)?void 0:c.height)&&(n=r):n=r}let u;return"function"===typeof t.getInputData&&(u=t.getInputData()),o.addDecision(t.name,r,u),r},s.reverse())[0]||s[s.length-1],d={tracks:a,trace:o.getTrace()},c=he(d,"audio"),u={video:he(d,"video")||this.abrDecisionsHashCode.video,audio:c||this.abrDecisionsHashCode.audio};return this.abrDecisionsHashCode.audio===u.audio&&this.abrDecisionsHashCode.video===u.video||(this.emit("AbrDecisionChange",d),this.abrDecisionsHashCode=u,this.lastAbrDecisionsLog=d),n&&this.emit("MaxCapAllowedVideoTrackUpdate",n),{audio:l.audio,video:l.video,text:null==r?void 0:r[0]}}getDebugInfo(){return{rules:this.rules.map(e=>e.getDebugInfo()),abrDecisionsLog:this.lastAbrDecisionsLog}}}var Gr=r(3984);class zr extends Gr.I{static obtain(e){return zr.instance||(zr.instance=new zr(e)),zr.instance}constructor(e){super(!0),this.fetchers=[],this.defaultEstimate={value:NaN,source:"default"},this.handleFetcherProgress=e=>{let{time:t,size:r,isLowLatency:i=!1}=e;return this.fetchers.some(e=>e.isLL())?this.sample(t,r,i):this.sample(t,r,!1,2e3)},this.destroy=()=>{this.fetchers.forEach(e=>{e.off("Progress",this.handleFetcherProgress)}),this.fetchers.length=0},e&&(this.defaultEstimate.value=e)}getBandwidthEstimate(){return super.getBandwidthEstimate(this.defaultEstimate)}setHalfLife(e){return super.setHalfLife({fast:.45,slow:5})}appendFetcher(e){e.on("Progress",this.handleFetcherProgress),this.fetchers.push(e)}removeFetcher(e){e.off("Progress",this.handleFetcherProgress);for(let t=0;t<this.fetchers.length;t++)this.fetchers[t]===e&&(this.fetchers.splice(t,1),t--)}setDefaultEstimate(e){this.defaultEstimate=e}getDebugInfo(){return{fetchersCount:this.fetchers.length,defaultEstimate:this.defaultEstimate,estimate:this.getBandwidthEstimate().value,source:this.getBandwidthEstimate().source}}}zr.instance=void 0;class qr{constructor(){this.history=[],this.handleTtfb=e=>{isFinite(e)&&this.sample(e)}}appendFetcher(e){e.on("RequestTtfb",this.handleTtfb)}removeFetcher(e){e.off("RequestTtfb",this.handleTtfb)}sample(e){this.history.unshift(e),this.history.length=Math.min(this.history.length,20)}getMinTtfbEstimate(e){return this.hasGoodEstimate()?{value:Math.min(...this.history),source:"min"}:e}getTtfbEstimate(e){return this.hasGoodEstimate()?{value:this.getCurrentEstimate(),source:"max"}:e}hasGoodEstimate(){return this.history.length>1}getCurrentEstimate(){return Math.max(...this.history)}getDebugInfo(){return{hasGood:this.hasGoodEstimate(),value:this.getCurrentEstimate(),history:[...this.history]}}}var Kr=r(9150);class Qr{constructor(e,t,r){this.bandwidthEstimator=e,this.ttfbEstimator=t,this.getRemainingTimeToStart=r,this.name="NetworkParamsRule",this.inputData={bandwidth:0,ttfb:0,playbackRate:0,bufferSize:0,remainingTimeToStart:null}}filter(e,t){var r;if(e.length<=1)return e;const{value:i}=this.bandwidthEstimator.getBandwidthEstimate(),n=null==(r=this.ttfbEstimator)?void 0:r.getTtfbEstimate({value:1e3,source:"default"}).value,s=null===t.currentTime?0:(a=t,o=t.currentTime,ne((0,Kr.w)(a),o));var a,o;const l=this.getRemainingTimeToStart();this.inputData.remainingTimeToStart=l,this.inputData.bandwidth=i,this.inputData.ttfb=n,this.inputData.playbackRate=t.playbackRate,this.inputData.bufferSize=s;if(!(7.5>=s))return e;const d=Math.max(t.playbackRate,1),c=e.filter(e=>{var t,r,s,a;const o=Math.max(null!=(t=null==(r=e.video)?void 0:r.duration)?t:0,null!=(s=null==(a=e.audio)?void 0:a.duration)?s:0)/1e3,c=e.bandwidth*o,u=.75*o/d,h=Math.min(null!==l?l-n/1e3:1/0,u);return i*h>c});return 0===c.length?[e[0]]:c}getInputData(){return this.inputData}getDebugInfo(){return{name:this.name}}isCappingRule(){return!1}}var Zr=r(9473),Jr=r(3942);class Xr{constructor(){this.previousVariantHeight=void 0,this.lastDowngradedVariantHeight=void 0,this.getTimeSinceDowngrade=()=>1/0}filter(e){const t=e.filter(me);if(t.length<=1)return e;let r=t[t.length-1].video.height;return this.isDowngrading(r)&&(this.lastDowngradedVariantHeight=r,this.getTimeSinceDowngrade=(0,kt.u)()),void 0!==this.lastDowngradedVariantHeight&&(this.getTimeSinceDowngrade()<1e4?r=this.lastDowngradedVariantHeight:this.lastDowngradedVariantHeight=void 0),this.previousVariantHeight=r,t.filter(e=>e.video.height<=r)}reset(){this.getTimeSinceDowngrade=()=>1/0,this.previousVariantHeight=void 0,this.lastDowngradedVariantHeight=void 0}isDowngrading(e){return void 0!==this.previousVariantHeight&&this.previousVariantHeight>e}}class $r{constructor(){this.name="SwitchHistoryRule",this.rule=new Xr}filter(e,t){return this.rule.filter(e)}getDebugInfo(){return{name:this.name}}isCappingRule(){return!1}}var ei=r(4893);const ti=Number.MAX_SAFE_INTEGER;var ri=r(6513);class ii{constructor(e,t){this.name="ResolutionRule",this.inputData={width:0,height:0,dpi:1,defaultQuality:ti,userQuality:ei.k},this.getUserQuality=void 0,this.getDefaultQuality=void 0,this.getDefaultQuality=e,this.getUserQuality=t}filter(e,t,r){var i,n;let s;if((0,mr.RW)("web_yasp_object_fit_in_resolution_rule")){var a,o,l,d;const{width:e,height:i}=t.videoSize||{width:0,height:0},n={width:null!=(a=null==(o=t.containerSize)?void 0:o.width)?a:0,height:null!=(l=null==(d=t.containerSize)?void 0:d.height)?l:0},c=t.objectFit;s=null!=r?r:(0,ri.k)({videoWidth:e,videoHeight:i},c,n)}else{var c,u;s=r||{width:null==(c=t.containerSize)?void 0:c.width,height:null==(u=t.containerSize)?void 0:u.height}}return s.dpi=t.devicePixelRatio?t.devicePixelRatio:1,this.inputData.width=null!=(i=s.width)?i:null,this.inputData.height=null!=(n=s.height)?n:null,this.inputData.dpi=s.dpi,this.inputData.userQuality=this.getUserQuality(),this.inputData.defaultQuality=this.getDefaultQuality(),fe(e,s,{defaultLongSideResolution:this.inputData.defaultQuality,userCappingResolution:this.inputData.userQuality})}getInputData(){return this.inputData}getDebugInfo(){return{name:this.name}}isCappingRule(){return!0}}class ni{constructor(){this.name="MaxBandwidthRule"}filter(e,t){const r=h(e.slice(0).reverse(),e=>{var t;return(null==e||null==(t=e.audio)?void 0:t.bitrate)||0});return r?[r]:e}getDebugInfo(){return{name:this.name}}isCappingRule(){return!1}}class si{constructor(e){this.getServerCapHeight=e,this.name="ServerRestrictionsRule",this.inputData={maxHeight:null}}filter(e){if(e.length<=1)return e;const t=this.getServerCapHeight();return this.inputData.maxHeight=t,null===t?e:function(e,t){const r=e.filter(me);if(r.length<=1)return e;const i=[];for(let n=0;n<r.length;n++)r[n].video.height<=t&&i.push(r[n]);return 0===i.length?[r[0]]:i}(e,t)}getInputData(){return this.inputData}getDebugInfo(){return{name:this.name}}isCappingRule(){return!0}}class ai{constructor(e){this.bandwidthEstimator=e,this.name="SimpleBandwidthRule",this.inputData={bandwidth:0,playbackRate:0,paused:!1}}filter(e,t){if(e.length<=1)return e;const{value:r}=this.bandwidthEstimator.getBandwidthEstimate();this.inputData.bandwidth=r,this.inputData.playbackRate=t.playbackRate,this.inputData.paused=t.paused;const i=e.filter(e=>e.bandwidth*Math.max(t.playbackRate,1)<=r);return 0===i.length?[e[0]]:i}getInputData(){return this.inputData}getDebugInfo(){return{name:this.name}}isCappingRule(){return!1}}var oi=r(2786),li=r(9787);class di{constructor(){this.name="SaveDataRule",this.inputData={saveData:(0,oi.R)()}}filter(e){return this.inputData.saveData=(0,oi.R)(),function(e){return(0,oi.R)()?e.filter(e=>!(e.video&&e.video.height&&e.video.width)||Math.min(e.video.height,e.video.width)<=li.T):e}(e)}getInputData(){return this.inputData}getDebugInfo(){return{name:this.name}}isCappingRule(){return!0}}var ci=r(7333);class ui extends Re.M{constructor(e){super(),this.videoState=e,this.watchedTimeCounter=void 0,this.watchedTimeCounter=new ci.p}run(){this.videoState.currentTime&&(this.watchedTimeCounter.calc(this.videoState.currentTime,this.videoState.playbackRate,!0),this.emit("WatchedTimeUpdated",{watchedTime:this.watchedTimeCounter.get()}))}}var hi=r(6114),pi=r.n(hi)().ru.yandex.videoplayer.multiplatform;class fi{constructor(){this.bufferGoalManager=void 0,this.constantBufferGoal=null,this.bufferGoalManager=new pi.bgm.BufferGoalManager(new pi.bgm.BufferGoalManagerProps(null,new pi.bgm.BufferGoalManagerFlags(new pi.flags.DisableDynamicBuffer(!1),new pi.flags.LowBufferBeforeStart(!0),new pi.flags.DefaultBuffer(30)),null))}setConstantBufferGoal(e){this.constantBufferGoal=e}getBufferGoal(e){if(this.constantBufferGoal)return this.constantBufferGoal;const{watchedTime:t=0,currentTime:r=0}=e;return this.bufferGoalManager.getBufferGoal(new pi.bgm.GetBufferGoalProps(new pi.bgm.WatchedTime(t),new pi.bgm.CurrentTime(r)))}setSkippableFragments(e){this.bufferGoalManager.setSkippableFragments(e?e.map(e=>{let{startTime:t,endTime:r}=e;return new pi.bgm.SkippableFragment(t,r)}):null)}getSkippableFragments(){const e=this.bufferGoalManager.getSkippableFragments()||void 0;return e&&e.map(e=>{let{startTime:t,endTime:r}=e;return{startTime:t,endTime:r}})}}class mi extends Re.M{constructor(e){super(),this.timeline=e}run(){this.timeline.getIsDynamic()&&this.update()}update(){const e=this.timeline.getSeekableRange(),t=e.start/1e3,r=e.end/1e3;this.emit("SeekableUpdate",{start:t,end:r})}destroy(){super.destroy()}}var gi=r(1841),vi=r(5887);class yi{constructor(e,t){this.onChange=e,this.types={},this.queue={audio:[],video:[]},this.enabledTypes=void 0,this.enabledTypes=(0,Ct.Z)(t),this.enabledTypes.forEach(e=>{this.types[e]=!1})}update(e,t){this.enabledTypes.includes(e)&&(this.queue[e].push(t),this.checkAndUpdate())}checkAndUpdate(){if(this.enabledTypes.every(e=>this.queue[e].length)){let e=!1;this.enabledTypes.forEach(t=>{const r=this.queue[t].shift();this.types[t]!==r&&(e=!0,this.types[t]=r)}),e&&this.onChange(this.types)}}onSeek(){this.enabledTypes.forEach(e=>this.queue[e].length=0)}}var Ei=r(2390);const Si=(0,kr.V)(self),Ai=(0,Pr.y)(self);var Ti,bi=r(8243),wi=r(5214);!function(e){e.append="append",e.remove="remove",e.setTimestampOffset="setTimestampOffset",e.changeType="changeType"}(Ti||(Ti={}));const _i=[[Ti.remove],[Ti.setTimestampOffset],[Ti.append,Ti.changeType]];class Ri{constructor(e,t){this.destroyed=!1,this.mimeType=void 0,this.sourceBuffer=void 0,this.mediaSource=void 0,this.sync=void 0,this.abortId=void 0,this.removeId=void 0,this.queues=void 0,this.mimeType=e,this.mediaSource=t,this.sourceBuffer=this.initSourceBuffer(),this.sync=(0,Ei.l)(),this.abortId=0,this.removeId=0,this.queues=_i.map(e=>[])}checkIfPresent(){return(0,wi.w)(this.mediaSource.sourceBuffers).some(e=>this.sourceBuffer===e)}isFree(){return this.sync.isFree()&&this.queues.every(e=>0===e.length)}lockForExternalOperation(e){return this.sync.waitAndLock(()=>e()).then(()=>{setTimeout(()=>this.performNextOperation())}).catch(rr.Z)}initSourceBuffer(){return this.mediaSource.addSourceBuffer(this.mimeType)}getNextOperationDescriptor(){for(let e=0;e<this.queues.length;e++)if(this.queues[e].length>0)return this.queues[e].shift();return null}performNextOperation(){if(!this.sync.isFree())return;const e=this.getNextOperationDescriptor();if(null===e)return;const{abortId:t,defer:r,operation:i,type:n}=e;this.sync.waitAndLock(async()=>{if(t!==this.abortId||this.destroyed)return r.reject(new dt.w({code:"YASP_OPERATION_ABORTED",details:{},isFatal:!1,category:ct.q.EXCEPTION,message:"SourceBuffer "+n+" operation aborted before start"})),r.promise;try{await i(),r.resolve()}catch(e){r.reject(e)}return r.promise}).catch(rr.Z).then(()=>{setTimeout(()=>this.performNextOperation())})}planOperation(e,t){const{abortId:r,destroyed:i}=this;if(i)throw new Error("SourceBuffer operation with type="+e+" skipped after destroy");const n=new fr.B,s=_i.findIndex(t=>t.includes(e));if(-1===s)throw new Error("SourceBuffer unknown operation with type="+e);return this.queues[s].push({defer:n,abortId:r,operation:t,type:e}),this.performNextOperation(),n.promise}static isChangeTypeSupported(){return void 0===(e=self)&&(e=window),!Si&&!Ai&&Boolean(e.SourceBuffer)&&Boolean(e.SourceBuffer.prototype)&&Boolean(e.SourceBuffer.prototype.changeType);var e}changeType(e){return this.planOperation(Ti.changeType,async()=>{this.mimeType!==e&&(this.sourceBuffer.changeType(e),this.mimeType=e)})}append(e){const{removeId:t}=this;return this.planOperation(Ti.append,()=>new Promise((r,i)=>{if(t!==this.removeId)return void i(new dt.w({code:"YASP_OPERATION_ABORTED",details:{},isFatal:!1,category:ct.q.EXCEPTION,message:"SourceBuffer append operation aborted before start"}));const n=new fr.B,s=new fr.B,a=(0,bi.O)(this.sourceBuffer,"updateend",()=>{n.resolve(),s.resolve()}),o=(0,bi.O)(this.sourceBuffer,"error",()=>{s.reject(new dt.w({code:"YASP_MSE_FAILED_TO_EXECUTE_PROCEDURE",message:"Failed to execute append operation in SourceBuffer",details:{operation:"append"},isFatal:!1,category:ct.q.EXCEPTION}))}),l=(0,bi.O)(this.sourceBuffer,"abort",()=>{s.reject(new dt.w({code:"YASP_OPERATION_ABORTED",details:{},isFatal:!1,category:ct.q.EXCEPTION,message:"SourceBuffer append operation aborted"}))});try{this.sourceBuffer.appendBuffer(e)}catch(d){const e=(0,lr.V)(d)?d:new Error("Failed to start append operation in SourceBuffer"),t="InvalidStateError"===e.name?"YASP_INVALID_STATE_ERROR":"YASP_QUOTA_EXCEEDED_ERROR";return void i(new dt.w({code:t,message:e.message,details:{operation:"append",error:e},isFatal:!1,category:ct.q.EXCEPTION}))}n.promise.then(()=>s.promise).catch(i).then(r).then((function(){a(),o(),l()}))}))}remove(e,t){return this.planOperation(Ti.remove,()=>new Promise((r,i)=>{this.removeId++;const n=new fr.B,s=new fr.B,a=(0,bi.O)(this.sourceBuffer,"updateend",()=>{n.resolve(),s.resolve()}),o=(0,bi.O)(this.sourceBuffer,"error",()=>{s.reject(new dt.w({code:"YASP_MSE_FAILED_TO_EXECUTE_PROCEDURE",message:"Failed to execute remove operation in SourceBuffer",details:{operation:"remove"},isFatal:!1,category:ct.q.EXCEPTION}))}),l=(0,bi.O)(this.sourceBuffer,"abort",()=>{s.reject(new dt.w({code:"YASP_OPERATION_ABORTED",details:{},isFatal:!1,category:ct.q.EXCEPTION,message:"SourceBuffer remove operation aborted"}))});try{this.sourceBuffer.remove(e,t)}catch(d){return void i(new dt.w({code:"YASP_MSE_FAILED_TO_START_OPERATION",message:(0,lr.V)(d)?d.message:"Failed to start remove operation in SourceBuffer",details:{operation:"remove",error:d},isFatal:!1,category:ct.q.EXCEPTION}))}n.promise.then(()=>s.promise).catch(i).then(r).then((function(){a(),o(),l()}))}))}setTimestampOffset(e){return this.planOperation(Ti.setTimestampOffset,async()=>{e>0&&(e-=.001),this.sourceBuffer.timestampOffset!==-e&&(this.sourceBuffer.timestampOffset=-e)})}abort(){this.abortId++}getBufferedRange(){return this.checkIfPresent()?(0,Kr.w)(this.sourceBuffer):[]}getBufferEnd(){return this.checkIfPresent()?0===this.sourceBuffer.buffered.length?null:this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1):null}async destroy(){return this.abort(),this.sync.waitAndLock(async()=>{try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(e){}this.destroyed=!0})}getDebugInfo(){return{abortId:this.abortId,removeId:this.removeId,mimeType:this.mimeType,locked:!this.sync.isFree(),buffered:this.getBufferedRange(),queues:this.queues.map(e=>e.map(e=>ve({},e)))}}}var ki=r(4754);class Pi extends Re.M{createMediaSource(){const e=(0,sr.Q)(self),t=this.mediaSource=new e,r=(0,Ct.Z)(this.mimeTypes),i=()=>{try{r.forEach(e=>this.createSourceBufferEngine(e))}catch(e){return this.mediaSourceOpenDeferred.reject(e),void this.destroy()}this.emit("Open"),this.mediaSourceOpenDeferred.resolve(),this.revokeObjectUrl()},n=new fr.B,s=r.length;let a=0;return t.sourceBuffers.addEventListener("addsourcebuffer",()=>{a++,a===s&&n.resolve()}),"open"===t.readyState?i():this.addListener(t,"sourceopen",i,{once:!0}),{sourceBufferAddingPromise:n.promise}}constructor(e){super(),this.mimeTypes=e,this.destroyed=!1,this.mediaSource=void 0,this.mediaSourceOpenDeferred=new fr.B,this.sourceBufferEngines={},this.objectUrl=void 0,this.listeners=[],this.reloadingMediaSource=!1,this.nextDurationToSet=null,(0,Ht.v)(this.mediaSourceOpenDeferred.promise),this.createMediaSource(),this.objectUrl=this.createObjectUrl(),this.once("Destroy",()=>{this.destroyed=!0,this.removeListeners()})}addListener(e,t,r,i){e.addEventListener(t,r,i);const n=()=>e.removeEventListener(t,r);return this.listeners.push(n),n}removeListeners(){this.listeners.forEach(e=>e()),this.listeners.length=0}async clearBuffer(e,t,r){if(this.destroyed)throw new Error("Can not clearBuffer because CoreMediaSourceEngine is destroyed");if(!this.checkType(e))return;if("open"!==this.mediaSource.readyState&&await this.mediaSourceOpenDeferred.promise,this.reloadingMediaSource)return;const{[e]:i}=this.sourceBufferEngines;await(null==i?void 0:i.remove(t,r))}async changeCodec(e,t){if(this.checkType(e)){if("open"!==this.mediaSource.readyState&&await this.mediaSourceOpenDeferred.promise,this.mimeTypes[e]=t,Ri.isChangeTypeSupported()){const{[e]:r}=this.sourceBufferEngines;return null==r?void 0:r.changeType(t)}return this.reset()}}abort(){this.destroyed||(0,Rt.z)(this.sourceBufferEngines).forEach(e=>{null==e||e.abort()})}async reset(){this.reloadingMediaSource=!0,this.removeListeners();try{var e;await this.removeSourceBuffers();const t=null!=(e=this.nextDurationToSet)?e:this.mediaSource.duration;this.mediaSource=null,this.mediaSourceOpenDeferred=new fr.B,(0,Ht.v)(this.mediaSourceOpenDeferred.promise);const{sourceBufferAddingPromise:r}=this.createMediaSource();this.objectUrl=this.createObjectUrl(),null!==t&&this.setDuration(t),this.emit("Reset",this.getObjectUrl()),await r}finally{this.reloadingMediaSource=!1}}checkType(e){return Boolean(this.mimeTypes[e])}createObjectUrl(){return self.URL.createObjectURL(this.mediaSource)||this.mediaSource.handle}revokeObjectUrl(){"string"===typeof this.objectUrl&&self.URL.revokeObjectURL(this.objectUrl)}async appendBuffer(e,t){if(this.destroyed)throw new Error("Can not appendBuffer because CoreMediaSourceEngine is destroyed");if("open"!==this.mediaSource.readyState&&await this.mediaSourceOpenDeferred.promise,this.reloadingMediaSource)throw new Error("Can not appendBuffer because CoreMediaSourceEngine is reloading");const{[e]:r}=this.sourceBufferEngines;return null==r?void 0:r.append(t)}getObjectUrl(){return this.objectUrl}isReloading(){return this.reloadingMediaSource}getReadyState(){return this.mediaSource.readyState}endOfStream(){if(!this.reloadingMediaSource&&"open"===this.mediaSource.readyState){for(const e of["audio","video"])if(void 0!==this.sourceBufferEngines[e]&&!this.sourceBufferEngines[e].isFree())return;this.mediaSource.endOfStream()}}getSourceBufferBufferedRange(e){var t;return null==(t=this.sourceBufferEngines[e])?void 0:t.getBufferedRange()}setDuration(e){isNaN(e)||(this.nextDurationToSet=e,"open"!==this.mediaSource.readyState?this.mediaSourceOpenDeferred.promise.then(()=>this.tryToSetDuration()).catch(e=>{this.destroyed||(0,At.L)(e)}):this.tryToSetDuration())}tryToSetDuration(){if(null===this.nextDurationToSet)return;const e=["audio","video"],t={audio:new fr.B,video:new fr.B};for(const i of e){var r;const{[i]:n}=this.sourceBufferEngines,s=async()=>{t[i].resolve(),await t[e[e.indexOf(i)%e.length]].promise,null!==this.nextDurationToSet&&(this.mediaSource.duration=this.nextDurationToSet,this.nextDurationToSet=null)};if(!n){s();continue}const a=null!=(r=n.getBufferEnd())?r:this.nextDurationToSet;a>this.nextDurationToSet&&n.remove(this.nextDurationToSet,a),n.lockForExternalOperation(s)}}getDuration(){return this.mediaSource.duration}async setLiveSeekableRange(e,t){if((0,ki.m)(this.mediaSource.setLiveSeekableRange)){if(this.reloadingMediaSource)throw new Error("Can not setLiveSeekableRange because CoreMediaSourceEngine is reloading");if(this.destroyed)throw new Error("Can not setLiveSeekableRange because CoreMediaSourceEngine is destroyed");if(e<0)throw new Error("Can not setLiveSeekableRange because start value is negative");if(e>t)throw new Error("Can not setLiveSeekableRange because start value is greater then end value");"open"!==this.mediaSource.readyState&&await this.mediaSourceOpenDeferred.promise,this.mediaSource.setLiveSeekableRange(e,t)}}async setTimestampOffset(e,t){if(this.destroyed)throw new Error("Can not setTimestampOffset because CoreMediaSourceEngine is destroyed");if("open"!==this.mediaSource.readyState&&await this.mediaSourceOpenDeferred.promise,this.reloadingMediaSource)return;const{[e]:r}=this.sourceBufferEngines;return null==r?void 0:r.setTimestampOffset(t)}getBufferedRanges(){return{audio:this.getBufferedRangesByType("audio"),video:this.getBufferedRangesByType("video")}}getBufferedRangesByType(e){var t;return null!=(t=this.getSourceBufferBufferedRange(e))?t:[]}async destroy(){if(!this.destroyed){super.destroy(),this.mediaSourceOpenDeferred.reject(new Error("Can not open media source because CoreMediaSourceEngine is destroyed"));try{this.mediaSource.endOfStream()}catch(e){}await this.removeSourceBuffers()}}removeSourceBuffers(){return this.abort(),Promise.all((0,Ct.Z)(this.sourceBufferEngines).map(async e=>{try{await this.sourceBufferEngines[e].destroy()}catch(t){this.destroyed||(0,At.L)(t)}delete this.sourceBufferEngines[e]}))}createSourceBufferEngine(e){if(this.sourceBufferEngines[e])return;const t=this.mimeTypes[e];if(!t)throw new dt.w({code:"YASP_EMPTY_MIME",details:{},isFatal:!0,category:ct.q.MEDIA});try{this.sourceBufferEngines[e]=new Ri(t,this.mediaSource)}catch(r){throw new dt.w({code:"YASP_CANNOT_CREATE_SOURCE_BUFFER",details:{reason:r.name,mimeType:t},isFatal:!0,category:ct.q.MEDIA})}}getDebugInfo(){var e,t,r,i,n,s;return{readyState:this.getReadyState(),audio:null!=(e=null==(t=this.sourceBufferEngines)||null==(r=t.audio)?void 0:r.getDebugInfo())?e:null,video:null!=(i=null==(n=this.sourceBufferEngines)||null==(s=n.video)?void 0:s.getDebugInfo())?i:null}}}var Ii=r(9881);const Ci=(0,kr.V)(self)||(0,Pr.y)(self)||(0,Ii.F)(self);class Oi extends Re.M{constructor(e,t,r,i){super(),this.cron=e,this.url=t,this.videoState=r,this.callbacks=i,this.abr=void 0,this.bandwidthEstimator=void 0,this.ttfbEstimator=void 0,this.manifesto=void 0,this.manifestUpdater=void 0,this.timeline=void 0,this.mse=void 0,this.mseFeeder=void 0,this.mseGc=void 0,this.timelineFiller=void 0,this.seekableUpdater=void 0,this.timelineGc=void 0,this.yaspWatchedTimeCollector=void 0,this.segmentFetcher=void 0,this.targetLatencyUpdater=void 0,this.cmafLogger=void 0,this.fetcher=void 0,this.fetcherParams=void 0,this.fetcherProgressAccumulator=void 0,this.attached=!1,this.startPosition=null,this.destroyed=!1,this.performOnLoad=void 0,this.watchedTime=0,this.bufferGoalManager=void 0,this.timelineFillerBufferGoalInterval=void 0,this.videoType=void 0,this.isLowLatency=!1,this.maxStartTimestamp=null,this.wasSegmentLoaded=!1,self.source=this,this.startPosition=de(this.url),this.performOnLoad=function(e){function t(){if(0===r.length)return;const e=r.slice();r.length=0,e.forEach(e=>{let{task:t,onPromiseReject:r}=e;if(a)r(n);else try{t(i)}catch(s){}}),r.length>0&&t()}const r=[];let i,n,s=!1,a=!1;return e.then(e=>{i=e,s=!0,t()}),e.catch(e=>{n=e,a=!0,t()}),function(e,t){if(void 0===t&&(t=Jt.Z),a)t(n);else if(!s||r.length>0)r.push({task:e,onPromiseReject:t});else try{e(i)}catch(o){}}}(new Promise(e=>{this.once("ManifestLoaded",e)})),this.timeline=this.createTimeline(),this.subscribeToTrackChanges(),this.bufferGoalManager=new fi;const{bandwidthEstimator:n,ttfbEstimator:s,abr:a}=function(e,t,r,i,n){const s=zr.obtain(n),a=new qr,o=[new di,new si(e),new ai(s),new Qr(s,a,i),new $r,new ii(r,t),new ni];return{bandwidthEstimator:s,ttfbEstimator:a,abr:new Yr({rules:o})}}(()=>{var e,t;return null!=(e=null==(t=this.manifesto)?void 0:t.getPlaylistCapHeight())?e:null},()=>this.callbacks.getUserQuality(),()=>this.callbacks.getMaxAutoQuality(),()=>this.getRemainingTimeToStart(),this.callbacks.getDefaultBandwidth().value);this.bandwidthEstimator=n,this.ttfbEstimator=s,this.abr=a,this.abr.on("AbrDecisionChange",e=>{const t=JSON.stringify(ye({},e,{type:this.attached?"main":"preload"}));this.sendEvent({name:"AbrDecisionChange",data:{message:t},shouldLogWhenDetached:!0})}),this.abr.on("MaxCapAllowedVideoTrackUpdate",e=>{var t,r,i,n;e&&null!=(t=e.video)&&t.width&&null!=(r=e.video)&&r.height&&this.emit("MaxCapAllowedVideoTrackUpdate",{width:null==(i=e.video)?void 0:i.width,height:null==(n=e.video)?void 0:n.height})}),this.on("SegmentLoaded",e=>{var t;null==(t=this.mseFeeder)||t.run(),this.wasSegmentLoaded=!0});const o=(0,gi.p)();void 0!==o&&(this.maxStartTimestamp=Date.now()+1e3*o)}getRemainingTimeToStart(){if(!this.maxStartTimestamp||this.wasSegmentLoaded)return null;const e=this.maxStartTimestamp-Date.now();return e<=0?0:e/1e3}updateSourceInfo(e){var t,r;const i=(0,Oe.IN)(e);null==(t=this.manifesto)||t.setSourceIndex(i),null==(r=this.timelineFiller)||r.setSourceIndex(i)}createTimeline(){if(this.timeline)return this.timeline;const e=new Dt;return e.on("BufferedInfoChanged",e=>{this.emit("BufferedInfoChanged",e)}),e.on("CuesAdded",e=>{this.emit("CuesAdded",e)}),e.on("CodecsChange",e=>{var t;if(!this.mse)return;null==(t=this.mseFeeder)||t.abortForType(e.type);const r=e.getFullMimeType();this.mse.changeCodec(e.type,r)}),e.on("StreamEndTimeUpdate",e=>{this.emit("StreamEndTimeUpdate",e)}),e}getStartPosition(){var e;return null!==this.startPosition&&Number.isFinite(this.startPosition)?this.startPosition:null!=(e=this.timeline)&&e.getIsDynamic()?Math.floor(this.timeline.getSeekableRange().end/1e3):this.timeline.getSeekableRange().start/1e3}setDurationByVideoType(){if(!this.mse||!this.videoType)return;const e=this.timeline.getDuration();void 0!==e&&this.mse.setDuration(e/1e3)}updateStreamingParameters(){if(this.videoType&&this.emit("VideoTypeChange",this.videoType),this.manifesto){const e=this.manifesto.getDrmInfos();e.length>0&&this.emit("DrmInfoReceived",e)}this.emit("UtcStartTimeUpdate",this.timeline.getUtcStartTime());const e=this.timeline.getSeekableRange(),t=e.start/1e3,r=e.end/1e3;if("number"===typeof this.startPosition&&(this.startPosition=Math.min(Math.max(this.startPosition,t),r-vi.C)),this.mse){this.timeline.getIsDynamic()&&this.mse.setLiveSeekableRange(t,r).catch(e=>{this.attached&&(0,At.L)(e)})}this.emit("SeekableRangeUpdate",{start:t,end:r}),this.emit("IsLowLatencyChange",this.isLowLatency)}async load(){var e;if(this.timeline.emitBufferedInfoChanged(),this.manifesto||(this.manifesto=new cr({url:this.url,timeline:this.timeline,fetcherParams:this.fetcherParams}),this.manifesto.on("Error",e=>{this.emit("Error",e)}),this.manifesto.on("DrmInfoReceived",e=>{this.emit("DrmInfoReceived",e)}),this.manifesto.on("ServerTimeChange",e=>{this.emit("ServerTimeChange",e)}),this.manifesto.on("ManifestUpdate",()=>{var e,t,r,i;this.emit("UtcStartTimeUpdate",this.timeline.getUtcStartTime());const n=this.timeline.getSeekableRange(),s=n.start/1e3,a=n.end/1e3;null==(e=this.mse)||e.setLiveSeekableRange(s,a).catch(e=>{this.attached&&(0,At.L)(e)}),this.emit("SeekableRangeUpdate",{start:s,end:a});const o=null==(t=this.manifesto)?void 0:t.getVideoType();this.videoType!==o&&(this.videoType=o,this.emit("VideoTypeChange",this.videoType),this.setDurationByVideoType());const l=this.timeline.isLowLatencyLive();this.isLowLatency!==l&&(this.isLowLatency=l,this.emit("IsLowLatencyChange",this.isLowLatency)),null==(r=this.segmentFetcher)||r.setEmsgSchemeIdUris(null==(i=this.manifesto)?void 0:i.getEmsgSchemeIdUris())})),this.manifestUpdater=null!=(e=this.manifestUpdater)?e:new ur(this.manifesto),this.manifesto.isInitiallyLoaded()?this.updateStreamingParameters():(await this.manifestUpdater.update(),this.emit("ManifestLoaded")),!this.destroyed){var t,r,i;if(!this.fetcher)this.fetcher=new nr(this.fetcherParams),this.fetcher.setIsLL(this.timeline.isLowLatencyLive()),this.fetcher.isLL()?this.bandwidthEstimator.appendFetcher(this.fetcher):(this.fetcherProgressAccumulator=new Br,this.fetcherProgressAccumulator.on("NetworkTrace",e=>{this.sendEvent({name:"NetworkTrace",data:e})}),this.fetcherProgressAccumulator.appendFetcher(this.fetcher),this.bandwidthEstimator.appendFetcher(this.fetcherProgressAccumulator)),null==(t=this.ttfbEstimator)||t.appendFetcher(this.fetcher);if(!this.cmafLogger){const e=e=>{this.sendEvent({name:"MediaFormatChange",data:e})};this.cmafLogger=new yi(e,this.getMseConfig())}if(!this.segmentFetcher)this.segmentFetcher=new Fr(this.fetcher),this.segmentFetcher.setEmsgSchemeIdUris(null==(r=this.manifesto)?void 0:r.getEmsgSchemeIdUris()),this.segmentFetcher.on("EmsgDetected",e=>{this.emit("EmsgDetected",e)}),this.segmentFetcher.on("ManifestUpdateRequired",()=>{var e;null==(e=this.manifestUpdater)||e.forceUpdate()}),this.segmentFetcher.on("SegmentLoaded",e=>{var t;null==(t=this.cmafLogger)||t.update(e.type,e.cmaf),this.emit("SegmentLoaded",e)}),this.segmentFetcher.on("BufferAllocationError",e=>{var t;const r=this.videoState.currentTime?1e3*this.videoState.currentTime:0,i=this.timeline.getSegmentsDebugInfo(r),n=(null==(t=this.mse)?void 0:t.getBufferedRanges())||{audio:[],video:[]};if((0,mr.RW)("yasp_decrease_virtual_buffer_on_allocation_error")){var s,a,o;null==(s=this.timelineGc)||s.setBackWatch(10);const e=this.bufferGoalManager.getBufferGoal({watchedTime:this.watchedTime,currentTime:null!=(a=this.videoState.currentTime)?a:0}),t=Math.max(e/2,15);null==(o=this.timelineGc)||o.setBufferGoal(t),this.bufferGoalManager.setConstantBufferGoal(t)}if((0,mr.RW)("yasp_decrease_mse_buffer_on_allocation_error")){var l,d;const e=15;null==(l=this.mseFeeder)||l.setBufferGoal(e),null==(d=this.mseGc)||d.setBufferGoal(e)}const c=new dt.w({isFatal:!1,message:e.error.message,code:"YASP_BUFFER_ALLOCATION_ERROR",category:ct.q.EXCEPTION,details:{type:e.type,video:ye({},i.video,{buffered:n.video}),audio:ye({},i.audio,{buffered:n.audio})}});this.emit("Error",c)});if(this.timelineFiller)this.timelineFiller.abort();else this.timelineFiller=new Lr({timeline:this.timeline,videoState:this.videoState,manifesto:this.manifesto,bufferGoal:this.bufferGoalManager.getBufferGoal({watchedTime:this.watchedTime,currentTime:this.videoState.currentTime||0}),abr:this.abr,segmentFetcher:this.segmentFetcher,bandwidthEstimator:this.bandwidthEstimator,ttfbEstimator:this.ttfbEstimator,sourceIndex:(0,Oe.IN)(this.url)}),this.timelineFiller.on("Error",e=>{this.emit("Error",e)}),this.timelineFiller.on("BandwidthEstimateUpdate",e=>{this.emit("BandwidthEstimateUpdate",e)}),this.cron.plan(this.timelineFiller,100),this.initTimelineFillerBufferGoalAutoUpdate(),this.timelineFiller.setVideoState(n(this.videoState,{currentTime:Math.max(null!=(i=this.getStartPosition())?i:0,0),duration:this.timeline.getDuration()/1e3})),this.timelineFiller.run();return this.timelineGc||(this.timelineGc=new Mr(this.timeline,this.videoState,30,35),this.cron.plan(this.timelineGc,1e3)),this.yaspWatchedTimeCollector||(this.yaspWatchedTimeCollector=new ui(this.videoState),this.yaspWatchedTimeCollector.on("WatchedTimeUpdated",e=>{let{watchedTime:t}=e;this.watchedTime=t}),this.cron.plan(this.yaspWatchedTimeCollector,100)),this.handleAttachedState(),{startPosition:this.startPosition}}}initTimelineFillerBufferGoalAutoUpdate(){this.stopTimelineFillerBufferGoalAutoUpdate();const e=()=>{var e;const t=this.bufferGoalManager.getBufferGoal({watchedTime:this.watchedTime,currentTime:this.videoState.currentTime||0});null==(e=this.timelineFiller)||e.setBufferGoal(t)};this.timelineFillerBufferGoalInterval=setInterval(e,1e3),e()}stopTimelineFillerBufferGoalAutoUpdate(){this.timelineFillerBufferGoalInterval&&clearInterval(this.timelineFillerBufferGoalInterval)}async handleSeek(){var e,t,r,i,n,s,a,o,l;((0,Pr.y)(self)?await(0,dr._)(100):(0,kr.V)(self)&&await(0,dr._)(0),null==(e=this.timelineFiller)||e.abortUseless(),null==(t=this.timelineFiller)||t.run(),null==(r=this.cmafLogger)||r.onSeek(),(0,mr.RW)("yasp_no_source_abort_on_fake_seek"))?(null==(n=this.mse)||n.abort(),null==(s=this.mseFeeder)||s.abortUseless(),await(null==(a=this.mseGc)?void 0:a.forceRun(this.videoState.currentTime).catch(e=>{if(this.attached)throw e}))):(await(null==(o=this.mseGc)?void 0:o.forceRun().catch(e=>{if(this.attached)throw e})),null==(l=this.mseFeeder)||l.abort());null==(i=this.mseFeeder)||i.run()}handleAttachedState(){var e,t,r,i;const s=this.attached?this.videoState:n(this.videoState,{currentTime:Math.max(null!=(e=this.startPosition)?e:0,0),duration:this.timeline.getDuration()/1e3}),a=this.attached?this.bufferGoalManager.getBufferGoal({watchedTime:this.watchedTime,currentTime:this.videoState.currentTime||0}):Vr.a;null==(t=this.timelineFiller)||t.setVideoState(s),null==(r=this.timelineFiller)||r.setBufferGoal(a),null==(i=this.timelineGc)||i.setVideoState(s)}handleSeekableUpdater(){if(!this.seekableUpdater&&this.attached)return this.seekableUpdater=new mi(this.timeline),this.seekableUpdater.on("SeekableUpdate",e=>{this.emit("SeekableRangeUpdate",e)}),void this.cron.plan(this.seekableUpdater,100);this.seekableUpdater&&!this.attached&&(this.cron.cancel(this.seekableUpdater),this.seekableUpdater.destroy(),this.seekableUpdater=void 0)}attach(e){return new Promise(t=>{this.performOnLoad(()=>{var r,i,n,s,a,o,l,d;this.attached=!0,this.updateSourceInfo(e),this.manifestUpdater&&this.manifestUpdater.update(),this.startPosition=null!=(r=this.startPosition)?r:de(e),this.timelineGc&&this.cron.plan(this.timelineGc,1e3),this.handleAttachedState(),this.mse=null!=(i=this.mse)?i:new Pi(this.getMseConfig()),this.mse.on("Reset",e=>{var t;null==(t=this.mseFeeder)||t.reset(),this.emit("UpdateUrlObject",e)}),this.handleSeekableUpdater(),this.setDurationByVideoType(),this.updateStreamingParameters(),this.mseFeeder=null!=(n=this.mseFeeder)?n:(a=this.timeline,o=this.videoState,l=this.mse,d={bufferGoal:30,totalBufferSoftCap:hr(),totalBufferHardCap:pr()},new yr(a,o,l,d)),this.mseFeeder.on("FatBuffer",e=>{this.mseGc&&this.mseGc.run()}),this.mseFeeder.on("QuotaExceededError",()=>{var e,t;null==(e=this.mseFeeder)||e.setBufferGoal(15),null==(t=this.mseGc)||t.setBufferGoal(15)}),this.mseFeeder.on("GorgedBuffer",e=>{}),this.mseGc=null!=(s=this.mseGc)?s:new xr(this.mse,this.videoState,10,pr()),this.mseFeeder.on("Error",e=>{this.emit("Error",e)}),(0,mr.RW)("web_yasp_target_latency_updater")&&!this.targetLatencyUpdater&&this.timeline.isLowLatencyLive()&&(this.targetLatencyUpdater=new Pt({timeline:this.timeline,videoState:this.videoState}),this.targetLatencyUpdater.on("TargetLatencyUpdate",e=>{this.emit("TargetLatencyUpdated",e)})),this.cron.plan(this.mseFeeder,100),this.cron.plan(this.mseGc,1e4),t(this.mse.getObjectUrl())})})}setVideoTrack(e){this.timeline.setVideoTrack(e),void 0!==e&&this.handleSetTrack()}setAudioTrack(e){this.timeline.setAudioLanguage(e),void 0!==e&&this.handleSetTrack()}handleSetTrack(){var e;null==(e=this.mseGc)||e.forceRun().then(()=>{var e;null==(e=this.mseFeeder)||e.abort(),Ci||this.emit("FlushMediaPipelineRequested")}).catch(e=>{var t;!this.attached||null!=(t=this.mse)&&t.isReloading()||(0,At.L)(e)})}setTextTrack(e){this.timeline.setTextTrack(e)}getVideoTracks(){return this.timeline.getVideoTracksInfo()}getAudioTracks(){return this.timeline.getAudioTracksInfo()}getTextTracks(){return this.timeline.getTextTracksInfo()}detach(){if(!this.attached)return;this.attached=!1,this.timelineGc&&this.cron.cancel(this.timelineGc),this.manifestUpdater&&this.manifestUpdater.disable();const{duration:e,currentTime:t}=this.videoState;if(t&&t>=e){const e=this.timeline.getSeekableRange().start;this.startPosition=e/1e3}else this.startPosition=this.videoState.currentTime;this.handleSeekableUpdater(),this.handleAttachedState(),this.mseFeeder&&(this.cron.cancel(this.mseFeeder),this.mseFeeder.destroy(),this.mseFeeder=void 0),this.mseGc&&(this.cron.cancel(this.mseGc),this.mseGc=void 0),this.mse&&(this.mse.destroy(),this.mse=void 0),this.yaspWatchedTimeCollector&&(this.cron.cancel(this.yaspWatchedTimeCollector),this.yaspWatchedTimeCollector.destroy(),this.yaspWatchedTimeCollector=void 0),this.targetLatencyUpdater&&(this.targetLatencyUpdater.destroy(),this.targetLatencyUpdater=void 0)}setVideoElementSizes(e){null!=e.width||(e.width=1/0),null!=e.height||(e.height=1/0),this.abr.setVideoElementSizes(e)}destroy(){var e,t,r,i;(this.detach(),this.manifestUpdater&&(this.manifestUpdater.disable(),this.manifestUpdater=void 0),this.mseFeeder&&(this.cron.cancel(this.mseFeeder),this.mseFeeder.destroy(),this.mseFeeder=void 0),this.mseGc&&(this.cron.cancel(this.mseGc),this.mseGc=void 0),this.mse&&(this.mse.destroy(),this.mse=void 0),this.timelineFiller&&(this.cron.cancel(this.timelineFiller),this.timelineFiller.destroy(),this.timelineFiller=void 0,this.stopTimelineFillerBufferGoalAutoUpdate()),this.segmentFetcher&&(this.segmentFetcher.destroy(),this.segmentFetcher=void 0),this.timelineGc&&(this.cron.cancel(this.timelineGc),this.timelineGc=void 0),this.manifesto&&(this.manifesto.destroy(),this.manifesto=void 0),this.fetcher)&&(null==(e=this.bandwidthEstimator)||e.removeFetcher(this.fetcher),null==(t=this.fetcherProgressAccumulator)||t.removeFetcher(this.fetcher),null==(r=this.ttfbEstimator)||r.removeFetcher(this.fetcher),this.fetcher.destroy(),this.fetcher=void 0);this.fetcherProgressAccumulator&&(this.fetcherProgressAccumulator.off("NetworkTrace"),null==(i=this.bandwidthEstimator)||i.removeFetcher(this.fetcherProgressAccumulator));this.yaspWatchedTimeCollector&&(this.cron.cancel(this.yaspWatchedTimeCollector),this.yaspWatchedTimeCollector.destroy(),this.yaspWatchedTimeCollector=void 0),this.fetcherProgressAccumulator=void 0,this.timeline.destroy(),this.abr.off("AbrDecisionChange"),this.destroyed=!0,super.destroy()}getMseConfig(){const e=this.timeline.getMimeTypes(),t=e.audio[0],r=e.video[0],i={};return t&&(i.audio=t),r&&(i.video=r),i}getDebugInfo(){const e=null!==this.videoState.currentTime?1e3*this.videoState.currentTime:void 0;try{var t,r,i,n,s,a,o,l,d,c,u,h,p,f,m,g,v,y;return JSON.parse(JSON.stringify({attached:this.attached,url:this.url,videoState:this.videoState,abr:this.abr.getDebugInfo(),bandwidthEstimator:this.bandwidthEstimator.getDebugInfo(),ttfbEstimator:null!=(t=null==(r=this.ttfbEstimator)?void 0:r.getDebugInfo())?t:null,manifesto:null!=(i=null==(n=this.manifesto)?void 0:n.getDebugInfo())?i:null,manifestUpdater:null!=(s=null==(a=this.manifestUpdater)?void 0:a.getDebugInfo())?s:null,mse:null!=(o=null==(l=this.mse)?void 0:l.getDebugInfo())?o:null,mseFeeder:null!=(d=null==(c=this.mseFeeder)?void 0:c.getDebugInfo())?d:null,mseGc:null!=(u=null==(h=this.mseGc)?void 0:h.getDebugInfo())?u:null,timeline:this.timeline.getDebugInfo(e),timelineFiller:null!=(p=null==(f=this.timelineFiller)?void 0:f.getDebugInfo())?p:null,timelineGc:null!=(m=null==(g=this.timelineGc)?void 0:g.getDebugInfo())?m:null,fetcher:null!=(v=null==(y=this.fetcher)?void 0:y.getDebugInfo())?v:null,userQuality:this.callbacks.getUserQuality(),maxAutoQuality:this.callbacks.getMaxAutoQuality(),wasSegmentLoaded:this.wasSegmentLoaded,maxStartTimestamp:this.maxStartTimestamp}))}catch(E){return{attached:String(this.attached),url:String(this.url),message:"failed to serialize debug info",error:String(E),stack:String(null==E?void 0:E.stack)}}}sendEvent(e){this.emit("Event",e)}getStats(){var e;return{bandwidth:null==(e=this.bandwidthEstimator)?void 0:e.getBandwidthEstimate()}}configure(e){var t;this.bandwidthEstimator&&e.defaultBandwidthEstimate&&this.bandwidthEstimator.setDefaultEstimate(e.defaultBandwidthEstimate),this.timeline.setPresentationDelay(e.presentationDelay);const r=this.bufferGoalManager.getSkippableFragments();this.bufferGoalManager.setSkippableFragments(null!=(t=e.skippableFragments)?t:r),void 0===e.maxStartTime||this.wasSegmentLoaded||(this.maxStartTimestamp=Date.now()+1e3*e.maxStartTime),this.updateFetchersParams(e)}updateFetchersParams(e){var t,r;this.fetcherParams=function(e,t){const r={};return void 0===e.withCredentials?t:(r.credentials=e.withCredentials?"include":"omit",r)}(e,this.fetcherParams),null==(t=this.fetcher)||t.setBaseParams(this.fetcherParams),null==(r=this.manifesto)||r.setFetcherBaseParams(this.fetcherParams)}subscribeToTrackChanges(){this.timeline.on("VideoTrackChange",e=>{this.emit("VideoTrackChange",e)}),this.timeline.on("AudioLanguageChange",e=>{this.emit("AudioLanguageChange",e)}),this.timeline.on("TextTrackChange",e=>{this.emit("TextTrackChange",e)})}}class Di{constructor(){this.timesheet=[],this.started=!1,this.startTimesheetItem=e=>{clearInterval(e.intervalId),e.intervalId=self.setInterval(()=>{e.tasks.forEach(e=>{if(this.started)try{e.run()}catch(t){self.setTimeout(()=>{throw t})}})},e.interval)}}static stopTimesheetItem(e){clearInterval(e.intervalId),e.intervalId=void 0}obtainTimesheetItemByInterval(e){const t=this.timesheet.find(t=>t.interval===e);if(void 0!==t)return t;const r={interval:e,intervalId:void 0,tasks:[]};return this.started&&this.startTimesheetItem(r),this.timesheet.push(r),r}start(){this.started||(this.started=!0,this.timesheet.forEach(this.startTimesheetItem))}stop(){this.started&&(this.started=!1,this.timesheet.forEach(Di.stopTimesheetItem))}plan(e,t){const r=this.obtainTimesheetItemByInterval(t);r.tasks.includes(e)||r.tasks.push(e)}cancel(e){for(let t=0;t<this.timesheet.length;t++){const r=this.timesheet[t],i=r.tasks.indexOf(e);-1!==i&&(r.tasks.splice(i,1),0===r.tasks.length&&(Di.stopTimesheetItem(r),this.timesheet.splice(t,1),t-=1))}}destroy(){this.stop(),this.timesheet.length=0}}var Ni=r(7926),Li=r(45),Mi=r(1647),Fi=r(9951),xi=r(1771),Vi=r(3451);class Ui{constructor(e){this.config=e,this.intervalId=void 0,this.contexts=[]}attach(e){(function(e){return e.performance&&(Se(e.performance.getEntriesByType)||Se(e.performance.webkitGetEntriesByType))&&(Se(e.performance.clearResourceTimings)||Se(e.performance.webkitClearResourceTimings))})(e)&&-1===this.contexts.indexOf(e)&&(0===this.contexts.length&&(this.intervalId=setInterval(()=>this.flush(),3e4)),this.contexts.push(e))}detach(e){const t=this.contexts.indexOf(e);-1!==t&&this.contexts.splice(t,1),0===this.contexts.length&&clearInterval(this.intervalId)}destroy(){this.flush(),this.contexts.length=0,clearInterval(this.intervalId)}flush(){const e=[],t=this.contexts.map(Ae),r=Math.min(...t);this.contexts.forEach((i,n)=>{(function(e){try{var t,r;const i=null!=(t=e.performance.getEntriesByType)?t:e.performance.webkitGetEntriesByType,n=null!=(r=e.performance.clearResourceTimings)?r:e.performance.webkitClearResourceTimings,s=i.call(e.performance,"resource");return n.call(e.performance),s}catch(i){return[]}})(i).forEach(i=>{xi.j.test(i.name)&&e.push(function(e,t,r){let{duration:i,entryType:n,name:s,startTime:a,connectEnd:o,connectStart:l,decodedBodySize:d,domainLookupEnd:c,domainLookupStart:u,encodedBodySize:h,fetchStart:p,initiatorType:f,nextHopProtocol:m,redirectEnd:g,redirectStart:v,requestStart:y,responseEnd:E,responseStart:S,secureConnectionStart:A,transferSize:T,workerStart:b,serverTiming:w,responseStatus:_,deliveryType:R,renderBlockingStatus:k,firstInterimResponseStart:P}=e;return{duration:i,entryType:n,name:s,encodedBodySize:h,decodedBodySize:d,initiatorType:f,transferSize:T,nextHopProtocol:m,serverTiming:w,responseStatus:_,deliveryType:R,renderBlockingStatus:k,startTime:Ee(a,t,r),connectEnd:Ee(o,t,r),connectStart:Ee(l,t,r),domainLookupEnd:Ee(c,t,r),domainLookupStart:Ee(u,t,r),fetchStart:Ee(p,t,r),redirectEnd:Ee(g,t,r),redirectStart:Ee(v,t,r),requestStart:Ee(y,t,r),responseEnd:Ee(E,t,r),responseStart:Ee(S,t,r),secureConnectionStart:Ee(A,t,r),workerStart:Ee(b,t,r),firstInterimResponseStart:Ee(P,t,r)}}(i,t[n],r))})}),0!==e.length&&this.config.sendLog(e,{perfnow:String((0,Vi.m6)()),navstart:String(r)})}}var Bi=r(8468),Hi=r(1911),ji=r(153),Wi=r(8493);class Yi{constructor(e){this.storage=new Map,this.common={userQuality:ei.k,maxAutoQuality:ti,defaultBandwidthEstimate:{value:Wi.S,source:"default"}},this.onError=void 0,this.onError=e}checkAndClearConfigStorage(){if(this.storage.size<100)return;const e=this.storage.keys();for(let t=0;t<50;t++)this.storage.delete(e.next().value);this.onError(new Error("To many items in config storage! 100"))}updateCommonOptions(e){Object.keys(this.common).forEach(t=>{const r=e[t];void 0!==r&&(this.common[t]=r)})}add(e,t){this.storage.set(e,t),this.updateCommonOptions(t),this.checkAndClearConfigStorage()}extract(e){const t=this.storage.get(e);return this.storage.delete(e),t}getCommonOptions(){return this.common}getDebugInfo(){return Te({storage:this.storage,size:this.storage.size},this.common)}}const Gi=["objectUrl"],zi=_e;"object"!==typeof window&&(self.window=self,_e())},1665:function(e,t){var r,i,n;"undefined"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView=function(e){return null!=e&&null!=e.__proto__&&e.__proto__.__proto__===Int8Array.prototype.__proto__}),"undefined"===typeof Math.imul&&(Math.imul=function(e,t){return(4294901760&e)*(65535&t)+(65535&e)*(0|t)|0}),i=[t],void 0===(n="function"===typeof(r=function(e){"use strict";function t(e,t){if(null==t){var r=0,i=e.length-1|0;if(r<=i)do{var n=r;if(r=r+1|0,null==e[n])return n}while(r<=i)}else{var s=0,a=e.length-1|0;if(s<=a)do{var o=s;if(s=s+1|0,xe(t,e[o]))return o}while(s<=a)}return-1}function r(e,t,r,i,n,s,a){return t=t===Sr?", ":t,r=r===Sr?"":r,i=i===Sr?"":i,n=n===Sr?-1:n,s=s===Sr?"...":s,a=a===Sr?null:a,function(e,t,r,i,n,s,a,o){r=r===Sr?", ":r,i=i===Sr?"":i,n=n===Sr?"":n,s=s===Sr?-1:s,a=a===Sr?"...":a,o=o===Sr?null:o,t.a(i);var l=0,d=e.b();e:for(;d.c();){var c=d.d();if((l=l+1|0)>1&&t.a(r),!(s<0||l<=s))break e;b(t,c,o)}return s>=0&&l>s&&t.a(a),t.a(n),t}(e,de(),t,r,i,n,s,a).toString()}function i(e){return Y(e)}function n(e){return yt(e,me)?i(e):function(e,t){for(var r=e.b();r.c();){var i=r.d();t.g(i)}return t}(e,W())}function s(){}function a(){Qt=this}function o(){return null==Qt&&new a,Qt}function l(e){this.o_1=e}function d(e,t){return t===e?"(this Map)":Se(t)}function c(e,t){var r;e:{for(var i=e.q().b();i.c();){var n=i.d();if(xe(n.p(),t)){r=n;break e}}r=null}return r}function u(){Zt=this}function h(){return null==Zt&&new u,Zt}function p(e){this.v_1=e,v.call(this)}function f(){h(),this.x_1=null,this.y_1=null}function m(){Jt=this}function g(){return null==Jt&&new m,Jt}function v(){g(),s.call(this)}function y(){return null==Xt&&new E,Xt}function E(){Xt=this,this.g1_1=new ze(-1478467534,-1720727600)}function S(){$t=this}function A(e,t){this.i1_1=e,this.j1_1=t}function T(){er=this}function b(e,t,r){var i;null!=r?e.a(r(t)):null==t||"string"===typeof(i=t)||yt(i,_)?e.a(t):t instanceof pe?e.t1(t.s1_1):e.a(Se(t))}function w(e,t){this.m1_1=e,this.n1_1=t}function _(){}function R(){}function k(){}function P(){tr=this}function I(){return null==tr&&new P,tr}function C(){}function O(e){for(var t=[],r=e.b();r.c();)t.push(r.d());return t}function D(e){return 0===(t=[e]).length?W():Y(new A(t,!0));var t}function N(e){return void 0!==e.toArray?e.toArray():O(e)}function L(){s.call(this)}function M(e){this.z1_1=e,this.x1_1=0,this.y1_1=-1}function F(){L.call(this),this.a2_1=0}function x(e){this.d2_1=e}function V(e,t){this.e2_1=e,this.f2_1=t}function U(){j.call(this)}function B(e){this.i2_1=e,j.call(this)}function H(){f.call(this),this.m2_1=null,this.n2_1=null}function j(){L.call(this)}function W(){return e=Be(Ue(z)),t=[],z.call(e,t),e;var e,t}function Y(e){return function(e,t){var r;return r=N(e),z.call(t,r),t}(e,Be(Ue(z)))}function G(e,t){return o().k(t,e.e()),t}function z(e){F.call(this),this.p2_1=e,this.q2_1=!1}function q(e,t){if(function(){var e=rr;if(null!=e)return e;rr=!1;var t=[],r=0;if(r<600)do{var i=r;r=r+1|0,t.push(i)}while(r<600);t.sort(K);var n=1,s=t.length;if(n<s)do{var a=n;n=n+1|0;var o=t[a-1|0],l=t[a];if((3&o)===(3&l)&&o>=l)return!1}while(n<s);return rr=!0,!0}()){var r=(i=t,function(e,t){return i.compare(e,t)});e.sort(r)}else!function(e,t,r,i){var n,s=e.length;n=function(e,t){var r=0,i=e.length-1|0;if(r<=i)do{var n=r;r=r+1|0,e[n]=t}while(n!==i);return e}(Array(s),null);var a=function e(t,r,i,n,s){if(i===n)return t;var a=(i+n|0)/2|0,o=e(t,r,i,a,s),l=e(t,r,a+1|0,n,s),d=o===r?t:r,c=i,u=a+1|0,h=i;if(h<=n)do{var p=h;if(h=h+1|0,c<=a&&u<=n){var f=o[c],m=l[u];s.compare(f,m)<=0?(d[p]=f,c=c+1|0):(d[p]=m,u=u+1|0)}else c<=a?(d[p]=o[c],c=c+1|0):(d[p]=l[u],u=u+1|0)}while(p!==n);return d}(e,n,t,r,i);if(a!==e){var o=t;if(o<=r)do{var l=o;o=o+1|0,e[l]=a[l]}while(l!==r)}}(e,0,e.length-1|0,t);var i}function K(e,t){return(3&e)-(3&t)|0}function Q(){ir=this}function Z(e){this.u2_1=e,U.call(this)}function J(e){return function(e,t){H.call(t),X.call(t),t.a3_1=e,t.b3_1=e.d3()}(new ie((null==ir&&new Q,ir)),e),e}function X(){this.c3_1=null}function $(e,t){var r=te(e,e.n3_1.t2(t));if(null==r)return null;var i=r;if(null!=i&&Et(i))return ee(i,e,t);var n=i;return e.n3_1.s2(n.p(),t)?n:null}function ee(e,t,r){var i;e:{for(var n=e,s=0,a=n.length;s<a;){var o=n[s];if(s=s+1|0,t.n3_1.s2(o.p(),r)){i=o;break e}}i=null}return i}function te(e,t){var r=e.o3_1[t];return void 0===r?null:r}function re(e){this.m3_1=e,this.f3_1=-1,this.g3_1=Object.keys(e.o3_1),this.h3_1=-1,this.i3_1=null,this.j3_1=!1,this.k3_1=-1,this.l3_1=null}function ie(e){this.n3_1=e,this.o3_1=this.q3(),this.p3_1=0}function ne(){}function se(e){this.t3_1=e,this.r3_1=null,this.s3_1=null,this.s3_1=this.t3_1.e4_1.b4_1}function ae(e,t,r){this.j4_1=e,V.call(this,t,r),this.h4_1=null,this.i4_1=null}function oe(e){this.e4_1=e,U.call(this)}function le(){this.b4_1=null,this.d4_1=!1}function de(){return e=Be(Ue(ce)),ce.call(e,""),e;var e}function ce(e){this.k4_1=void 0!==e?e:""}function ue(e,t){return e-t|0}function he(){nr=this,this.l4_1=0,this.m4_1=65535,this.n4_1=55296,this.o4_1=56319,this.p4_1=56320,this.q4_1=57343,this.r4_1=55296,this.s4_1=57343,this.t4_1=2,this.u4_1=16}function pe(e){null==nr&&new he,this.s1_1=e}function fe(){}function me(){}function ge(){}function ve(){}function ye(){}function Ee(){}function Se(e){var t=null==e?null:Me(e);return null==t?"null":t}function Ae(e){for(var t=1,r=[],i=e,n=0,s=i.length;n<s;){var a=i[n];n=n+1|0;var o=t,l=a.prototype.$imask$,d=null==l?a.$imask$:l;null!=d&&(r.push(d),o=d.length);var c,u=a.$metadata$.iid;null==u?c=null:(p=u,f=void 0,m=void 0,g=void 0,f=new Int32Array(1+(p>>5)|0),g=1<<(31&p),f[m=p>>5]=f[m]|g,c=f);var h=c;null!=h&&(r.push(h),o=Math.max(o,h.length)),o>t&&(t=o)}var p,f,m,g;return function(e,t){for(var r=0,i=e,n=new Int32Array(i);r<i;){for(var s,a=r,o=0,l=t,d=0,c=l.length;d<c;){var u=l[d];d=d+1|0,a<u.length&&(o|=u[a])}s=o,n[a]=s,r=r+1|0}return n}(t,r)}function Te(e){return new be(e)}function be(e){this.x4_1=e,this.w4_1=0}function we(){return Ie(),sr}function _e(){return Ie(),ar}function Re(){return Ie(),or}function ke(){return Ie(),lr}function Pe(e){return Ie(),(0|e)===e?(t=e)instanceof ze?t.k5():function(e){return e>2147483647?2147483647:e<-2147483648?-2147483648:0|e}(t):(_e()[0]=e,Ar(Re()[(Ie(),dr)],31)+Re()[ke()]|0);var t}function Ie(){if(cr);else{cr=!0,sr=new ArrayBuffer(8);var e=new Float64Array(we());ar=e;new Float32Array(we());var t,r=new Int32Array(we());or=r,_e()[0]=-1,t=0!==Re()[0]?1:0,lr=t,dr=1-ke()|0}}function Ce(e){return Me(e)}function Oe(e,t){var r;switch(typeof e){case"number":r="number"===typeof t?De(e,t):t instanceof ze?De(e,t.a5()):Ne(e,t);break;case"string":case"boolean":r=Ne(e,t);break;default:r=function(e,t){return e.u1(t)}(e,t)}return r}function De(e,t){var r;if(e<t)r=-1;else if(e>t)r=1;else if(e===t){var i;if(0!==e)i=0;else{var n=1/e;i=n===1/t?0:n<0?-1:1}r=i}else r=e!==e?t!==t?0:1:-1;return r}function Ne(e,t){return e<t?-1:e>t?1:0}function Le(e){if(!("kotlinHashCodeValue$"in e)){var t=0|4294967296*Math.random(),r=new Object;r.value=t,r.enumerable=!1,Object.defineProperty(e,"kotlinHashCodeValue$",r)}return e.kotlinHashCodeValue$}function Me(e){return null==e?"null":function(e){return!!gt(e)||Tr(e)}(e)?"[...]":e.toString()}function Fe(e){if(null==e)return 0;var t;switch(typeof e){case"object":t="function"===typeof e.hashCode?e.hashCode():Le(e);break;case"function":t=Le(e);break;case"number":t=Pe(e);break;case"boolean":t=e?1:0;break;default:t=function(e){var t=0,r=e.length,i=0,n=r-1|0;if(i<=n)do{var s=i;i=i+1|0;var a=e.charCodeAt(s);t=Ar(t,31)+a|0}while(s!==n);return t}(String(e))}return t}function xe(e,t){if(null==e)return null==t;if(null==t)return!1;if("object"===typeof e&&"function"===typeof e.equals)return e.equals(t);if(e!==e)return t!==t;if("number"===typeof e&&"number"===typeof t){var r;if(e===t)r=0!==e||1/e===1/t;else r=!1;return r}return e===t}function Ve(e,t){null!=Error.captureStackTrace?Error.captureStackTrace(e,t):e.stack=(new Error).stack}function Ue(e){return e.prototype}function Be(e){return Object.create(e)}function He(e,t,r){Error.call(e),function(e,t,r){if(!je(e,"message")){var i;if(null==t){var n;if(null!==t){var s=r,a=null==s?null:s.toString();n=null==a?Sr:a}else n=Sr;i=n}else i=t;e.message=i}je(e,"cause")||(e.cause=r),e.name=Object.getPrototypeOf(e).constructor.name}(e,t,r)}function je(e,t){return Object.getPrototypeOf(e).hasOwnProperty(t)}function We(e){var t;return null==e?function(){throw Wt()}():t=e,t}function Ye(){throw Gt()}function Ge(){ur=this,this.b5_1=new ze(0,-2147483648),this.c5_1=new ze(-1,2147483647),this.d5_1=8,this.e5_1=64}function ze(e,t){null==ur&&new Ge,k.call(this),this.y4_1=e,this.z4_1=t}function qe(){return pt(),hr}function Ke(){return pt(),pr}function Qe(){return pt(),fr}function Ze(){return pt(),gr}function Je(){return pt(),vr}function Xe(e,t){if(pt(),it(e,t))return 0;var r=st(e),i=st(t);return r&&!i?-1:!r&&i?1:st(et(e,t))?-1:1}function $e(e,t){pt();var r=e.z4_1>>>16|0,i=65535&e.z4_1,n=e.y4_1>>>16|0,s=65535&e.y4_1,a=t.z4_1>>>16|0,o=65535&t.z4_1,l=t.y4_1>>>16|0,d=0,c=0,u=0,h=0;return d=(d=d+((c=(c=c+((u=(u=u+((h=h+(s+(65535&t.y4_1)|0)|0)>>>16|0)|0)+(n+l|0)|0)>>>16|0)|0)+(i+o|0)|0)>>>16|0)|0)+(r+a|0)|0,new ze((u&=65535)<<16|(h&=65535),(d&=65535)<<16|(c&=65535))}function et(e,t){return pt(),$e(e,t.i5())}function tt(e,t){if(pt(),at(e))return qe();if(at(t))return qe();if(it(e,Ze()))return ot(t)?Ze():qe();if(it(t,Ze()))return ot(e)?Ze():qe();if(st(e))return st(t)?tt(lt(e),lt(t)):lt(tt(lt(e),t));if(st(t))return lt(tt(e,lt(t)));if(dt(e,Je())&&dt(t,Je()))return ct(rt(e)*rt(t));var r=e.z4_1>>>16|0,i=65535&e.z4_1,n=e.y4_1>>>16|0,s=65535&e.y4_1,a=t.z4_1>>>16|0,o=65535&t.z4_1,l=t.y4_1>>>16|0,d=65535&t.y4_1,c=0,u=0,h=0,p=0;return h=h+((p=p+Ar(s,d)|0)>>>16|0)|0,p&=65535,u=(u=u+((h=h+Ar(n,d)|0)>>>16|0)|0)+((h=(h&=65535)+Ar(s,l)|0)>>>16|0)|0,h&=65535,c=(c=(c=c+((u=u+Ar(i,d)|0)>>>16|0)|0)+((u=(u&=65535)+Ar(n,l)|0)>>>16|0)|0)+((u=(u&=65535)+Ar(s,o)|0)>>>16|0)|0,u&=65535,c=c+(((Ar(r,d)+Ar(i,l)|0)+Ar(n,o)|0)+Ar(s,a)|0)|0,new ze(h<<16|p,(c&=65535)<<16|u)}function rt(e){return pt(),4294967296*e.z4_1+function(e){return pt(),e.y4_1>=0?e.y4_1:4294967296+e.y4_1}(e)}function it(e,t){return pt(),e.z4_1===t.z4_1&&e.y4_1===t.y4_1}function nt(e){return pt(),new ze(e,e<0?-1:0)}function st(e){return pt(),e.z4_1<0}function at(e){return pt(),0===e.z4_1&&0===e.y4_1}function ot(e){return pt(),1===(1&e.y4_1)}function lt(e){return pt(),e.i5()}function dt(e,t){return pt(),Xe(e,t)<0}function ct(e){return pt(),(t=e)!==t?qe():e<=-0x8000000000000000?Ze():e+1>=0x8000000000000000?(pt(),mr):e<0?lt(ct(-e)):new ze(0|e%4294967296,0|e/4294967296);var t}function ut(e,t){return pt(),Xe(e,t)>0}function ht(e,t){return pt(),Xe(e,t)>=0}function pt(){yr||(yr=!0,hr=nt(0),pr=nt(1),fr=nt(-1),mr=new ze(-1,2147483647),gr=new ze(0,-2147483648),vr=nt(16777216))}function ft(e,t,r,i){return mt("class",e,t,r,i,null)}function mt(e,t,r,i,n,s){return{kind:e,simpleName:t,associatedObjectKey:r,associatedObjects:i,suspendArity:n,$kClass$:Sr,iid:s}}function gt(e){return Array.isArray(e)}function vt(e,t,r,i,n,s,a,o){null!=i&&(e.prototype=Object.create(i.prototype),e.prototype.constructor=e);var l=r(t,s,a,null==o?[]:o);e.$metadata$=l,null!=n&&((null!=l.iid?e:e.prototype).$imask$=Ae(n))}function yt(e,t){return function(e,t){var r=e.$imask$,i=r;return null!=i&&function(e,t){var r=t>>5;if(r>e.length)return!1;var i=1<<(31&t);return!(0===(e[r]&i))}(i,t)}(e,t.$metadata$.iid)}function Et(e){return!!gt(e)&&!e.$type$}function St(e){var t;switch(typeof e){case"string":case"number":case"boolean":case"function":t=!0;break;default:t=e instanceof Object}return t}function At(e){var t,r=typeof e;return"string"===r||"boolean"===r||"number"===typeof(t=e)||t instanceof ze||yt(e,R)}function Tt(e,t,r,i){return mt("interface",e,t,r,i,function(){null==Er&&(Er=0);var e=bt();Er=e+1|0;var t=bt();return t}())}function bt(){if(null!=Er)return Er;!function(e){throw qt("lateinit property "+e+" has not been initialized")}("iid")}function wt(e,t,r,i){return mt("object",e,t,r,i,null)}function _t(e){var t=function(e,t){return Mt(e,t),Rt.call(t),t}(e,Be(Ue(Rt)));return Ve(t,_t),t}function Rt(){Ve(this,Rt)}function kt(e){var t=function(e,t){return Mt(e,t),Pt.call(t),t}(e,Be(Ue(Pt)));return Ve(t,kt),t}function Pt(){Ve(this,Pt)}function It(e){var t=function(e,t){return Mt(e,t),Ct.call(t),t}(e,Be(Ue(Ct)));return Ve(t,It),t}function Ct(){Ve(this,Ct)}function Ot(e,t){return He(t,e),Nt.call(t),t}function Dt(e){var t=Ot(e,Be(Ue(Nt)));return Ve(t,Dt),t}function Nt(){Ve(this,Nt)}function Lt(e){return function(e){He(e),Nt.call(e)}(e),Ft.call(e),e}function Mt(e,t){return Ot(e,t),Ft.call(t),t}function Ft(){Ve(this,Ft)}function xt(){var e,t=(Lt(e=Be(Ue(Ut))),Ut.call(e),e);return Ve(t,xt),t}function Vt(e){var t=function(e,t){return Mt(e,t),Ut.call(t),t}(e,Be(Ue(Ut)));return Ve(t,Vt),t}function Ut(){Ve(this,Ut)}function Bt(){var e,t=(Lt(e=Be(Ue(jt))),jt.call(e),e);return Ve(t,Bt),t}function Ht(e){var t=function(e,t){return Mt(e,t),jt.call(t),t}(e,Be(Ue(jt)));return Ve(t,Ht),t}function jt(){Ve(this,jt)}function Wt(){var e,t=(Lt(e=Be(Ue(Yt))),Yt.call(e),e);return Ve(t,Wt),t}function Yt(){Ve(this,Yt)}function Gt(){var e,t=(Lt(e=Be(Ue(zt))),zt.call(e),e);return Ve(t,Gt),t}function zt(){Ve(this,zt)}function qt(e){var t=function(e,t){return Mt(e,t),Kt.call(t),t}(e,Be(Ue(Kt)));return Ve(t,qt),t}function Kt(){Ve(this,Kt)}var Qt,Zt,Jt,Xt,$t,er,tr,rr,ir,nr,sr,ar,or,lr,dr,cr,ur,hr,pr,fr,mr,gr,vr,yr,Er,Sr,Ar=Math.imul,Tr=ArrayBuffer.isView;return vt(me,"Collection",Tt),vt(s,"AbstractCollection",ft,Sr,[me]),vt(a,"Companion",wt),vt(l,Sr,ft),vt(u,"Companion",wt),vt(Ee,"Set",Tt,Sr,[me]),vt(v,"AbstractSet",ft,s,[s,Ee]),vt(p,Sr,ft,v),vt(ve,"Map",Tt),vt(f,"AbstractMap",ft,Sr,[ve]),vt(m,"Companion",wt),vt(fe,"List",Tt,Sr,[me]),vt(E,"EmptyList",wt,Sr,[fe]),vt(S,"EmptyIterator",wt),vt(A,"ArrayAsCollection",ft,Sr,[me]),vt(C,"Comparator",Tt),vt(T,"ReverseOrderComparator",wt,Sr,[C]),vt(w,"Pair",ft),vt(_,"CharSequence",Tt),vt(R,"Comparable",Tt),vt(k,"Number",ft),vt(P,"Unit",wt),vt(L,"AbstractMutableCollection",ft,s,[s,me]),vt(M,"IteratorImpl",ft),vt(F,"AbstractMutableList",ft,L,[L,fe,me]),vt(x,Sr,ft),vt(ge,"Entry",Tt),vt(ye,"MutableEntry",Tt,Sr,[ge]),vt(V,"SimpleEntry",ft,Sr,[ye]),vt(j,"AbstractMutableSet",ft,L,[L,Ee,me]),vt(U,"AbstractEntrySet",ft,j),vt(B,Sr,ft,j),vt(H,"AbstractMutableMap",ft,f,[f,ve]),vt(z,"ArrayList",ft,F,[F,fe,me]),vt(Q,"HashCode",wt),vt(Z,"EntrySet",ft,U),vt(X,"HashMap",ft,H,[H,ve]),vt(re,Sr,ft),vt(ne,"InternalMap",Tt),vt(ie,"InternalHashCodeMap",ft,Sr,[ne]),vt(se,"EntryIterator",ft),vt(ae,"ChainEntry",ft,V),vt(oe,"EntrySet",ft,U),vt(le,"LinkedHashMap",ft,X,[X,ve]),vt(ce,"StringBuilder",ft,Sr,[_]),vt(he,"Companion",wt),vt(pe,"Char",ft,Sr,[R]),vt(be,Sr,ft),vt(Ge,"Companion",wt),vt(ze,"Long",ft,k,[k,R]),vt(Nt,"Exception",ft,Error),vt(Ft,"RuntimeException",ft,Nt),vt(Rt,"IllegalArgumentException",ft,Ft),vt(Pt,"IndexOutOfBoundsException",ft,Ft),vt(Ct,"IllegalStateException",ft,Ft),vt(Ut,"NoSuchElementException",ft,Ft),vt(jt,"UnsupportedOperationException",ft,Ft),vt(Yt,"NullPointerException",ft,Ft),vt(zt,"ClassCastException",ft,Ft),vt(Kt,"UninitializedPropertyAccessException",ft,Ft),Ue(s).h=function(e){var t;e:if(yt(this,me)&&this.i())t=!1;else{for(var r=this.b();r.c();)if(xe(r.d(),e)){t=!0;break e}t=!1}return t},Ue(s).j=function(e){var t;e:if(yt(e,me)&&e.i())t=!0;else{for(var r=e.b();r.c();){var i=r.d();if(!this.h(i)){t=!1;break e}}t=!0}return t},Ue(s).i=function(){return 0===this.e()},Ue(s).toString=function(){return r(this,", ","[","]",Sr,Sr,(e=this,function(t){return t===e?"(this Collection)":Se(t)}));var e},Ue(s).toArray=function(){return O(this)},Ue(a).k=function(e,t){if(e<0||e>=t)throw kt("index: "+e+", size: "+t)},Ue(a).l=function(e,t){if(e<0||e>t)throw kt("index: "+e+", size: "+t)},Ue(a).m=function(e){for(var t=1,r=e.b();r.c();){var i=r.d(),n=Ar(31,t),s=null==i?null:Fe(i);t=n+(null==s?0:s)|0}return t},Ue(a).n=function(e,t){if(e.e()!==t.e())return!1;for(var r=t.b(),i=e.b();i.c();)if(!xe(i.d(),r.d()))return!1;return!0},Ue(l).c=function(){return this.o_1.c()},Ue(l).d=function(){return this.o_1.d().p()},Ue(u).r=function(e){var t=e.p(),r=null==t?null:Fe(t),i=null==r?0:r,n=e.s(),s=null==n?null:Fe(n);return i^(null==s?0:s)},Ue(u).t=function(e){return Se(e.p())+"="+Se(e.s())},Ue(u).u=function(e,t){return!(null==t||!yt(t,ge))&&!!xe(e.p(),t.p())&&xe(e.s(),t.s())},Ue(p).w=function(e){return this.v_1.z(e)},Ue(p).h=function(e){return!(null!=e&&!St(e))&&this.w(null==e||St(e)?e:Ye())},Ue(p).b=function(){return new l(this.v_1.q().b())},Ue(p).e=function(){return this.v_1.e()},Ue(f).z=function(e){return!(null==c(this,e))},Ue(f).b1=function(e){if(null==e||!yt(e,ge))return!1;var t=e.p(),r=e.s(),i=(yt(this,ve)?this:Ye()).c1(t);return!!xe(r,i)&&!(null==i&&!(yt(this,ve)?this:Ye()).z(t))},Ue(f).equals=function(e){if(e===this)return!0;if(null==e||!yt(e,ve))return!1;if(this.e()!==e.e())return!1;var t;e:{var r=e.q();if(yt(r,me)&&r.i())t=!0;else{for(var i=r.b();i.c();){var n=i.d();if(!this.b1(n)){t=!1;break e}}t=!0}}return t},Ue(f).c1=function(e){var t=c(this,e);return null==t?null:t.s()},Ue(f).hashCode=function(){return Fe(this.q())},Ue(f).e=function(){return this.q().e()},Ue(f).d1=function(){return null==this.x_1&&(this.x_1=new p(this)),We(this.x_1)},Ue(f).toString=function(){var e;return r(this.q(),", ","{","}",Sr,Sr,(e=this,function(t){return e.a1(t)}))},Ue(f).a1=function(e){return d(this,e.p())+"="+d(this,e.s())},Ue(m).e1=function(e){for(var t=0,r=e.b();r.c();){var i=r.d(),n=t,s=null==i?null:Fe(i);t=n+(null==s?0:s)|0}return t},Ue(m).f1=function(e,t){return e.e()===t.e()&&e.j(t)},Ue(v).equals=function(e){return e===this||!(null==e||!yt(e,Ee))&&g().f1(this,e)},Ue(v).hashCode=function(){return g().e1(this)},Ue(E).equals=function(e){return!(null==e||!yt(e,fe))&&e.i()},Ue(E).hashCode=function(){return 1},Ue(E).toString=function(){return"[]"},Ue(E).e=function(){return 0},Ue(E).i=function(){return!0},Ue(E).h1=function(e){return e.i()},Ue(E).j=function(e){return this.h1(e)},Ue(E).f=function(e){throw kt("Empty list doesn't contain element at index "+e+".")},Ue(E).b=function(){return null==$t&&new S,$t},Ue(S).c=function(){return!1},Ue(S).d=function(){throw xt()},Ue(A).e=function(){return this.i1_1.length},Ue(A).i=function(){return 0===this.i1_1.length},Ue(A).k1=function(e){return function(e,r){return t(e,r)>=0}(this.i1_1,e)},Ue(A).l1=function(e){var t;e:if(yt(e,me)&&e.i())t=!0;else{for(var r=e.b();r.c();){var i=r.d();if(!this.k1(i)){t=!1;break e}}t=!0}return t},Ue(A).j=function(e){return this.l1(e)},Ue(A).b=function(){return Te(this.i1_1)},Ue(T).r1=function(e,t){return Oe(t,e)},Ue(T).compare=function(e,t){var r=null!=e&&At(e)?e:Ye();return this.r1(r,null!=t&&At(t)?t:Ye())},Ue(w).toString=function(){return"("+this.m1_1+", "+this.n1_1+")"},Ue(w).o1=function(){return this.m1_1},Ue(w).p1=function(){return this.n1_1},Ue(w).hashCode=function(){var e=null==this.m1_1?0:Fe(this.m1_1);return e=Ar(e,31)+(null==this.n1_1?0:Fe(this.n1_1))|0},Ue(w).equals=function(e){if(this===e)return!0;if(!(e instanceof w))return!1;var t=e instanceof w?e:Ye();return!!xe(this.m1_1,t.m1_1)&&!!xe(this.n1_1,t.n1_1)},Ue(P).toString=function(){return"kotlin.Unit"},Ue(L).toJSON=function(){return this.toArray()},Ue(L).w1=function(){},Ue(M).c=function(){return this.x1_1<this.z1_1.e()},Ue(M).d=function(){if(!this.c())throw xt();var e=this.x1_1;return this.x1_1=e+1|0,this.y1_1=e,this.z1_1.f(this.y1_1)},Ue(F).g=function(e){return this.w1(),this.b2(this.e(),e),!0},Ue(F).b=function(){return new M(this)},Ue(F).h=function(e){return this.c2(e)>=0},Ue(F).c2=function(e){var t=0,r=this.e()-1|0;if(t<=r)do{var i=t;if(t=t+1|0,xe(this.f(i),e))return i}while(i!==r);return-1},Ue(F).equals=function(e){return e===this||!(null==e||!yt(e,fe))&&o().n(this,e)},Ue(F).hashCode=function(){return o().m(this)},Ue(x).c=function(){return this.d2_1.c()},Ue(x).d=function(){return this.d2_1.d().p()},Ue(V).p=function(){return this.e2_1},Ue(V).s=function(){return this.f2_1},Ue(V).g2=function(e){var t=this.f2_1;return this.f2_1=e,t},Ue(V).hashCode=function(){return h().r(this)},Ue(V).toString=function(){return h().t(this)},Ue(V).equals=function(e){return h().u(this,e)},Ue(U).h=function(e){return this.h2(e)},Ue(B).j2=function(e){throw Ht("Add is not supported on keys")},Ue(B).g=function(e){return this.j2(null==e||St(e)?e:Ye())},Ue(B).w=function(e){return this.i2_1.z(e)},Ue(B).h=function(e){return!(null!=e&&!St(e))&&this.w(null==e||St(e)?e:Ye())},Ue(B).b=function(){return new x(this.i2_1.q().b())},Ue(B).e=function(){return this.i2_1.e()},Ue(H).d1=function(){return null==this.m2_1&&(this.m2_1=new B(this)),We(this.m2_1)},Ue(j).equals=function(e){return e===this||!(null==e||!yt(e,Ee))&&g().f1(this,e)},Ue(j).hashCode=function(){return g().e1(this)},Ue(z).e=function(){return this.p2_1.length},Ue(z).f=function(e){var t=this.p2_1[G(this,e)];return null==t||St(t)?t:Ye()},Ue(z).v1=function(e,t){this.w1(),G(this,e);var r=this.p2_1[e];this.p2_1[e]=t;var i=r;return null==i||St(i)?i:Ye()},Ue(z).g=function(e){this.w1(),this.p2_1.push(e);var t=this.a2_1;return this.a2_1=t+1|0,!0},Ue(z).b2=function(e,t){this.w1(),this.p2_1.splice(function(e,t){return o().l(t,e.e()),t}(this,e),0,t);var r=this.a2_1;this.a2_1=r+1|0},Ue(z).c2=function(e){return t(this.p2_1,e)},Ue(z).toString=function(){return e=this.p2_1,t=(t=", ")===Sr?", ":t,r=(r="[")===Sr?"":r,i=(i="]")===Sr?"":i,n=(n=Sr)===Sr?-1:n,s=(s=Sr)===Sr?"...":s,a=(a=Ce)===Sr?null:a,function(e,t,r,i,n,s,a,o){r=r===Sr?", ":r,i=i===Sr?"":i,n=n===Sr?"":n,s=s===Sr?-1:s,a=a===Sr?"...":a,o=o===Sr?null:o,t.a(i);var l=0,d=e,c=0,u=d.length;e:for(;c<u;){var h=d[c];if(c=c+1|0,(l=l+1|0)>1&&t.a(r),!(s<0||l<=s))break e;b(t,h,o)}return s>=0&&l>s&&t.a(a),t.a(n),t}(e,de(),t,r,i,n,s,a).toString();var e,t,r,i,n,s,a},Ue(z).r2=function(){return[].slice.call(this.p2_1)},Ue(z).toArray=function(){return this.r2()},Ue(z).w1=function(){if(this.q2_1)throw Bt()},Ue(Q).s2=function(e,t){return xe(e,t)},Ue(Q).t2=function(e){var t=null==e?null:Fe(e);return null==t?0:t},Ue(Z).v2=function(e){throw Ht("Add is not supported on entries")},Ue(Z).g=function(e){return this.v2(null!=e&&yt(e,ye)?e:Ye())},Ue(Z).h2=function(e){return this.u2_1.b1(e)},Ue(Z).b=function(){return this.u2_1.a3_1.b()},Ue(Z).e=function(){return this.u2_1.e()},Ue(X).z=function(e){return this.a3_1.w(e)},Ue(X).q=function(){return null==this.c3_1&&(this.c3_1=this.e3()),We(this.c3_1)},Ue(X).e3=function(){return new Z(this)},Ue(X).c1=function(e){return this.a3_1.c1(e)},Ue(X).q1=function(e,t){return this.a3_1.q1(e,t)},Ue(X).e=function(){return this.a3_1.e()},Ue(re).c=function(){return-1===this.f3_1&&(this.f3_1=function(e){if(null!=e.i3_1&&e.j3_1){var t=e.i3_1,r=t.length,i=e;if(i.k3_1=i.k3_1+1|0,i.k3_1<r)return 0}var n=e;if(n.h3_1=n.h3_1+1|0,n.h3_1<e.g3_1.length){e.i3_1=e.m3_1.o3_1[e.g3_1[e.h3_1]];var s=e,a=e.i3_1;return s.j3_1=null!=a&&Et(a),e.k3_1=0,0}return e.i3_1=null,1}(this)),0===this.f3_1},Ue(re).d=function(){if(!this.c())throw xt();var e=this.j3_1?this.i3_1[this.k3_1]:this.i3_1;return this.l3_1=e,this.f3_1=-1,e},Ue(ie).d3=function(){return this.n3_1},Ue(ie).e=function(){return this.p3_1},Ue(ie).q1=function(e,t){var r=this.n3_1.t2(e),i=te(this,r);if(null==i)this.o3_1[r]=new V(e,t);else{if(null==i||!Et(i)){var n,s=i;if(this.n3_1.s2(s.p(),e))return s.g2(t);n=[s,new V(e,t)],this.o3_1[r]=n;var a=this.p3_1;return this.p3_1=a+1|0,null}var o=i,l=ee(o,this,e);if(null!=l)return l.g2(t);o.push(new V(e,t))}var d=this.p3_1;return this.p3_1=d+1|0,null},Ue(ie).w=function(e){return!(null==$(this,e))},Ue(ie).c1=function(e){var t=$(this,e);return null==t?null:t.s()},Ue(ie).b=function(){return new re(this)},Ue(se).c=function(){return!(null===this.s3_1)},Ue(se).d=function(){if(!this.c())throw xt();var e=We(this.s3_1);this.r3_1=e;var t,r=e.h4_1;return t=r!==this.t3_1.e4_1.b4_1?r:null,this.s3_1=t,e},Ue(ae).g2=function(e){return this.j4_1.w1(),Ue(V).g2.call(this,e)},Ue(oe).v2=function(e){throw Ht("Add is not supported on entries")},Ue(oe).g=function(e){return this.v2(null!=e&&yt(e,ye)?e:Ye())},Ue(oe).h2=function(e){return this.e4_1.b1(e)},Ue(oe).b=function(){return new se(this)},Ue(oe).e=function(){return this.e4_1.e()},Ue(le).z=function(e){return this.c4_1.z(e)},Ue(le).e3=function(){return new oe(this)},Ue(le).c1=function(e){var t=this.c4_1.c1(e);return null==t?null:t.s()},Ue(le).q1=function(e,t){this.w1();var r=this.c4_1.c1(e);if(null==r){var i=new ae(this,e,t);return this.c4_1.q1(e,i),function(e,t){if(null!=e.h4_1||null!=e.i4_1)throw It(Me("Check failed."));var r=t.b4_1;if(null==r)t.b4_1=e,e.h4_1=e,e.i4_1=e;else{var i=r.i4_1;if(null==i)throw It(Me("Required value was null."));var n=i;e.i4_1=n,e.h4_1=r,r.i4_1=e,n.h4_1=e}}(i,this),null}return r.g2(t)},Ue(le).e=function(){return this.c4_1.e()},Ue(le).w1=function(){if(this.d4_1)throw Bt()},Ue(ce).t1=function(e){return this.k4_1=this.k4_1+new pe(e),this},Ue(ce).a=function(e){return this.k4_1=this.k4_1+Se(e),this},Ue(ce).toString=function(){return this.k4_1},Ue(pe).v4=function(e){return ue(this.s1_1,e)},Ue(pe).u1=function(e){return function(e,t){return ue(e.s1_1,t instanceof pe?t.s1_1:Ye())}(this,e)},Ue(pe).equals=function(e){return function(e,t){return t instanceof pe&&e===t.s1_1}(this.s1_1,e)},Ue(pe).hashCode=function(){return this.s1_1},Ue(pe).toString=function(){return e=this.s1_1,String.fromCharCode(e);var e},Ue(be).c=function(){return!(this.w4_1===this.x4_1.length)},Ue(be).d=function(){if(this.w4_1===this.x4_1.length)throw Vt(""+this.w4_1);var e=this.w4_1;return this.w4_1=e+1|0,this.x4_1[e]},Ue(ze).f5=function(e){return Xe(this,e)},Ue(ze).u1=function(e){return this.f5(e instanceof ze?e:Ye())},Ue(ze).g5=function(e){return $e(this,e)},Ue(ze).h5=function(e){return function(e,t){if(pt(),at(t))throw Dt("division by zero");if(at(e))return qe();if(it(e,Ze())){if(it(t,Ke())||it(t,Qe()))return Ze();if(it(t,Ze()))return Ke();var r=function(e,t){pt();var r=63&t;return 0===r?e:r<32?new ze(e.y4_1<<r,e.z4_1<<r|e.y4_1>>>(32-r|0)|0):new ze(0,e.y4_1<<(r-32|0))}(function(e,t){pt();var r=63&t;return 0===r?e:r<32?new ze(e.y4_1>>>r|0|e.z4_1<<(32-r|0),e.z4_1>>r):new ze(e.z4_1>>(r-32|0),e.z4_1>=0?0:-1)}(e,1).h5(t),1);if(it(r,qe()))return st(t)?Ke():Qe();var i=et(e,tt(t,r));return $e(r,i.h5(t))}if(it(t,Ze()))return qe();if(st(e))return st(t)?lt(e).h5(lt(t)):lt(lt(e).h5(t));if(st(t))return lt(e.h5(lt(t)));for(var n=qe(),s=e;ht(s,t);){for(var a=rt(s)/rt(t),o=Math.max(1,Math.floor(a)),l=Math.ceil(Math.log(o)/Math.LN2),d=l<=48?1:Math.pow(2,l-48),c=ct(o),u=tt(c,t);st(u)||ut(u,s);)c=ct(o-=d),u=tt(c,t);at(c)&&(c=Ke()),n=$e(n,c),s=et(s,u)}return n}(this,e)},Ue(ze).i5=function(){return this.j5().g5(new ze(1,0))},Ue(ze).j5=function(){return new ze(~this.y4_1,~this.z4_1)},Ue(ze).k5=function(){return this.y4_1},Ue(ze).a5=function(){return rt(this)},Ue(ze).valueOf=function(){return this.a5()},Ue(ze).equals=function(e){return e instanceof ze&&it(this,e)},Ue(ze).hashCode=function(){return e=this,pt(),e.y4_1^e.z4_1;var e},Ue(ze).toString=function(){return function e(t,r){if(pt(),r<2||36<r)throw Dt("radix out of range: "+r);if(at(t))return"0";if(st(t)){if(it(t,Ze())){var i=nt(r),n=t.h5(i),s=et(tt(n,i),t).k5(),a=e(n,r),o=s.toString(r);return a+o}return"-"+e(lt(t),r)}for(var l=2===r?31:r<=10?9:r<=21?7:r<=35?6:5,d=ct(Math.pow(r,l)),c=t,u="";;){var h=c.h5(d),p=et(c,tt(h,d)).k5(),f=p.toString(r),m=f;if(at(c=h))return m+u;for(;m.length<l;)m="0"+m;u=m+u}}(this,10)},Ue(ie).q3=function(){var e=Object.create(null);return e.foo=1,delete e.foo,I(),e},rr=null,e.$_$=e.$_$||{},e.$_$.a=W,e.$_$.b=function(){return J(e=Be(Ue(le))),le.call(e),e.c4_1=J(Be(Ue(X))),e;var e},e.$_$.c=I,e.$_$.d=function(e){return i=(t=[e]).length,function(e,t){for(var r=t,i=0,n=r.length;i<n;){var s=r[i];i=i+1|0;var a=s.o1(),o=s.p1();e.q1(a,o)}}(r=function(e,t){return function(e,t,r){if(J(r),!(e>=0))throw _t(Me("Negative initial capacity: "+e));if(!(t>=0))throw _t(Me("Non-positive load factor: "+t))}(e,0,t),t}(i,Be(Ue(X))),t),r;var t,r,i},e.$_$.e=function(e){return function(e,t){if(yt(e,me)){if(e.e()<=1)return function(e){if(yt(e,me)){var t;switch(e.e()){case 0:t=y();break;case 1:var r;r=yt(e,fe)?e.f(0):e.b().d(),t=D(r);break;default:t=i(e)}return t}return function(e){switch(e.e()){case 0:return y();case 1:return D(e.f(0));default:return e}}(n(e))}(e);var r=N(e),s=Et(r)?r:Ye();return function(e,t){e.length>1&&q(e,t)}(s,t),function(e){return new z(e)}(s)}var a=n(e);return function(e,t){!function(e,t){if(e.e()<=1)return I();var r=N(e);q(r,t);var i=0,n=r.length;if(i<n)do{var s=i;i=i+1|0,e.v1(s,r[s])}while(i<n)}(e,t)}(a,t),a}(e,(null==er&&new T,yt(t=er,C)?t:Ye()));var t},e.$_$.f=Te,e.$_$.g=ft,e.$_$.h=Oe,e.$_$.i=Tt,e.$_$.j=wt,e.$_$.k=Ue,e.$_$.l=vt,e.$_$.m=function(e,t){return new w(e,t)},e.$_$.n=Sr,e})?r.apply(t,i):r)||(e.exports=n)},6114:function(e,t,r){var i,n,s;n=[t,r(1665)],void 0===(s="function"===typeof(i=function(e,t){"use strict";function r(e,t){return e=e===M?null:e,this.b6(e)}function i(){A=this,this.r5_1=(new y).getValue()}function n(){return null==A&&new i,A}function s(e){n(),this.n5_1=e;var t=this.n5_1;this.o5_1=null==t?null:t.flags;var r=this.n5_1;this.p5_1=new g(null==r?null:r.skippableFragments),this.q5_1=function(e){var t,r=e.n5_1;if(null!=(null==r?null:r.rules)){for(var i=O(),n=e.n5_1.rules,s=D(n);s.c();){var a=s.d(),o=a.priority,l=a.rules;i.q1(o,l)}t=i}else{var d=[e.p5_1,new v];t=C(I(0,d))}return t}(this)}function a(e,t,r){this.disableDynamicBuffer=e,this.lowBufferBeforeStart=t,this.defaultBuffer=r}function o(e,t,r){this.skippableFragments=e,this.flags=t,this.rules=r}function l(){}function d(e,t,r){r=r!==M&&r,this.startTime=e,this.endTime=t,this.autoSkip=r}function c(e,t,r){this.watchedTime=e,this.currentTime=t,this.flags=r}function u(){return T}function h(e){e=e===M?null:e,this.h6_1=e}function p(e){e=e===M?null:e,this.i6_1=e}function f(e,t){this.watchedTime=e,this.currentTime=t}function m(e,t){this.priority=e,this.rules=t}function g(e){e=e===M?null:e,this.s5_1=e}function v(){}function y(e){e=e===M?null:e,this.k6_1=e}function E(e){e=e===M?null:e,this.l6_1=e}function S(e){e=e===M?null:e,this.m6_1=e}var A,T,b,w,_,R,k,P=t.$_$.c,I=t.$_$.m,C=t.$_$.d,O=t.$_$.b,D=t.$_$.f,N=t.$_$.k,L=t.$_$.j,M=t.$_$.n,F=t.$_$.l,x=t.$_$.g,V=t.$_$.e,U=t.$_$.a,B=t.$_$.h,H=t.$_$.i;return F(i,"Companion",L),F(s,"BufferGoalManager",x),F(a,"BufferGoalManagerFlags",x),F(o,"BufferGoalManagerProps",x),F(l,"BufferGoalRule",H),F(d,"SkippableFragment",x),F(c,"BufferGoalRuleProps",x),F(h,"WatchedTime",x),F(p,"CurrentTime",x),F(f,"GetBufferGoalProps",x),F(m,"Rules",x),F(g,"SkippableFragmentsRule",x,M,[l]),F(v,"WatchedTimeRule",x,M,[l]),F(y,"DefaultBuffer",x),F(E,"DisableDynamicBuffer",x),F(S,"LowBufferBeforeStart",x),N(s).getBufferGoal=function(e){var t=this.o5_1,r=null==t?null:t.defaultBuffer,i=null==r?null:r.getValue(),s=null==i?n().r5_1:i,a=this.o5_1,o=null==a?null:a.disableDynamicBuffer;if(!0===(null==o?null:o.getValue()))return s;var l=null==e?null:e.watchedTime,d=null==l?null:l.getValue(),u=null==e?null:e.currentTime,h=new c(d,null==u?null:u.getValue(),this.o5_1),p=function(e,t){for(var r=V(e.d1()).b();r.c();){var i,n=r.d(),s=e.c1(n);if(null==s)i=null;else{for(var a=U(),o=D(s);o.c();){var l=o.d(),d=l.getBufferGoal(t);null==d||(a.g(d),P())}i=a}var c,u=i;if(null==u)c=null;else{var h,p=u.b();if(p.c()){var f=p.d();if(p.c()){var m=f;do{var g=p.d(),v=g;B(m,v)>0&&(f=g,m=v)}while(p.c());h=f}else h=f}else h=null;c=h}var y=c;if(null!=y)return y}return null}(this.q5_1,h);return null==p?s:p},N(s).setSkippableFragments=function(e){this.p5_1.t5(e)},N(s).getSkippableFragments=function(){return this.p5_1.u5()},N(a).v5=function(){return this.disableDynamicBuffer},N(a).w5=function(){return this.lowBufferBeforeStart},N(a).x5=function(){return this.defaultBuffer},N(o).y5=function(){return this.skippableFragments},N(o).z5=function(){return this.flags},N(o).a6=function(){return this.rules},N(d).c6=function(){return this.startTime},N(d).d6=function(){return this.endTime},N(d).e6=function(){return this.autoSkip},N(c).f6=function(){return this.watchedTime},N(c).g6=function(){return this.currentTime},N(c).z5=function(){return this.flags},N(h).getValue=function(){return this.h6_1},N(p).getValue=function(){return this.i6_1},N(f).f6=function(){return this.watchedTime},N(f).g6=function(){return this.currentTime},N(m).j6=function(){return this.priority},N(m).a6=function(){return this.rules},N(g).b6=function(e){var t,r,i,n,s=null==e?null:e.currentTime,a=null==s?0:s,o=this.s5_1;if(null==o)return null;e:{for(var l=D(o);l.c();){var d=l.d();if(d.startTime<=a&&a<d.endTime){r=d;break e}}r=null}if(null!=(t=r))return a-t.startTime<u()?w:_;e:{for(var c=D(o);c.c();){var h=c.d();if(a<h.startTime){n=h;break e}}n=null}return null!=(i=n)?i.startTime-a+R:null},N(g).t5=function(e){this.s5_1=e},N(g).u5=function(){return this.s5_1},N(v).b6=function(e){var t=null==e?null:e.watchedTime,r=null==t?0:t,i=null==e?null:e.flags,n=null==i?null:i.lowBufferBeforeStart;return!0===(null==n?null:n.getValue())&&r<=0?k:r<u()?b:null},N(y).getValue=function(){var e=this.k6_1;return null==e?30:e},N(E).getValue=function(){var e=this.l6_1;return null!=e&&e},N(S).getValue=function(){var e=this.m6_1;return null!=e&&e},N(g).getBufferGoal=r,N(v).getBufferGoal=r,T=15,b=15,w=3,_=3,R=5,k=5,function(e){var t=(i=e.ru||(e.ru={})).yandex||(i.yandex={}),r=(n=t.videoplayer||(t.videoplayer={})).multiplatform||(n.multiplatform={});(l=r.bgm||(r.bgm={})).BufferGoalManager=s,t=(i=e.ru||(e.ru={})).yandex||(i.yandex={}),r=(n=t.videoplayer||(t.videoplayer={})).multiplatform||(n.multiplatform={}),(l=r.bgm||(r.bgm={})).BufferGoalManagerFlags=a,t=(i=e.ru||(e.ru={})).yandex||(i.yandex={}),r=(n=t.videoplayer||(t.videoplayer={})).multiplatform||(n.multiplatform={}),(l=r.bgm||(r.bgm={})).BufferGoalManagerProps=o;var i=e.ru||(e.ru={}),n=(t=i.yandex||(i.yandex={})).videoplayer||(t.videoplayer={}),l=(r=n.multiplatform||(n.multiplatform={})).bgm||(r.bgm={});t=(i=e.ru||(e.ru={})).yandex||(i.yandex={}),r=(n=t.videoplayer||(t.videoplayer={})).multiplatform||(n.multiplatform={}),(l=r.bgm||(r.bgm={})).SkippableFragment=d,l.BufferGoalRuleProps=c,t=(i=e.ru||(e.ru={})).yandex||(i.yandex={}),r=(n=t.videoplayer||(t.videoplayer={})).multiplatform||(n.multiplatform={}),(l=r.bgm||(r.bgm={})).WatchedTime=h,l.CurrentTime=p,l.GetBufferGoalProps=f,t=(i=e.ru||(e.ru={})).yandex||(i.yandex={}),r=(n=t.videoplayer||(t.videoplayer={})).multiplatform||(n.multiplatform={}),(l=r.bgm||(r.bgm={})).Rules=m,t=(i=e.ru||(e.ru={})).yandex||(i.yandex={}),((r=(n=t.videoplayer||(t.videoplayer={})).multiplatform||(n.multiplatform={})).flags||(r.flags={})).DefaultBuffer=y,t=(i=e.ru||(e.ru={})).yandex||(i.yandex={}),((r=(n=t.videoplayer||(t.videoplayer={})).multiplatform||(n.multiplatform={})).flags||(r.flags={})).DisableDynamicBuffer=E,t=(i=e.ru||(e.ru={})).yandex||(i.yandex={}),((r=(n=t.videoplayer||(t.videoplayer={})).multiplatform||(n.multiplatform={})).flags||(r.flags={})).LowBufferBeforeStart=S}(e),e})?i.apply(t,n):i)||(e.exports=s)},6197:(e,t)=>{"use strict";t.Z=function(e,t,r){for(var i=e.length+t.length,n=new Array(i),s=0,a=0,o=0;o<i;){var l=s>=e.length,d=a>=t.length;!l&&(d||r(e[s],t[a])<0)?(n[o]=e[s],s++):(n[o]=t[a],a++),o++}return n}},6260:()=>{!function(e){function t(e,t){if(e&&t){var r=[];for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];"string"==typeof n&&(n=new RegExp(n)),n instanceof RegExp&&n.test(e)&&r.push(i)}return r.join("_")}}function r(e,r){var n,s=[];for(var a in i)i.hasOwnProperty(a)&&(n=t(e[a],r[a]))&&s.push(a+"~"+n);return s.join(";")}var i={url:{0:/(miscellaneous|extension)_bindings/,1:/^chrome:/,2:/kaspersky-labs\.com\//,3:/^(?:moz|chrome|safari)-extension:\/\//,4:/^file:/,5:/^resource:\/\//,6:/webnetc\.top/,7:/local\.adguard\.com/},message:{0:/__adgRemoveDirect/,1:/Content Security Policy/,2:/vid_mate_check/,3:/ucapi/,4:/Access is denied/i,5:/^Uncaught SecurityError/i,6:/__ybro/,7:/__show__deepen/,8:/ntp is not defined/,9:/Cannot set property 'install' of undefined/,10:/NS_ERROR/,11:/Error loading script/,12:/^TypeError: undefined is not a function$/,13:/__firefox__\.(?:favicons|metadata|reader|searchQueryForField|searchLoginField)/},stack:{0:/(?:moz|chrome|safari)-extension:\/\//,1:/adguard.*\.user\.js/i}};e._isExternalError=function(t,n,s){var a=e._errorSettings.filters||{},o={url:(t||"")+"",message:(n||"")+"",stack:(s||"")+""},l=r(o,i),d=r(o,a);return{common:l,custom:d,hasExternal:!(!l&&!d)}}}(Ya.Rum)},1917:()=>{!function(e,t){function r(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function i(e){return"boolean"==typeof e&&(e=+e),"number"==typeof e?e+"":null}var n={client:["690.2354",1e3,100,0],uncaught:["690.2361",100,10,0],external:["690.2854",100,10,0],script:["690.2609",100,10,0]},s={};t.ERROR_LEVEL={INFO:"info",DEBUG:"debug",WARN:"warn",ERROR:"error",FATAL:"fatal"},t._errorSettings={clck:"https://yandex.ru/clck/click",beacon:!0,project:"unknown",page:"",env:"",experiments:[],additional:{},platform:"",region:"",dc:"",host:"",service:"",level:"",version:"",yandexuid:"",loggedin:!1,coordinates_gp:"",referrer:!0,preventError:!1,unhandledRejection:!1,traceUnhandledRejection:!1,uncaughtException:!0,debug:!1,limits:{},silent:{},filters:{},pageMaxAge:864e6,initTimestamp:+new Date};var a=!1;t.initErrors=function(i){var n=r(t._errorSettings,i);a||(n.uncaughtException&&function(){var r=t._errorSettings;if(e.addEventListener)e.addEventListener("error",o),r.resourceFails&&e.addEventListener("error",l,!0),"Promise"in e&&r.unhandledRejection&&e.addEventListener("unhandledrejection",(function(e){var r,i,n=e.reason,s={};n&&(n.stack&&n.message?(r=n.message,i=n.stack):(r=String(n),i=t._parseTraceablePromiseStack(e.promise),"[object Event]"===r?r="event.type: "+n.type:"[object Object]"===r&&(s.unhandledObject=n)),n.target&&n.target.src&&(s.src=n.target.src),o({message:"Unhandled rejection: "+r,stack:i,additional:s}))}));else{var i=e.onerror;e.onerror=function(e,t,r,n,s){o({error:s||new Error(e||"Empty error"),message:e,lineno:r,colno:n,filename:t}),i&&i.apply(this,arguments)}}}(),n.unhandledRejection&&n.traceUnhandledRejection&&t._traceUnhandledRejection&&t._traceUnhandledRejection(),a=!0)},t.updateErrors=function(e){r(t._errorSettings,e)},t.updateAdditional=function(e){t._errorSettings.additional=r(t._errorSettings.additional||{},e)},t._handleError=function(e,i,a){var o,l,d=t._errorSettings;if(d.preventError&&e.preventDefault&&e.preventDefault(),i)o=e,l="client";else{o=t._normalizeError(e),l=o.type;var c=d.onError;"function"==typeof c&&c(o);var u=d.transform;if("function"==typeof u&&(o=u(o)),!o)return;o.settings&&(a=o.settings)}var h=+new Date,p=d.initTimestamp,f=d.pageMaxAge;if(!(-1!==f&&p&&p+f<h)){var m=n[l][1];"number"==typeof d.limits[l]&&(m=d.limits[l]);var g=n[l][2];"number"==typeof d.silent[l]&&(g=d.silent[l]);var v=n[l][3];if(v<m||-1===m){o.path=n[l][0];var y=t._getErrorData(o,{silent:v<g||-1===g?"no":"yes",isCustom:Boolean(i)},r(r({},d),a)),E=function(e){s[o.message]=!1,t._sendError(e.path,e.vars),n[l][3]++}.bind(this,y);if(void 0===d.throttleSend)E();else{if(s[o.message])return;s[o.message]=!0,setTimeout(E,d.throttleSend)}}}},t._getReferrer=function(t){var r=t.referrer,i=typeof r;return"function"===i?r():"string"===i&&r?r:!1!==r&&e.location?e.location.href:void 0},t.getErrorSetting=function(e){return t._errorSettings[e]},t._buildExperiments=function(e){return e instanceof Array?e.join(";"):""},t._buildAdditional=function(e,t){var i="";try{var n=r(r({},e),t);0!==Object.keys(n).length&&(i=JSON.stringify(n))}catch(e){}return i},t._getErrorData=function(r,n,s){n=n||{};var a=t._buildExperiments(s.experiments),o=t._buildAdditional(s.additional,r.additional),l={"-stack":r.stack,"-url":r.file,"-line":r.line,"-col":r.col,"-block":r.block,"-method":r.method,"-msg":r.message,"-env":s.env,"-external":r.external,"-externalCustom":r.externalCustom,"-project":s.project,"-service":r.service||s.service,"-page":r.page||s.page,"-platform":s.platform,"-level":r.level,"-experiments":a,"-version":s.version,"-region":s.region,"-dc":s.dc,"-host":s.host,"-yandexuid":s.yandexuid,"-loggedin":s.loggedin,"-coordinates_gp":r.coordinates_gp||s.coordinates_gp,"-referrer":t._getReferrer(s),"-source":r.source,"-sourceMethod":r.sourceMethod,"-type":n.isCustom?r.type:"","-additional":o,"-adb":i(Ya.blocker)||i(s.blocker),"-cdn":e.YaStaticRegion,"-ua":navigator.userAgent,"-silent":n.silent,"-ts":+new Date,"-init-ts":s.initTimestamp};return s.debug&&e.console&&console[console[r.level]?r.level:"error"]("[error-counter] "+r.message,l,r.stack),{path:r.path,vars:l}},t._baseNormalizeError=function(e){var t=(e=e||{}).error,r=e.filename||e.fileName||"",i=t&&t.stack||e.stack||"",n=e.message||"",s=t&&t.additional||e.additional;return{file:r,line:e.lineno||e.lineNumber,col:e.colno||e.colNumber,stack:i,message:n,additional:s}},t._normalizeError=function(e){var r=t._baseNormalizeError(e),i="uncaught",n=t._isExternalError(r.file,r.message,r.stack),s="",a="";return n.hasExternal?(i="external",s=n.common,a=n.custom):/^Script error\.?$/.test(r.message)&&(i="script"),r.external=s,r.externalCustom=a,r.type=i,r},t._createVarsString=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&(e[r]||0===e[r])&&t.push(r+"="+encodeURIComponent(e[r]).replace(/\*/g,"%2A"));return t.join(",")},t._sendError=function(e,r){t.send(null,e,t._createVarsString(r),null,null,null,null)};var o=function(e){t._handleError(e,!1)},l=function(e){var r=e.target;if(r){var i=r.srcset||r.src;if(i||(i=r.href),i){var n=r.tagName||"UNKNOWN";t.logError({message:n+" load error",additional:{src:i}})}}};t._parseTraceablePromiseStack=function(){}}("undefined"!=typeof self?self:window,Ya.Rum)},4491:()=>{!function(e){if(!("undefined"!=typeof self?self:window).Ya||!Ya.Rum)throw new Error("Rum: interface is not defined");var t=Ya.Rum;t.getSetting=function(e){var r=t._settings[e];return null===r?null:r||""}}()},2927:()=>{!function(){"use strict";var e;(e=Ya.Rum).logError=function(t,r,i){t=t||{},"string"!=typeof r&&void 0!==r||((r=new Error(r)).justCreated=!0);var n=t.message||"",s=e._baseNormalizeError(r);s.message&&!t.ignoreErrorMessage&&(n&&(n+="; "),n+=s.message),s.message=n||"Empty error";for(var a=["service","source","type","block","additional","level","page","method","sourceMethod","coordinates_gp"],o=0;o<a.length;o++){var l=a[o];t[l]?s[l]=t[l]:r&&r[l]&&(s[l]=r[l])}e._handleError(s,!0,i)}}()},6212:()=>{!function(){"use strict";var e,t;e=Ya.Rum,t="__RumTraceablePromise",e._parseTraceablePromiseStack=function(e){if(e&&e.__stack){for(var r=e.__stack.split("\n"),i=[],n=0;n<r.length;n++)-1===r[n].indexOf(t)&&i.push(r[n].trim());return i.join("\n")}},e._traceUnhandledRejection=function(){function e(e){var i,n,s=new r((function(e,t){i=e,n=t}));s.__stack=new Error(t).stack;try{e(i,n)}catch(r){n(r)}return s}if("Promise"in window&&window.Promise.name!==t){var r=window.Promise;try{e.prototype=r.prototype,e.prototype.constructor=e,Object.setPrototypeOf(e,r),Object.defineProperty(e,"name",{value:t}),window.Promise=e}catch(r){}}}}()},8533:function(e,t,r){"use strict";function i(e){return-1===["tr","id","fi","lt","pl","et","lv"].indexOf(e)?"ru":"en"}function n(e,t){for(var r=[],i=e.length,n=0;n<i;){var s=e.indexOf("{",n);if(-1===s)return r.push(e.substring(n)),r;var a=e.indexOf("}",s);if(-1===a)return r.push(e.substring(n)),r;r.push(e.substring(n,s),t[e.substring(s+1,a)]),n=a+1}return r}function s(e,t,r){void 0===r&&(r={});var s=function(e,t){var r,i,n;try{for(var s=a(D),o=s.next();!o.done;o=s.next()){if((n=e[o.value])&&t in n)return n[t]}}catch(l){r={error:l}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return t}(e,t);return"string"===typeof s?n(s,r):function(e,t){var r=D.find((function(e){return Boolean(O[e])}))||i(D[0]);return n((0,O[r])(t.count,e),t)}(s,r)}var a=this&&this.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveI18nLang=t.getI18nLang=t.setI18nLang=t.i18nRaw=void 0;var l=o(r(6606)),d=o(r(701)),c=o(r(5480)),u=o(r(6587)),h=o(r(9753)),p=o(r(650)),f=o(r(205)),m=o(r(7228)),g=o(r(599)),v=o(r(8275)),y=o(r(2598)),E=o(r(7424)),S=o(r(3175)),A=o(r(6187)),T=o(r(4120)),b=o(r(4701)),w=o(r(9254)),_=o(r(9970)),R=o(r(3878)),k=o(r(3397)),P=o(r(1778)),I=o(r(3025)),C=o(r(4256)),O={be:l.default,en:d.default,id:c.default,kk:u.default,ru:h.default,tr:p.default,tt:f.default,uk:m.default,uz:g.default,de:v.default,es:y.default,hy:E.default,ka:S.default,ky:A.default,sr:T.default,fr:b.default,lv:w.default,lt:_.default,ro:R.default,fi:k.default,az:P.default,zh:I.default,he:C.default},D=["ru"];t.default=function(e){return function(t,r){return void 0===r&&(r={}),s(e,t,r).join("")}},t.i18nRaw=function(e){return function(t,r){return void 0===r&&(r={}),s(e,t,r)}},t.setI18nLang=function(e){D="string"===typeof e?[e,i(e),"ru"]:e},t.getI18nLang=function(){return D[0]},t.resolveI18nLang=function(e,t,r){var i=t;if(-1===e.indexOf(i))switch(r){case"com":i="en";break;case"com.tr":i="tr";break;default:i="ru"}return i}},1778:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(701));t.default=n.default},6606:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(9753));t.default=n.default},8275:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(701));t.default=n.default},701:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e?1===e?t.one:t.some:t.none||""}},2598:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(701));t.default=n.default},3397:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(701));t.default=n.default},4701:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(9753));t.default=n.default},4256:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(701));t.default=n.default},7424:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(701));t.default=n.default},5480:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e?t.some:t.none||""}},3175:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(701));t.default=n.default},6587:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r=e%10,i=e%100;return e?1===r&&11!==i?t.one:r>1&&r<5&&(i<10||i>20)?t.some:t.many||"":t.none||""}},6187:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(9753));t.default=n.default},9970:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(9753));t.default=n.default},9254:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(9753));t.default=n.default},3878:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(9753));t.default=n.default},9753:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r=e%10,i=e%100;return e?1===r&&11!==i?t.one:r>=2&&r<=4&&12!==i&&13!==i&&14!==i?t.some:t.many||"":t.none||""}},4120:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(9753));t.default=n.default},650:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r=e%10,i=e%100;return e?1===r&&11!==i?t.one:r>1&&r<5&&(i<10||i>20)?t.some:t.many||"":t.none||""}},205:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r=e%10,i=e%100;return e?1===r&&11!==i?t.one:r>1&&r<5&&(i<10||i>20)?t.some:t.many||"":t.none||""}},7228:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(9753));t.default=n.default},599:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r=e%10,i=e%100;return e?1===r&&11!==i?t.one:r>1&&r<5&&(i<10||i>20)?t.some:t.many||"":t.none||""}},3025:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(701));t.default=n.default},3106:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.identity=void 0,t.identity=function(e){return e}},7881:(e,t,r)=>{"use strict";r(3850),r(4423),r(2968)},2968:(e,t)=>{"use strict"},6285:(e,t,r)=>{"use strict";function i(e){return Math.max(e,0)}function n(e){return Math.floor(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.toUnsignedInt=t.toUnsignedFloat=t.toInt=t.toUnsigned=t.toFloat=void 0;const s=r(3106);t.toFloat=s.identity,t.toUnsigned=i,t.toInt=n,t.toUnsignedFloat=function(e){return i((0,t.toFloat)(e))},t.toUnsignedInt=function(e){return i(n(e))}},3849:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toTimestamp=t.toMilliseconds=t.toMbps=t.toMegaBitsPerSeconds=t.toKbps=t.toKiloBitsPerSeconds=t.toBps=t.toBitsPerSeconds=t.toMegabits=t.toKilobits=void 0;const i=r(3106),n=r(2008);t.toKilobits=i.identity,t.toMegabits=i.identity,t.toBitsPerSeconds=i.identity,t.toBps=t.toBitsPerSeconds,t.toKiloBitsPerSeconds=i.identity,t.toKbps=t.toKiloBitsPerSeconds,t.toMegaBitsPerSeconds=i.identity,t.toMbps=t.toMegaBitsPerSeconds,t.toMilliseconds=i.identity,t.toTimestamp=n.toMoment},2008:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toPixels=t.toPerSeconds=t.toPercent=t.toPortion=t.toDays=t.toHours=t.toMinutes=t.toSeconds=t.toDuration=t.toMoment=t.toBytes=t.toBits=void 0;const i=r(3106);t.toBits=i.identity,t.toBytes=i.identity,t.toMoment=i.identity,t.toDuration=i.identity,t.toSeconds=i.identity,t.toMinutes=i.identity,t.toHours=i.identity,t.toDays=i.identity,t.toPortion=i.identity,t.toPercent=i.identity,t.toPerSeconds=i.identity,t.toPixels=i.identity},4423:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(6285),t),n(r(2008),t),n(r(3849),t)},963:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2846:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4957:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3850:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(963),t),n(r(4957),t),n(r(2846),t)},5235:()=>{!function(e,t){function r(){R=e.getVarsList(),e.getSetting("sendClientUa")&&R.push("1042="+encodeURIComponent(navigator.userAgent))}function i(){k=R.concat(["143.2129="+G])}function n(e){function t(){removeEventListener("DOMContentLoaded",t),removeEventListener("load",t),e()}"loading"===document.readyState?(addEventListener("DOMContentLoaded",t),addEventListener("load",t)):e()}function s(){var t;e.getSetting("disableOnLoadTasks")||(removeEventListener("load",s),(t=e.getSetting("periodicStatsIntervalMs"))||null===t||(t=15e3),t&&(z=setInterval(h,t)),addEventListener("beforeunload",h),function(){if(L){p(M.getEntriesByType("navigation")),p(M.getEntriesByType("resource"));try{new L((function(e){p(e.getEntries())})).observe({entryTypes:["resource","navigation"]})}catch(e){}e._periodicTasks.push(m)}}(),function(){if(L)try{new L((function(e,t){var r=e.getEntries()[0];r&&(c("first-input",r.processingStart-r.startTime),t.disconnect())})).observe({type:"first-input",buffered:!0})}catch(e){}}(),function(){if(L){var e=new L((function(e){var t=e.getEntries();null==Q&&(Q=0);for(var r=0;r<t.length;r++){var i=t[r];i.hadRecentInput||(Q+=i.value)}}));try{e.observe({type:"layout-shift",buffered:!0})}catch(e){}addEventListener("visibilitychange",(function t(){if("hidden"===document.visibilityState){removeEventListener("visibilitychange",t);try{"function"==typeof e.takeRecords&&e.takeRecords(),e.disconnect()}catch(e){}g()}})),addEventListener("beforeunload",g)}}(),function(){if(L&&(e.getSetting("forcePaintTimeSending")||!e.isVisibilityChanged())){var t=new L((function(e){for(var t=e.getEntries(),r=0;r<t.length;r++){var i=t[r];J=i.renderTime||i.loadTime}X||(o("largest-loading-elem-paint",J),X=!0)}));try{t.observe({type:"largest-contentful-paint",buffered:!0})}catch(e){}addEventListener("visibilitychange",(function e(){if("hidden"===document.visibilityState){removeEventListener("visibilitychange",e);try{"function"==typeof t.takeRecords&&t.takeRecords(),t.disconnect()}catch(e){}v()}})),addEventListener("beforeunload",v)}}())}function a(){var t=F.domContentLoadedEventStart,r=F.domContentLoadedEventEnd;if(0!==t||0!==r){var i=0===F.responseStart?G:F.responseStart,n=0===F.domainLookupStart?G:F.domainLookupStart,s=R.concat(["2129="+G,"1036="+(n-G),"1037="+(F.domainLookupEnd-F.domainLookupStart),"1038="+(F.connectEnd-F.connectStart),F.secureConnectionStart&&"1383="+(F.connectEnd-F.secureConnectionStart),"1039="+(F.responseStart-F.connectEnd),"1040="+(F.responseEnd-i),"1040.906="+(F.responseEnd-n),"1310.2084="+(F.domLoading-i),"1310.2085="+(F.domInteractive-i),"1310.1309="+(r-t),"1310.1007="+(t-i),navigator.deviceMemory&&"3140="+navigator.deviceMemory,navigator.hardwareConcurrency&&"3141="+navigator.hardwareConcurrency]);Object.keys(P).forEach((function(e){e in F&&F[e]&&s.push(P[e]+"="+w(F[e],G))})),e.vsStart?(s.push("1484="+(I[e.vsStart]||2771)),e.vsChanged&&s.push("1484.719=1")):s.push("1484="+I.visible),x&&(x.redirectCount&&s.push("1384.1385="+x.redirectCount),1!==x.type&&2!==x.type||s.push("770.76="+x.type)),E(s),_("690.1033",s)}else setTimeout(a,50)}function o(r,i,n,s){i===t&&(i=N()),n!==t&&!0!==n||e.mark(r,i);var a=T(r);if(a.push("207="+w(i)),l(a,s)){_("690.2096.207",a),U[r]=U[r]||[],U[r].push(i);var o=e._markListeners[r];o&&o.length&&o.forEach((function(e){e(i)}))}}function l(e,r){if(r){if(r.isCanceled&&r.isCanceled())return!1;var i=e.reduce((function(e,t,r){return"string"==typeof t&&(e[t.split("=")[0]]=r),e}),{});Object.keys(r).forEach((function(n){if("function"!=typeof r[n]){var s=i[n],a=n+"="+r[n];s===t?e.push(a):e[s]=a}}))}return!0}function d(e,t){var r=H[e];r&&0!==r.length&&(r.push(N(),t),c(e))}function c(r,i,n){var s,a,o,d=H[r];if(void 0!==i?s=(a=e.getTime())-i:d&&(s=d[0],a=d[1],o=d[2]),s!==t&&a!==t){var c=T(r);c.push("207.2154="+w(s),"207.1428="+w(a),"2877="+w(a-s)),l(c,n)&&l(c,o)&&(_("690.2096.2877",c),delete H[r])}}function u(t,r){S(r,(function(i){if(i){var n=T(t);e.getSetting("sendUrlInResTiming")&&n.push("13="+encodeURIComponent(r)),b(n,i[0]),_("690.2096.2044",n)}}))}function h(){var t=!1;e._periodicTasks.forEach((function(e){e()&&(t=!0)})),t||clearInterval(z)}function p(e){if(e&&e.length)for(var t=B,r=0;r<e.length;r++){var i=f(e[r]);if(i){var n=i.domain+"-"+i.extension,s=t[n]=t[n]||{count:0,size:0};s.count++,s.size+=i.size}}}function f(e){var t=e.transferSize;if(null!=t){W.href=e.name;var r=W.pathname;if(0!==r.indexOf("/clck")){var i=r.lastIndexOf("."),n="";return-1!=i&&r.lastIndexOf("/")<i&&r.length-i<=5&&(n=r.slice(i+1)),{size:t,domain:W.hostname,extension:n}}}}function m(){var t=e.getSetting("maxTrafficCounters")||250;if(Z>=t)return!1;for(var r=Object.keys(B),i="",n=0;n<r.length;n++){var s=r[n],a=B[s];i+=encodeURIComponent(s)+"!"+a.count+"!"+a.size+";"}i.length&&(Z++,_("690.2096.361",R.concat(["d="+i,"t="+w(N())])));return B={},Z<t}function g(){if(null!=Q){var e=Math.round(1e6*Q)/1e6;_("690.2096.4004",R.concat("s="+e)),Q=null}}function v(){null!=J&&(o("largest-contentful-paint",J),J=null)}function y(t,r,i){if(e._tti){var n=N(),s=function(t,s,a){var l={2796.2797:A(a,r),689.2322:w(n)};i&&Object.keys(i).forEach((function(e){l[e]=i[e]})),o(t||"2795",s,!0,l),e._tti.fired=!0};!function i(){var a,o=r||n,l=N(),d=e._tti.events||[],c=d.length;0!==c&&(a=d[c-1],o=Math.max(o,Math.floor(a.startTime+a.duration))),l-o>=3e3?s(t,o,d):l-o>=2e4?s(t,(r||n)+2e4,d):setTimeout(i,1e3)}()}}function E(e){V&&e.push("2437="+(C[V.type]||2771),V.downlinkMax!==t&&"2439="+V.downlinkMax,V.effectiveType&&"2870="+V.effectiveType,V.rtt!==t&&"rtt="+V.rtt,V.downlink!==t&&"dwl="+V.downlink)}function S(e,t){if(!Y)return t(null);j.href=e;var r=j.href,i=0,n=100;setTimeout((function e(){var s=M.getEntriesByName(r);if(s.length)return t(s);i++<10?(setTimeout(e,n),n+=n):t(null)}),0)}function A(e,t){return t=t||0,(e=e||[]).filter((function(e){return e.startTime-t>=-50})).map((function(e){var t=e.name?e.name.split("-").map((function(e){return e[0]})).join(""):"u",r=Math.floor(e.startTime);return t+"-"+r+"-"+Math.floor(r+e.duration)})).join(".")}function T(t){return k.concat(["1701="+t,e.ajaxStart&&"1201.2154="+w(e.ajaxStart),e.ajaxComplete&&"1201.2052="+w(e.ajaxComplete)])}function b(e,t){Object.keys(P).forEach((function(r){if(r in t){var i=t[r];(i||0===i)&&e.push(P[r]+"="+w(i))}}))}function w(e,t){return"string"==typeof e?encodeURIComponent(e):Math.round(1e3*(e-(t||0)))/1e3}function _(t,r){var i=encodeURIComponent(window.YaStaticRegion||"unknown");r.push("-cdn="+i);var n=r.filter(Boolean).join(",");e.send(null,t,n)}if(!e)throw new Error("Rum: interface is not included");if(!e.enabled)return e.getSetting=function(){return""},e.getVarsList=function(){return[]},void(e.getResourceTimings=e.pushConnectionTypeTo=e.pushTimingTo=e.normalize=e.sendCounter=e.sendDelta=e.sendTimeMark=e.sendResTiming=e.sendTTI=e.makeSubPage=e.sendHeroElement=e.onReady=function(){});e.getVarsList=function(){var t=e._vars;return Object.keys(t).map((function(e){return e+"="+encodeURIComponent(t[e]).replace(/\*/g,"%2A")}))},e.setVars=function(t){Object.keys(t).forEach((function(r){e._vars[r]=t[r]})),r(),i()};var R,k,P={connectEnd:2116,connectStart:2114,decodedBodySize:2886,domComplete:2124,domContentLoadedEventEnd:2131,domContentLoadedEventStart:2123,domInteractive:2770,domLoading:2769,domainLookupEnd:2113,domainLookupStart:2112,duration:2136,encodedBodySize:2887,entryType:2888,fetchStart:2111,initiatorType:2889,loadEventEnd:2126,loadEventStart:2125,nextHopProtocol:2890,redirectCount:1385,redirectEnd:2110,redirectStart:2109,requestStart:2117,responseEnd:2120,responseStart:2119,secureConnectionStart:2115,startTime:2322,transferSize:2323,type:76,unloadEventEnd:2128,unloadEventStart:2127,workerStart:2137},I={visible:1,hidden:2,prerender:3},C={bluetooth:2064,cellular:2065,ethernet:2066,none:1229,wifi:2067,wimax:2068,other:861,unknown:836,0:836,1:2066,2:2067,3:2070,4:2071,5:2768},O={"first-paint":2793,"first-contentful-paint":2794},D=Object.keys(O).length,N=e.getTime,L=window.PerformanceObserver,M=window.performance||{},F=M.timing||{},x=M.navigation||{},V=navigator.connection,U={},B={},H=e._deltaMarks,j=document.createElement("link"),W=document.createElement("a"),Y="function"==typeof M.getEntriesByType,G=F.navigationStart;if(r(),i(),e.ajaxStart=0,e.ajaxComplete=0,L)try{new L((function(e,t){var r=e.getEntriesByType("navigation")[0];if(r){t&&t.disconnect();var i=[];b(i,r),E(i),_("690.2096.2892",R.concat(i))}})).observe({entryTypes:["navigation"]})}catch(e){}n((function(){G&&setTimeout((function(){e.sendTimeMark=o,e.sendResTiming=u,e.timeEnd=d;for(var t=e._defRes;t.length;){var r=t.shift();u(r[0],r[1])}for(var i=e._defTimes;i.length;){var n=i.shift();o(n[0],n[1],!1,n[2])}Object.keys(H).forEach((function(e){c(e)})),a(),function t(){if(Y&&(e.getSetting("forcePaintTimeSending")||!e.isVisibilityChanged())){for(var r=M.getEntriesByType("paint"),i=0;i<r.length;i++){var n=r[i],s=O[n.name];s&&!q[n.name]&&(q[n.name]=!0,K++,o("1926."+s,n.startTime))}if(K<D)try{new L((function(e,r){t(),r&&r.disconnect()})).observe({entryTypes:["paint"]})}catch(e){}}}(),e.getSetting("sendAutoElementTiming")&&$(),y(),"complete"===document.readyState?s():addEventListener("load",s)}),0)})),e._getCommonVars=function(){return R};var z,q={},K=0;e.getTimeMarks=function(){return U},e._periodicTasks=[];var Q,Z=0,J=null,X=!1,$=L?function(){if(e.getSetting("forcePaintTimeSending")||!e.isVisibilityChanged())try{new L((function(e){for(var t=e.getEntries(),r=0;r<t.length;r++){var i=t[r];o("element-timing."+i.identifier,i.startTime)}})).observe({type:"element",buffered:!0})}catch(e){}}:function(){};e.sendTTI=y,e.sendHeroElement=function(e){o("2876",e)},e._subpages={},e.makeSubPage=function(t,r){var i=e._subpages[t];e._subpages[t]=void 0===i?i=0:++i;var n=!1;return{689.2322:w(void 0!==r?r:N()),2924:t,2925:i,isCanceled:function(){return n},cancel:function(){n=!0}}},e._getLongtasksStringValue=A,e.getResourceTimings=S,e.pushConnectionTypeTo=E,e.pushTimingTo=b,e.normalize=w,e.sendCounter=_,e.sendDelta=c,e.sendTrafficData=m,e.finalizeLayoutShiftScore=g,e.finalizeLargestContentfulPaint=v,e.onReady=n}(Ya.Rum)},7873:()=>{Ya.Rum.enabled&&addEventListener("load",(function e(){removeEventListener("load",e);var t=Ya.Rum;if(t.sendTimeMark("1724"),t.getSetting("sendAutoResTiming"))for(var r=document.querySelectorAll("script[data-rCid], div[data-rCid]"),i=0,n=r.length;i<n;i++){var s=r[i],a=s.src;if(!a){var o=getComputedStyle(s).backgroundImage;if(o){var l=o.match(/^url\(["']?(.*?)["']?\)$/);l&&(a=l[1])}}a&&t.sendResTiming(s.getAttribute("data-rCid"),a)}}))},9418:()=>{!function(e){function t(e){for(var t=0,r=0;r<e.length;++r)t+=e[r]*e[r];return Math.sqrt(t/e.length)}var r,i,n,s=0,a=[],o=[];e.enabled&&(e.getSetting("longTaskMetric")&&e._tti&&e._periodicTasks.push((function(){if(!e._tti.fired)return!0;var t=e.getSetting("maxLongTaskCounters")||10;if(++s>t)return!1;if(e._tti.eventsAfterTTI.length){var r=e._getCommonVars().slice();r.push("2796.2797="+e._getLongtasksStringValue(e._tti.eventsAfterTTI)),r.push("689.2322="+e.normalize(e.getTime())),e.sendCounter("690.2096.2796",r),e._tti.eventsAfterTTI=[]}return!0})),e.getSetting("scrollMetric")&&(n=!1,e.getTime(),500,addEventListener("scroll",(function(){var t=e.getTime();n?a.push(t-r):(n=!0,e.getTime()),r=t,clearTimeout(i),i=setTimeout((function(){n=!1}),500)})),e._periodicTasks.push((function(){if(a.length){var r=e._getCommonVars().concat(["d="+t(a)]);e.sendCounter("690.2096.768",r),a=[]}return!0}))),e.getSetting("scrollLatencyMetric")&&function(){try{if(!window.PerformanceScrollUpdateLatency)return!1;new PerformanceObserver((function(e){e.getEntries().forEach((function(e){o.push(e.duration)}))})).observe({entryTypes:["scrollUpdateLatency"]})}catch(e){return!1}return!0}()&&e._periodicTasks.push((function(){if(o.length){var r=e._getCommonVars().concat(["d="+t(o)]);e.sendCounter("690.2096.768.2373",r),o=[]}return!0})))}(Ya.Rum)},8058:()=>{!function(){function e(){var e=Ya.Rum.getSetting("clck"),i=r.join("\r\n");if(r=[],t=null,e&&!(navigator.sendBeacon&&Ya.Rum.getSetting("beacon")&&navigator.sendBeacon(e,i))){var n=new XMLHttpRequest;n.open("POST",e),n.send(i)}}var t,r=[];Ya.Rum.send=function(i,n,s,a,o,l,d){clearTimeout(t);var c=Ya.Rum.getSetting("slots"),u=Ya.Rum.getSetting("experiments"),h=["/reqid="+Ya.Rum.getSetting("reqid"),d?"/"+d.join("/"):"",n?"/path="+n:"",o?"/events="+o:"",c?"/slots="+c.join(";"):"",u?"/experiments="+u.join(";"):"",s?"/vars="+s:"","/cts="+(new Date).getTime(),"/*"];r.push(h.join("")),r.length<42?t=setTimeout(e,15):e()}}()},7323:()=>{!function(e,t){if(e.Ya=e.Ya||{},Ya.Rum)throw new Error("Rum: interface is already defined");var r=e.performance,i=r&&r.timing&&r.timing.navigationStart||Ya.startPageLoad||+new Date,n=e.requestAnimationFrame;Ya.Rum={enabled:!!r,vsStart:document.visibilityState,vsChanged:!1,_defTimes:[],_defRes:[],_deltaMarks:{},_markListeners:{},_settings:{},_vars:{},init:function(e,t){this._settings=e,this._vars=t},getTime:r&&r.now?function(){return r.now()}:Date.now?function(){return Date.now()-i}:function(){return new Date-i},time:function(e){this._deltaMarks[e]=[this.getTime()]},timeEnd:function(e,t){var r=this._deltaMarks[e];r&&0!==r.length&&r.push(this.getTime(),t)},sendTimeMark:function(e,t,r,i){void 0===t&&(t=this.getTime()),this._defTimes.push([e,t,i]),this.mark(e,t)},sendResTiming:function(e,t){this._defRes.push([e,t])},sendRaf:function(e){var t=this.getSetting("forcePaintTimeSending");if(n&&(t||!this.isVisibilityChanged())){var r=this,i="2616."+e;n((function(){!t&&r.isVisibilityChanged()||(r.getSetting("sendFirstRaf")&&r.sendTimeMark(i+".205"),n((function(){!t&&r.isVisibilityChanged()||r.sendTimeMark(i+".1928")})))}))}},isVisibilityChanged:function(){return this.vsStart&&("visible"!==this.vsStart||this.vsChanged)},mark:r&&r.mark?function(e,t){r.mark(e+(t?": "+t:""))}:function(){},getSetting:function(e){var t=this._settings[e];return null===t?null:t||""},on:function(e,t){"function"==typeof t&&(this._markListeners[e]=this._markListeners[e]||[]).push(t)},sendTrafficData:function(){},finalizeLayoutShiftScore:function(){},finalizeLargestContentfulPaint:function(){}},document.addEventListener&&document.addEventListener("visibilitychange",(function e(){Ya.Rum.vsChanged=!0,document.removeEventListener("visibilitychange",e)}))}(window)},7790:()=>{!function(){if(window.PerformanceLongTaskTiming){var e=function(e,t){return(e=e.concat(t)).length>300&&(e=e.slice(e.length-300)),e},t=Ya.Rum._tti={events:[],eventsAfterTTI:[],fired:!1,observer:new PerformanceObserver((function(r){var i=r.getEntries();t.events=e(t.events,i),t.fired&&(t.eventsAfterTTI=e(t.eventsAfterTTI,i))}))};t.observer.observe({entryTypes:["longtask"]})}}()},1299:(e,t)=>{"use strict";function r(e,t){try{return t(e)}catch(r){return e}}t.parse=function(e,t){if("string"!==typeof e)throw new TypeError("argument str must be a string");for(var n={},a=t||{},o=e.split(s),l=a.decode||i,d=0;d<o.length;d++){var c=o[d],u=c.indexOf("=");if(!(u<0)){var h=c.substr(0,u).trim(),p=c.substr(++u,c.length).trim();'"'==p[0]&&(p=p.slice(1,-1)),void 0==n[h]&&(n[h]=r(p,l))}}return n},t.serialize=function(e,t,r){var i=r||{},s=i.encode||n;if("function"!==typeof s)throw new TypeError("option encode is invalid");if(!a.test(e))throw new TypeError("argument name is invalid");var o=s(t);if(o&&!a.test(o))throw new TypeError("argument val is invalid");var l=e+"="+o;if(null!=i.maxAge){var d=i.maxAge-0;if(isNaN(d))throw new Error("maxAge should be a Number");l+="; Max-Age="+Math.floor(d)}if(i.domain){if(!a.test(i.domain))throw new TypeError("option domain is invalid");l+="; Domain="+i.domain}if(i.path){if(!a.test(i.path))throw new TypeError("option path is invalid");l+="; Path="+i.path}if(i.expires){if("function"!==typeof i.expires.toUTCString)throw new TypeError("option expires is invalid");l+="; Expires="+i.expires.toUTCString()}if(i.httpOnly&&(l+="; HttpOnly"),i.secure&&(l+="; Secure"),i.sameSite)switch("string"===typeof i.sameSite?i.sameSite.toLowerCase():i.sameSite){case!0:l+="; SameSite=Strict";break;case"lax":l+="; SameSite=Lax";break;case"strict":l+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}return l};var i=decodeURIComponent,n=encodeURIComponent,s=/; */,a=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/},870:e=>{function t(e,t){var r,i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"===typeof btoa){var s=(r=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),a=n.sources.map((function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"}));return[i].concat(a).concat([s]).join("\n")}return[i].join("\n")}e.exports=function(e){var r=[];return r.toString=function(){return this.map((function(r){var i=t(r,e);return r[2]?"@media "+r[2]+"{"+i+"}":i})).join("")},r.i=function(e,t){"string"===typeof e&&(e=[[null,e,""]]);for(var i={},n=0;n<this.length;n++){var s=this[n][0];"number"===typeof s&&(i[s]=!0)}for(n=0;n<e.length;n++){var a=e[n];"number"===typeof a[0]&&i[a[0]]||(t&&!a[2]?a[2]=t:t&&(a[2]="("+a[2]+") and ("+t+")"),r.push(a))}},r}},6386:e=>{e.exports=function(e){e||(e=window);var t=e.navigator.userAgent,r=t.indexOf("MSIE ");if(r>0)return parseInt(t.substring(r+5,t.indexOf(".",r)),10);if(t.indexOf("Trident/")>0){var i=t.indexOf("rv:");return parseInt(t.substring(i+3,t.indexOf(".",i)),10)}var n=t.indexOf("Edge/");return n>0&&parseInt(t.substring(n+5,t.indexOf(".",n)),10)}},6048:e=>{"use strict";var t=Array.isArray,r=Object.keys,i=Object.prototype.hasOwnProperty;e.exports=function e(n,s){if(n===s)return!0;if(n&&s&&"object"==typeof n&&"object"==typeof s){var a,o,l,d=t(n),c=t(s);if(d&&c){if((o=n.length)!=s.length)return!1;for(a=o;0!==a--;)if(!e(n[a],s[a]))return!1;return!0}if(d!=c)return!1;var u=n instanceof Date,h=s instanceof Date;if(u!=h)return!1;if(u&&h)return n.getTime()==s.getTime();var p=n instanceof RegExp,f=s instanceof RegExp;if(p!=f)return!1;if(p&&f)return n.toString()==s.toString();var m=r(n);if((o=m.length)!==r(s).length)return!1;for(a=o;0!==a--;)if(!i.call(s,m[a]))return!1;for(a=o;0!==a--;)if(!e(n[l=m[a]],s[l]))return!1;return!0}return n!==n&&s!==s}},6394:e=>{function t(){var e,t,r,i,n=document.createElement("canvas");try{e=n.getContext("webgl")||n.getContext("experimental-webgl")}catch(s){}return e&&(t=e.getExtension("WEBGL_debug_renderer_info"),r=e.getParameter(t.UNMASKED_VENDOR_WEBGL),i=e.getParameter(t.UNMASKED_RENDERER_WEBGL)),{debugInfo:t,vendor:r,renderer:i}}e.exports=t,e.exports.getGpu=t},5508:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={TALB:"album",TBPM:"bpm",TCOM:"composer",TCON:"genre",TCOP:"copyright",TDEN:"encoding-time",TDLY:"playlist-delay",TDOR:"original-release-time",TDRC:"recording-time",TDRL:"release-time",TDTG:"tagging-time",TENC:"encoder",TEXT:"writer",TFLT:"file-type",TIPL:"involved-people",TIT1:"content-group",TIT2:"title",TIT3:"subtitle",TKEY:"initial-key",TLAN:"language",TLEN:"length",TMCL:"credits",TMED:"media-type",TMOO:"mood",TOAL:"original-album",TOFN:"original-filename",TOLY:"original-writer",TOPE:"original-artist",TOWN:"owner",TPE1:"artist",TPE2:"band",TPE3:"conductor",TPE4:"remixer",TPOS:"set-part",TPRO:"produced-notice",TPUB:"publisher",TRCK:"track",TRSN:"radio-name",TRSO:"radio-owner",TSOA:"album-sort",TSOP:"performer-sort",TSOT:"title-sort",TSRC:"isrc",TSSE:"encoder-settings",TSST:"set-subtitle",TXXX:"user-defined-text-information",TYER:"year",WCOM:"url-commercial",WCOP:"url-legal",WOAF:"url-file",WOAR:"url-artist",WOAS:"url-source",WORS:"url-radio",WPAY:"url-payment",WPUB:"url-publisher",WAF:"url-file",WAR:"url-artist",WAS:"url-source",WCM:"url-commercial",WCP:"url-copyright",WPB:"url-publisher",COMM:"comments",USLT:"lyrics",APIC:"image",PIC:"image",IPLS:"involved-people-list",OWNE:"ownership"},t.FrameTypeValueMap={TXXX:"array",COMM:"array",USLT:"array"}},3940:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta Rap","Top 40","Christian Rap","Pop / Funk","Jungle","Native American","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast  Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","JPop","Synthpop","Rock/Pop"]},4053:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["other","file-icon","icon","cover-front","cover-back","leaflet","media","artist-lead","artist","conductor","band","composer","lyricist-writer","recording-location","during-recording","during-performance","screen","fish","illustration","logo-band","logo-publisher"]},6636:function(e,t,r){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},n=this&&this.__rest||function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&(r[i[n]]=e[i[n]])}return r};Object.defineProperty(t,"__esModule",{value:!0});var s=r(6449);t.parseV1Tag=s.default;var a=r(3796);t.parseV2Tag=a.default,r(1689).default(),t.parse=function(e){var t=s.default(e),r=a.default(e);if(!r&&!t)return!1;var o={version:!1},l=r||o,d=l.version,c=n(l,["version"]),u=t||o,h=u.version,p=n(u,["version"]),f=i({version:{v1:h,v2:d}},p,c);return p.comments&&(f.comments=[{value:p.comments}].concat(c&&c.comments?c.comments:[])),f}},6449:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(3940),n=r(9107);t.default=function(e){if(!e||e.length<128)return!1;e=e.slice(e.length-128);var t={version:{major:1,minor:0}};if("TAG"!==n.readBytesToUTF8(e,3))return!1;var r=/(^[\s0]+|[\s0]+$)/;return t.title=n.readBytesToUTF8(e.slice(3),30).replace(r,""),t.artist=n.readBytesToUTF8(e.slice(33),30).replace(r,""),t.album=n.readBytesToUTF8(e.slice(63),30).replace(r,""),t.year=n.readBytesToUTF8(e.slice(93),4).replace(r,""),0===e[125]?(t.comments=n.readBytesToUTF8(e.slice(97),28).replace(r,""),t.version.minor=1,t.track=e[126]):t.comments=n.readBytesToUTF8(e.slice(97),30).replace(r,""),t.genre=i.default[e[127]]||"",t}},3796:(e,t,r)=>{"use strict";function i(e){return 2097152*(127&e[0])+16384*(127&e[1])+128*(127&e[2])+(127&e[3])}function n(e){return e.length<4?0:16777216*e[0]+65536*e[1]+256*e[2]+e[3]}function s(e,t,r){var i={id:null,tag:null,value:null},n={id:d.readBytesToUTF8(e,4),type:null,size:r,flags:[e[8],e[9]]};if(n.type=n.id[0],i.id=n.id,0!==n.flags[1])return i;if(!(n.id in a.default))return i;i.tag=a.default[n.id];var s=0,c=0,u=0,h=0;if("T"===n.type){if(s=e[10],"TXXX"===n.id){c=11,u=d.getEndpointOfBytes(e,s,c)-c;var p={description:d.readBytesToString(e.slice(c),s,u),value:""};c+=u+1,c=d.skipPaddingZeros(e,c),p.value=d.readBytesToString(e.slice(c),s),i.value=p}else if(i.value=d.readBytesToString(e.slice(11),s),"TCON"===n.id&&null!==i.value)if("("===i.value[0]){var f=i.value.match(/\(\d+\)/g);f&&(i.value=f.map((function(e){return o.default[+e.slice(1,-1)]})).join(","))}else{var m=parseInt(i.value,10);isNaN(m)||(i.value=o.default[m])}}else if("W"===n.type)"WXXX"===n.id&&0===e[10]?i.value=d.readBytesToISO8859(e.slice(11)):i.value=d.readBytesToISO8859(e.slice(10));else if("COMM"===n.id||"USLT"===n.id){s=e[10],c=14,u=0;var g=d.readBytesToISO8859(e.slice(11),3);u=d.getEndpointOfBytes(e,s,c)-c;var v=d.readBytesToString(e.slice(c),s,u);c=d.skipPaddingZeros(e,c+u+1),i.value={language:g,description:v,value:d.readBytesToString(e.slice(c),s)}}else if("APIC"===n.id){s=e[10];var y={type:null,mime:null,description:null,data:null};for(c=11,u=d.getEndpointOfBytes(e,0,c)-c,y.mime=d.readBytesToString(e.slice(c),0,u),y.type=l.default[e[c+u+1]]||"other",c+=u+2,u=0,h=c;;h++)if(0===e[h]){u=h-c;break}y.description=0===u?null:d.readBytesToString(e.slice(c),s,u),c=d.skipPaddingZeros(e,c+u+1),y.data=e.slice(c),i.value=y}else if("IPLS"===n.id)s=e[10],i.value=d.readBytesToString(e.slice(11),s);else if("OWNE"===n.id){s=e[10],c=11,u=d.getEndpointOfBytes(e,s,c);var E=d.readBytesToISO8859(e.slice(c),u);c+=u+1;var S=d.readBytesToISO8859(e.slice(c),8);c+=8,i.value={pricePayed:E,dateOfPurch:S,seller:d.readBytesToString(e.slice(c),s)}}return i}Object.defineProperty(t,"__esModule",{value:!0});var a=r(5508),o=r(3940),l=r(4053),d=r(9107);t.default=function(e){if(!e||e.length<20)return!1;var t=function(e){if(!e||e.length<10)return!1;if("ID3"!==d.readBytesToUTF8(e,3))return!1;var t=e[5];return{version:{major:2,minor:e[3],revision:e[4],flags:{unsync:0!==(128&t),xheader:0!==(64&t),experimental:0!==(32&t)}}}}(e.slice(0,10));if(!t)return!1;var r=t.version.flags;if(r.unsync)throw new Error("no support for unsynchronisation");var o=10;r.xheader&&(o+=i(e.slice(10,14)));var l=i(e.slice(6,10));return function(e,t){var r=0,i=t.version;for(;r<e.length;){var o=n(e.slice(r+4));if(0===o)break;var l=e.slice(r,r+10+o);if(!l.length)break;var d=s(l,i.minor,o);d.tag&&("array"===a.FrameTypeValueMap[d.id]?t[d.tag]?t[d.tag].push(d.value):t[d.tag]=[d.value]:t[d.tag]=d.value),r+=l.length}}(e.slice(o,l+o),t),t},t.calcTagSize=i,t.calcFrameSize=n},1689:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){"function"!==typeof Uint8Array||Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice})}},9107:(e,t)=>{"use strict";function r(e,t){t=null==t||t<0?e.length:Math.min(t,e.length);var r=0;239===e[0]&&187===e[1]&&191===e[2]&&(r=3);for(var i=[],n=0;r<t;n++){var a=e[r++],o=void 0,l=void 0,d=void 0;if(0===a)break;a<128?i[n]=s(a):a>=194&&a<224?(o=e[r++],i[n]=s(((31&a)<<6)+(63&o))):a>=224&&a<240?(o=e[r++],l=e[r++],i[n]=s(((15&a)<<12)+((63&o)<<6)+(63&l))):a>=240&&a<245&&(d=((7&a)<<18)+((63&(o=e[r++]))<<12)+((63&(l=e[r++]))<<6)+(63&e[r++])-65536,i[n]=s(55296+(d>>10),56320+(1023&d)))}return i.join("")}function i(e,t,r){r=null==r||r<0?e.length:Math.min(r,e.length);var i=0,n=1,a=0;254===e[0]&&255===e[1]?(t=!0,i=2):255===e[0]&&254===e[1]&&(t=!1,i=2),t&&(n=0,a=1);for(var o,l,d,c,u=[],h=0;i<r&&(o=e[i+n],l=e[i+a],i+=2,0!==(d=(o<<8)+l));h++)o<216||o>=224?u[h]=s(d):(c=(e[i+n]<<8)+e[i+a],i+=2,u[h]=s(d,c));return u.join("")}function n(e,t){t=null==t||t<0?e.length:Math.min(t,e.length);for(var r=[],i=0;i<t;i++)r.push(s(e[i]));return r.join("")}Object.defineProperty(t,"__esModule",{value:!0});var s=String.fromCharCode;t.readBytesToUTF8=r,t.readBytesToUTF16=i,t.readBytesToISO8859=n,t.readBytesToString=function(e,t,s){return 0===t?n(e,s):3===t?r(e,s):1===t||2===t?i(e,void 0,s):null},t.getEndpointOfBytes=function(e,t,r){void 0===r&&(r=0);for(var i=0===t?function(t){return 0===e[t]}:function(t){return 0===e[t]&&0===e[t+1]},n=r;n<e.length&&!i(n);n++);return n},t.skipPaddingZeros=function(e,t){for(var r=t;0===e[r];r++)t++;return t}},502:(e,t,r)=>{"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();t.hasCookies=function(){var e=new c;try{e.setItem("__test","1");var t=e.getItem("__test");return e.removeItem("__test"),"1"===t}catch(r){return!1}};var a,o=r(1299),l=(a=o)&&a.__esModule?a:{default:a},d="lS_",c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this.cookieOptions=i({path:"/"},t),d=void 0===t.prefix?d:t.prefix}return s(e,[{key:"getItem",value:function(e){var t=l.default.parse(document.cookie);return t&&t.hasOwnProperty(d+e)?t[d+e]:null}},{key:"setItem",value:function(e,t){return document.cookie=l.default.serialize(d+e,t,this.cookieOptions),t}},{key:"removeItem",value:function(e){var t=i({},this.cookieOptions,{maxAge:-1});return document.cookie=l.default.serialize(d+e,"",t),null}},{key:"clear",value:function(){var e=l.default.parse(document.cookie);for(var t in e)0===t.indexOf(d)&&this.removeItem(t.substr(d.length));return null}}]),e}();t.default=c},4585:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._data={}}return r(e,[{key:"getItem",value:function(e){return this._data.hasOwnProperty(e)?this._data[e]:null}},{key:"setItem",value:function(e,t){return this._data[e]=String(t)}},{key:"removeItem",value:function(e){return delete this._data[e]}},{key:"clear",value:function(){return this._data={}}}]),e}();t.default=i},2741:(e,t,r)=>{"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n=i(r(1402)),s=i(r(502)),a=i(r(4585)),o=null;o=(0,n.default)("localStorage")?window.localStorage:(0,n.default)("sessionStorage")?window.sessionStorage:(0,n.default)("cookieStorage")?new s.default:new a.default,t.ZP=o,n.default,s.default,a.default},1402:(e,t,r)=>{"use strict";function i(e){try{var t=window[e];return t.setItem("__test","1"),t.removeItem("__test"),!0}catch(r){return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"localStorage",t=String(e).replace(/storage$/i,"").toLowerCase();if("local"===t)return i("localStorage");if("session"===t)return i("sessionStorage");if("cookie"===t)return(0,n.hasCookies)();if("memory"===t)return!0;throw new Error("Storage method `"+e+"` is not available.\n    Please use one of the following: localStorage, sessionStorage, cookieStorage, memoryStorage.")};var n=r(502)},8139:e=>{"use strict";e.exports=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){return e.__proto__=t,e}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(e,r)||(e[r]=t[r]);return e})},3741:function(e,t){!function(e){"use strict";function t(e,t){function n(t){for(var r=[];e[c];)if(e.charCodeAt(c)==p){if(e.charCodeAt(c+1)===g){var i=c+2;if(c=e.indexOf(">",c),-1==e.substring(i,c).indexOf(t)){var n=e.substring(0,c).split("\n");throw new Error("Unexpected close tag\nLine: "+(n.length-1)+"\nColumn: "+(n[n.length-1].length+1)+"\nChar: "+e[c])}return c+1&&(c+=1),r}if(e.charCodeAt(c+1)===v){if(e.charCodeAt(c+2)==m){const t=c;for(;-1!==c&&(e.charCodeAt(c)!==f||e.charCodeAt(c-1)!=m||e.charCodeAt(c-2)!=m||-1==c);)c=e.indexOf(">",c+1);-1===c&&(c=e.length),u&&r.push(e.substring(t,c+1))}else{if(e.charCodeAt(c+2)===S&&e.charCodeAt(c+8)===S&&"cdata"===e.substr(c+3,5).toLowerCase()){var a=e.indexOf("]]>",c);-1==a?(r.push(e.substr(c+9)),c=e.length):(r.push(e.substring(c+9,a)),c=a+3);continue}{const t=c+1;c+=2;for(var l=!1;(e.charCodeAt(c)!==f||!0===l)&&e[c];)e.charCodeAt(c)===S?l=!0:!0===l&&e.charCodeAt(c)===A&&(l=!1),c++;r.push(e.substring(t,c))}}c++;continue}var d=o();r.push(d),"?"===d.tagName[0]&&(r.push(...d.children),d.children=[])}else{var y=s();if(h)y.length>0&&r.push(y);else{var E=y.trim();E.length>0&&r.push(E)}c++}return r}function s(){var t=c;return-2===(c=e.indexOf("<",c)-1)&&(c=e.length),e.slice(t,c+1)}function a(){for(var t=c;-1==="\r\n\t>/= ".indexOf(e[c])&&e[c];)c++;return e.slice(t,c)}function o(){c++;const t=a(),r={};let i=[];for(;e.charCodeAt(c)!==f&&e[c];){var s=e.charCodeAt(c);if(s>64&&s<91||s>96&&s<123){for(var o=a(),d=e.charCodeAt(c);d&&d!==y&&d!==E&&!(d>64&&d<91||d>96&&d<123)&&d!==f;)c++,d=e.charCodeAt(c);if(d===y||d===E){var u=l();if(-1===c)return{tagName:t,attributes:r,children:i}}else u=null,c--;r[o]=u}c++}if(e.charCodeAt(c-1)!==g)if("script"==t){var h=c+1;c=e.indexOf("<\/script>",c),i=[e.slice(h,c)],c+=9}else"style"==t?(h=c+1,c=e.indexOf("</style>",c),i=[e.slice(h,c)],c+=8):-1===T.indexOf(t)?(c++,i=n(t)):c++;else c++;return{tagName:t,attributes:r,children:i}}function l(){var t=e[c],r=c+1;return c=e.indexOf(t,r),e.slice(r,c)}var d,c=(t=t||{}).pos||0,u=!!t.keepComments,h=!!t.keepWhitespace,p="<".charCodeAt(0),f=">".charCodeAt(0),m="-".charCodeAt(0),g="/".charCodeAt(0),v="!".charCodeAt(0),y="'".charCodeAt(0),E='"'.charCodeAt(0),S="[".charCodeAt(0),A="]".charCodeAt(0),T=t.noChildNodes||["img","br","input","meta","link","hr"],b=null;if(void 0!==t.attrValue)for(t.attrName=t.attrName||"id",b=[];-1!==(d=new RegExp("\\s"+t.attrName+"\\s*=['\"]"+t.attrValue+"['\"]").exec(e),c=d?d.index:-1);)-1!==(c=e.lastIndexOf("<",c))&&b.push(o()),e=e.substr(c),c=0;else b=t.parseNode?o():n("");return t.filter&&(b=i(b,t.filter)),t.simplify?r(Array.isArray(b)?b:[b]):(t.setPos&&(b.pos=c),b)}function r(e){var t={};if(!e.length)return"";if(1===e.length&&"string"==typeof e[0])return e[0];for(var i in e.forEach((function(e){if("object"==typeof e){t[e.tagName]||(t[e.tagName]=[]);var i=r(e.children);t[e.tagName].push(i),Object.keys(e.attributes).length&&"string"!=typeof i&&(i._attributes=e.attributes)}})),t)1==t[i].length&&(t[i]=t[i][0]);return t}function i(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n="");var s=[];return e.forEach((function(e,a){if("object"==typeof e&&t(e,a,r,n)&&s.push(e),e.children){var o=i(e.children,t,r+1,(n?n+".":"")+a+"."+e.tagName);s=s.concat(o)}})),s}e.filter=i,e.getElementById=function(e,r,i){var n=t(e,{attrValue:r});return i?tXml.simplify(n):n[0]},e.getElementsByClassName=function(e,r,i){const n=t(e,{attrName:"class",attrValue:"[a-zA-Z0-9- ]*"+r+"[a-zA-Z0-9- ]*"});return i?tXml.simplify(n):n},e.parse=t,e.simplify=r,e.simplifyLostLess=function e(t,r){void 0===r&&(r={});var i={};return t.length?1===t.length&&"string"==typeof t[0]?Object.keys(r).length?{_attributes:r,value:t[0]}:t[0]:(t.forEach((function(t){if("object"==typeof t){i[t.tagName]||(i[t.tagName]=[]);var r=e(t.children||[],t.attributes);i[t.tagName].push(r),Object.keys(t.attributes).length&&(r._attributes=t.attributes)}})),i):i},e.stringify=function(e){function t(e){if(e)for(var t=0;t<e.length;t++)"string"==typeof e[t]?i+=e[t].trim():r(e[t])}function r(e){for(var r in i+="<"+e.tagName,e.attributes)null===e.attributes[r]?i+=" "+r:-1===e.attributes[r].indexOf('"')?i+=" "+r+'="'+e.attributes[r].trim()+'"':i+=" "+r+"='"+e.attributes[r].trim()+"'";"?"!==e.tagName[0]?(i+=">",t(e.children),i+="</"+e.tagName+">"):i+="?>"}var i="";return t(e),i},e.toContentString=function e(t){if(Array.isArray(t)){var r="";return t.forEach((function(t){r=(r+=" "+e(t)).trim()})),r}return"object"==typeof t?e(t.children):" "+t},Object.defineProperty(e,"__esModule",{value:!0})}(t)},866:(e,t,r)=>{(t=e.exports=r(870)(!1)).push([e.id,"._20Eh5WL::-webkit-media-controls{display:none!important}._1ll4Zna::-webkit-media-controls-current-time-display,._1ll4Zna::-webkit-media-controls-time-remaining-display{visibility:hidden!important}._3D52tih::-webkit-media-controls-timeline{visibility:hidden!important}._2yNfXKt::-webkit-media-controls-toggle-closed-captions-button{display:none}",""]),t.locals={video_hiddenControls:"_20Eh5WL",videoHiddenControls:"_20Eh5WL",video_hiddenTime:"_1ll4Zna",videoHiddenTime:"_1ll4Zna",video_hiddenTimeline:"_3D52tih",videoHiddenTimeline:"_3D52tih",video_hiddenSubtitlesBtn:"_2yNfXKt",videoHiddenSubtitlesBtn:"_2yNfXKt"}},9840:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var i={};try{var n=(new EventTarget).constructor;class e extends n{}new e,i.EventTarget=(new EventTarget).constructor}catch(EventTarget){!function(e,t){function r(){t.set(this,a(null))}function n(e,t,r){o(e,t,{configurable:!0,writable:!0,value:r})}function s(e){var t=e.options;return t&&t.once&&e.target.removeEventListener(this.type,e.listener),"function"===typeof e.listener?e.listener.call(e.target,this):e.listener.handleEvent(this),this._stopImmediatePropagationFlag}var a=e.create,o=e.defineProperty,l=r.prototype;n(l,"addEventListener",(function(e,r,i){for(var n=t.get(this),s=n[e]||(n[e]=[]),a=0,o=s.length;a<o;a++)if(s[a].listener===r)return;s.push({target:this,listener:r,options:i})})),n(l,"dispatchEvent",(function(e){var r=t.get(this)[e.type];return r&&(n(e,"target",this),n(e,"currentTarget",this),r.slice(0).some(s,e),delete e.currentTarget,delete e.target),!0})),n(l,"removeEventListener",(function(e,r){for(var i=t.get(this),n=i[e]||(i[e]=[]),s=0,a=n.length;s<a;s++)if(n[s].listener===r)return void n.splice(s,1)})),i.EventTarget=r}(Object,new WeakMap)}const s=i.EventTarget}},r={};e.m=t,e.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},e.d=(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};e(9047)})();